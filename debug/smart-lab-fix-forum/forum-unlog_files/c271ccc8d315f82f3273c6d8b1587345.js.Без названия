// Automatic generation on 2021-06-11 16:01:54
var aRouter = new Array();
aRouter['error'] = '/error/';
aRouter['registration'] = '/registration/';
aRouter['profile'] = '/profile/';
aRouter['blog'] = '/blog/';
aRouter['top'] = '/top/';
aRouter['index'] = '/index/';
aRouter['topic'] = '/topic/';
aRouter['login'] = '/login/';
aRouter['people'] = '/people/';
aRouter['settings'] = '/settings/';
aRouter['tag'] = '/tag/';
aRouter['talk'] = '/talk/';
aRouter['allcomments'] = '/allcomments/';
aRouter['rss'] = '/rss/';
aRouter['link'] = '/link/';
aRouter['question'] = '/question/';
aRouter['blogs'] = '/blogs/';
aRouter['search'] = '/search/';
aRouter['admin'] = '/admin/';
aRouter['page'] = '/page/';
aRouter['allblog'] = '/allblog/';
aRouter['news'] = '/news/';
aRouter['allsignals'] = '/allsignals/';
aRouter['disclosure'] = '/disclosure/';
aRouter['votes'] = '/votes/';
aRouter['vopros'] = '/vopros/';
aRouter['pushes'] = '/pushes/';
aRouter['tags'] = '/tags/';
aRouter['flow'] = '/flow/';
aRouter['smm'] = '/smm/';
aRouter['zen'] = '/zen/';
aRouter['thisday'] = '/thisday/';
aRouter['print'] = '/print/';
aRouter['maintheme'] = '/maintheme/';
aRouter['my'] = '/my/';
aRouter['allvotes'] = '/allvotes/';
aRouter['money'] = '/money/';
aRouter['tradingreads'] = '/tradingreads/';
aRouter['friends'] = '/friends/';
aRouter['my-trading-account'] = '/my-trading-account/';
aRouter['user-trading-account'] = '/user-trading-account/';
aRouter['finansoviy-slovar'] = '/finansoviy-slovar/';
aRouter['forums'] = '/forums/';
aRouter['forum'] = '/forum/';
aRouter['kompanii'] = '/kompanii/';
aRouter['bonds'] = '/bonds/';
aRouter['banki'] = '/banki/';
aRouter['options'] = '/options/';
aRouter['algotrading'] = '/algotrading/';
aRouter['brokers-rating'] = '/brokers-rating/';
aRouter['brokers'] = '/brokers/';
aRouter['forex'] = '/forex/';
aRouter['trading-software'] = '/trading-software/';
aRouter['dividends'] = '/dividends/';
aRouter['trading'] = '/trading/';
aRouter['crypto'] = '/crypto/';
aRouter['chat'] = '/chat/';
aRouter['stocks'] = '/stocks/';
aRouter['company'] = '/company/';
aRouter['companytag'] = '/companytag/';
aRouter['panel'] = '/panel/';
aRouter['books'] = '/books/';
aRouter['review'] = '/review/';
aRouter['e'] = '/e/';
aRouter['g'] = '/g/';
aRouter['gr'] = '/gr/';
aRouter['q'] = '/q/';
aRouter['poll'] = '/poll/';
aRouter['consumer-confidence-russia'] = '/consumer-confidence-russia/';
aRouter['console'] = '/console/';
aRouter['oil'] = '/oil/';
aRouter['lchi2016'] = '/lchi2016/';
aRouter['lchi2017'] = '/lchi2017/';
aRouter['lchi2018'] = '/lchi2018/';
aRouter['lchi2019'] = '/lchi2019/';
aRouter['lchi2020'] = '/lchi2020/';
aRouter['summoner'] = '/summoner/';
aRouter['calendar'] = '/calendar/';
aRouter['stat'] = '/stat/';
aRouter['statx'] = '/statx/';
aRouter['favtop'] = '/favtop/';
aRouter['vtop'] = '/vtop/';
aRouter['smartlab-tv'] = '/smartlab-tv/';
aRouter['blacklist'] = '/blacklist/';
aRouter['abuse'] = '/abuse/';
aRouter['mobile'] = '/mobile/';
aRouter['read'] = '/read/';
aRouter['rest'] = '/rest/';
;
/**
 * JsHttpRequest: JavaScript "AJAX" data loader
 * Minimized version: see debug directory for the complete one.
 *
 * @license LGPL
 * @author Dmitry Koterov, http://en.dklab.ru/lib/JsHttpRequest/
 * @version 5.x $Id$
 */
function JsHttpRequest(){
var t=this;
t.onreadystatechange=null;
t.readyState=0;
t.responseText=null;
t.responseXML=null;
t.status=200;
t.statusText="OK";
t.responseJS=null;
t.caching=false;
t.loader=null;
t.session_name="PHPSESSID";
t._ldObj=null;
t._reqHeaders=[];
t._openArgs=null;
t._errors={inv_form_el:"Invalid FORM element detected: name=%, tag=%",must_be_single_el:"If used, <form> must be a single HTML element in the list.",js_invalid:"JavaScript code generated by backend is invalid!\n%",url_too_long:"Cannot use so long query with GET request (URL is larger than % bytes)",unk_loader:"Unknown loader: %",no_loaders:"No loaders registered at all, please check JsHttpRequest.LOADERS array",no_loader_matched:"Cannot find a loader which may process the request. Notices are:\n%"};
t.abort=function(){
with(this){
if(_ldObj&&_ldObj.abort){
_ldObj.abort();
}
_cleanup();
if(readyState==0){
return;
}
if(readyState==1&&!_ldObj){
readyState=0;
return;
}
_changeReadyState(4,true);
}
};
t.open=function(_2,_3,_4,_5,_6){
with(this){
if(_3.match(/^((\w+)\.)?(GET|POST)\s+(.*)/i)){
this.loader=RegExp.$2?RegExp.$2:null;
_2=RegExp.$3;
_3=RegExp.$4;
}
try{
if(document.location.search.match(new RegExp("[&?]"+session_name+"=([^&?]*)"))||document.cookie.match(new RegExp("(?:;|^)\\s*"+session_name+"=([^;]*)"))){
_3+=(_3.indexOf("?")>=0?"&":"?")+session_name+"="+this.escape(RegExp.$1);
}
}
catch(e){
}
_openArgs={method:(_2||"").toUpperCase(),url:_3,asyncFlag:_4,username:_5!=null?_5:"",password:_6!=null?_6:""};
_ldObj=null;
_changeReadyState(1,true);
return true;
}
};
t.send=function(_7){
if(!this.readyState){
return;
}
this._changeReadyState(1,true);
this._ldObj=null;
var _8=[];
var _9=[];
if(!this._hash2query(_7,null,_8,_9)){
return;
}
var _a=null;
if(this.caching&&!_9.length){
_a=this._openArgs.username+":"+this._openArgs.password+"@"+this._openArgs.url+"|"+_8+"#"+this._openArgs.method;
var _b=JsHttpRequest.CACHE[_a];
if(_b){
this._dataReady(_b[0],_b[1]);
return false;
}
}
var _c=(this.loader||"").toLowerCase();
if(_c&&!JsHttpRequest.LOADERS[_c]){
return this._error("unk_loader",_c);
}
var _d=[];
var _e=JsHttpRequest.LOADERS;
for(var _f in _e){
var ldr=_e[_f].loader;
if(!ldr){
continue;
}
if(_c&&_f!=_c){
continue;
}
var _11=new ldr(this);
JsHttpRequest.extend(_11,this._openArgs);
JsHttpRequest.extend(_11,{queryText:_8.join("&"),queryElem:_9,id:(new Date().getTime())+""+JsHttpRequest.COUNT++,hash:_a,span:null});
var _12=_11.load();
if(!_12){
this._ldObj=_11;
JsHttpRequest.PENDING[_11.id]=this;
return true;
}
if(!_c){
_d[_d.length]="- "+_f.toUpperCase()+": "+this._l(_12);
}else{
return this._error(_12);
}
}
return _f?this._error("no_loader_matched",_d.join("\n")):this._error("no_loaders");
};
t.getAllResponseHeaders=function(){
with(this){
return _ldObj&&_ldObj.getAllResponseHeaders?_ldObj.getAllResponseHeaders():[];
}
};
t.getResponseHeader=function(_13){
with(this){
return _ldObj&&_ldObj.getResponseHeader?_ldObj.getResponseHeader(_13):null;
}
};
t.setRequestHeader=function(_14,_15){
with(this){
_reqHeaders[_reqHeaders.length]=[_14,_15];
}
};
t._dataReady=function(_16,js){
with(this){
if(caching&&_ldObj){
JsHttpRequest.CACHE[_ldObj.hash]=[_16,js];
}
responseText=responseXML=_16;
responseJS=js;
if(js!==null){
status=200;
statusText="OK";
}else{
status=500;
statusText="Internal Server Error";
}
_changeReadyState(2);
_changeReadyState(3);
_changeReadyState(4);
_cleanup();
}
};
t._l=function(_18){
var i=0,p=0,msg=this._errors[_18[0]];
while((p=msg.indexOf("%",p))>=0){
var a=_18[++i]+"";
msg=msg.substring(0,p)+a+msg.substring(p+1,msg.length);
p+=1+a.length;
}
return msg;
};
t._error=function(msg){
msg=this._l(typeof (msg)=="string"?arguments:msg);
msg="JsHttpRequest: "+msg;
if(!window.Error){
throw msg;
}else{
if((new Error(1,"test")).description=="test"){
throw new Error(1,msg);
}else{
throw new Error(msg);
}
}
};
t._hash2query=function(_1e,_1f,_20,_21){
if(_1f==null){
_1f="";
}
if((""+typeof (_1e)).toLowerCase()=="object"){
var _22=false;
if(_1e&&_1e.parentNode&&_1e.parentNode.appendChild&&_1e.tagName&&_1e.tagName.toUpperCase()=="FORM"){
_1e={form:_1e};
}
for(var k in _1e){
var v=_1e[k];
if(v instanceof Function){
continue;
}
var _25=_1f?_1f+"["+this.escape(k)+"]":this.escape(k);
var _26=v&&v.parentNode&&v.parentNode.appendChild&&v.tagName;
if(_26){
var tn=v.tagName.toUpperCase();
if(tn=="FORM"){
_22=true;
}else{
if(tn=="INPUT"||tn=="TEXTAREA"||tn=="SELECT"){
}else{
return this._error("inv_form_el",(v.name||""),v.tagName);
}
}
_21[_21.length]={name:_25,e:v};
}else{
if(v instanceof Object){
this._hash2query(v,_25,_20,_21);
}else{
if(v===null){
continue;
}
if(v===true){
v=1;
}
if(v===false){
v="";
}
_20[_20.length]=_25+"="+this.escape(""+v);
}
}
if(_22&&_21.length>1){
return this._error("must_be_single_el");
}
}
}else{
_20[_20.length]=_1e;
}
return true;
};
t._cleanup=function(){
var _28=this._ldObj;
if(!_28){
return;
}
JsHttpRequest.PENDING[_28.id]=false;
var _29=_28.span;
if(!_29){
return;
}
_28.span=null;
var _2a=function(){
_29.parentNode.removeChild(_29);
};
JsHttpRequest.setTimeout(_2a,50);
};
t._changeReadyState=function(s,_2c){
with(this){
if(_2c){
status=statusText=responseJS=null;
responseText="";
}
readyState=s;
if(onreadystatechange){
onreadystatechange();
}
}
};
t.escape=function(s){
return escape(s).replace(new RegExp("\\+","g"),"%2B");
};
}
JsHttpRequest.COUNT=0;
JsHttpRequest.MAX_URL_LEN=2000;
JsHttpRequest.CACHE={};
JsHttpRequest.PENDING={};
JsHttpRequest.LOADERS={};
JsHttpRequest._dummy=function(){
};
JsHttpRequest.TIMEOUTS={s:window.setTimeout,c:window.clearTimeout};
JsHttpRequest.setTimeout=function(_2e,dt){
window.JsHttpRequest_tmp=JsHttpRequest.TIMEOUTS.s;
if(typeof (_2e)=="string"){
id=window.JsHttpRequest_tmp(_2e,dt);
}else{
var id=null;
var _31=function(){
_2e();
delete JsHttpRequest.TIMEOUTS[id];
};
id=window.JsHttpRequest_tmp(_31,dt);
JsHttpRequest.TIMEOUTS[id]=_31;
}
window.JsHttpRequest_tmp=null;
return id;
};
JsHttpRequest.clearTimeout=function(id){
window.JsHttpRequest_tmp=JsHttpRequest.TIMEOUTS.c;
delete JsHttpRequest.TIMEOUTS[id];
var r=window.JsHttpRequest_tmp(id);
window.JsHttpRequest_tmp=null;
return r;
};
JsHttpRequest.query=function(url,_35,_36,_37){
var req=new this();
req.caching=!_37;
req.onreadystatechange=function(){
if(req.readyState==4){
_36(req.responseJS,req.responseText);
}
};
req.open(null,url,true);
req.send(_35);
};
JsHttpRequest.dataReady=function(d){
var th=this.PENDING[d.id];
delete this.PENDING[d.id];
if(th){
th._dataReady(d.text,d.js);
}else{
if(th!==false){
throw "dataReady(): unknown pending id: "+d.id;
}
}
};
JsHttpRequest.extend=function(_3b,src){
for(var k in src){
_3b[k]=src[k];
}
};
JsHttpRequest.LOADERS.xml={loader:function(req){
JsHttpRequest.extend(req._errors,{xml_no:"Cannot use XMLHttpRequest or ActiveX loader: not supported",xml_no_diffdom:"Cannot use XMLHttpRequest to load data from different domain %",xml_no_headers:"Cannot use XMLHttpRequest loader or ActiveX loader, POST method: headers setting is not supported, needed to work with encodings correctly",xml_no_form_upl:"Cannot use XMLHttpRequest loader: direct form elements using and uploading are not implemented"});
this.load=function(){
if(this.queryElem.length){
return ["xml_no_form_upl"];
}
if(this.url.match(new RegExp("^([a-z]+://[^\\/]+)(.*)","i"))){
if(RegExp.$1.toLowerCase()!=document.location.protocol+"//"+document.location.hostname.toLowerCase()){
return ["xml_no_diffdom",RegExp.$1];
}
}
var xr=null;
if(window.XMLHttpRequest){
try{
xr=new XMLHttpRequest();
}
catch(e){
}
}else{
if(window.ActiveXObject){
try{
xr=new ActiveXObject("Microsoft.XMLHTTP");
}
catch(e){
}
if(!xr){
try{
xr=new ActiveXObject("Msxml2.XMLHTTP");
}
catch(e){
}
}
}
}
if(!xr){
return ["xml_no"];
}
var _40=window.ActiveXObject||xr.setRequestHeader;
if(!this.method){
this.method=_40&&this.queryText.length?"POST":"GET";
}
if(this.method=="GET"){
if(this.queryText){
this.url+=(this.url.indexOf("?")>=0?"&":"?")+this.queryText;
}
this.queryText="";
if(this.url.length>JsHttpRequest.MAX_URL_LEN){
return ["url_too_long",JsHttpRequest.MAX_URL_LEN];
}
}else{
if(this.method=="POST"&&!_40){
return ["xml_no_headers"];
}
}
this.url+=(this.url.indexOf("?")>=0?"&":"?")+"JsHttpRequest="+(req.caching?"0":this.id)+"-xml";
var id=this.id;
xr.onreadystatechange=function(){
if(xr.readyState!=4){
return;
}
xr.onreadystatechange=JsHttpRequest._dummy;
req.status=null;
try{
req.status=xr.status;
req.responseText=xr.responseText;
}
catch(e){
}
if(!req.status){
return;
}
try{
eval("JsHttpRequest._tmp = function(id) { var d = "+req.responseText+"; d.id = id; JsHttpRequest.dataReady(d); }");
}
catch(e){
return req._error("js_invalid",req.responseText);
}
JsHttpRequest._tmp(id);
JsHttpRequest._tmp=null;
};
xr.open(this.method,this.url,true,this.username,this.password);
if(_40){
for(var i=0;i<req._reqHeaders.length;i++){
xr.setRequestHeader(req._reqHeaders[i][0],req._reqHeaders[i][1]);
}
xr.setRequestHeader("Content-Type","application/octet-stream");
}
xr.send(this.queryText);
this.span=null;
this.xr=xr;
return null;
};
this.getAllResponseHeaders=function(){
return this.xr.getAllResponseHeaders();
};
this.getResponseHeader=function(_43){
return this.xr.getResponseHeader(_43);
};
this.abort=function(){
this.xr.abort();
this.xr=null;
};
}};
JsHttpRequest.LOADERS.script={loader:function(req){
JsHttpRequest.extend(req._errors,{script_only_get:"Cannot use SCRIPT loader: it supports only GET method",script_no_form:"Cannot use SCRIPT loader: direct form elements using and uploading are not implemented"});
this.load=function(){
if(this.queryText){
this.url+=(this.url.indexOf("?")>=0?"&":"?")+this.queryText;
}
this.url+=(this.url.indexOf("?")>=0?"&":"?")+"JsHttpRequest="+this.id+"-"+"script";
this.queryText="";
if(!this.method){
this.method="GET";
}
if(this.method!=="GET"){
return ["script_only_get"];
}
if(this.queryElem.length){
return ["script_no_form"];
}
if(this.url.length>JsHttpRequest.MAX_URL_LEN){
return ["url_too_long",JsHttpRequest.MAX_URL_LEN];
}
var th=this,d=document,s=null,b=d.body;
if(!window.opera){
this.span=s=d.createElement("SCRIPT");
var _49=function(){
s.language="JavaScript";
if(s.setAttribute){
s.setAttribute("src",th.url);
}else{
s.src=th.url;
}
b.insertBefore(s,b.lastChild);
};
}else{
this.span=s=d.createElement("SPAN");
s.style.display="none";
b.insertBefore(s,b.lastChild);
s.innerHTML="Workaround for IE.<s"+"cript></"+"script>";
var _49=function(){
s=s.getElementsByTagName("SCRIPT")[0];
s.language="JavaScript";
if(s.setAttribute){
s.setAttribute("src",th.url);
}else{
s.src=th.url;
}
};
}
JsHttpRequest.setTimeout(_49,10);
return null;
};
}};
JsHttpRequest.LOADERS.form={loader:function(req){
JsHttpRequest.extend(req._errors,{form_el_not_belong:"Element \"%\" does not belong to any form!",form_el_belong_diff:"Element \"%\" belongs to a different form. All elements must belong to the same form!",form_el_inv_enctype:"Attribute \"enctype\" of the form must be \"%\" (for IE), \"%\" given."});
this.load=function(){
var th=this;
if(!th.method){
th.method="POST";
}
th.url+=(th.url.indexOf("?")>=0?"&":"?")+"JsHttpRequest="+th.id+"-"+"form";
if(th.method=="GET"){
if(th.queryText){
th.url+=(th.url.indexOf("?")>=0?"&":"?")+th.queryText;
}
if(th.url.length>JsHttpRequest.MAX_URL_LEN){
return ["url_too_long",JsHttpRequest.MAX_URL_LEN];
}
var p=th.url.split("?",2);
th.url=p[0];
th.queryText=p[1]||"";
}
var _4d=null;
var _4e=false;
if(th.queryElem.length){
if(th.queryElem[0].e.tagName.toUpperCase()=="FORM"){
_4d=th.queryElem[0].e;
_4e=true;
th.queryElem=[];
}else{
_4d=th.queryElem[0].e.form;
for(var i=0;i<th.queryElem.length;i++){
var e=th.queryElem[i].e;
if(!e.form){
return ["form_el_not_belong",e.name];
}
if(e.form!=_4d){
return ["form_el_belong_diff",e.name];
}
}
}
if(th.method=="POST"){
var _51="multipart/form-data";
var _52=(_4d.attributes.encType&&_4d.attributes.encType.nodeValue)||(_4d.attributes.enctype&&_4d.attributes.enctype.value)||_4d.enctype;
if(_52!=_51){
return ["form_el_inv_enctype",_51,_52];
}
}
}
var d=_4d&&(_4d.ownerDocument||_4d.document)||document;
var _54="jshr_i_"+th.id;
var s=th.span=d.createElement("DIV");
s.style.position="absolute";
s.style.display="none";
s.style.visibility="hidden";
s.innerHTML=(_4d?"":"<form"+(th.method=="POST"?" enctype=\"multipart/form-data\" method=\"post\"":"")+"></form>")+"<iframe name=\""+_54+"\" id=\""+_54+"\" style=\"width:0px; height:0px; overflow:hidden; border:none\"></iframe>";
if(!_4d){
_4d=th.span.firstChild;
}
d.body.insertBefore(s,d.body.lastChild);
var _56=function(e,_58){
var sv=[];
var _5a=e;
if(e.mergeAttributes){
var _5a=d.createElement("form");
_5a.mergeAttributes(e,false);
}
for(var i=0;i<_58.length;i++){
var k=_58[i][0],v=_58[i][1];
sv[sv.length]=[k,_5a.getAttribute(k)];
_5a.setAttribute(k,v);
}
if(e.mergeAttributes){
e.mergeAttributes(_5a,false);
}
return sv;
};
var _5e=function(){
top.JsHttpRequestGlobal=JsHttpRequest;
var _5f=[];
if(!_4e){
for(var i=0,n=_4d.elements.length;i<n;i++){
_5f[i]=_4d.elements[i].name;
_4d.elements[i].name="";
}
}
var qt=th.queryText.split("&");
for(var i=qt.length-1;i>=0;i--){
var _63=qt[i].split("=",2);
var e=d.createElement("INPUT");
e.type="hidden";
e.name=unescape(_63[0]);
e.value=_63[1]!=null?unescape(_63[1]):"";
_4d.appendChild(e);
}
for(var i=0;i<th.queryElem.length;i++){
th.queryElem[i].e.name=th.queryElem[i].name;
}
var sv=_56(_4d,[["action",th.url],["method",th.method],["onsubmit",null],["target",_54]]);
_4d.submit();
_56(_4d,sv);
for(var i=0;i<qt.length;i++){
_4d.lastChild.parentNode.removeChild(_4d.lastChild);
}
if(!_4e){
for(var i=0,n=_4d.elements.length;i<n;i++){
_4d.elements[i].name=_5f[i];
}
}
};
JsHttpRequest.setTimeout(_5e,100);
return null;
};
}};

;
/*! jQuery v3.6.0 | (c) OpenJS Foundation and other contributors | jquery.org/license */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(C,e){"use strict";var t=[],r=Object.getPrototypeOf,s=t.slice,g=t.flat?function(e){return t.flat.call(e)}:function(e){return t.concat.apply([],e)},u=t.push,i=t.indexOf,n={},o=n.toString,v=n.hasOwnProperty,a=v.toString,l=a.call(Object),y={},m=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},x=function(e){return null!=e&&e===e.window},E=C.document,c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||E).createElement("script");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[o.call(e)]||"object":typeof e}var f="3.6.0",S=function(e,t){return new S.fn.init(e,t)};function p(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!m(e)&&!x(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}S.fn=S.prototype={jquery:f,constructor:S,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=S.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return S.each(this,e)},map:function(n){return this.pushStack(S.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(S.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(S.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},S.extend=S.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||m(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(S.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||S.isPlainObject(n)?n:{},i=!1,a[t]=S.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},S.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==o.call(e))&&(!(t=r(e))||"function"==typeof(n=v.call(t,"constructor")&&t.constructor)&&a.call(n)===l)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(p(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(p(Object(e))?S.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(p(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:y}),"function"==typeof Symbol&&(S.fn[Symbol.iterator]=t[Symbol.iterator]),S.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var d=function(n){var e,d,b,o,i,h,f,g,w,u,l,T,C,a,E,v,s,c,y,S="sizzle"+1*new Date,p=n.document,k=0,r=0,m=ue(),x=ue(),A=ue(),N=ue(),j=function(e,t){return e===t&&(l=!0),0},D={}.hasOwnProperty,t=[],q=t.pop,L=t.push,H=t.push,O=t.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",I="(?:\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",W="\\["+M+"*("+I+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+M+"*\\]",F=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",B=new RegExp(M+"+","g"),$=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=new RegExp("^"+M+"*,"+M+"*"),z=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"|>"),X=new RegExp(F),V=new RegExp("^"+I+"$"),G={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){T()},ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{H.apply(t=O.call(p.childNodes),p.childNodes),t[p.childNodes.length].nodeType}catch(e){H={apply:t.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function se(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(T(e),e=e||C,E)){if(11!==p&&(u=Z.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&y(e,a)&&a.id===i)return n.push(a),n}else{if(u[2])return H.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&d.getElementsByClassName&&e.getElementsByClassName)return H.apply(n,e.getElementsByClassName(i)),n}if(d.qsa&&!N[t+" "]&&(!v||!v.test(t))&&(1!==p||"object"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===p&&(U.test(t)||z.test(t))){(f=ee.test(t)&&ye(e.parentNode)||e)===e&&d.scope||((s=e.getAttribute("id"))?s=s.replace(re,ie):e.setAttribute("id",s=S)),o=(l=h(t)).length;while(o--)l[o]=(s?"#"+s:":scope")+" "+xe(l[o]);c=l.join(",")}try{return H.apply(n,f.querySelectorAll(c)),n}catch(e){N(t,!0)}finally{s===S&&e.removeAttribute("id")}}}return g(t.replace($,"$1"),e,n,r)}function ue(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function le(e){return e[S]=!0,e}function ce(e){var t=C.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){var n=e.split("|"),r=n.length;while(r--)b.attrHandle[n[r]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function de(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function he(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}function ge(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ve(a){return le(function(o){return o=+o,le(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ye(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}for(e in d=se.support={},i=se.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},T=se.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:p;return r!=C&&9===r.nodeType&&r.documentElement&&(a=(C=r).documentElement,E=!i(C),p!=C&&(n=C.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",oe,!1):n.attachEvent&&n.attachEvent("onunload",oe)),d.scope=ce(function(e){return a.appendChild(e).appendChild(C.createElement("div")),"undefined"!=typeof e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),d.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),d.getElementsByTagName=ce(function(e){return e.appendChild(C.createComment("")),!e.getElementsByTagName("*").length}),d.getElementsByClassName=K.test(C.getElementsByClassName),d.getById=ce(function(e){return a.appendChild(e).id=S,!C.getElementsByName||!C.getElementsByName(S).length}),d.getById?(b.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(te,ne);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=d.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):d.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},b.find.CLASS=d.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&E)return t.getElementsByClassName(e)},s=[],v=[],(d.qsa=K.test(C.querySelectorAll))&&(ce(function(e){var t;a.appendChild(e).innerHTML="<a id='"+S+"'></a><select id='"+S+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+S+"-]").length||v.push("~="),(t=C.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||v.push("\\["+M+"*name"+M+"*="+M+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+S+"+*").length||v.push(".#.+[+~]"),e.querySelectorAll("\\\f"),v.push("[\\r\\n\\f]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=C.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(d.matchesSelector=K.test(c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ce(function(e){d.disconnectedMatch=c.call(e,"*"),c.call(e,"[s!='']:x"),s.push("!=",F)}),v=v.length&&new RegExp(v.join("|")),s=s.length&&new RegExp(s.join("|")),t=K.test(a.compareDocumentPosition),y=t||K.test(a.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},j=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!d.sortDetached&&t.compareDocumentPosition(e)===n?e==C||e.ownerDocument==p&&y(p,e)?-1:t==C||t.ownerDocument==p&&y(p,t)?1:u?P(u,e)-P(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e==C?-1:t==C?1:i?-1:o?1:u?P(u,e)-P(u,t):0;if(i===o)return pe(e,t);n=e;while(n=n.parentNode)a.unshift(n);n=t;while(n=n.parentNode)s.unshift(n);while(a[r]===s[r])r++;return r?pe(a[r],s[r]):a[r]==p?-1:s[r]==p?1:0}),C},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(T(e),d.matchesSelector&&E&&!N[t+" "]&&(!s||!s.test(t))&&(!v||!v.test(t)))try{var n=c.call(e,t);if(n||d.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){N(t,!0)}return 0<se(t,C,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!=C&&T(e),y(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=C&&T(e);var n=b.attrHandle[t.toLowerCase()],r=n&&D.call(b.attrHandle,t.toLowerCase())?n(e,t,!E):void 0;return void 0!==r?r:d.attributes||!E?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!d.detectDuplicates,u=!d.sortStable&&e.slice(0),e.sort(j),l){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else while(t=e[r++])n+=o(t);return n},(b=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=h(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=m[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&m(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=se.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(B," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(h,e,t,g,v){var y="nth"!==h.slice(0,3),m="last"!==h.slice(-4),x="of-type"===e;return 1===g&&0===v?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=y!==m?"nextSibling":"previousSibling",c=e.parentNode,f=x&&e.nodeName.toLowerCase(),p=!n&&!x,d=!1;if(c){if(y){while(l){a=e;while(a=a[l])if(x?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l="only"===h&&!u&&"nextSibling"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&p){d=(s=(r=(i=(o=(a=c)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1])&&r[2],a=s&&c.childNodes[s];while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if(1===a.nodeType&&++d&&a===e){i[h]=[k,s,d];break}}else if(p&&(d=s=(r=(i=(o=(a=e)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1]),!1===d)while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if((x?a.nodeName.toLowerCase()===f:1===a.nodeType)&&++d&&(p&&((i=(o=a[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[k,d]),a===e))break;return(d-=v)===g||d%g==0&&0<=d/g}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[S]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=P(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=f(e.replace($,"$1"));return s[S]?le(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(te,ne),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return V.test(n||"")||se.error("unsupported lang: "+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=E?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,n){return[n<0?n+t:n]}),even:ve(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ve(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ve(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:ve(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=de(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=he(e);function me(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function be(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&"parentNode"===c,p=r++;return e.first?function(e,t,n){while(e=e[u])if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var r,i,o,a=[k,p];if(n){while(e=e[u])if((1===e.nodeType||f)&&s(e,t,n))return!0}else while(e=e[u])if(1===e.nodeType||f)if(i=(o=e[S]||(e[S]={}))[e.uniqueID]||(o[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===k&&r[1]===p)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function we(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ce(d,h,g,v,y,e){return v&&!v[S]&&(v=Ce(v)),y&&!y[S]&&(y=Ce(y,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),f=!d||!e&&h?c:Te(c,s,d,n,r),p=g?y||(e?d:l||v)?[]:t:f;if(g&&g(f,p,n,r),v){i=Te(p,u),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(p[u[o]]=!(f[u[o]]=a))}if(e){if(y||d){if(y){i=[],o=p.length;while(o--)(a=p[o])&&i.push(f[o]=a);y(null,p=[],i,r)}o=p.length;while(o--)(a=p[o])&&-1<(i=y?P(e,a):s[o])&&(e[i]=!(t[i]=a))}}else p=Te(p===t?p.splice(l,p.length):p),y?y(null,t,p,r):H.apply(t,p)})}function Ee(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=be(function(e){return e===i},a,!0),l=be(function(e){return-1<P(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!==w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[be(we(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return Ce(1<s&&we(c),1<s&&xe(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace($,"$1"),t,s<n&&Ee(e.slice(s,n)),n<r&&Ee(e=e.slice(n)),n<r&&xe(e))}c.push(t)}return we(c)}return me.prototype=b.filters=b.pseudos,b.setFilters=new me,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=x[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=_.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=z.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace($," ")}),a=a.slice(n.length)),b.filter)!(r=G[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):x(e,s).slice(0)},f=se.compile=function(e,t){var n,v,y,m,x,r,i=[],o=[],a=A[e+" "];if(!a){t||(t=h(e)),n=t.length;while(n--)(a=Ee(t[n]))[S]?i.push(a):o.push(a);(a=A(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=k+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==C||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==C||(T(o),n=!E);while(s=v[a++])if(s(o,t||C,n)){r.push(o);break}i&&(k=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=q.call(r));f=Te(f)}H.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&se.uniqueSort(r)}return i&&(k=h,w=p),c},m?le(r):r))).selector=e}return a},g=se.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&E&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(te,ne),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=G.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(te,ne),ee.test(o[0].type)&&ye(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&xe(o)))return H.apply(n,r),n;break}}}return(l||f(e,c))(r,t,!E,n,!t||ee.test(e)&&ye(t.parentNode)||t),n},d.sortStable=S.split("").sort(j).join("")===S,d.detectDuplicates=!!l,T(),d.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(C.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),d.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(C);S.find=d,S.expr=d.selectors,S.expr[":"]=S.expr.pseudos,S.uniqueSort=S.unique=d.uniqueSort,S.text=d.getText,S.isXMLDoc=d.isXML,S.contains=d.contains,S.escapeSelector=d.escape;var h=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&S(e).is(n))break;r.push(e)}return r},T=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},k=S.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var N=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,n,r){return m(n)?S.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?S.grep(e,function(e){return e===n!==r}):"string"!=typeof n?S.grep(e,function(e){return-1<i.call(n,e)!==r}):S.filter(n,e,r)}S.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?S.find.matchesSelector(r,e)?[r]:[]:S.find.matches(e,S.grep(t,function(e){return 1===e.nodeType}))},S.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(S(e).filter(function(){for(t=0;t<r;t++)if(S.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)S.find(e,i[t],n);return 1<r?S.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&k.test(e)?S(e):e||[],!1).length}});var D,q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(S.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||D,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:q.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof S?t[0]:t,S.merge(this,S.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:E,!0)),N.test(r[1])&&S.isPlainObject(t))for(r in t)m(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=E.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):m(e)?void 0!==n.ready?n.ready(e):e(S):S.makeArray(e,this)}).prototype=S.fn,D=S(E);var L=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function O(e,t){while((e=e[t])&&1!==e.nodeType);return e}S.fn.extend({has:function(e){var t=S(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(S.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&S(e);if(!k.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&S.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?S.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(S(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(S.uniqueSort(S.merge(this.get(),S(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),S.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return h(e,"parentNode")},parentsUntil:function(e,t,n){return h(e,"parentNode",n)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return h(e,"nextSibling")},prevAll:function(e){return h(e,"previousSibling")},nextUntil:function(e,t,n){return h(e,"nextSibling",n)},prevUntil:function(e,t,n){return h(e,"previousSibling",n)},siblings:function(e){return T((e.parentNode||{}).firstChild,e)},children:function(e){return T(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(A(e,"template")&&(e=e.content||e),S.merge([],e.childNodes))}},function(r,i){S.fn[r]=function(e,t){var n=S.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=S.filter(t,n)),1<this.length&&(H[r]||S.uniqueSort(n),L.test(r)&&n.reverse()),this.pushStack(n)}});var P=/[^\x20\t\r\n\f]+/g;function R(e){return e}function M(e){throw e}function I(e,t,n,r){var i;try{e&&m(i=e.promise)?i.call(e).done(t).fail(n):e&&m(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}S.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},S.each(e.match(P)||[],function(e,t){n[t]=!0}),n):S.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){S.each(e,function(e,t){m(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==w(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return S.each(arguments,function(e,t){var n;while(-1<(n=S.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<S.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},S.extend({Deferred:function(e){var o=[["notify","progress",S.Callbacks("memory"),S.Callbacks("memory"),2],["resolve","done",S.Callbacks("once memory"),S.Callbacks("once memory"),0,"resolved"],["reject","fail",S.Callbacks("once memory"),S.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return S.Deferred(function(r){S.each(o,function(e,t){var n=m(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&m(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,m(t)?s?t.call(e,l(u,o,R,s),l(u,o,M,s)):(u++,t.call(e,l(u,o,R,s),l(u,o,M,s),l(u,o,R,o.notifyWith))):(a!==R&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){S.Deferred.exceptionHook&&S.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==M&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(S.Deferred.getStackHook&&(t.stackTrace=S.Deferred.getStackHook()),C.setTimeout(t))}}return S.Deferred(function(e){o[0][3].add(l(0,e,m(r)?r:R,e.notifyWith)),o[1][3].add(l(0,e,m(t)?t:R)),o[2][3].add(l(0,e,m(n)?n:M))}).promise()},promise:function(e){return null!=e?S.extend(e,a):a}},s={};return S.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=s.call(arguments),o=S.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(I(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||m(i[t]&&i[t].then)))return o.then();while(t--)I(i[t],a(t),o.reject);return o.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;S.Deferred.exceptionHook=function(e,t){C.console&&C.console.warn&&e&&W.test(e.name)&&C.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},S.readyException=function(e){C.setTimeout(function(){throw e})};var F=S.Deferred();function B(){E.removeEventListener("DOMContentLoaded",B),C.removeEventListener("load",B),S.ready()}S.fn.ready=function(e){return F.then(e)["catch"](function(e){S.readyException(e)}),this},S.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--S.readyWait:S.isReady)||(S.isReady=!0)!==e&&0<--S.readyWait||F.resolveWith(E,[S])}}),S.ready.then=F.then,"complete"===E.readyState||"loading"!==E.readyState&&!E.documentElement.doScroll?C.setTimeout(S.ready):(E.addEventListener("DOMContentLoaded",B),C.addEventListener("load",B));var $=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===w(n))for(s in i=!0,n)$(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,m(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(S(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},_=/^-ms-/,z=/-([a-z])/g;function U(e,t){return t.toUpperCase()}function X(e){return e.replace(_,"ms-").replace(z,U)}var V=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function G(){this.expando=S.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t={},V(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[X(t)]=n;else for(r in t)i[X(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(X):(t=X(t))in r?[t]:t.match(P)||[]).length;while(n--)delete r[t[n]]}(void 0===t||S.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!S.isEmptyObject(t)}};var Y=new G,Q=new G,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,K=/[A-Z]/g;function Z(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(K,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:J.test(i)?JSON.parse(i):i)}catch(e){}Q.set(e,t,n)}else n=void 0;return n}S.extend({hasData:function(e){return Q.hasData(e)||Y.hasData(e)},data:function(e,t,n){return Q.access(e,t,n)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,n){return Y.access(e,t,n)},_removeData:function(e,t){Y.remove(e,t)}}),S.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=Q.get(o),1===o.nodeType&&!Y.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=X(r.slice(5)),Z(o,r,i[r]));Y.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){Q.set(this,n)}):$(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=Q.get(o,n))?t:void 0!==(t=Z(o,n))?t:void 0;this.each(function(){Q.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){Q.remove(this,e)})}}),S.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Y.get(e,t),n&&(!r||Array.isArray(n)?r=Y.access(e,t,S.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=S.queue(e,t),r=n.length,i=n.shift(),o=S._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){S.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Y.get(e,n)||Y.access(e,n,{empty:S.Callbacks("once memory").add(function(){Y.remove(e,[t+"queue",n])})})}}),S.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?S.queue(this[0],t):void 0===n?this:this.each(function(){var e=S.queue(this,t,n);S._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&S.dequeue(this,t)})},dequeue:function(e){return this.each(function(){S.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=S.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=Y.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var ee=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,te=new RegExp("^(?:([+-])=|)("+ee+")([a-z%]*)$","i"),ne=["Top","Right","Bottom","Left"],re=E.documentElement,ie=function(e){return S.contains(e.ownerDocument,e)},oe={composed:!0};re.getRootNode&&(ie=function(e){return S.contains(e.ownerDocument,e)||e.getRootNode(oe)===e.ownerDocument});var ae=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ie(e)&&"none"===S.css(e,"display")};function se(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return S.css(e,t,"")},u=s(),l=n&&n[3]||(S.cssNumber[t]?"":"px"),c=e.nodeType&&(S.cssNumber[t]||"px"!==l&&+u)&&te.exec(S.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)S.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,S.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ue={};function le(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=Y.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ae(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ue[s])||(o=a.body.appendChild(a.createElement(s)),u=S.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ue[s]=u)))):"none"!==n&&(l[c]="none",Y.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}S.fn.extend({show:function(){return le(this,!0)},hide:function(){return le(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?S(this).show():S(this).hide()})}});var ce,fe,pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i;ce=E.createDocumentFragment().appendChild(E.createElement("div")),(fe=E.createElement("input")).setAttribute("type","radio"),fe.setAttribute("checked","checked"),fe.setAttribute("name","t"),ce.appendChild(fe),y.checkClone=ce.cloneNode(!0).cloneNode(!0).lastChild.checked,ce.innerHTML="<textarea>x</textarea>",y.noCloneChecked=!!ce.cloneNode(!0).lastChild.defaultValue,ce.innerHTML="<option></option>",y.option=!!ce.lastChild;var ge={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ve(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&A(e,t)?S.merge([e],n):n}function ye(e,t){for(var n=0,r=e.length;n<r;n++)Y.set(e[n],"globalEval",!t||Y.get(t[n],"globalEval"))}ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td,y.option||(ge.optgroup=ge.option=[1,"<select multiple='multiple'>","</select>"]);var me=/<|&#?\w+;/;function xe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===w(o))S.merge(p,o.nodeType?[o]:o);else if(me.test(o)){a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+S.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;S.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&-1<S.inArray(o,r))i&&i.push(o);else if(l=ie(o),a=ve(f.appendChild(o),"script"),l&&ye(a),n){c=0;while(o=a[c++])he.test(o.type||"")&&n.push(o)}return f}var be=/^([^.]*)(?:\.(.+)|)/;function we(){return!0}function Te(){return!1}function Ce(e,t){return e===function(){try{return E.activeElement}catch(e){}}()==("focus"===t)}function Ee(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Ee(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Te;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return S().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=S.guid++)),e.each(function(){S.event.add(this,t,i,r,n)})}function Se(e,i,o){o?(Y.set(e,i,!1),S.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=Y.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(S.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),Y.set(this,i,r),t=o(this,i),this[i](),r!==(n=Y.get(this,i))||t?Y.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n&&n.value}else r.length&&(Y.set(this,i,{value:S.event.trigger(S.extend(r[0],S.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Y.get(e,i)&&S.event.add(e,i,we)}S.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.get(t);if(V(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&S.find.matchesSelector(re,i),n.guid||(n.guid=S.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return"undefined"!=typeof S&&S.event.triggered!==e.type?S.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(P)||[""]).length;while(l--)d=g=(s=be.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=S.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=S.event.special[d]||{},c=S.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&S.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),S.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.hasData(e)&&Y.get(e);if(v&&(u=v.events)){l=(t=(t||"").match(P)||[""]).length;while(l--)if(d=g=(s=be.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){f=S.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||S.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)S.event.remove(e,d+t[l],n,r,!0);S.isEmptyObject(u)&&Y.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=S.event.fix(e),l=(Y.get(this,"events")||Object.create(null))[u.type]||[],c=S.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=S.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((S.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<S(i,this).index(l):S.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(S.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[S.expando]?e:new S.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click",we),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&A(t,"input")&&Y.get(t,"click")||A(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},S.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},S.Event=function(e,t){if(!(this instanceof S.Event))return new S.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?we:Te,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&S.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[S.expando]=!0},S.Event.prototype={constructor:S.Event,isDefaultPrevented:Te,isPropagationStopped:Te,isImmediatePropagationStopped:Te,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=we,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=we,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=we,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},S.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},S.event.addProp),S.each({focus:"focusin",blur:"focusout"},function(e,t){S.event.special[e]={setup:function(){return Se(this,e,Ce),!1},trigger:function(){return Se(this,e),!0},_default:function(){return!0},delegateType:t}}),S.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){S.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||S.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),S.fn.extend({on:function(e,t,n,r){return Ee(this,e,t,n,r)},one:function(e,t,n,r){return Ee(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,S(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Te),this.each(function(){S.event.remove(this,e,n,t)})}});var ke=/<script|<style|<link/i,Ae=/checked\s*(?:[^=]|=\s*.checked.)/i,Ne=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function je(e,t){return A(e,"table")&&A(11!==t.nodeType?t:t.firstChild,"tr")&&S(e).children("tbody")[0]||e}function De(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function qe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Le(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(Y.hasData(e)&&(s=Y.get(e).events))for(i in Y.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)S.event.add(t,i,s[i][n]);Q.hasData(e)&&(o=Q.access(e),a=S.extend({},o),Q.set(t,a))}}function He(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=m(d);if(h||1<f&&"string"==typeof d&&!y.checkClone&&Ae.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),He(t,r,i,o)});if(f&&(t=(e=xe(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=S.map(ve(e,"script"),De)).length;c<f;c++)u=e,c!==p&&(u=S.clone(u,!0,!0),s&&S.merge(a,ve(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,S.map(a,qe),c=0;c<s;c++)u=a[c],he.test(u.type||"")&&!Y.access(u,"globalEval")&&S.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?S._evalUrl&&!u.noModule&&S._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):b(u.textContent.replace(Ne,""),u,l))}return n}function Oe(e,t,n){for(var r,i=t?S.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||S.cleanData(ve(r)),r.parentNode&&(n&&ie(r)&&ye(ve(r,"script")),r.parentNode.removeChild(r));return e}S.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=ie(e);if(!(y.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||S.isXMLDoc(e)))for(a=ve(c),r=0,i=(o=ve(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ve(e),a=a||ve(c),r=0,i=o.length;r<i;r++)Le(o[r],a[r]);else Le(e,c);return 0<(a=ve(c,"script")).length&&ye(a,!f&&ve(e,"script")),c},cleanData:function(e){for(var t,n,r,i=S.event.special,o=0;void 0!==(n=e[o]);o++)if(V(n)){if(t=n[Y.expando]){if(t.events)for(r in t.events)i[r]?S.event.remove(n,r):S.removeEvent(n,r,t.handle);n[Y.expando]=void 0}n[Q.expando]&&(n[Q.expando]=void 0)}}}),S.fn.extend({detach:function(e){return Oe(this,e,!0)},remove:function(e){return Oe(this,e)},text:function(e){return $(this,function(e){return void 0===e?S.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return He(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||je(this,e).appendChild(e)})},prepend:function(){return He(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=je(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(S.cleanData(ve(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return S.clone(this,e,t)})},html:function(e){return $(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!ke.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=S.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(S.cleanData(ve(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return He(this,arguments,function(e){var t=this.parentNode;S.inArray(this,n)<0&&(S.cleanData(ve(this)),t&&t.replaceChild(e,this))},n)}}),S.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){S.fn[e]=function(e){for(var t,n=[],r=S(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),S(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});var Pe=new RegExp("^("+ee+")(?!px)[a-z%]+$","i"),Re=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=C),t.getComputedStyle(e)},Me=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Ie=new RegExp(ne.join("|"),"i");function We(e,t,n){var r,i,o,a,s=e.style;return(n=n||Re(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||ie(e)||(a=S.style(e,t)),!y.pixelBoxStyles()&&Pe.test(a)&&Ie.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function Fe(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",re.appendChild(u).appendChild(l);var e=C.getComputedStyle(l);n="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),re.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=E.createElement("div"),l=E.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",y.clearCloneStyle="content-box"===l.style.backgroundClip,S.extend(y,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=E.createElement("table"),t=E.createElement("tr"),n=E.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",re.appendChild(e).appendChild(t).appendChild(n),r=C.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,re.removeChild(e)),a}}))}();var Be=["Webkit","Moz","ms"],$e=E.createElement("div").style,_e={};function ze(e){var t=S.cssProps[e]||_e[e];return t||(e in $e?e:_e[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Be.length;while(n--)if((e=Be[n]+t)in $e)return e}(e)||e)}var Ue=/^(none|table(?!-c[ea]).+)/,Xe=/^--/,Ve={position:"absolute",visibility:"hidden",display:"block"},Ge={letterSpacing:"0",fontWeight:"400"};function Ye(e,t,n){var r=te.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Qe(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=S.css(e,n+ne[a],!0,i)),r?("content"===n&&(u-=S.css(e,"padding"+ne[a],!0,i)),"margin"!==n&&(u-=S.css(e,"border"+ne[a]+"Width",!0,i))):(u+=S.css(e,"padding"+ne[a],!0,i),"padding"!==n?u+=S.css(e,"border"+ne[a]+"Width",!0,i):s+=S.css(e,"border"+ne[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function Je(e,t,n){var r=Re(e),i=(!y.boxSizingReliable()||n)&&"border-box"===S.css(e,"boxSizing",!1,r),o=i,a=We(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Pe.test(a)){if(!n)return a;a="auto"}return(!y.boxSizingReliable()&&i||!y.reliableTrDimensions()&&A(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===S.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===S.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+Qe(e,t,n||(i?"border":"content"),o,r,a)+"px"}function Ke(e,t,n,r,i){return new Ke.prototype.init(e,t,n,r,i)}S.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=We(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=X(t),u=Xe.test(t),l=e.style;if(u||(t=ze(s)),a=S.cssHooks[t]||S.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=te.exec(n))&&i[1]&&(n=se(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(S.cssNumber[s]?"":"px")),y.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=X(t);return Xe.test(t)||(t=ze(s)),(a=S.cssHooks[t]||S.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=We(e,t,r)),"normal"===i&&t in Ge&&(i=Ge[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),S.each(["height","width"],function(e,u){S.cssHooks[u]={get:function(e,t,n){if(t)return!Ue.test(S.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Je(e,u,n):Me(e,Ve,function(){return Je(e,u,n)})},set:function(e,t,n){var r,i=Re(e),o=!y.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===S.css(e,"boxSizing",!1,i),s=n?Qe(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-Qe(e,u,"border",!1,i)-.5)),s&&(r=te.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=S.css(e,u)),Ye(0,t,s)}}}),S.cssHooks.marginLeft=Fe(y.reliableMarginLeft,function(e,t){if(t)return(parseFloat(We(e,"marginLeft"))||e.getBoundingClientRect().left-Me(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),S.each({margin:"",padding:"",border:"Width"},function(i,o){S.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+ne[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(S.cssHooks[i+o].set=Ye)}),S.fn.extend({css:function(e,t){return $(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Re(e),i=t.length;a<i;a++)o[t[a]]=S.css(e,t[a],!1,r);return o}return void 0!==n?S.style(e,t,n):S.css(e,t)},e,t,1<arguments.length)}}),((S.Tween=Ke).prototype={constructor:Ke,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||S.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(S.cssNumber[n]?"":"px")},cur:function(){var e=Ke.propHooks[this.prop];return e&&e.get?e.get(this):Ke.propHooks._default.get(this)},run:function(e){var t,n=Ke.propHooks[this.prop];return this.options.duration?this.pos=t=S.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Ke.propHooks._default.set(this),this}}).init.prototype=Ke.prototype,(Ke.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=S.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){S.fx.step[e.prop]?S.fx.step[e.prop](e):1!==e.elem.nodeType||!S.cssHooks[e.prop]&&null==e.elem.style[ze(e.prop)]?e.elem[e.prop]=e.now:S.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=Ke.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},S.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},S.fx=Ke.prototype.init,S.fx.step={};var Ze,et,tt,nt,rt=/^(?:toggle|show|hide)$/,it=/queueHooks$/;function ot(){et&&(!1===E.hidden&&C.requestAnimationFrame?C.requestAnimationFrame(ot):C.setTimeout(ot,S.fx.interval),S.fx.tick())}function at(){return C.setTimeout(function(){Ze=void 0}),Ze=Date.now()}function st(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=ne[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function ut(e,t,n){for(var r,i=(lt.tweeners[t]||[]).concat(lt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function lt(o,e,t){var n,a,r=0,i=lt.prefilters.length,s=S.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=Ze||at(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:S.extend({},e),opts:S.extend(!0,{specialEasing:{},easing:S.easing._default},t),originalProperties:e,originalOptions:t,startTime:Ze||at(),duration:t.duration,tweens:[],createTween:function(e,t){var n=S.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=X(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=S.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=lt.prefilters[r].call(l,o,c,l.opts))return m(n.stop)&&(S._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return S.map(c,ut,l),m(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),S.fx.timer(S.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}S.Animation=S.extend(lt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return se(n.elem,e,te.exec(t),n),n}]},tweener:function(e,t){m(e)?(t=e,e=["*"]):e=e.match(P);for(var n,r=0,i=e.length;r<i;r++)n=e[r],lt.tweeners[n]=lt.tweeners[n]||[],lt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ae(e),v=Y.get(e,"fxshow");for(r in n.queue||(null==(a=S._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,S.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],rt.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||S.style(e,r)}if((u=!S.isEmptyObject(t))||!S.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=Y.get(e,"display")),"none"===(c=S.css(e,"display"))&&(l?c=l:(le([e],!0),l=e.style.display||l,c=S.css(e,"display"),le([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===S.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=Y.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&le([e],!0),p.done(function(){for(r in g||le([e]),Y.remove(e,"fxshow"),d)S.style(e,r,d[r])})),u=ut(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?lt.prefilters.unshift(e):lt.prefilters.push(e)}}),S.speed=function(e,t,n){var r=e&&"object"==typeof e?S.extend({},e):{complete:n||!n&&t||m(e)&&e,duration:e,easing:n&&t||t&&!m(t)&&t};return S.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in S.fx.speeds?r.duration=S.fx.speeds[r.duration]:r.duration=S.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){m(r.old)&&r.old.call(this),r.queue&&S.dequeue(this,r.queue)},r},S.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=S.isEmptyObject(t),o=S.speed(e,n,r),a=function(){var e=lt(this,S.extend({},t),o);(i||Y.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=S.timers,r=Y.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&it.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||S.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=Y.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=S.timers,o=n?n.length:0;for(t.finish=!0,S.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),S.each(["toggle","show","hide"],function(e,r){var i=S.fn[r];S.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(st(r,!0),e,t,n)}}),S.each({slideDown:st("show"),slideUp:st("hide"),slideToggle:st("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){S.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),S.timers=[],S.fx.tick=function(){var e,t=0,n=S.timers;for(Ze=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||S.fx.stop(),Ze=void 0},S.fx.timer=function(e){S.timers.push(e),S.fx.start()},S.fx.interval=13,S.fx.start=function(){et||(et=!0,ot())},S.fx.stop=function(){et=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(r,e){return r=S.fx&&S.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=C.setTimeout(e,r);t.stop=function(){C.clearTimeout(n)}})},tt=E.createElement("input"),nt=E.createElement("select").appendChild(E.createElement("option")),tt.type="checkbox",y.checkOn=""!==tt.value,y.optSelected=nt.selected,(tt=E.createElement("input")).value="t",tt.type="radio",y.radioValue="t"===tt.value;var ct,ft=S.expr.attrHandle;S.fn.extend({attr:function(e,t){return $(this,S.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){S.removeAttr(this,e)})}}),S.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?S.prop(e,t,n):(1===o&&S.isXMLDoc(e)||(i=S.attrHooks[t.toLowerCase()]||(S.expr.match.bool.test(t)?ct:void 0)),void 0!==n?null===n?void S.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=S.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!y.radioValue&&"radio"===t&&A(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(P);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),ct={set:function(e,t,n){return!1===t?S.removeAttr(e,n):e.setAttribute(n,n),n}},S.each(S.expr.match.bool.source.match(/\w+/g),function(e,t){var a=ft[t]||S.find.attr;ft[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=ft[o],ft[o]=r,r=null!=a(e,t,n)?o:null,ft[o]=i),r}});var pt=/^(?:input|select|textarea|button)$/i,dt=/^(?:a|area)$/i;function ht(e){return(e.match(P)||[]).join(" ")}function gt(e){return e.getAttribute&&e.getAttribute("class")||""}function vt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(P)||[]}S.fn.extend({prop:function(e,t){return $(this,S.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[S.propFix[e]||e]})}}),S.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&S.isXMLDoc(e)||(t=S.propFix[t]||t,i=S.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=S.find.attr(e,"tabindex");return t?parseInt(t,10):pt.test(e.nodeName)||dt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),y.optSelected||(S.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),S.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){S.propFix[this.toLowerCase()]=this}),S.fn.extend({addClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).addClass(t.call(this,e,gt(this)))});if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){a=0;while(o=e[a++])r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},removeClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).removeClass(t.call(this,e,gt(this)))});if(!arguments.length)return this.attr("class","");if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){a=0;while(o=e[a++])while(-1<r.indexOf(" "+o+" "))r=r.replace(" "+o+" "," ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},toggleClass:function(i,t){var o=typeof i,a="string"===o||Array.isArray(i);return"boolean"==typeof t&&a?t?this.addClass(i):this.removeClass(i):m(i)?this.each(function(e){S(this).toggleClass(i.call(this,e,gt(this),t),t)}):this.each(function(){var e,t,n,r;if(a){t=0,n=S(this),r=vt(i);while(e=r[t++])n.hasClass(e)?n.removeClass(e):n.addClass(e)}else void 0!==i&&"boolean"!==o||((e=gt(this))&&Y.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===i?"":Y.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+ht(gt(n))+" ").indexOf(t))return!0;return!1}});var yt=/\r/g;S.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=m(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,S(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=S.map(t,function(e){return null==e?"":e+""})),(r=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=S.valHooks[t.type]||S.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(yt,""):null==e?"":e:void 0}}),S.extend({valHooks:{option:{get:function(e){var t=S.find.attr(e,"value");return null!=t?t:ht(S.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!A(n.parentNode,"optgroup"))){if(t=S(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=S.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<S.inArray(S.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),S.each(["radio","checkbox"],function(){S.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<S.inArray(S(e).val(),t)}},y.checkOn||(S.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),y.focusin="onfocusin"in C;var mt=/^(?:focusinfocus|focusoutblur)$/,xt=function(e){e.stopPropagation()};S.extend(S.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||E],d=v.call(e,"type")?e.type:e,h=v.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||E,3!==n.nodeType&&8!==n.nodeType&&!mt.test(d+S.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[S.expando]?e:new S.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:S.makeArray(t,[e]),c=S.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!x(n)){for(s=c.delegateType||d,mt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||E)&&p.push(a.defaultView||a.parentWindow||C)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(Y.get(o,"events")||Object.create(null))[e.type]&&Y.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&V(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!V(n)||u&&m(n[d])&&!x(n)&&((a=n[u])&&(n[u]=null),S.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,xt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,xt),S.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=S.extend(new S.Event,n,{type:e,isSimulated:!0});S.event.trigger(r,null,t)}}),S.fn.extend({trigger:function(e,t){return this.each(function(){S.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return S.event.trigger(e,t,n,!0)}}),y.focusin||S.each({focus:"focusin",blur:"focusout"},function(n,r){var i=function(e){S.event.simulate(r,e.target,S.event.fix(e))};S.event.special[r]={setup:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r);t||e.addEventListener(n,i,!0),Y.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r)-1;t?Y.access(e,r,t):(e.removeEventListener(n,i,!0),Y.remove(e,r))}}});var bt=C.location,wt={guid:Date.now()},Tt=/\?/;S.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new C.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||S.error("Invalid XML: "+(n?S.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t};var Ct=/\[\]$/,Et=/\r?\n/g,St=/^(?:submit|button|image|reset|file)$/i,kt=/^(?:input|select|textarea|keygen)/i;function At(n,e,r,i){var t;if(Array.isArray(e))S.each(e,function(e,t){r||Ct.test(n)?i(n,t):At(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==w(e))i(n,e);else for(t in e)At(n+"["+t+"]",e[t],r,i)}S.param=function(e,t){var n,r=[],i=function(e,t){var n=m(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!S.isPlainObject(e))S.each(e,function(){i(this.name,this.value)});else for(n in e)At(n,e[n],t,i);return r.join("&")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=S.prop(this,"elements");return e?S.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!S(this).is(":disabled")&&kt.test(this.nodeName)&&!St.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=S(this).val();return null==n?null:Array.isArray(n)?S.map(n,function(e){return{name:t.name,value:e.replace(Et,"\r\n")}}):{name:t.name,value:n.replace(Et,"\r\n")}}).get()}});var Nt=/%20/g,jt=/#.*$/,Dt=/([?&])_=[^&]*/,qt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Lt=/^(?:GET|HEAD)$/,Ht=/^\/\//,Ot={},Pt={},Rt="*/".concat("*"),Mt=E.createElement("a");function It(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(P)||[];if(m(t))while(n=i[r++])"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Wt(t,i,o,a){var s={},u=t===Pt;function l(e){var r;return s[e]=!0,S.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function Ft(e,t){var n,r,i=S.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&S.extend(!0,e,r),e}Mt.href=bt.href,S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:bt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(bt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Rt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ft(Ft(e,S.ajaxSettings),t):Ft(S.ajaxSettings,e)},ajaxPrefilter:It(Ot),ajaxTransport:It(Pt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=S.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?S(y):S.event,x=S.Deferred(),b=S.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=qt.exec(p))n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2])}t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||bt.href)+"").replace(Ht,bt.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(P)||[""],null==v.crossDomain){r=E.createElement("a");try{r.href=v.url,r.href=r.href,v.crossDomain=Mt.protocol+"//"+Mt.host!=r.protocol+"//"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=S.param(v.data,v.traditional)),Wt(Ot,v,t,T),h)return T;for(i in(g=S.event&&v.global)&&0==S.active++&&S.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Lt.test(v.type),f=v.url.replace(jt,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(Nt,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(Tt.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(Dt,"$1"),o=(Tt.test(f)?"&":"?")+"_="+wt.guid+++o),v.url=f+o),v.ifModified&&(S.lastModified[f]&&T.setRequestHeader("If-Modified-Since",S.lastModified[f]),S.etag[f]&&T.setRequestHeader("If-None-Match",S.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+Rt+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Wt(Pt,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=C.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&C.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),!i&&-1<S.inArray("script",v.dataTypes)&&S.inArray("json",v.dataTypes)<0&&(v.converters["text script"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(S.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(S.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--S.active||S.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return S.get(e,t,n,"json")},getScript:function(e,t){return S.get(e,void 0,t,"script")}}),S.each(["get","post"],function(e,i){S[i]=function(e,t,n,r){return m(t)&&(r=r||n,n=t,t=void 0),S.ajax(S.extend({url:e,type:i,dataType:r,data:t,success:n},S.isPlainObject(e)&&e))}}),S.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),S._evalUrl=function(e,t,n){return S.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){S.globalEval(e,t,n)}})},S.fn.extend({wrapAll:function(e){var t;return this[0]&&(m(e)&&(e=e.call(this[0])),t=S(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return m(n)?this.each(function(e){S(this).wrapInner(n.call(this,e))}):this.each(function(){var e=S(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=m(t);return this.each(function(e){S(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){S(this).replaceWith(this.childNodes)}),this}}),S.expr.pseudos.hidden=function(e){return!S.expr.pseudos.visible(e)},S.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},S.ajaxSettings.xhr=function(){try{return new C.XMLHttpRequest}catch(e){}};var Bt={0:200,1223:204},$t=S.ajaxSettings.xhr();y.cors=!!$t&&"withCredentials"in $t,y.ajax=$t=!!$t,S.ajaxTransport(function(i){var o,a;if(y.cors||$t&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(Bt[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&C.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),S.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),S.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return S.globalEval(e),e}}}),S.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),S.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=S("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),E.head.appendChild(r[0])},abort:function(){i&&i()}}});var _t,zt=[],Ut=/(=)\?(?=&|$)|\?\?/;S.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=zt.pop()||S.expando+"_"+wt.guid++;return this[e]=!0,e}}),S.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Ut.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ut.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Ut,"$1"+r):!1!==e.jsonp&&(e.url+=(Tt.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||S.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=C[r],C[r]=function(){o=arguments},n.always(function(){void 0===i?S(C).removeProp(r):C[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,zt.push(r)),o&&m(i)&&i(o[0]),o=i=void 0}),"script"}),y.createHTMLDocument=((_t=E.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===_t.childNodes.length),S.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(y.createHTMLDocument?((r=(t=E.implementation.createHTMLDocument("")).createElement("base")).href=E.location.href,t.head.appendChild(r)):t=E),o=!n&&[],(i=N.exec(e))?[t.createElement(i[1])]:(i=xe([e],t,o),o&&o.length&&S(o).remove(),S.merge([],i.childNodes)));var r,i,o},S.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=ht(e.slice(s)),e=e.slice(0,s)),m(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&S.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?S("<div>").append(S.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},S.expr.pseudos.animated=function(t){return S.grep(S.timers,function(e){return t===e.elem}).length},S.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=S.css(e,"position"),c=S(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=S.css(e,"top"),u=S.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),m(t)&&(t=t.call(e,n,S.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},S.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){S.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===S.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===S.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=S(e).offset()).top+=S.css(e,"borderTopWidth",!0),i.left+=S.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-S.css(r,"marginTop",!0),left:t.left-i.left-S.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===S.css(e,"position"))e=e.offsetParent;return e||re})}}),S.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;S.fn[t]=function(e){return $(this,function(e,t,n){var r;if(x(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),S.each(["top","left"],function(e,n){S.cssHooks[n]=Fe(y.pixelPosition,function(e,t){if(t)return t=We(e,n),Pe.test(t)?S(e).position()[n]+"px":t})}),S.each({Height:"height",Width:"width"},function(a,s){S.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){S.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return $(this,function(e,t,n){var r;return x(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?S.css(e,t,i):S.style(e,t,n,i)},s,n?e:void 0,n)}})}),S.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){S.fn[t]=function(e){return this.on(t,e)}}),S.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),S.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){S.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var Xt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;S.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),m(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||S.guid++,i},S.holdReady=function(e){e?S.readyWait++:S.ready(!0)},S.isArray=Array.isArray,S.parseJSON=JSON.parse,S.nodeName=A,S.isFunction=m,S.isWindow=x,S.camelCase=X,S.type=w,S.now=Date.now,S.isNumeric=function(e){var t=S.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},S.trim=function(e){return null==e?"":(e+"").replace(Xt,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return S});var Vt=C.jQuery,Gt=C.$;return S.noConflict=function(e){return C.$===S&&(C.$=Gt),e&&C.jQuery===S&&(C.jQuery=Vt),S},"undefined"==typeof e&&(C.jQuery=C.$=S),S});
;
/**
 * Copyright (c) 2007-2015 Ariel Flesler - aflesler<a>gmail<d>com | http://flesler.blogspot.com
 * Licensed under MIT
 * @author Ariel Flesler
 * @version 2.1.2
 */
;(function(f){"use strict";"function"===typeof define&&define.amd?define(["jquery"],f):"undefined"!==typeof module&&module.exports?module.exports=f(require("jquery")):f(jQuery)})(function($){"use strict";function n(a){return!a.nodeName||-1!==$.inArray(a.nodeName.toLowerCase(),["iframe","#document","html","body"])}function h(a){return $.isFunction(a)||$.isPlainObject(a)?a:{top:a,left:a}}var p=$.scrollTo=function(a,d,b){return $(window).scrollTo(a,d,b)};p.defaults={axis:"xy",duration:0,limit:!0};$.fn.scrollTo=function(a,d,b){"object"=== typeof d&&(b=d,d=0);"function"===typeof b&&(b={onAfter:b});"max"===a&&(a=9E9);b=$.extend({},p.defaults,b);d=d||b.duration;var u=b.queue&&1<b.axis.length;u&&(d/=2);b.offset=h(b.offset);b.over=h(b.over);return this.each(function(){function k(a){var k=$.extend({},b,{queue:!0,duration:d,complete:a&&function(){a.call(q,e,b)}});r.animate(f,k)}if(null!==a){var l=n(this),q=l?this.contentWindow||window:this,r=$(q),e=a,f={},t;switch(typeof e){case "number":case "string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(e)){e= h(e);break}e=l?$(e):$(e,q);case "object":if(e.length===0)return;if(e.is||e.style)t=(e=$(e)).offset()}var v=$.isFunction(b.offset)&&b.offset(q,e)||b.offset;$.each(b.axis.split(""),function(a,c){var d="x"===c?"Left":"Top",m=d.toLowerCase(),g="scroll"+d,h=r[g](),n=p.max(q,c);t?(f[g]=t[m]+(l?0:h-r.offset()[m]),b.margin&&(f[g]-=parseInt(e.css("margin"+d),10)||0,f[g]-=parseInt(e.css("border"+d+"Width"),10)||0),f[g]+=v[m]||0,b.over[m]&&(f[g]+=e["x"===c?"width":"height"]()*b.over[m])):(d=e[m],f[g]=d.slice&& "%"===d.slice(-1)?parseFloat(d)/100*n:d);b.limit&&/^\d+$/.test(f[g])&&(f[g]=0>=f[g]?0:Math.min(f[g],n));!a&&1<b.axis.length&&(h===f[g]?f={}:u&&(k(b.onAfterFirst),f={}))});k(b.onAfter)}})};p.max=function(a,d){var b="x"===d?"Width":"Height",h="scroll"+b;if(!n(a))return a[h]-$(a)[b.toLowerCase()]();var b="client"+b,k=a.ownerDocument||a.document,l=k.documentElement,k=k.body;return Math.max(l[h],k[h])-Math.min(l[b],k[b])};$.Tween.propHooks.scrollLeft=$.Tween.propHooks.scrollTop={get:function(a){return $(a.elem)[a.prop]()}, set:function(a){var d=this.get(a);if(a.options.interrupt&&a._last&&a._last!==d)return $(a.elem).stop();var b=Math.round(a.now);d!==b&&($(a.elem)[a.prop](b),a._last=this.get(a))}};return p});
/*
 Sticky-kit v1.1.3 | MIT | Leaf Corcoran 2015 | http://leafo.net
*/
(function(){var c,f;c=window.jQuery;f=c(window);c.fn.stick_in_parent=function(b){var A,w,J,n,B,K,p,q,L,k,E,t;null==b&&(b={});t=b.sticky_class;B=b.inner_scrolling;E=b.recalc_every;k=b.parent;q=b.offset_top;p=b.spacer;w=b.bottoming;null==q&&(q=0);null==k&&(k=void 0);null==B&&(B=!0);null==t&&(t="is_stuck");A=c(document);null==w&&(w=!0);L=function(a){var b;return window.getComputedStyle?(a=window.getComputedStyle(a[0]),b=parseFloat(a.getPropertyValue("width"))+parseFloat(a.getPropertyValue("margin-left"))+
parseFloat(a.getPropertyValue("margin-right")),"border-box"!==a.getPropertyValue("box-sizing")&&(b+=parseFloat(a.getPropertyValue("border-left-width"))+parseFloat(a.getPropertyValue("border-right-width"))+parseFloat(a.getPropertyValue("padding-left"))+parseFloat(a.getPropertyValue("padding-right"))),b):a.outerWidth(!0)};J=function(a,b,n,C,F,u,r,G){var v,H,m,D,I,d,g,x,y,z,h,l;if(!a.data("sticky_kit")){a.data("sticky_kit",!0);I=A.height();g=a.parent();null!=k&&(g=g.closest(k));if(!g.length)throw"failed to find stick parent";
v=m=!1;(h=null!=p?p&&a.closest(p):c("<div />"))&&h.css("position",a.css("position"));x=function(){var d,f,e;if(!G&&(I=A.height(),d=parseInt(g.css("border-top-width"),10),f=parseInt(g.css("padding-top"),10),b=parseInt(g.css("padding-bottom"),10),n=g.offset().top+d+f,C=g.height(),m&&(v=m=!1,null==p&&(a.insertAfter(h),h.detach()),a.css({position:"",top:"",width:"",bottom:""}).removeClass(t),e=!0),F=a.offset().top-(parseInt(a.css("margin-top"),10)||0)-q,u=a.outerHeight(!0),r=a.css("float"),h&&h.css({width:L(a),
height:u,display:a.css("display"),"vertical-align":a.css("vertical-align"),"float":r}),e))return l()};x();if(u!==C)return D=void 0,d=q,z=E,l=function(){var c,l,e,k;if(!G&&(e=!1,null!=z&&(--z,0>=z&&(z=E,x(),e=!0)),e||A.height()===I||x(),e=f.scrollTop(),null!=D&&(l=e-D),D=e,m?(w&&(k=e+u+d>C+n,v&&!k&&(v=!1,a.css({position:"fixed",bottom:"",top:d}).trigger("sticky_kit:unbottom"))),e<F&&(m=!1,d=q,null==p&&("left"!==r&&"right"!==r||a.insertAfter(h),h.detach()),c={position:"",width:"",top:""},a.css(c).removeClass(t).trigger("sticky_kit:unstick")),
B&&(c=f.height(),u+q>c&&!v&&(d-=l,d=Math.max(c-u,d),d=Math.min(q,d),m&&a.css({top:d+"px"})))):e>F&&(m=!0,c={position:"fixed",top:d},c.width="border-box"===a.css("box-sizing")?a.outerWidth()+"px":a.width()+"px",a.css(c).addClass(t),null==p&&(a.after(h),"left"!==r&&"right"!==r||h.append(a)),a.trigger("sticky_kit:stick")),m&&w&&(null==k&&(k=e+u+d>C+n),!v&&k)))return v=!0,"static"===g.css("position")&&g.css({position:"relative"}),a.css({position:"absolute",bottom:b,top:"auto"}).trigger("sticky_kit:bottom")},
y=function(){x();return l()},H=function(){G=!0;f.off("touchmove",l);f.off("scroll",l);f.off("resize",y);c(document.body).off("sticky_kit:recalc",y);a.off("sticky_kit:detach",H);a.removeData("sticky_kit");a.css({position:"",bottom:"",top:"",width:""});g.position("position","");if(m)return null==p&&("left"!==r&&"right"!==r||a.insertAfter(h),h.remove()),a.removeClass(t)},f.on("touchmove",l),f.on("scroll",l),f.on("resize",y),c(document.body).on("sticky_kit:recalc",y),a.on("sticky_kit:detach",H),setTimeout(l,
0)}};n=0;for(K=this.length;n<K;n++)b=this[n],J(c(b));return this}}).call(this);
;
/**
*  Ajax Autocomplete for jQuery, version 1.2.27
*  (c) 2014 Tomas Kirda
*
*  Ajax Autocomplete for jQuery is freely distributable under the terms of an MIT-style license.
*  For details, see the web site: https://github.com/devbridge/jQuery-Autocomplete
*/
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports&&"function"==typeof require?require("jquery"):jQuery)}(function(a){"use strict";function b(c,d){var e=a.noop,f=this,g={ajaxSettings:{},autoSelectFirst:!1,appendTo:document.body,serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:b.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:e,onSearchComplete:e,onSearchError:e,preserveInput:!1,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!0,preventBadQueries:!0,lookupFilter:function(a,b,c){return-1!==a.value.toLowerCase().indexOf(c)},paramName:"query",transformResult:function(b){return"string"==typeof b?a.parseJSON(b):b},showNoSuggestionNotice:!1,noSuggestionNotice:"No results",orientation:"bottom",forceFixPosition:!1};f.element=c,f.el=a(c),f.suggestions=[],f.badQueries=[],f.selectedIndex=-1,f.currentValue=f.element.value,f.intervalId=0,f.cachedResponse={},f.onChangeInterval=null,f.onChange=null,f.isLocal=!1,f.suggestionsContainer=null,f.noSuggestionsContainer=null,f.options=a.extend({},g,d),f.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},f.hint=null,f.hintValue="",f.selection=null,f.initialize(),f.setOptions(d)}var c=function(){return{escapeRegExChars:function(a){return a.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")},createNode:function(a){var b=document.createElement("div");return b.className=a,b.style.position="absolute",b.style.display="none",b}}}(),d={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};b.utils=c,a.Autocomplete=b,b.formatResult=function(a,b){if(!b)return a.value;var d="("+c.escapeRegExChars(b)+")";return a.value.replace(new RegExp(d,"gi"),"<strong>$1</strong>").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/&lt;(\/?strong)&gt;/g,"<$1>")},b.prototype={killerFn:null,initialize:function(){var c,d=this,e="."+d.classes.suggestion,f=d.classes.selected,g=d.options;d.element.setAttribute("autocomplete","off"),d.killerFn=function(b){a(b.target).closest("."+d.options.containerClass).length||(d.killSuggestions(),d.disableKillerFn())},d.noSuggestionsContainer=a('<div class="autocomplete-no-suggestion"></div>').html(this.options.noSuggestionNotice).get(0),d.suggestionsContainer=b.utils.createNode(g.containerClass),c=a(d.suggestionsContainer),c.appendTo(g.appendTo),"auto"!==g.width&&c.css("width",g.width),c.on("mouseover.autocomplete",e,function(){d.activate(a(this).data("index"))}),c.on("mouseout.autocomplete",function(){d.selectedIndex=-1,c.children("."+f).removeClass(f)}),c.on("click.autocomplete",e,function(){return d.select(a(this).data("index")),!1}),d.fixPositionCapture=function(){d.visible&&d.fixPosition()},a(window).on("resize.autocomplete",d.fixPositionCapture),d.el.on("keydown.autocomplete",function(a){d.onKeyPress(a)}),d.el.on("keyup.autocomplete",function(a){d.onKeyUp(a)}),d.el.on("blur.autocomplete",function(){d.onBlur()}),d.el.on("focus.autocomplete",function(){d.onFocus()}),d.el.on("change.autocomplete",function(a){d.onKeyUp(a)}),d.el.on("input.autocomplete",function(a){d.onKeyUp(a)})},onFocus:function(){var a=this;a.fixPosition(),a.el.val().length>=a.options.minChars&&a.onValueChange()},onBlur:function(){this.enableKillerFn()},abortAjax:function(){var a=this;a.currentRequest&&(a.currentRequest.abort(),a.currentRequest=null)},setOptions:function(b){var c=this,d=c.options;a.extend(d,b),c.isLocal=a.isArray(d.lookup),c.isLocal&&(d.lookup=c.verifySuggestionsFormat(d.lookup)),d.orientation=c.validateOrientation(d.orientation,"bottom"),a(c.suggestionsContainer).css({"max-height":d.maxHeight+"px",width:d.width+"px","z-index":d.zIndex})},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var a=this;a.disabled=!0,clearInterval(a.onChangeInterval),a.abortAjax()},enable:function(){this.disabled=!1},fixPosition:function(){var b=this,c=a(b.suggestionsContainer),d=c.parent().get(0);if(d===document.body||b.options.forceFixPosition){var e=b.options.orientation,f=c.outerHeight(),g=b.el.outerHeight(),h=b.el.offset(),i={top:h.top,left:h.left};if("auto"===e){var j=a(window).height(),k=a(window).scrollTop(),l=-k+h.top-f,m=k+j-(h.top+g+f);e=Math.max(l,m)===l?"top":"bottom"}if("top"===e?i.top+=-f:i.top+=g,d!==document.body){var n,o=c.css("opacity");b.visible||c.css("opacity",0).show(),n=c.offsetParent().offset(),i.top-=n.top,i.left-=n.left,b.visible||c.css("opacity",o).hide()}"auto"===b.options.width&&(i.width=b.el.outerWidth()+"px"),c.css(i)}},enableKillerFn:function(){var b=this;a(document).on("click.autocomplete",b.killerFn)},disableKillerFn:function(){var b=this;a(document).off("click.autocomplete",b.killerFn)},killSuggestions:function(){var a=this;a.stopKillSuggestions(),a.intervalId=window.setInterval(function(){a.visible&&(a.options.preserveInput||a.el.val(a.currentValue),a.hide()),a.stopKillSuggestions()},50)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var a,b=this,c=b.el.val().length,d=b.element.selectionStart;return"number"==typeof d?d===c:document.selection?(a=document.selection.createRange(),a.moveStart("character",-c),c===a.text.length):!0},onKeyPress:function(a){var b=this;if(!b.disabled&&!b.visible&&a.which===d.DOWN&&b.currentValue)return void b.suggest();if(!b.disabled&&b.visible){switch(a.which){case d.ESC:b.el.val(b.currentValue),b.hide();break;case d.RIGHT:if(b.hint&&b.options.onHint&&b.isCursorAtEnd()){b.selectHint();break}return;case d.TAB:if(b.hint&&b.options.onHint)return void b.selectHint();if(-1===b.selectedIndex)return void b.hide();if(b.select(b.selectedIndex),b.options.tabDisabled===!1)return;break;case d.RETURN:if(-1===b.selectedIndex)return void b.hide();b.select(b.selectedIndex);break;case d.UP:b.moveUp();break;case d.DOWN:b.moveDown();break;default:return}a.stopImmediatePropagation(),a.preventDefault()}},onKeyUp:function(a){var b=this;if(!b.disabled){switch(a.which){case d.UP:case d.DOWN:return}clearInterval(b.onChangeInterval),b.currentValue!==b.el.val()&&(b.findBestHint(),b.options.deferRequestBy>0?b.onChangeInterval=setInterval(function(){b.onValueChange()},b.options.deferRequestBy):b.onValueChange())}},onValueChange:function(){var b=this,c=b.options,d=b.el.val(),e=b.getQuery(d);return b.selection&&b.currentValue!==e&&(b.selection=null,(c.onInvalidateSelection||a.noop).call(b.element)),clearInterval(b.onChangeInterval),b.currentValue=d,b.selectedIndex=-1,c.triggerSelectOnValidInput&&b.isExactMatch(e)?void b.select(0):void(e.length<c.minChars?b.hide():b.getSuggestions(e))},isExactMatch:function(a){var b=this.suggestions;return 1===b.length&&b[0].value.toLowerCase()===a.toLowerCase()},getQuery:function(b){var c,d=this.options.delimiter;return d?(c=b.split(d),a.trim(c[c.length-1])):b},getSuggestionsLocal:function(b){var c,d=this,e=d.options,f=b.toLowerCase(),g=e.lookupFilter,h=parseInt(e.lookupLimit,10);return c={suggestions:a.grep(e.lookup,function(a){return g(a,b,f)})},h&&c.suggestions.length>h&&(c.suggestions=c.suggestions.slice(0,h)),c},getSuggestions:function(b){var c,d,e,f,g=this,h=g.options,i=h.serviceUrl;if(h.params[h.paramName]=b,d=h.ignoreParams?null:h.params,h.onSearchStart.call(g.element,h.params)!==!1){if(a.isFunction(h.lookup))return void h.lookup(b,function(a){g.suggestions=a.suggestions,g.suggest(),h.onSearchComplete.call(g.element,b,a.suggestions)});g.isLocal?c=g.getSuggestionsLocal(b):(a.isFunction(i)&&(i=i.call(g.element,b)),e=i+"?"+a.param(d||{}),c=g.cachedResponse[e]),c&&a.isArray(c.suggestions)?(g.suggestions=c.suggestions,g.suggest(),h.onSearchComplete.call(g.element,b,c.suggestions)):g.isBadQuery(b)?h.onSearchComplete.call(g.element,b,[]):(g.abortAjax(),f={url:i,data:d,type:h.type,dataType:h.dataType},a.extend(f,h.ajaxSettings),g.currentRequest=a.ajax(f).done(function(a){var c;g.currentRequest=null,c=h.transformResult(a,b),g.processResponse(c,b,e),h.onSearchComplete.call(g.element,b,c.suggestions)}).fail(function(a,c,d){h.onSearchError.call(g.element,b,a,c,d)}))}},isBadQuery:function(a){if(!this.options.preventBadQueries)return!1;for(var b=this.badQueries,c=b.length;c--;)if(0===a.indexOf(b[c]))return!0;return!1},hide:function(){var b=this,c=a(b.suggestionsContainer);a.isFunction(b.options.onHide)&&b.visible&&b.options.onHide.call(b.element,c),b.visible=!1,b.selectedIndex=-1,clearInterval(b.onChangeInterval),a(b.suggestionsContainer).hide(),b.signalHint(null)},suggest:function(){if(!this.suggestions.length)return void(this.options.showNoSuggestionNotice?this.noSuggestions():this.hide());var b,c=this,d=c.options,e=d.groupBy,f=d.formatResult,g=c.getQuery(c.currentValue),h=c.classes.suggestion,i=c.classes.selected,j=a(c.suggestionsContainer),k=a(c.noSuggestionsContainer),l=d.beforeRender,m="",n=function(a,c){var d=a.data[e];return b===d?"":(b=d,'<div class="autocomplete-group"><strong>'+b+"</strong></div>")};return d.triggerSelectOnValidInput&&c.isExactMatch(g)?void c.select(0):(a.each(c.suggestions,function(a,b){e&&(m+=n(b,g,a)),m+='<div class="'+h+'" data-index="'+a+'">'+f(b,g,a)+"</div>"}),this.adjustContainerWidth(),k.detach(),j.html(m),a.isFunction(l)&&l.call(c.element,j,c.suggestions),c.fixPosition(),j.show(),d.autoSelectFirst&&(c.selectedIndex=0,j.scrollTop(0),j.children("."+h).first().addClass(i)),c.visible=!0,void c.findBestHint())},noSuggestions:function(){var b=this,c=a(b.suggestionsContainer),d=a(b.noSuggestionsContainer);this.adjustContainerWidth(),d.detach(),c.empty(),c.append(d),b.fixPosition(),c.show(),b.visible=!0},adjustContainerWidth:function(){var b,c=this,d=c.options,e=a(c.suggestionsContainer);"auto"===d.width&&(b=c.el.outerWidth(),e.css("width",b>0?b:300))},findBestHint:function(){var b=this,c=b.el.val().toLowerCase(),d=null;c&&(a.each(b.suggestions,function(a,b){var e=0===b.value.toLowerCase().indexOf(c);return e&&(d=b),!e}),b.signalHint(d))},signalHint:function(b){var c="",d=this;b&&(c=d.currentValue+b.value.substr(d.currentValue.length)),d.hintValue!==c&&(d.hintValue=c,d.hint=b,(this.options.onHint||a.noop)(c))},verifySuggestionsFormat:function(b){return b.length&&"string"==typeof b[0]?a.map(b,function(a){return{value:a,data:null}}):b},validateOrientation:function(b,c){return b=a.trim(b||"").toLowerCase(),-1===a.inArray(b,["auto","bottom","top"])&&(b=c),b},processResponse:function(a,b,c){var d=this,e=d.options;a.suggestions=d.verifySuggestionsFormat(a.suggestions),e.noCache||(d.cachedResponse[c]=a,e.preventBadQueries&&!a.suggestions.length&&d.badQueries.push(b)),b===d.getQuery(d.currentValue)&&(d.suggestions=a.suggestions,d.suggest())},activate:function(b){var c,d=this,e=d.classes.selected,f=a(d.suggestionsContainer),g=f.find("."+d.classes.suggestion);return f.find("."+e).removeClass(e),d.selectedIndex=b,-1!==d.selectedIndex&&g.length>d.selectedIndex?(c=g.get(d.selectedIndex),a(c).addClass(e),c):null},selectHint:function(){var b=this,c=a.inArray(b.hint,b.suggestions);b.select(c)},select:function(a){var b=this;b.hide(),b.onSelect(a),b.disableKillerFn()},moveUp:function(){var b=this;if(-1!==b.selectedIndex)return 0===b.selectedIndex?(a(b.suggestionsContainer).children().first().removeClass(b.classes.selected),b.selectedIndex=-1,b.el.val(b.currentValue),void b.findBestHint()):void b.adjustScroll(b.selectedIndex-1)},moveDown:function(){var a=this;a.selectedIndex!==a.suggestions.length-1&&a.adjustScroll(a.selectedIndex+1)},adjustScroll:function(b){var c=this,d=c.activate(b);if(d){var e,f,g,h=a(d).outerHeight();e=d.offsetTop,f=a(c.suggestionsContainer).scrollTop(),g=f+c.options.maxHeight-h,f>e?a(c.suggestionsContainer).scrollTop(e):e>g&&a(c.suggestionsContainer).scrollTop(e-c.options.maxHeight+h),c.options.preserveInput||c.el.val(c.getValue(c.suggestions[b].value)),c.signalHint(null)}},onSelect:function(b){var c=this,d=c.options.onSelect,e=c.suggestions[b];c.currentValue=c.getValue(e.value),c.currentValue===c.el.val()||c.options.preserveInput||c.el.val(c.currentValue),c.signalHint(null),c.suggestions=[],c.selection=e,a.isFunction(d)&&d.call(c.element,e)},getValue:function(a){var b,c,d=this,e=d.options.delimiter;return e?(b=d.currentValue,c=b.split(e),1===c.length?a:b.substr(0,b.length-c[c.length-1].length)+a):a},dispose:function(){var b=this;b.el.off(".autocomplete").removeData("autocomplete"),b.disableKillerFn(),a(window).off("resize.autocomplete",b.fixPositionCapture),a(b.suggestionsContainer).remove()}},a.fn.autocomplete=a.fn.devbridgeAutocomplete=function(c,d){var e="autocomplete";return arguments.length?this.each(function(){var f=a(this),g=f.data(e);"string"==typeof c?g&&"function"==typeof g[c]&&g[c](d):(g&&g.dispose&&g.dispose(),g=new b(this,c),f.data(e,g))}):this.first().data(e)}});
(function(j,f){var c=j(window);function n(){return new Date(Date.UTC.apply(Date,arguments));}function g(){var q=new Date();return n(q.getFullYear(),q.getMonth(),q.getDate());
}function l(q){return function(){return this[q].apply(this,arguments);};}var e=(function(){var q={get:function(r){return this.slice(r)[0];},contains:function(u){var t=u&&u.valueOf();
for(var s=0,r=this.length;s<r;s++){if(this[s].valueOf()===t){return s;}}return -1;},remove:function(r){this.splice(r,1);},replace:function(r){if(!r){return;
}if(!j.isArray(r)){r=[r];}this.clear();this.push.apply(this,r);},clear:function(){this.splice(0);},copy:function(){var r=new e();r.replace(this);return r;
}};return function(){var r=[];r.push.apply(r,arguments);j.extend(r,q);return r;};})();var k=function(r,q){this.dates=new e();this.viewDate=g();this.focusDate=null;
this._process_options(q);this.element=j(r);this.isInline=false;this.isInput=this.element.is("input");this.component=this.element.is(".date")?this.element.find(".add-on, .input-group-addon, .btn"):false;
this.hasInput=this.component&&this.element.find("input").length;if(this.component&&this.component.length===0){this.component=false;}this.picker=j(m.template);
this._buildEvents();this._attachEvents();if(this.isInline){this.picker.addClass("datepicker-inline").appendTo(this.element);}else{this.picker.addClass("datepicker-dropdown dropdown-menu");
}if(this.o.rtl){this.picker.addClass("datepicker-rtl");}this.viewMode=this.o.startView;if(this.o.calendarWeeks){this.picker.find("tfoot th.today").attr("colspan",function(s,t){return parseInt(t)+1;
});}this._allow_update=false;this.setStartDate(this._o.startDate);this.setEndDate(this._o.endDate);this.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled);
this.fillDow();this.fillMonths();this._allow_update=true;this.update();this.showMode();if(this.isInline){this.show();}};k.prototype={constructor:k,_process_options:function(q){this._o=j.extend({},this._o,q);
var u=this.o=j.extend({},this._o);var t=u.language;if(!b[t]){t=t.split("-")[0];if(!b[t]){t=h.language;}}u.language=t;switch(u.startView){case 2:case"decade":u.startView=2;
break;case 1:case"year":u.startView=1;break;default:u.startView=0;}switch(u.minViewMode){case 1:case"months":u.minViewMode=1;break;case 2:case"years":u.minViewMode=2;
break;default:u.minViewMode=0;}u.startView=Math.max(u.startView,u.minViewMode);if(u.multidate!==true){u.multidate=Number(u.multidate)||false;if(u.multidate!==false){u.multidate=Math.max(0,u.multidate);
}else{u.multidate=1;}}u.multidateSeparator=String(u.multidateSeparator);u.weekStart%=7;u.weekEnd=((u.weekStart+6)%7);var r=m.parseFormat(u.format);if(u.startDate!==-Infinity){if(!!u.startDate){if(u.startDate instanceof Date){u.startDate=this._local_to_utc(this._zero_time(u.startDate));
}else{u.startDate=m.parseDate(u.startDate,r,u.language);}}else{u.startDate=-Infinity;}}if(u.endDate!==Infinity){if(!!u.endDate){if(u.endDate instanceof Date){u.endDate=this._local_to_utc(this._zero_time(u.endDate));
}else{u.endDate=m.parseDate(u.endDate,r,u.language);}}else{u.endDate=Infinity;}}u.daysOfWeekDisabled=u.daysOfWeekDisabled||[];if(!j.isArray(u.daysOfWeekDisabled)){u.daysOfWeekDisabled=u.daysOfWeekDisabled.split(/[,\s]*/);
}u.daysOfWeekDisabled=j.map(u.daysOfWeekDisabled,function(w){return parseInt(w,10);});var s=String(u.orientation).toLowerCase().split(/\s+/g),v=u.orientation.toLowerCase();
s=j.grep(s,function(w){return(/^auto|left|right|top|bottom$/).test(w);});u.orientation={x:"auto",y:"auto"};if(!v||v==="auto"){}else{if(s.length===1){switch(s[0]){case"top":case"bottom":u.orientation.y=s[0];
break;case"left":case"right":u.orientation.x=s[0];break;}}else{v=j.grep(s,function(w){return(/^left|right$/).test(w);});u.orientation.x=v[0]||"auto";v=j.grep(s,function(w){return(/^top|bottom$/).test(w);
});u.orientation.y=v[0]||"auto";}}},_events:[],_secondaryEvents:[],_applyEvents:function(q){for(var r=0,t,s,u;r<q.length;r++){t=q[r][0];if(q[r].length===2){s=f;
u=q[r][1];}else{if(q[r].length===3){s=q[r][1];u=q[r][2];}}t.on(u,s);}},_unapplyEvents:function(q){for(var r=0,t,u,s;r<q.length;r++){t=q[r][0];if(q[r].length===2){s=f;
u=q[r][1];}else{if(q[r].length===3){s=q[r][1];u=q[r][2];}}t.off(u,s);}},_buildEvents:function(){if(this.isInput){this._events=[[this.element,{focus:j.proxy(this.show,this),keyup:j.proxy(function(q){if(j.inArray(q.keyCode,[27,37,39,38,40,32,13,9])===-1){this.update();
}},this),keydown:j.proxy(this.keydown,this)}]];}else{if(this.component&&this.hasInput){this._events=[[this.element.find("input"),{focus:j.proxy(this.show,this),keyup:j.proxy(function(q){if(j.inArray(q.keyCode,[27,37,39,38,40,32,13,9])===-1){this.update();
}},this),keydown:j.proxy(this.keydown,this)}],[this.component,{click:j.proxy(this.show,this)}]];}else{if(this.element.is("div")){this.isInline=true;}else{this._events=[[this.element,{click:j.proxy(this.show,this)}]];
}}}this._events.push([this.element,"*",{blur:j.proxy(function(q){this._focused_from=q.target;},this)}],[this.element,{blur:j.proxy(function(q){this._focused_from=q.target;
},this)}]);this._secondaryEvents=[[this.picker,{click:j.proxy(this.click,this)}],[j(window),{resize:j.proxy(this.place,this)}],[j(document),{"mousedown touchstart":j.proxy(function(q){if(!(this.element.is(q.target)||this.element.find(q.target).length||this.picker.is(q.target)||this.picker.find(q.target).length)){this.hide();
}},this)}]];},_attachEvents:function(){this._detachEvents();this._applyEvents(this._events);},_detachEvents:function(){this._unapplyEvents(this._events);
},_attachSecondaryEvents:function(){this._detachSecondaryEvents();this._applyEvents(this._secondaryEvents);},_detachSecondaryEvents:function(){this._unapplyEvents(this._secondaryEvents);
},_trigger:function(s,t){var r=t||this.dates.get(-1),q=this._utc_to_local(r);this.element.trigger({type:s,date:q,dates:j.map(this.dates,this._utc_to_local),format:j.proxy(function(u,w){if(arguments.length===0){u=this.dates.length-1;
w=this.o.format;}else{if(typeof u==="string"){w=u;u=this.dates.length-1;}}w=w||this.o.format;var v=this.dates.get(u);return m.formatDate(v,w,this.o.language);
},this)});},show:function(){if(!this.isInline){this.picker.appendTo("body");}this.picker.show();this.place();this._attachSecondaryEvents();this._trigger("show");
},hide:function(){if(this.isInline){return;}if(!this.picker.is(":visible")){return;}this.focusDate=null;this.picker.hide().detach();this._detachSecondaryEvents();
this.viewMode=this.o.startView;this.showMode();if(this.o.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())){this.setValue();
}this._trigger("hide");},remove:function(){this.hide();this._detachEvents();this._detachSecondaryEvents();this.picker.remove();delete this.element.data().datepicker;
if(!this.isInput){delete this.element.data().date;}},_utc_to_local:function(q){return q&&new Date(q.getTime()+(q.getTimezoneOffset()*60000));},_local_to_utc:function(q){return q&&new Date(q.getTime()-(q.getTimezoneOffset()*60000));
},_zero_time:function(q){return q&&new Date(q.getFullYear(),q.getMonth(),q.getDate());},_zero_utc_time:function(q){return q&&new Date(Date.UTC(q.getUTCFullYear(),q.getUTCMonth(),q.getUTCDate()));
},getDates:function(){return j.map(this.dates,this._utc_to_local);},getUTCDates:function(){return j.map(this.dates,function(q){return new Date(q);});},getDate:function(){return this._utc_to_local(this.getUTCDate());
},getUTCDate:function(){return new Date(this.dates.get(-1));},setDates:function(){var q=j.isArray(arguments[0])?arguments[0]:arguments;this.update.apply(this,q);
this._trigger("changeDate");this.setValue();},setUTCDates:function(){var q=j.isArray(arguments[0])?arguments[0]:arguments;this.update.apply(this,j.map(q,this._utc_to_local));
this._trigger("changeDate");this.setValue();},setDate:l("setDates"),setUTCDate:l("setUTCDates"),setValue:function(){var q=this.getFormattedDate();if(!this.isInput){if(this.component){this.element.find("input").val(q).change();
}}else{this.element.val(q).change();}},getFormattedDate:function(q){if(q===f){q=this.o.format;}var r=this.o.language;return j.map(this.dates,function(s){return m.formatDate(s,q,r);
}).join(this.o.multidateSeparator);},setStartDate:function(q){this._process_options({startDate:q});this.update();this.updateNavArrows();},setEndDate:function(q){this._process_options({endDate:q});
this.update();this.updateNavArrows();},setDaysOfWeekDisabled:function(q){this._process_options({daysOfWeekDisabled:q});this.update();this.updateNavArrows();
},place:function(){if(this.isInline){return;}var E=this.picker.outerWidth(),A=this.picker.outerHeight(),u=10,w=c.width(),r=c.height(),v=c.scrollTop();var C=parseInt(this.element.parents().filter(function(){return j(this).css("z-index")!=="auto";
}).first().css("z-index"))+10;var z=this.component?this.component.parent().offset():this.element.offset();var D=this.component?this.component.outerHeight(true):this.element.outerHeight(false);
var t=this.component?this.component.outerWidth(true):this.element.outerWidth(false);var y=z.left,B=z.top;this.picker.removeClass("datepicker-orient-top datepicker-orient-bottom datepicker-orient-right datepicker-orient-left");
if(this.o.orientation.x!=="auto"){this.picker.addClass("datepicker-orient-"+this.o.orientation.x);if(this.o.orientation.x==="right"){y-=E-t;}}else{this.picker.addClass("datepicker-orient-left");
if(z.left<0){y-=z.left-u;}else{if(z.left+E>w){y=w-E-u;}}}var q=this.o.orientation.y,s,x;if(q==="auto"){s=-v+z.top-A;x=v+r-(z.top+D+A);if(Math.max(s,x)===x){q="top";
}else{q="bottom";}}this.picker.addClass("datepicker-orient-"+q);if(q==="top"){B+=D;}else{B-=A+parseInt(this.picker.css("padding-top"));}this.picker.css({top:B,left:y,zIndex:C});
},_allow_update:true,update:function(){if(!this._allow_update){return;}var r=this.dates.copy(),s=[],q=false;if(arguments.length){j.each(arguments,j.proxy(function(u,t){if(t instanceof Date){t=this._local_to_utc(t);
}s.push(t);},this));q=true;}else{s=this.isInput?this.element.val():this.element.data("date")||this.element.find("input").val();if(s&&this.o.multidate){s=s.split(this.o.multidateSeparator);
}else{s=[s];}delete this.element.data().date;}s=j.map(s,j.proxy(function(t){return m.parseDate(t,this.o.format,this.o.language);},this));s=j.grep(s,j.proxy(function(t){return(t<this.o.startDate||t>this.o.endDate||!t);
},this),true);this.dates.replace(s);if(this.dates.length){this.viewDate=new Date(this.dates.get(-1));}else{if(this.viewDate<this.o.startDate){this.viewDate=new Date(this.o.startDate);
}else{if(this.viewDate>this.o.endDate){this.viewDate=new Date(this.o.endDate);}}}if(q){this.setValue();}else{if(s.length){if(String(r)!==String(this.dates)){this._trigger("changeDate");
}}}if(!this.dates.length&&r.length){this._trigger("clearDate");}this.fill();},fillDow:function(){var r=this.o.weekStart,s="<tr>";if(this.o.calendarWeeks){var q='<th class="cw">&nbsp;</th>';
s+=q;this.picker.find(".datepicker-days thead tr:first-child").prepend(q);}while(r<this.o.weekStart+7){s+='<th class="dow">'+b[this.o.language].daysMin[(r++)%7]+"</th>";
}s+="</tr>";this.picker.find(".datepicker-days thead").append(s);},fillMonths:function(){var r="",q=0;while(q<12){r+='<span class="month">'+b[this.o.language].monthsShort[q++]+"</span>";
}this.picker.find(".datepicker-months td").html(r);},setRange:function(q){if(!q||!q.length){delete this.range;}else{this.range=j.map(q,function(r){return r.valueOf();
});}this.fill();},getClassNames:function(s){var q=[],t=this.viewDate.getUTCFullYear(),u=this.viewDate.getUTCMonth(),r=new Date();if(s.getUTCFullYear()<t||(s.getUTCFullYear()===t&&s.getUTCMonth()<u)){q.push("old");
}else{if(s.getUTCFullYear()>t||(s.getUTCFullYear()===t&&s.getUTCMonth()>u)){q.push("new");}}if(this.focusDate&&s.valueOf()===this.focusDate.valueOf()){q.push("focused");
}if(this.o.todayHighlight&&s.getUTCFullYear()===r.getFullYear()&&s.getUTCMonth()===r.getMonth()&&s.getUTCDate()===r.getDate()){q.push("today");}if(this.dates.contains(s)!==-1){q.push("active");
}if(s.valueOf()<this.o.startDate||s.valueOf()>this.o.endDate||j.inArray(s.getUTCDay(),this.o.daysOfWeekDisabled)!==-1){q.push("disabled");}if(this.range){if(s>this.range[0]&&s<this.range[this.range.length-1]){q.push("range");
}if(j.inArray(s.valueOf(),this.range)!==-1){q.push("selected");}}return q;},fill:function(){var L=new Date(this.viewDate),A=L.getUTCFullYear(),M=L.getUTCMonth(),F=this.o.startDate!==-Infinity?this.o.startDate.getUTCFullYear():-Infinity,J=this.o.startDate!==-Infinity?this.o.startDate.getUTCMonth():-Infinity,x=this.o.endDate!==Infinity?this.o.endDate.getUTCFullYear():Infinity,G=this.o.endDate!==Infinity?this.o.endDate.getUTCMonth():Infinity,y=b[this.o.language].today||b.en.today||"",s=b[this.o.language].clear||b.en.clear||"",u;
this.picker.find(".datepicker-days thead th.datepicker-switch").text(b[this.o.language].months[M]+" "+A);this.picker.find("tfoot th.today").text(y).toggle(this.o.todayBtn!==false);
this.picker.find("tfoot th.clear").text(s).toggle(this.o.clearBtn!==false);this.updateNavArrows();this.fillMonths();var O=n(A,M-1,28),I=m.getDaysInMonth(O.getUTCFullYear(),O.getUTCMonth());
O.setUTCDate(I);O.setUTCDate(I-(O.getUTCDay()-this.o.weekStart+7)%7);var q=new Date(O);q.setUTCDate(q.getUTCDate()+42);q=q.valueOf();var z=[];var D;while(O.valueOf()<q){if(O.getUTCDay()===this.o.weekStart){z.push("<tr>");
if(this.o.calendarWeeks){var r=new Date(+O+(this.o.weekStart-O.getUTCDay()-7)%7*86400000),v=new Date(Number(r)+(7+4-r.getUTCDay())%7*86400000),t=new Date(Number(t=n(v.getUTCFullYear(),0,1))+(7+4-t.getUTCDay())%7*86400000),B=(v-t)/86400000/7+1;
z.push('<td class="cw">'+B+"</td>");}}D=this.getClassNames(O);D.push("day");if(this.o.beforeShowDay!==j.noop){var C=this.o.beforeShowDay(this._utc_to_local(O));
if(C===f){C={};}else{if(typeof(C)==="boolean"){C={enabled:C};}else{if(typeof(C)==="string"){C={classes:C};}}}if(C.enabled===false){D.push("disabled");}if(C.classes){D=D.concat(C.classes.split(/\s+/));
}if(C.tooltip){u=C.tooltip;}}D=j.unique(D);z.push('<td class="'+D.join(" ")+'"'+(u?' title="'+u+'"':"")+">"+O.getUTCDate()+"</td>");if(O.getUTCDay()===this.o.weekEnd){z.push("</tr>");
}O.setUTCDate(O.getUTCDate()+1);}this.picker.find(".datepicker-days tbody").empty().append(z.join(""));var w=this.picker.find(".datepicker-months").find("th:eq(1)").text(A).end().find("span").removeClass("active");
j.each(this.dates,function(P,Q){if(Q.getUTCFullYear()===A){w.eq(Q.getUTCMonth()).addClass("active");}});if(A<F||A>x){w.addClass("disabled");}if(A===F){w.slice(0,J).addClass("disabled");
}if(A===x){w.slice(G+1).addClass("disabled");}z="";A=parseInt(A/10,10)*10;var N=this.picker.find(".datepicker-years").find("th:eq(1)").text(A+"-"+(A+9)).end().find("td");
A-=1;var E=j.map(this.dates,function(P){return P.getUTCFullYear();}),K;for(var H=-1;H<11;H++){K=["year"];if(H===-1){K.push("old");}else{if(H===10){K.push("new");
}}if(j.inArray(A,E)!==-1){K.push("active");}if(A<F||A>x){K.push("disabled");}z+='<span class="'+K.join(" ")+'">'+A+"</span>";A+=1;}N.html(z);},updateNavArrows:function(){if(!this._allow_update){return;
}var s=new Date(this.viewDate),q=s.getUTCFullYear(),r=s.getUTCMonth();switch(this.viewMode){case 0:if(this.o.startDate!==-Infinity&&q<=this.o.startDate.getUTCFullYear()&&r<=this.o.startDate.getUTCMonth()){this.picker.find(".prev").css({visibility:"hidden"});
}else{this.picker.find(".prev").css({visibility:"visible"});}if(this.o.endDate!==Infinity&&q>=this.o.endDate.getUTCFullYear()&&r>=this.o.endDate.getUTCMonth()){this.picker.find(".next").css({visibility:"hidden"});
}else{this.picker.find(".next").css({visibility:"visible"});}break;case 1:case 2:if(this.o.startDate!==-Infinity&&q<=this.o.startDate.getUTCFullYear()){this.picker.find(".prev").css({visibility:"hidden"});
}else{this.picker.find(".prev").css({visibility:"visible"});}if(this.o.endDate!==Infinity&&q>=this.o.endDate.getUTCFullYear()){this.picker.find(".next").css({visibility:"hidden"});
}else{this.picker.find(".next").css({visibility:"visible"});}break;}},click:function(u){u.preventDefault();var v=j(u.target).closest("span, td, th"),x,w,y;
if(v.length===1){switch(v[0].nodeName.toLowerCase()){case"th":switch(v[0].className){case"datepicker-switch":this.showMode(1);break;case"prev":case"next":var q=m.modes[this.viewMode].navStep*(v[0].className==="prev"?-1:1);
switch(this.viewMode){case 0:this.viewDate=this.moveMonth(this.viewDate,q);this._trigger("changeMonth",this.viewDate);break;case 1:case 2:this.viewDate=this.moveYear(this.viewDate,q);
if(this.viewMode===1){this._trigger("changeYear",this.viewDate);}break;}this.fill();break;case"today":var r=new Date();r=n(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0);
this.showMode(-2);var s=this.o.todayBtn==="linked"?null:"view";this._setDate(r,s);break;case"clear":var t;if(this.isInput){t=this.element;}else{if(this.component){t=this.element.find("input");
}}if(t){t.val("").change();}this.update();this._trigger("changeDate");if(this.o.autoclose){this.hide();}break;}break;case"span":if(!v.is(".disabled")){this.viewDate.setUTCDate(1);
if(v.is(".month")){y=1;w=v.parent().find("span").index(v);x=this.viewDate.getUTCFullYear();this.viewDate.setUTCMonth(w);this._trigger("changeMonth",this.viewDate);
if(this.o.minViewMode===1){this._setDate(n(x,w,y));}}else{y=1;w=0;x=parseInt(v.text(),10)||0;this.viewDate.setUTCFullYear(x);this._trigger("changeYear",this.viewDate);
if(this.o.minViewMode===2){this._setDate(n(x,w,y));}}this.showMode(-1);this.fill();}break;case"td":if(v.is(".day")&&!v.is(".disabled")){y=parseInt(v.text(),10)||1;
x=this.viewDate.getUTCFullYear();w=this.viewDate.getUTCMonth();if(v.is(".old")){if(w===0){w=11;x-=1;}else{w-=1;}}else{if(v.is(".new")){if(w===11){w=0;x+=1;
}else{w+=1;}}}this._setDate(n(x,w,y));}break;}}if(this.picker.is(":visible")&&this._focused_from){j(this._focused_from).focus();}delete this._focused_from;
},_toggle_multidate:function(r){var q=this.dates.contains(r);if(!r){this.dates.clear();}else{if(q!==-1){this.dates.remove(q);}else{this.dates.push(r);}}if(typeof this.o.multidate==="number"){while(this.dates.length>this.o.multidate){this.dates.remove(0);
}}},_setDate:function(q,s){if(!s||s==="date"){this._toggle_multidate(q&&new Date(q));}if(!s||s==="view"){this.viewDate=q&&new Date(q);}this.fill();this.setValue();
this._trigger("changeDate");var r;if(this.isInput){r=this.element;}else{if(this.component){r=this.element.find("input");}}if(r){r.change();}if(this.o.autoclose&&(!s||s==="date")){this.hide();
}},moveMonth:function(q,r){if(!q){return f;}if(!r){return q;}var u=new Date(q.valueOf()),y=u.getUTCDate(),v=u.getUTCMonth(),t=Math.abs(r),x,w;r=r>0?1:-1;
if(t===1){w=r===-1?function(){return u.getUTCMonth()===v;}:function(){return u.getUTCMonth()!==x;};x=v+r;u.setUTCMonth(x);if(x<0||x>11){x=(x+12)%12;}}else{for(var s=0;
s<t;s++){u=this.moveMonth(u,r);}x=u.getUTCMonth();u.setUTCDate(y);w=function(){return x!==u.getUTCMonth();};}while(w()){u.setUTCDate(--y);u.setUTCMonth(x);
}return u;},moveYear:function(r,q){return this.moveMonth(r,q*12);},dateWithinRange:function(q){return q>=this.o.startDate&&q<=this.o.endDate;},keydown:function(w){if(this.picker.is(":not(:visible)")){if(w.keyCode===27){this.show();
}return;}var s=false,r,q,u,v=this.focusDate||this.viewDate;switch(w.keyCode){case 27:if(this.focusDate){this.focusDate=null;this.viewDate=this.dates.get(-1)||this.viewDate;
this.fill();}else{this.hide();}w.preventDefault();break;case 37:case 39:if(!this.o.keyboardNavigation){break;}r=w.keyCode===37?-1:1;if(w.ctrlKey){q=this.moveYear(this.dates.get(-1)||g(),r);
u=this.moveYear(v,r);this._trigger("changeYear",this.viewDate);}else{if(w.shiftKey){q=this.moveMonth(this.dates.get(-1)||g(),r);u=this.moveMonth(v,r);this._trigger("changeMonth",this.viewDate);
}else{q=new Date(this.dates.get(-1)||g());q.setUTCDate(q.getUTCDate()+r);u=new Date(v);u.setUTCDate(v.getUTCDate()+r);}}if(this.dateWithinRange(q)){this.focusDate=this.viewDate=u;
this.setValue();this.fill();w.preventDefault();}break;case 38:case 40:if(!this.o.keyboardNavigation){break;}r=w.keyCode===38?-1:1;if(w.ctrlKey){q=this.moveYear(this.dates.get(-1)||g(),r);
u=this.moveYear(v,r);this._trigger("changeYear",this.viewDate);}else{if(w.shiftKey){q=this.moveMonth(this.dates.get(-1)||g(),r);u=this.moveMonth(v,r);this._trigger("changeMonth",this.viewDate);
}else{q=new Date(this.dates.get(-1)||g());q.setUTCDate(q.getUTCDate()+r*7);u=new Date(v);u.setUTCDate(v.getUTCDate()+r*7);}}if(this.dateWithinRange(q)){this.focusDate=this.viewDate=u;
this.setValue();this.fill();w.preventDefault();}break;case 32:break;case 13:v=this.focusDate||this.dates.get(-1)||this.viewDate;this._toggle_multidate(v);
s=true;this.focusDate=null;this.viewDate=this.dates.get(-1)||this.viewDate;this.setValue();this.fill();if(this.picker.is(":visible")){w.preventDefault();
if(this.o.autoclose){this.hide();}}break;case 9:this.focusDate=null;this.viewDate=this.dates.get(-1)||this.viewDate;this.fill();this.hide();break;}if(s){if(this.dates.length){this._trigger("changeDate");
}else{this._trigger("clearDate");}var t;if(this.isInput){t=this.element;}else{if(this.component){t=this.element.find("input");}}if(t){t.change();}}},showMode:function(q){if(q){this.viewMode=Math.max(this.o.minViewMode,Math.min(2,this.viewMode+q));
}this.picker.find(">div").hide().filter(".datepicker-"+m.modes[this.viewMode].clsName).css("display","block");this.updateNavArrows();}};var p=function(r,q){this.element=j(r);
this.inputs=j.map(q.inputs,function(s){return s.jquery?s[0]:s;});delete q.inputs;j(this.inputs).datepicker(q).bind("changeDate",j.proxy(this.dateUpdated,this));
this.pickers=j.map(this.inputs,function(s){return j(s).data("datepicker");});this.updateDates();};p.prototype={updateDates:function(){this.dates=j.map(this.pickers,function(q){return q.getUTCDate();
});this.updateRanges();},updateRanges:function(){var q=j.map(this.dates,function(r){return r.valueOf();});j.each(this.pickers,function(r,s){s.setRange(q);
});},dateUpdated:function(t){if(this.updating){return;}this.updating=true;var u=j(t.target).data("datepicker"),s=u.getUTCDate(),r=j.inArray(t.target,this.inputs),q=this.inputs.length;
if(r===-1){return;}j.each(this.pickers,function(v,w){if(!w.getUTCDate()){w.setUTCDate(s);}});if(s<this.dates[r]){while(r>=0&&s<this.dates[r]){this.pickers[r--].setUTCDate(s);
}}else{if(s>this.dates[r]){while(r<q&&s>this.dates[r]){this.pickers[r++].setUTCDate(s);}}}this.updateDates();delete this.updating;},remove:function(){j.map(this.pickers,function(q){q.remove();
});delete this.element.data().datepicker;}};function i(t,w){var v=j(t).data(),q={},u,s=new RegExp("^"+w.toLowerCase()+"([A-Z])");w=new RegExp("^"+w.toLowerCase());
function x(z,y){return y.toLowerCase();}for(var r in v){if(w.test(r)){u=r.replace(s,x);q[u]=v[r];}}return q;}function a(s){var q={};if(!b[s]){s=s.split("-")[0];
if(!b[s]){return;}}var r=b[s];j.each(o,function(u,t){if(t in r){q[t]=r[t];}});return q;}var d=j.fn.datepicker;j.fn.datepicker=function(s){var q=Array.apply(null,arguments);
q.shift();var r;this.each(function(){var A=j(this),y=A.data("datepicker"),u=typeof s==="object"&&s;if(!y){var w=i(this,"date"),t=j.extend({},h,w,u),v=a(t.language),x=j.extend({},h,v,w,u);
if(A.is(".input-daterange")||x.inputs){var z={inputs:x.inputs||A.find("input").toArray()};A.data("datepicker",(y=new p(this,j.extend(x,z))));}else{A.data("datepicker",(y=new k(this,x)));
}}if(typeof s==="string"&&typeof y[s]==="function"){r=y[s].apply(y,q);if(r!==f){return false;}}});if(r!==f){return r;}else{return this;}};var h=j.fn.datepicker.defaults={autoclose:false,beforeShowDay:j.noop,calendarWeeks:false,clearBtn:false,daysOfWeekDisabled:[],endDate:Infinity,forceParse:true,format:"mm/dd/yyyy",keyboardNavigation:true,language:"en",minViewMode:0,multidate:false,multidateSeparator:",",orientation:"auto",rtl:false,startDate:-Infinity,startView:0,todayBtn:false,todayHighlight:false,weekStart:0};
var o=j.fn.datepicker.locale_opts=["format","rtl","weekStart"];j.fn.datepicker.Constructor=k;var b=j.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear"}};
var m={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(q){return(((q%4===0)&&(q%100!==0))||(q%400===0));
},getDaysInMonth:function(q,r){return[31,(m.isLeapYear(q)?29:28),31,30,31,30,31,31,30,31,30,31][r];},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(s){var q=s.replace(this.validParts,"\0").split("\0"),r=s.match(this.validParts);
if(!q||!q.length||!r||r.length===0){throw new Error("Invalid date format.");}return{separators:q,parts:r};},parseDate:function(H,E,B){if(!H){return f;}if(H instanceof Date){return H;
}if(typeof E==="string"){E=m.parseFormat(E);}var t=/([\-+]\d+)([dmwy])/,z=H.match(/([\-+]\d+)([dmwy])/g),A,y,D;if(/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(H)){H=new Date();
for(D=0;D<z.length;D++){A=t.exec(z[D]);y=parseInt(A[1]);switch(A[2]){case"d":H.setUTCDate(H.getUTCDate()+y);break;case"m":H=k.prototype.moveMonth.call(k.prototype,H,y);
break;case"w":H.setUTCDate(H.getUTCDate()+y*7);break;case"y":H=k.prototype.moveYear.call(k.prototype,H,y);break;}}return n(H.getUTCFullYear(),H.getUTCMonth(),H.getUTCDate(),0,0,0);
}z=H&&H.match(this.nonpunctuation)||[];H=new Date();var u={},F=["yyyy","yy","M","MM","m","mm","d","dd"],x={yyyy:function(J,s){return J.setUTCFullYear(s);
},yy:function(J,s){return J.setUTCFullYear(2000+s);},m:function(J,s){if(isNaN(J)){return J;}s-=1;while(s<0){s+=12;}s%=12;J.setUTCMonth(s);while(J.getUTCMonth()!==s){J.setUTCDate(J.getUTCDate()-1);
}return J;},d:function(J,s){return J.setUTCDate(s);}},I,r;x.M=x.MM=x.mm=x.m;x.dd=x.d;H=n(H.getFullYear(),H.getMonth(),H.getDate(),0,0,0);var q=E.parts.slice();
if(z.length!==q.length){q=j(q).filter(function(s,J){return j.inArray(J,F)!==-1;}).toArray();}function G(){var s=this.slice(0,z[D].length),J=z[D].slice(0,s.length);
return s===J;}if(z.length===q.length){var C;for(D=0,C=q.length;D<C;D++){I=parseInt(z[D],10);A=q[D];if(isNaN(I)){switch(A){case"MM":r=j(b[B].months).filter(G);
I=j.inArray(r[0],b[B].months)+1;break;case"M":r=j(b[B].monthsShort).filter(G);I=j.inArray(r[0],b[B].monthsShort)+1;break;}}u[A]=I;}var v,w;for(D=0;D<F.length;
D++){w=F[D];if(w in u&&!isNaN(u[w])){v=new Date(H);x[w](v,u[w]);if(!isNaN(v)){H=v;}}}}return H;},formatDate:function(q,u,w){if(!q){return"";}if(typeof u==="string"){u=m.parseFormat(u);
}var v={d:q.getUTCDate(),D:b[w].daysShort[q.getUTCDay()],DD:b[w].days[q.getUTCDay()],m:q.getUTCMonth()+1,M:b[w].monthsShort[q.getUTCMonth()],MM:b[w].months[q.getUTCMonth()],yy:q.getUTCFullYear().toString().substring(2),yyyy:q.getUTCFullYear()};
v.dd=(v.d<10?"0":"")+v.d;v.mm=(v.m<10?"0":"")+v.m;q=[];var t=j.extend([],u.separators);for(var s=0,r=u.parts.length;s<=r;s++){if(t.length){q.push(t.shift());
}q.push(v[u.parts[s]]);}return q.join("");},headTemplate:'<thead><tr><th class="prev">&laquo;</th><th colspan="5" class="datepicker-switch"></th><th class="next">&raquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};
m.template='<div class="datepicker"><div class="datepicker-days"><table class=" table-condensed">'+m.headTemplate+"<tbody></tbody>"+m.footTemplate+'</table></div><div class="datepicker-months"><table class="table-condensed">'+m.headTemplate+m.contTemplate+m.footTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+m.headTemplate+m.contTemplate+m.footTemplate+"</table></div></div>";
j.fn.datepicker.DPGlobal=m;j.fn.datepicker.noConflict=function(){j.fn.datepicker=d;return this;};j(document).on("focus.datepicker.data-api click.datepicker.data-api",'[data-provide="datepicker"]',function(r){var q=j(this);
if(q.data("datepicker")){return;}r.preventDefault();q.datepicker("show");});j(function(){j('[data-provide="datepicker-inline"]').datepicker();});}(window.jQuery));
;
(function(a){a.fn.datepicker.dates.ru={days:["","","","","","","",""],daysShort:["","","","","","","",""],daysMin:["","","","","","","",""],months:["","","","","","","","","","","",""],monthsShort:["","","","","","","","","","","",""],today:"",clear:" ",weekStart:1};
a.fn.datepicker.defaults.format="dd.mm.yyyy";a.fn.datepicker.defaults.language="ru";a.fn.datepicker.defaults.autoclose=true;}(jQuery));
/**
 * jBox is a jQuery plugin that makes it easy to create customizable tooltips, modal windows, image galleries and more.
 *
 * Author: Stephan Wagner (https://stephanwagner.me)
 *
 * License: MIT (https://opensource.org/licenses/MIT)
 *
 * Requires: jQuery 3.2.1 (https://code.jquery.com/jquery-3.2.1.min.js)
 *
 * Documentation: https://stephanwagner.me/jBox/documentation
 *
 * Demos: https://stephanwagner.me/jBox/demos
 */


// AMD and CommonJS support: http://ifandelse.com/its-not-hard-making-your-library-support-amd-and-commonjs

(function (root, factory) {
  
  // AMD support

  if (typeof define === 'function' && define.amd) {
    
    define(['jquery'], function(jQuery) {
      return (root.jBox = factory(jQuery));
    });
  
  // CommonJS support
  
  } else if (typeof module === 'object' && module.exports) {
    
    module.exports = (root.jBox = factory(require('jquery')));
  
  // Browser
  
  } else {
    
    root.jBox = factory(root.jQuery);
    
  }

}(this, function (jQuery) {
    
    
  // The actual jBox plugin starts here
    
  var jBox = function jBox(type, options) {
    
    
    // Options (https://stephanwagner.me/jBox/options)
    
    this.options = {
      
      // jBox ID
      id: null,                    // Choose a unique id, otherwise jBox will set one for you (jBox1, jBox2, ...)
      
      // Dimensions
      width: 'auto',               // The width of the content area, e.g. 'auto', 200, '80%'
      height: 'auto',              // The height of the content area
      minWidth: null,              // Minimal width
      minHeight: null,             // Minimal height
      maxWidth: null,              // Maximal width
      maxHeight: null,             // Maximal height
      
      // Responsive dimensions
      responsiveWidth: true,       // Adjusts the width to fit the viewport
      responsiveHeight: true,      // Adjusts the height to fit the viewport
      responsiveMinWidth: 100,     // Don't adjust width below this value (in pixel)
      responsiveMinHeight: 100,    // Don't adjust height below this value (in pixel)
      
      // Attach
      attach: null,                // A jQuery selector to elements that will open and close your jBox, e.g. '.tooltip'
      trigger: 'click',            // The event to open or close your jBox, use 'click', 'touchclick' or 'mouseenter'
      preventDefault: false,       // Prevent the default event when opening jBox, e.g. don't follow the href in a link
      
      // Content
      content: null,               // You can use HTML or a jQuery element, e.g. jQuery('#jBox-content'). The elements will be appended to the content element and then made visible, so hide them with style="display: none" beforehand
      getContent: null,            // Get the content from an attribute when jBox opens, e.g. getContent: 'data-content'. Use 'html' to get the attached elements HTML as content
      title: null,                 // Adds a title to your jBox
      getTitle: null,              // Get the title from an attribute when jBox opens, e.g. getTitle: 'data-title'
      footer: null,                // Adds a footer to your jBox
      isolateScroll: true,         // Isolates scrolling to the content container
      
      // AJAX
      ajax: {                      // Setting an URL will make an AJAX request when jBox opens. Optional you can add any jQuery AJAX option (http://api.jquery.com/jquery.ajax/)
        url: null,                 // The URL to send the AJAX request to
        data: '',                  // Data to send with your AJAX request, e.g. {id: 82, limit: 10}
        reload: false,             // Resend the AJAX request when jBox opens. Use true to send the AJAX request only once for every attached element or 'strict' to resend every time jBox opens
        getURL: 'data-url',        // The attribute in the source element where the AJAX request will look for the URL, e.g. data-url="https://ajaxresponse.com"
        getData: 'data-ajax',      // The attribute in the source element where the AJAX request will look for the data, e.g. data-ajax="id=82&limit=10"
        setContent: true,          // Automatically set the response as new content when the AJAX request is finished
        spinner: true,             // Hides the current content and adds a spinner while loading. You can pass HTML content to add your own spinner, e.g. spinner: '<div class="mySpinner"></div>'
        spinnerDelay: 300,         // Milliseconds to wait until spinner appears
        spinnerReposition: true    // Repositions jBox when the spinner is added or removed
      },
      
      // Position
      followMouse: false,          // open in mouse position

      target: null,                // The jQuery selector to the target element where jBox will be opened. If no element is found, jBox will use the attached element as target
      position: {
        x: 'center',               // Horizontal position, use a number, 'left', 'right' or 'center'
        y: 'center'                // Vertical position, use a number, 'top', 'bottom' or 'center'
      },
      outside: null,               // Use 'x', 'y', or 'xy' to move your jBox outside of the target element
      offset: 0,                   // Offset to final position, you can set different values for x and y with an object, e.g. {x: 20, y: 10}
      attributes: {                // Note that attributes can only be 'left' or 'right' when using numbers for position, e.g. {x: 300, y: 20}
        x: 'left',                 // Horizontal position, use 'left' or 'right'
        y: 'top'                   // Vertical position, use 'top' or 'bottom'
      },
      fixed: false,                // Your jBox will stay on position when scrolling
      adjustPosition: true,        // Adjusts your jBoxes position if there is not enough space, use 'flip', 'move' or true for both. This option overrides the reposition options
      adjustTracker: false,        // By default jBox adjusts its position when it opens or when the window size changes, set to true to also adjust when scrolling
      adjustDistance: 5,           // The minimal distance to the viewport edge while adjusting. Use an object to set different values, e.g. {top: 50, right: 5, bottom: 20, left: 5}
      reposition: true,            // Calculates new position when the window-size changes
      repositionOnOpen: true,      // Calculates new position each time jBox opens (rather than only when it opens the first time)
      repositionOnContent: true,   // Calculates new position when the content changes with .setContent() or .setTitle()
      
      // Pointer
      pointer: false,              // Your pointer will always point towards the target element, so the option outside needs to be 'x' or 'y'. By default the pointer is centered, set a position to move it to any side. You can also add an offset, e.g. 'left:30' or 'center:-20'
      pointTo: 'target',           // Setting something else than 'target' will add a pointer even if there is no target element set or found. Use 'top', 'right', 'bottom' or 'left'
      
      // Animations
      fade: 180,                   // Fade duration in ms, set to 0 or false to disable
      animation: null,             // Animation when opening or closing, use 'pulse', 'zoomIn', 'zoomOut', 'move', 'slide', 'flip', 'tada' (CSS inspired from Daniel Edens Animate.css: http://daneden.me/animate)
      
      // Appearance
      theme: 'Default',            // Set a jBox theme class
      addClass: null,              // Adds classes to the wrapper
      overlay: false,              // Adds an overlay to hide page content when jBox opens (adjust color and opacity with CSS)
      zIndex: 10000,               // Use a high z-index
      
      // Delays
      delayOpen: 0,                // Delay opening in ms. Note that the delay will be ignored if your jBox didn't finish closing
      delayClose: 0,               // Delay closing in ms. Nnote that there is always a closing delay of at least 10ms to ensure jBox won't be closed when opening right away
      
      // Closing
      closeOnEsc: false,           // Close jBox when pressing [esc] key
      closeOnClick: false,         // Close jBox with mouseclick. Use true (click anywhere), 'box' (click on jBox itself), 'overlay' (click on the overlay), 'body' (click anywhere but jBox)
      closeOnMouseleave: false,    // Close jBox when the mouse leaves the jBox area or the area of the attached element
      closeButton: false,          // Adds a close button to your jBox. Use 'title', 'box', 'overlay' or true (true will add the button to the overlay, title or the jBox itself, in that order if any of those elements can be found)
      
      // Other options
      appendTo: jQuery('body'),    // The element your jBox will be appended to. Any other element than jQuery('body') is only useful for fixed positions or when position values are numbers
      createOnInit: false,         // Creates jBox and makes it available in DOM when it's being initialized, otherwise it will be created when it opens for the first time
      blockScroll: false,          // Blocks scrolling when jBox is open
      draggable: false,            // Make your jBox draggable (use 'true', 'title' or provide an element as handle) (inspired from Chris Coyiers CSS-Tricks http://css-tricks.com/snippets/jquery/draggable-without-jquery-ui/)
      dragOver: true,              // When you have multiple draggable jBoxes, the one you select will always move over the other ones
      autoClose: false,            // Time in ms when jBox will close automatically after it was opened
      delayOnHover: false,         // Delay auto-closing while mouse is hovered
      showCountdown: false,        // Display a nice progress-indicator when autoClose is enabled
      
      // Audio                     // You can use the integrated audio function whenever you'd like to play an audio file, e.g. onInit: function () { this.audio('url_to_audio_file_without_file_extension', 75); }
      preloadAudio: true,          // Preloads the audio files set in option audio. You can also preload other audio files, e.g. ['src_to_file.mp3', 'src_to_file.ogg']
      audio: null,                 // The URL to an audio file to play when jBox opens. Set the URL without file extension, jBox will look for an .mp3 and .ogg file. To play audio when jBox closes, use an object, e.g. {open: 'src_to_audio1', close: 'src_to_audio2'}
      volume: 100,                 // The volume in percent. To have different volumes for opening and closeing, use an object, e.g. {open: 75, close: 100}
      
      // Events                    // Note that you can use 'this' in all event functions, it refers to your jBox object (e.g. onInit: function () { this.open(); })
      onInit: null,                // Fired when jBox is initialized
      onAttach: null,              // Fired when jBox attached itself to elements, the attached element will be passed as a parameter, e.g. onAttach: function (element) { element.css({color: 'red'}); }
      onPosition: null,            // Fired when jBox is positioned
      onCreated: null,             // Fired when jBox is created and availible in DOM
      onOpen: null,                // Fired when jBox opens
      onClose: null,               // Fired when jBox closes
      onCloseComplete: null        // Fired when jBox is completely closed (when fading is finished)
    };
    
    
    // Default plugin options
    
    this._pluginOptions = {
      
      // Default options for tooltips
      'Tooltip': {
        getContent: 'title',
        trigger: 'mouseenter',
        position: {
          x: 'center',
          y: 'top'
        },
        outside: 'y',
        pointer: true
      },
      
      // Default options for mouse tooltips
      'Mouse': {
        responsiveWidth: false,
        responsiveHeight: false,
        adjustPosition: 'flip',
        target: 'mouse',
        trigger: 'mouseenter',
        position: {
          x: 'right',
          y: 'bottom'
        },
        outside: 'xy',
        offset: 5
      },
      
      // Default options for modal windows
      'Modal': {
        target: jQuery(window),
        fixed: true,
        blockScroll: true,
        closeOnEsc: true,
        closeOnClick: 'overlay',
        closeButton: true,
        overlay: true,
        animation: 'zoomIn'
      },
    };
    
    
    // Merge options
    
    this.options = jQuery.extend(true, this.options, this._pluginOptions[type] ? this._pluginOptions[type] : jBox._pluginOptions[type], options);
    
    
    // Set the jBox type
    
    jQuery.type(type) == 'string' && (this.type = type);
    
    
    // Local function to fire events
    
    this._fireEvent = function (event, pass)
    {
      this.options['_' + event] && (this.options['_' + event].bind(this))(pass);
      this.options[event] && (this.options[event].bind(this))(pass);
    };
    
    
    // Get a unique jBox ID
    
    this.options.id === null && (this.options.id = 'jBox' + jBox._getUniqueID());
    this.id = this.options.id;
    
    
    // Correct impossible options
    
    ((this.options.position.x == 'center' && this.options.outside == 'x') || (this.options.position.y == 'center' && this.options.outside == 'y')) && (this.options.outside = null);
    this.options.pointTo == 'target' && (!this.options.outside || this.options.outside == 'xy') && (this.options.pointer = false);
    
    
    // Correct multiple choice options
    
    jQuery.type(this.options.offset) != 'object' ? (this.options.offset = {x: this.options.offset, y: this.options.offset}) : (this.options.offset = jQuery.extend({x: 0, y: 0}, this.options.offset));
    jQuery.type(this.options.adjustDistance) != 'object' ? (this.options.adjustDistance = {top: this.options.adjustDistance, right: this.options.adjustDistance, bottom: this.options.adjustDistance, left: this.options.adjustDistance}) : (this.options.adjustDistance = jQuery.extend({top: 5, left: 5, right: 5, bottom: 5}, this.options.adjustDistance));
    
    
    // Save default outside position
    
    this.outside = this.options.outside && this.options.outside != 'xy' ? this.options.position[this.options.outside] : false;
    
    
    // Save where the jBox is aligned to
    
    this.align = this.outside ? this.outside : (this.options.position.y != 'center' && jQuery.type(this.options.position.y) != 'number' ? this.options.position.x : (this.options.position.x != 'center' && jQuery.type(this.options.position.x) != 'number' ? this.options.position.y : this.options.attributes.x));
    
    
    // Internal positioning functions
    
    this._getOpp = function (opp) { return {left: 'right', right: 'left', top: 'bottom', bottom: 'top', x: 'y', y: 'x'}[opp]; };
    this._getXY = function (xy) { return {left: 'x', right: 'x', top: 'y', bottom: 'y', center: 'x'}[xy]; };
    this._getTL = function (tl) { return {left: 'left', right: 'left', top: 'top', bottom: 'top', center: 'left', x: 'left', y: 'top'}[tl]; };
    
    
    // Get a dimension value in integer pixel dependent on appended element
    
    this._getInt = function (value, dimension) {
      if (value == 'auto') return 'auto';
      if (value && jQuery.type(value) == 'string' && value.slice(-1) == '%') {
        return jQuery(window)[dimension == 'height' ? 'innerHeight' : 'innerWidth']() * parseInt(value.replace('%', '')) / 100;
      }
      return value;
    };
    
    
    // Create an svg element
    
    this._createSVG = function (type, options)
    {
      var svg = document.createElementNS('http://www.w3.org/2000/svg', type);
      jQuery.each(options, function (index, item) {
        svg.setAttribute(item[0], (item[1] || ''));
      });
      return svg;
    };
    
    
    // Isolate scrolling in a container
    
    this._isolateScroll = function (el)
    {
      // Abort if element not found
      if (!el || !el.length) return;
      
      el.on('DOMMouseScroll.jBoxIsolateScroll mousewheel.jBoxIsolateScroll', function (ev) {
        var delta = ev.wheelDelta || (ev.originalEvent && ev.originalEvent.wheelDelta) || -ev.detail;
        var overflowBottom = this.scrollTop + el.outerHeight() - this.scrollHeight >= 0;
        var overflowTop = this.scrollTop <= 0;
        ((delta < 0 && overflowBottom) || (delta > 0 && overflowTop)) && ev.preventDefault();
      });
    };
    
    
    // Set the title width to content width 
    
    this._setTitleWidth = function ()
    {
      // Abort if there is no title or width of content is auto
      if (!this.titleContainer || (this.content[0].style.width == 'auto' && !this.content[0].style.maxWidth)) return null;
      
      // Expose wrapper to get actual width
      if (this.wrapper.css('display') == 'none') {
        this.wrapper.css('display', 'block');
        var contentWidth = this.content.outerWidth();
        this.wrapper.css('display', 'none');
      } else {
        var contentWidth = this.content.outerWidth();
      }
      
      // Set max-width only
      this.titleContainer.css({maxWidth: (Math.max(contentWidth, parseInt(this.content[0].style.maxWidth)) || null)});
    }
    
    
    // Make jBox draggable
    
    this._draggable = function ()
    {
      // Abort if jBox is not draggable
      if (!this.options.draggable) return false;
      
      // Get the handle where jBox will be dragged with
      var handle = this.options.draggable == 'title' ? this.titleContainer : (this.options.draggable instanceof jQuery ? this.options.draggable : (jQuery.type(this.options.draggable) == 'string' ? jQuery(this.options.draggable) : this.wrapper));
      
      // Abort if no handle or if draggable was set already
      if (!handle || !(handle instanceof jQuery) || !handle.length || handle.data('jBox-draggable')) return false;
      
      // Add mouse events
      handle.addClass('jBox-draggable').data('jBox-draggable', true).on('mousedown', function (ev)
      {
        if (ev.button == 2 || jQuery(ev.target).hasClass('jBox-noDrag') || jQuery(ev.target).parents('.jBox-noDrag').length) return;
        
        // Adjust z-index when dragging jBox over another draggable jBox
        if (this.options.dragOver && this.wrapper.css('zIndex') <= jBox.zIndexMax) {
          jBox.zIndexMax += 1;
          this.wrapper.css('zIndex', jBox.zIndexMax);
        }
        
        var drg_h = this.wrapper.outerHeight();
        var drg_w = this.wrapper.outerWidth();
        var pos_y = this.wrapper.offset().top + drg_h - ev.pageY;
        var pos_x = this.wrapper.offset().left + drg_w - ev.pageX;
        
        jQuery(document).on('mousemove.jBox-draggable-' + this.id, function (ev) {
          this.wrapper.offset({
            top: ev.pageY + pos_y - drg_h,
            left: ev.pageX + pos_x - drg_w
          });
        }.bind(this));
        ev.preventDefault();
        
      }.bind(this)).on('mouseup', function () { jQuery(document).off('mousemove.jBox-draggable-' + this.id); }.bind(this));
      
      // Get highest z-index
      jBox.zIndexMax = !jBox.zIndexMax ? this.options.zIndex : Math.max(jBox.zIndexMax, this.options.zIndex);
      
      
      
      return this;
    };
    
    // Create jBox
    
    this._create = function ()
    {
      // Abort if jBox was created already
      if (this.wrapper) return;
      
      // Create wrapper
      this.wrapper = jQuery('<div/>', {
        id: this.id,
        'class': 'jBox-wrapper' + (this.type ? ' jBox-' + this.type : '') + (this.options.theme ? ' jBox-' + this.options.theme : '') + (this.options.addClass ? ' ' + this.options.addClass : '')
      }).css({
        position: (this.options.fixed ? 'fixed' : 'absolute'),
        display: 'none',
        opacity: 0,
        zIndex: this.options.zIndex
        
        // Save the jBox instance in the wrapper, so you can get access to your jBox when you only have the element
      }).data('jBox', this);
      
      // Add mouseleave event, only close jBox when the new target is not the source element
      this.options.closeOnMouseleave && this.wrapper.on('mouseleave', function (ev) {
        !this.source || !(ev.relatedTarget == this.source[0] || jQuery.inArray(this.source[0], jQuery(ev.relatedTarget).parents('*')) !== -1) && this.close();
      }.bind(this));
      
      // Add closeOnClick: 'box' events
      (this.options.closeOnClick == 'box') && this.wrapper.on('touchend click', function () { this.close({ignoreDelay: true}); }.bind(this));
      
      // Create container
      this.container = jQuery('<div class="jBox-container"/>').appendTo(this.wrapper);
      
      // Create content
      this.content = jQuery('<div class="jBox-content"/>').appendTo(this.container);
      
      // Create footer
      this.options.footer && (this.footer = jQuery('<div class="jBox-footer"/>').append(this.options.footer).appendTo(this.container));
      
      // Isolate scrolling
      this.options.isolateScroll && this._isolateScroll(this.content);
      
      // Create close button
      if (this.options.closeButton) {
        var closeButtonSVG = this._createSVG('svg', [['viewBox', '0 0 24 24']]);
        closeButtonSVG.appendChild(this._createSVG('path', [['d', 'M22.2,4c0,0,0.5,0.6,0,1.1l-6.8,6.8l6.9,6.9c0.5,0.5,0,1.1,0,1.1L20,22.3c0,0-0.6,0.5-1.1,0L12,15.4l-6.9,6.9c-0.5,0.5-1.1,0-1.1,0L1.7,20c0,0-0.5-0.6,0-1.1L8.6,12L1.7,5.1C1.2,4.6,1.7,4,1.7,4L4,1.7c0,0,0.6-0.5,1.1,0L12,8.5l6.8-6.8c0.5-0.5,1.1,0,1.1,0L22.2,4z']]));
        this.closeButton = jQuery('<div class="jBox-closeButton jBox-noDrag"/>').on('touchend click', function (ev) { this.close({ignoreDelay: true}); }.bind(this)).append(closeButtonSVG);
        
        // Add close button to jBox container
        if (this.options.closeButton == 'box' || (this.options.closeButton === true && !this.options.overlay && !this.options.title && !this.options.getTitle)) {
          this.wrapper.addClass('jBox-closeButton-box');
          this.closeButton.appendTo(this.container);
        }
      }
      
      // Append jBox to DOM
      this.wrapper.appendTo(this.options.appendTo);
      
      // Fix adjustDistance if there is a close button in the box
      this.wrapper.find('.jBox-closeButton').length &&  jQuery.each(['top', 'right', 'bottom', 'left'], function (index, pos) {
        this.wrapper.find('.jBox-closeButton').css(pos) && this.wrapper.find('.jBox-closeButton').css(pos) != 'auto' && (this.options.adjustDistance[pos] = Math.max(this.options.adjustDistance[pos], this.options.adjustDistance[pos] + (((parseInt(this.wrapper.find('.jBox-closeButton').css(pos)) || 0) + (parseInt(this.container.css('border-' + pos + '-width')) || 0)) * -1)));
      }.bind(this));
      
      // Create pointer
      if (this.options.pointer) {
        
        // Get pointer vars and save globally
        this.pointer = {
          position: (this.options.pointTo != 'target') ? this.options.pointTo : this._getOpp(this.outside),
          xy: (this.options.pointTo != 'target') ? this._getXY(this.options.pointTo) : this._getXY(this.outside),
          align: 'center',
          offset: 0
        };
        
        this.pointer.element = jQuery('<div class="jBox-pointer jBox-pointer-' + this.pointer.position + '"/>').appendTo(this.wrapper);
        this.pointer.dimensions = {
          x: this.pointer.element.outerWidth(),
          y: this.pointer.element.outerHeight()
        };
        
        if (jQuery.type(this.options.pointer) == 'string') {
          var split = this.options.pointer.split(':');
          split[0] && (this.pointer.align = split[0]);
          split[1] && (this.pointer.offset = parseInt(split[1]));
        }
        this.pointer.alignAttribute = (this.pointer.xy == 'x' ? (this.pointer.align == 'bottom' ? 'bottom' : 'top') : (this.pointer.align == 'right' ? 'right' : 'left'));
        
        // Set wrapper CSS
        this.wrapper.css('padding-' + this.pointer.position, this.pointer.dimensions[this.pointer.xy]);
        
        // Set pointer CSS
        this.pointer.element.css(this.pointer.alignAttribute, (this.pointer.align == 'center' ? '50%' : 0)).css('margin-' + this.pointer.alignAttribute, this.pointer.offset);
        this.pointer.margin = {};
        this.pointer.margin['margin-' + this.pointer.alignAttribute] = this.pointer.offset;
        
        // Add a transform to fix centered position
        (this.pointer.align == 'center') && this.pointer.element.css('transform', 'translate(' + (this.pointer.xy == 'y' ? (this.pointer.dimensions.x * -0.5 + 'px') : 0) + ', ' + (this.pointer.xy == 'x' ? (this.pointer.dimensions.y * -0.5 + 'px') : 0) + ')');
        
        this.pointer.element.css((this.pointer.xy == 'x' ? 'width' : 'height'), parseInt(this.pointer.dimensions[this.pointer.xy]) + parseInt(this.container.css('border-' + this.pointer.alignAttribute + '-width')));
        
        // Add class to wrapper for CSS access
        this.wrapper.addClass('jBox-pointerPosition-' + this.pointer.position);
      }
      
      // Set title and content
      this.setContent(this.options.content, true);
      this.setTitle(this.options.title, true);
      
      this.options.draggable && this._draggable();
      
      // Fire onCreated event
      this._fireEvent('onCreated');
    };
    
    
    // Create jBox onInit
    
    this.options.createOnInit && this._create();
    
    
    // Attach jBox
    
    this.options.attach && this.attach();
    
    
    // Attach document and window events
    
    this._attachEvents = function ()
    {
      // Closing event: closeOnEsc
      this.options.closeOnEsc && jQuery(document).on('keyup.jBox-' + this.id, function (ev) { if (ev.keyCode == 27) { this.close({ignoreDelay: true}); }}.bind(this));
      
      // Closing event: closeOnClick
      if (this.options.closeOnClick === true || this.options.closeOnClick == 'body') {
        jQuery(document).on('touchend.jBox-' + this.id + ' click.jBox-' + this.id, function (ev) {
          if (this.blockBodyClick || (this.options.closeOnClick == 'body' && (ev.target == this.wrapper[0] || this.wrapper.has(ev.target).length))) return;
          this.close({ignoreDelay: true});
        }.bind(this));
      }
      
      // Cancel countdown on mouseenter if delayOnHover
      this.options.delayOnHover && jQuery('#' + this.id).on('mouseenter', function (ev) { this.isHovered = true; }.bind(this));
      // Resume countdown on mouseleave if delayOnHover
      this.options.delayOnHover && jQuery('#' + this.id).on('mouseleave', function (ev) { this.isHovered = false; }.bind(this));
      
      // Positioning events
      if ((this.options.adjustPosition || this.options.reposition) && !this.fixed && this.outside) {
        
        // Trigger position events when scrolling
        this.options.adjustTracker && jQuery(window).on('scroll.jBox-' + this.id, function (ev) { this.position(); }.bind(this));
        
        // Trigger position events when resizing
        (this.options.adjustPosition || this.options.reposition) && jQuery(window).on('resize.jBox-' + this.id, function (ev) { this.position(); }.bind(this));
      }
      
      // Mousemove events
      this.options.target == 'mouse' && jQuery('body').on('mousemove.jBox-' + this.id, function (ev) { this.position({mouseTarget: {top: ev.pageY, left: ev.pageX}}); }.bind(this));
    };
    
    
    // Detach document and window events
    
    this._detachEvents = function ()
    {
      // Closing event: closeOnEsc
      this.options.closeOnEsc && jQuery(document).off('keyup.jBox-' + this.id);
      
      // Closing event: closeOnClick
      (this.options.closeOnClick === true || this.options.closeOnClick == 'body') && jQuery(document).off('touchend.jBox-' + this.id + ' click.jBox-' + this.id);
      
      // Positioning events
      this.options.adjustTracker && jQuery(window).off('scroll.jBox-' + this.id);
      (this.options.adjustPosition || this.options.reposition) && jQuery(window).off('resize.jBox-' + this.id);
      
      // Mousemove events
      this.options.target == 'mouse' && jQuery('body').off('mousemove.jBox-' + this.id);
    };
    
    
    // Show overlay
    
    this._showOverlay = function ()
    {
      // Create the overlay if wasn't created already
      if (!this.overlay) {
        
        // Create element and append to the element where jBox is appended to
        this.overlay = jQuery('<div id="' + this.id + '-overlay"/>').addClass('jBox-overlay' + (this.type ? ' jBox-overlay-' + this.type : '')).css({
          display: 'none',
          opacity: 0,
          zIndex: this.options.zIndex - 1
        }).appendTo(this.options.appendTo);
        
        // Add close button to overlay
        (this.options.closeButton == 'overlay' || this.options.closeButton === true) && this.overlay.append(this.closeButton);
        
        // Add closeOnClick: 'overlay' events
        this.options.closeOnClick == 'overlay' && this.overlay.on('touchend click', function () { this.close({ignoreDelay: true}); }.bind(this));
        
        // Adjust option adjustDistance if there is a close button in the overlay
        jQuery('#' + this.id + '-overlay .jBox-closeButton').length && (this.options.adjustDistance.top = Math.max(jQuery('#' + this.id + '-overlay .jBox-closeButton').outerHeight(), this.options.adjustDistance.top));
      }
      
      // Abort if overlay is already visible
      if (this.overlay.css('display') == 'block') return;
      
      // Show overlay
      this.options.fade ? (this.overlay.stop() && this.overlay.animate({opacity: 1}, {
        queue: false,
        duration: this.options.fade,
        start: function () { this.overlay.css({display: 'block'}); }.bind(this)
      })) : this.overlay.css({display: 'block', opacity: 1});
    };
    
    
    // Hide overlay
    
    this._hideOverlay = function ()
    {
      // Abort if the overlay wasn't created yet
      if (!this.overlay) return;
      
      // Hide overlay if no other jBox needs it
      this.options.fade ? (this.overlay.stop() && this.overlay.animate({opacity: 0}, {
        queue: false,
        duration: this.options.fade,
        complete: function () { this.overlay.css({display: 'none'}); }.bind(this)
      })) : this.overlay.css({display: 'none', opacity: 0});
    };
    
    
    // Get the correct jBox dimensions by moving jBox out of viewport
    
    this._exposeDimensions = function ()
    {
      // Move wrapper out of viewport
      this.wrapper.css({
        top: -10000,
        left: -10000,
        right: 'auto',
        bottom: 'auto'
      });
    
      // Get jBox dimensions
      var jBoxDimensions = {
        x: this.wrapper.outerWidth(),
        y: this.wrapper.outerHeight()
      };
      
      // Reset position to viewport
      this.wrapper.css({
        top: 'auto',
        left: 'auto'
      });
      
      return jBoxDimensions;
    };
    
    
    // Generate CSS for animations and append to header
    
    this._generateAnimationCSS = function ()
    {
      // Get open and close animations if none provided
      (jQuery.type(this.options.animation) != 'object') && (this.options.animation = {
        pulse: {open: 'pulse', close: 'zoomOut'},
        zoomIn: {open: 'zoomIn', close: 'zoomIn'},
        zoomOut: {open: 'zoomOut', close: 'zoomOut'},
        move: {open: 'move', close: 'move'},
        slide: {open: 'slide', close: 'slide'},
        flip: {open: 'flip', close: 'flip'},
        tada: {open: 'tada', close: 'zoomOut'}
      }[this.options.animation]);
      
      // Abort if animation not found
      if (!this.options.animation) return null;
      
      // Get direction var
      this.options.animation.open && (this.options.animation.open = this.options.animation.open.split(':'));
      this.options.animation.close && (this.options.animation.close = this.options.animation.close.split(':'));
      this.options.animation.openDirection = this.options.animation.open[1] ? this.options.animation.open[1] : null;
      this.options.animation.closeDirection = this.options.animation.close[1] ? this.options.animation.close[1] : null;
      this.options.animation.open && (this.options.animation.open = this.options.animation.open[0]);
      this.options.animation.close && (this.options.animation.close = this.options.animation.close[0]);
      
      // Add 'Open' and 'Close' to animation names
      this.options.animation.open && (this.options.animation.open += 'Open');
      this.options.animation.close && (this.options.animation.close += 'Close');
      
      // All animations
      var animations = {
        pulse: {
          duration: 350,
          css: [['0%', 'scale(1)'], ['50%', 'scale(1.1)'], ['100%', 'scale(1)']]
        },
        zoomInOpen: {
          duration: (this.options.fade || 180),
          css: [['0%', 'scale(0.9)'], ['100%', 'scale(1)']]
        },
        zoomInClose: {
          duration: (this.options.fade || 180),
          css: [['0%', 'scale(1)'], ['100%', 'scale(0.9)']]
        },
        zoomOutOpen: {
          duration: (this.options.fade || 180),
          css: [['0%', 'scale(1.1)'], ['100%', 'scale(1)']]
        },
        zoomOutClose: {
          duration: (this.options.fade || 180),
          css: [['0%', 'scale(1)'], ['100%', 'scale(1.1)']]
        },
        moveOpen: {
          duration: (this.options.fade || 180),
          positions: {top: {'0%': -12}, right: {'0%': 12}, bottom: {'0%': 12}, left: {'0%': -12}},
          css: [['0%', 'translate%XY(%Vpx)'], ['100%', 'translate%XY(0px)']]
        },
        moveClose: {
          duration: (this.options.fade || 180),
          timing: 'ease-in',
          positions: {top: {'100%': -12}, right: {'100%': 12}, bottom: {'100%': 12}, left: {'100%': -12}},
          css: [['0%', 'translate%XY(0px)'], ['100%', 'translate%XY(%Vpx)']]
        },
        slideOpen: {
          duration: 400,
          positions: {top: {'0%': -400}, right: {'0%': 400}, bottom: {'0%': 400}, left: {'0%': -400}},
          css: [['0%', 'translate%XY(%Vpx)'], ['100%', 'translate%XY(0px)']]
        },
        slideClose: {
          duration: 400,
          timing: 'ease-in',
          positions: {top: {'100%': -400}, right: {'100%': 400}, bottom: {'100%': 400}, left: {'100%': -400}},
          css: [['0%', 'translate%XY(0px)'], ['100%', 'translate%XY(%Vpx)']]
        },
        flipOpen: {
          duration: 600,
          css: [['0%', 'perspective(400px) rotateX(90deg)'], ['40%', 'perspective(400px) rotateX(-15deg)'], ['70%', 'perspective(400px) rotateX(15deg)'], ['100%', 'perspective(400px) rotateX(0deg)']]
        },
        flipClose: {
          duration: (this.options.fade || 300),
          css: [['0%', 'perspective(400px) rotateX(0deg)'], ['100%', 'perspective(400px) rotateX(90deg)']]
        },
        tada: {
          duration: 800,
          css: [['0%', 'scale(1)'], ['10%, 20%', 'scale(0.9) rotate(-3deg)'], ['30%, 50%, 70%, 90%', 'scale(1.1) rotate(3deg)'], ['40%, 60%, 80%', 'scale(1.1) rotate(-3deg)'], ['100%', 'scale(1) rotate(0)']]
        }
      };
      
      // Set Open and Close names for standalone animations
      jQuery.each(['pulse', 'tada'], function (index, item) { animations[item + 'Open'] = animations[item + 'Close'] = animations[item]; });
      
      // Function to generate the CSS for the keyframes
      var generateKeyframeCSS = function (ev, position)
      {  
        // Generate keyframes CSS
        keyframe_css = '@keyframes jBox-' + this.id + '-animation-' + this.options.animation[ev] + '-' + ev + (position ? '-' + position : '') + ' {';
        jQuery.each(animations[this.options.animation[ev]].css, function (index, item) {
          var translate = position ? item[1].replace('%XY', this._getXY(position).toUpperCase()) : item[1];
          animations[this.options.animation[ev]].positions && (translate = translate.replace('%V', animations[this.options.animation[ev]].positions[position][item[0]]));
          keyframe_css += item[0] + ' {transform:' + translate + ';}';
        }.bind(this));
        keyframe_css += '}';
        
        // Generate class CSS
        keyframe_css += '.jBox-' + this.id + '-animation-' + this.options.animation[ev] + '-' + ev + (position ? '-' + position : '') + ' {';
        keyframe_css += 'animation-duration: ' + animations[this.options.animation[ev]].duration + 'ms;';
        keyframe_css += 'animation-name: jBox-' + this.id + '-animation-' + this.options.animation[ev] + '-' + ev + (position ? '-' + position : '') + ';';
        keyframe_css += animations[this.options.animation[ev]].timing ? ('animation-timing-function: ' + animations[this.options.animation[ev]].timing + ';') : '';
        keyframe_css += '}';
        
        return keyframe_css;
      }.bind(this);
      
      // Generate css for each event and positions
      this._animationCSS = '';
      jQuery.each(['open', 'close'], function (index, ev)
      {
        // No CSS needed for closing with no fade
        if (!this.options.animation[ev] || !animations[this.options.animation[ev]] || (ev == 'close' && !this.options.fade)) return '';
        
        // Generate CSS
        animations[this.options.animation[ev]].positions ?
          jQuery.each(['top', 'right', 'bottom', 'left'], function (index2, position) { this._animationCSS += generateKeyframeCSS(ev, position); }.bind(this)) :
          this._animationCSS += generateKeyframeCSS(ev);
      }.bind(this));
      
    };
    
    
    // Add css for animations
    
    this.options.animation && this._generateAnimationCSS();
    
    
    // Block body clicks for 10ms to prevent extra event triggering
    
    this._blockBodyClick = function ()
    {
      this.blockBodyClick = true;
      setTimeout(function () { this.blockBodyClick = false; }.bind(this), 10);
    };
    
    
    // Animations
    
    this._animate = function (ev)
    {
      // The event which triggers the animation
      !ev && (ev = this.isOpen ? 'open' : 'close');
      
      // Don't animate when closing with no fade duration
      if (!this.options.fade && ev == 'close') return null;
      
      // Get the current position, use opposite if jBox is flipped
      var animationDirection = (this.options.animation[ev + 'Direction'] || ((this.align != 'center') ? this.align : this.options.attributes.x));
      this.flipped && this._getXY(animationDirection) == (this._getXY(this.align)) && (animationDirection = this._getOpp(animationDirection));
      
      // Add event and position classes
      var classnames = 'jBox-' + this.id + '-animation-' + this.options.animation[ev] + '-' + ev + ' jBox-' + this.id + '-animation-' + this.options.animation[ev] + '-' + ev + '-' + animationDirection;
      this.wrapper.addClass(classnames);
      
      // Get duration of animation
      var animationDuration = parseFloat(this.wrapper.css('animation-duration')) * 1000;
      ev == 'close' && (animationDuration = Math.min(animationDuration, this.options.fade));
      
      // Remove animation classes when animation is finished
      setTimeout(function () { this.wrapper.removeClass(classnames); }.bind(this), animationDuration);
    };
    
    
    // Abort an animation
    
    this._abortAnimation = function ()
    {
      // Remove all animation classes
      var classes = this.wrapper.attr('class').split(' ').filter(function (c) {
        return c.lastIndexOf('jBox-' + this.id + '-animation', 0) !== 0;
      }.bind(this));
      this.wrapper.attr('class', classes.join(' '));
    };
    
    
    // Adjust dimensions when browser is resized
    
    if (this.options.responsiveWidth || this.options.responsiveHeight)
    {
      // Responsive positioning overrides options adjustPosition and reposition
      // TODO: Only add this resize event when the other one from adjustPosition and reposition was not set
      jQuery(window).on('resize.responsivejBox-' + this.id, function (ev) { if (this.isOpen) { this.position(); } }.bind(this));
    }
    
    
    // Fix audio options
    
    jQuery.type(this.options.preloadAudio) === 'string' && (this.options.preloadAudio = [this.options.preloadAudio]);
    jQuery.type(this.options.audio) === 'string' && (this.options.audio = {open: this.options.audio});
    jQuery.type(this.options.volume) === 'number' && (this.options.volume = {open: this.options.volume, close: this.options.volume});
    
    if (this.options.preloadAudio === true && this.options.audio) {
      this.options.preloadAudio = [];
      jQuery.each(this.options.audio, function (index, url) {
        this.options.preloadAudio.push(url + '.mp3');
        this.options.preloadAudio.push(url + '.ogg');
      }.bind(this));
    }
    
    
    // Preload audio files
    
    this.options.preloadAudio.length && jQuery.each(this.options.preloadAudio, function (index, url) {
      var audio = new Audio();
      audio.src = url;
      audio.preload = 'auto';
    });
    
    
    // Fire onInit event
    if (this.options.followMouse)
    {
      jQuery(document).on('mousemove', function(ev)
      {
        this.mouse = {x: ev.pageX, y: ev.pageY };
      }.bind(this));
    }

    
    this._fireEvent('onInit');
  
    
    return this;
  };
  
  
  // Attach jBox to elements
  
  jBox.prototype.attach = function (elements, trigger)
  {
    // Get elements from options if none passed
    !elements && (elements = this.options.attach);
    
    // Convert selectors to jQuery objects
    jQuery.type(elements) == 'string' && (elements = jQuery(elements));
    
    // Get trigger event from options if not passed
    !trigger && (trigger = this.options.trigger);
    
    // Loop through elements and attach jBox
    elements && elements.length && jQuery.each(elements, function (index, el) {
      el = jQuery(el);
      
      // Only attach if the element wasn't attached to this jBox already
      if (!el.data('jBox-attached-' + this.id)) {
        
        // Remove title attribute and store content on element
        (this.options.getContent == 'title' && el.attr('title') != undefined) && el.data('jBox-getContent', el.attr('title')).removeAttr('title');
        
        // Add Element to collection
        this.attachedElements || (this.attachedElements = []);
        this.attachedElements.push(el[0]);
        
        // Add click or mouseenter event, click events can prevent default as well
        el.on(trigger + '.jBox-attach-' + this.id, function (ev)
        {  
          // Clear timer
          this.timer && clearTimeout(this.timer);
          
          // Block opening when jbox is open and the source element is triggering
          if (trigger == 'mouseenter' && this.isOpen && this.source[0] == el[0]) return;
          
          // Only close jBox if you click the current target element, otherwise open at new target
          if (this.isOpen && this.source && this.source[0] != el[0]) var forceOpen = true;
          
          // Set new source element
          this.source = el;
          
          // Set new target
          !this.options.target && (this.target = el);
          
          // Prevent default action on click
          trigger == 'click' && this.options.preventDefault && ev.preventDefault();
          
          // Toggle or open jBox
          this[trigger == 'click' && !forceOpen ? 'toggle' : 'open']();
          
        }.bind(this));
        
        // Add close event for trigger event mouseenter
        (this.options.trigger == 'mouseenter') && el.on('mouseleave', function (ev)
        {
          // Abort if jBox wasn't created yet
          if (!this.wrapper) return null;
          
          // If we have set closeOnMouseleave, do not close jBox when leaving attached element and mouse is over jBox
          if (!this.options.closeOnMouseleave || !(ev.relatedTarget == this.wrapper[0] || jQuery(ev.relatedTarget).parents('#' + this.id).length)) this.close();
        }.bind(this));
        
        // Store 
        el.data('jBox-attached-' + this.id, trigger);
        
        // Fire onAttach event
        this._fireEvent('onAttach', el);
      }
      
    }.bind(this));
    
    return this;
  };
  
  
  // Detach jBox from elements
  
  jBox.prototype.detach = function (elements)
  {
    // Get elements from stores elements if none passed
    !elements && (elements = this.attachedElements || []);
    
    elements && elements.length && jQuery.each(elements, function (index, el) {
      el = jQuery(el);
      
      // Remove events
      if (el.data('jBox-attached-' + this.id)) {
        el.off(el.data('jBox-attached-' + this.id) + '.jBox-attach-' + this.id);
        el.data('jBox-attached-' + this.id, null);
      }
      // Remove element from collection
      this.attachedElements = jQuery.grep(this.attachedElements, function (value) {
        return value != el[0];
      });
    }.bind(this));
    
    return this;
  };
  
  
  // Set title
  
  jBox.prototype.setTitle = function (title, ignore_positioning)
  {
    // Abort if title to set
    if (title == null || title == undefined) return this;
    
    // Create jBox if it wasn't created already
    !this.wrapper && this._create();
    
    // Get the width and height of wrapper, only if they change we need to reposition
    var wrapperHeight = this.wrapper.outerHeight();
    var wrapperWidth = this.wrapper.outerWidth();
    
    // Create title elements if they weren't created already
    if (!this.title) {
      this.titleContainer = jQuery('<div class="jBox-title"/>');
      this.title = jQuery('<div/>').appendTo(this.titleContainer);
      this.wrapper.addClass('jBox-hasTitle');
      if (this.options.closeButton == 'title' || (this.options.closeButton === true && !this.options.overlay)) {
        this.wrapper.addClass('jBox-closeButton-title');
        this.closeButton.appendTo(this.titleContainer);
      }
      this.titleContainer.insertBefore(this.content);
      this._setTitleWidth();
    }
    this.title.html(title);
    
    // Adjust width of title
    wrapperWidth != this.wrapper.outerWidth() && this._setTitleWidth();
    
    // Make jBox draggable
    this.options.draggable && this._draggable();
    
    // Reposition if dimensions changed
    !ignore_positioning && this.options.repositionOnContent && (wrapperHeight != this.wrapper.outerHeight() || wrapperWidth != this.wrapper.outerWidth()) && this.position();
    
    return this;
  };
  
  
  // Set content
  
  jBox.prototype.setContent = function (content, ignore_positioning)
  {
    // Abort if no content to set
    if (content == null || content == undefined) return this;
    
    // Create jBox if it wasn't created already
    !this.wrapper && this._create();
    
    // Get the width and height of wrapper, only if they change we need to reposition
    var wrapperHeight = this.wrapper.outerHeight();
    var wrapperWidth = this.wrapper.outerWidth();
    
    // Move all appended containers to body
    this.content.children('[data-jbox-content-appended]').appendTo('body').css({display: 'none'});
    
    // Set the new content
    switch (jQuery.type(content)) {
      case 'string': this.content.html(content); break;
      case 'object': this.content.html(''); content.attr('data-jbox-content-appended', 1).appendTo(this.content).css({display: 'block'}); break;
     }
     
    // Adjust title width
    wrapperWidth != this.wrapper.outerWidth() && this._setTitleWidth();
    
    // Make jBox draggable
    this.options.draggable && this._draggable();
      
    // Reposition if dimensions changed
    !ignore_positioning && this.options.repositionOnContent && (wrapperHeight != this.wrapper.outerHeight() || wrapperWidth != this.wrapper.outerWidth()) && this.position();
    
    return this;
  };
  
  
  // Set jBox dimensions
  
  jBox.prototype.setDimensions = function (type, value, pos)
  {
    // Create jBox if it wasn't created already
    !this.wrapper && this._create();
    
    // Default value is 'auto'
    value == undefined && (value = 'auto');
    
    // Set CSS of content and title
    this.content.css(type, this._getInt(value));
    
    // Adjust title width
    type == 'width' && this._setTitleWidth();
    
    // Reposition by default
    (pos == undefined || pos) && this.position();
  };
  
  
  // Set jBox width or height
  
  jBox.prototype.setWidth = function (value, pos) { this.setDimensions('width', value, pos); };
  jBox.prototype.setHeight = function (value, pos) { this.setDimensions('height', value, pos); };
  
  
  // Position jBox
  
  jBox.prototype.position = function (options)
  {
    // Options are required
    !options && (options = {});
    
    // Combine passed options with jBox options
    options = jQuery.extend(true, this.options, options);
    
    // Get the target
    this.target = options.target || this.target || jQuery(window);
    
    // Make sure target is a jQuery element
    !(this.target instanceof jQuery || this.target == 'mouse') && (this.target = jQuery(this.target));
    
    // Abort if target is missing
    if (!this.target.length) return this;
    
    // Reset content css to get original dimensions
    this.content.css({
      width: this._getInt(options.width, 'width'),
      height: this._getInt(options.height, 'height'),
      minWidth: this._getInt(options.minWidth, 'width'),
      minHeight: this._getInt(options.minHeight, 'height'),
      maxWidth: this._getInt(options.maxWidth, 'width'),
      maxHeight: this._getInt(options.maxHeight, 'height'),
    });
    
    // Reset width of title
    this._setTitleWidth();
    
    // Get jBox dimensions
    var jBoxDimensions = this._exposeDimensions();
    
    // Check if target has fixed position, store in elements data
    this.target != 'mouse' && !this.target.data('jBox-' + this.id + '-fixed') && this.target.data('jBox-' + this.id + '-fixed', (this.target[0] != jQuery(window)[0] && (this.target.css('position') == 'fixed' || this.target.parents().filter(function () { return jQuery(this).css('position') == 'fixed'; }).length > 0)) ? 'fixed' : 'static');
    
    // Get the window dimensions
    var windowDimensions = {
      x: jQuery(window).outerWidth(),
      y: jQuery(window).outerHeight(),
      top: (options.fixed && this.target.data('jBox-' + this.id + '-fixed') ? 0 : jQuery(window).scrollTop()),
      left: (options.fixed && this.target.data('jBox-' + this.id + '-fixed') ? 0 : jQuery(window).scrollLeft())
    };
    windowDimensions.bottom = windowDimensions.top + windowDimensions.y;
    windowDimensions.right = windowDimensions.left + windowDimensions.x;
    
    // Get target offset
    try { var targetOffset = this.target.offset(); } catch (e) { var targetOffset = {top: 0, left: 0}; };
    
    // When the target is fixed and jBox is fixed, remove scroll offset
    if (this.target != 'mouse' && this.target.data('jBox-' + this.id + '-fixed') == 'fixed' && options.fixed) {
      targetOffset.top = targetOffset.top - jQuery(window).scrollTop();
      targetOffset.left = targetOffset.left - jQuery(window).scrollLeft();
    }
    
    // Get target dimensions
    var targetDimensions = {
      x: this.target == 'mouse' ? 12 : this.target.outerWidth(),
      y: this.target == 'mouse' ? 20 : this.target.outerHeight(),
      top: this.target == 'mouse' && options.mouseTarget ? options.mouseTarget.top : (targetOffset ? targetOffset.top : 0),
      left: this.target == 'mouse' && options.mouseTarget ? options.mouseTarget.left : (targetOffset ? targetOffset.left : 0)
    };
    
    // Check if jBox is outside
    var outside = options.outside && !(options.position.x == 'center' && options.position.y == 'center');
    
    // Get the available space on all sides
    var availableSpace = {
      x: windowDimensions.x - options.adjustDistance.left - options.adjustDistance.right, // TODO: substract position.x when they are numbers
      y: windowDimensions.y - options.adjustDistance.top - options.adjustDistance.bottom, // TODO: substract position.x when they are numbers
      left: !outside ? 0 : (targetDimensions.left - jQuery(window).scrollLeft() - options.adjustDistance.left),
      right: !outside ? 0 : (windowDimensions.x - targetDimensions.left + jQuery(window).scrollLeft() - targetDimensions.x - options.adjustDistance.right),
      top: !outside ? 0 : (targetDimensions.top - jQuery(window).scrollTop() - this.options.adjustDistance.top),
      bottom: !outside ? 0 : (windowDimensions.y - targetDimensions.top + jQuery(window).scrollTop() - targetDimensions.y - options.adjustDistance.bottom),
    };
    
    // Get the default outside position, check if box will be flipped
    var jBoxOutsidePosition = {
      x: (options.outside == 'x' || options.outside == 'xy') && jQuery.type(options.position.x) != 'number' ? options.position.x : null,
      y: (options.outside == 'y' || options.outside == 'xy') && jQuery.type(options.position.y) != 'number' ? options.position.y : null
    };
    var flip = {x: false, y: false};
    (jBoxOutsidePosition.x && jBoxDimensions.x > availableSpace[jBoxOutsidePosition.x] && availableSpace[this._getOpp(jBoxOutsidePosition.x)] > availableSpace[jBoxOutsidePosition.x]) && (jBoxOutsidePosition.x = this._getOpp(jBoxOutsidePosition.x)) && (flip.x = true);
    (jBoxOutsidePosition.y && jBoxDimensions.y > availableSpace[jBoxOutsidePosition.y] && availableSpace[this._getOpp(jBoxOutsidePosition.y)] > availableSpace[jBoxOutsidePosition.y]) && (jBoxOutsidePosition.y = this._getOpp(jBoxOutsidePosition.y)) && (flip.y = true);
    
    // Adjust responsive dimensions
    if (options.responsiveWidth || options.responsiveHeight) {
      
      // Adjust width and height according to default outside position
      var adjustResponsiveWidth = function ()
      {
        if (options.responsiveWidth && jBoxDimensions.x > availableSpace[jBoxOutsidePosition.x || 'x']) {
          var contentWidth = availableSpace[jBoxOutsidePosition.x || 'x'] - (this.pointer && outside && options.outside == 'x' ? this.pointer.dimensions.x : 0) - parseInt(this.container.css('border-left-width')) - parseInt(this.container.css('border-right-width'));
          this.content.css({
            width: contentWidth > this.options.responsiveMinWidth ? contentWidth : null,
            minWidth: contentWidth < parseInt(this.content.css('minWidth')) ? 0 : null
          });
          this._setTitleWidth();
        }
        jBoxDimensions = this._exposeDimensions();
        
      }.bind(this);
      options.responsiveWidth && adjustResponsiveWidth();
      
      // After adjusting width, check if jBox will be flipped for y
      options.responsiveWidth && !flip.y && (jBoxOutsidePosition.y && jBoxDimensions.y > availableSpace[jBoxOutsidePosition.y] && availableSpace[this._getOpp(jBoxOutsidePosition.y)] > availableSpace[jBoxOutsidePosition.y]) && (jBoxOutsidePosition.y = this._getOpp(jBoxOutsidePosition.y)) && (flip.y = true);
        
      // Adjust width and height according to default outside position
      var adjustResponsiveHeight = function ()
      {
        if (options.responsiveHeight && jBoxDimensions.y > availableSpace[jBoxOutsidePosition.y || 'y']) {
          
          // Expose wrapper to get correct title height
          var exposeTitleFooterHeight = function () {
            if (!this.titleContainer && !this.footer) return 0;
            if (this.wrapper.css('display') == 'none') {
              this.wrapper.css('display', 'block');
              var height = (this.titleContainer ? this.titleContainer.outerHeight() : 0) + (this.footer ? this.footer.outerHeight() : 0);
              this.wrapper.css('display', 'none');
            } else {
              var height = (this.titleContainer ? this.titleContainer.outerHeight() : 0) + (this.footer ? this.footer.outerHeight() : 0);
            }
            return height || 0;
          }.bind(this);
          
          var contentHeight = availableSpace[jBoxOutsidePosition.y || 'y'] - (this.pointer && outside && options.outside == 'y' ? this.pointer.dimensions.y : 0) - exposeTitleFooterHeight() - parseInt(this.container.css('border-top-width')) - parseInt(this.container.css('border-bottom-width'));
          this.content.css({height: contentHeight > this.options.responsiveMinHeight ? contentHeight : null});
          this._setTitleWidth();
        }
        jBoxDimensions = this._exposeDimensions();
        
      }.bind(this);
      options.responsiveHeight && adjustResponsiveHeight();
      
      // After adjusting height, check if jBox will be flipped for x
      options.responsiveHeight && !flip.x && (jBoxOutsidePosition.x && jBoxDimensions.x > availableSpace[jBoxOutsidePosition.x] && availableSpace[this._getOpp(jBoxOutsidePosition.x)] > availableSpace[jBoxOutsidePosition.x]) && (jBoxOutsidePosition.x = this._getOpp(jBoxOutsidePosition.x)) && (flip.x = true);
        
      // Adjust width and height if jBox will be flipped
      if (options.adjustPosition && options.adjustPosition != 'move') {
        flip.x && adjustResponsiveWidth();
        flip.y && adjustResponsiveHeight();
      }
    }
    
    // Store new positioning vars in local var
    var pos = {};
    
    // Calculate positions
    var setPosition = function (p)
    {
      // Set number positions
      if (jQuery.type(options.position[p]) == 'number') {
        pos[options.attributes[p]] = options.position[p];
        return;
      }
      
      // We have a target, so use 'left' or 'top' as attributes
      var a = options.attributes[p] = (p == 'x' ? 'left' : 'top');
      
      // Start at target position
      pos[a] = targetDimensions[a];
      
      // Set centered position
      if (options.position[p] == 'center') {

        if (options.followMouse)
        {
          pos[a] = Math.ceil(this.mouse[p] - jBoxDimensions[p] / 2);
        } else
        {
          pos[a] += Math.ceil((targetDimensions[p] - jBoxDimensions[p]) / 2);
        }
       
        // If the target is the window, adjust centered position depending on adjustDistance
        (this.target != 'mouse' && this.target[0] && this.target[0] == jQuery(window)[0]) && (pos[a] += (options.adjustDistance[a] - options.adjustDistance[this._getOpp(a)]) * 0.5);
        return;
      }
      
      if (options.followMouse)
      {
        pos[a] = this.mouse[p];

      } else
      {
        // Move inside
        (a != options.position[p]) && (pos[a] += targetDimensions[p] - jBoxDimensions[p]);
        
        // Move outside
        (options.outside == p || options.outside == 'xy') && (pos[a] += jBoxDimensions[p] * (a != options.position[p] ? 1 : -1));
      }
      
    }.bind(this);
    
    // Set position including offset
    setPosition('x');
    setPosition('y');
    
    // Adjust position depending on pointer align
    if (this.pointer && options.pointTo == 'target' && jQuery.type(options.position.x) != 'number' && jQuery.type(options.position.y) != 'number') {
      
      var adjustWrapper = 0;
      
      // Where is the pointer aligned? Add or substract accordingly
      switch (this.pointer.align) {
        case 'center':
        if (options.position[this._getOpp(options.outside)] != 'center') {
          adjustWrapper += (jBoxDimensions[this._getOpp(options.outside)] / 2);
        }
        break;
        default:
        switch (options.position[this._getOpp(options.outside)]) {
          case 'center':
            adjustWrapper += ((jBoxDimensions[this._getOpp(options.outside)] / 2) - (this.pointer.dimensions[this._getOpp(options.outside)] / 2)) * (this.pointer.align == this._getTL(this.pointer.align) ? 1 : -1);
          break;
          default:
            adjustWrapper += (this.pointer.align != options.position[this._getOpp(options.outside)]) ?
              
            // If pointer align is different to position align
            (this.dimensions[this._getOpp(options.outside)] * (jQuery.inArray(this.pointer.align, ['top', 'left']) !== -1 ? 1 : -1)) + ((this.pointer.dimensions[this._getOpp(options.outside)] / 2) * (jQuery.inArray(this.pointer.align, ['top', 'left']) !== -1 ? -1 : 1)) :
              
            // If pointer align is same as position align
            (this.pointer.dimensions[this._getOpp(options.outside)] / 2) * (jQuery.inArray(this.pointer.align, ['top', 'left']) !== -1 ? 1 : -1);
          break;
        }
        break;
      }
    
      adjustWrapper *= (options.position[this._getOpp(options.outside)] == this.pointer.alignAttribute ? -1 : 1);
      adjustWrapper += this.pointer.offset * (this.pointer.align == this._getOpp(this._getTL(this.pointer.align)) ? 1 : -1);
      
      pos[this._getTL(this._getOpp(this.pointer.xy))] += adjustWrapper;
    }
    
    // Add final offset
    pos[options.attributes.x] += options.offset.x;
    pos[options.attributes.y] += options.offset.y;
    
    // Set CSS
    this.wrapper.css(pos);
    
    // Adjust position
    if (options.adjustPosition) {
      
      // Reset cached pointer position
      if (this.positionAdjusted) {
        this.pointer && this.wrapper.css('padding', 0).css('padding-' + this._getOpp(this.outside), this.pointer.dimensions[this._getXY(this.outside)]).removeClass('jBox-pointerPosition-' + this._getOpp(this.pointer.position)).addClass('jBox-pointerPosition-' + this.pointer.position);
        this.pointer && this.pointer.element.attr('class', 'jBox-pointer jBox-pointer-' + this._getOpp(this.outside)).css(this.pointer.margin);
        this.positionAdjusted = false;
        this.flipped = false;
      }
      
      // Find out where the jBox is out of view area
      var outYT = (windowDimensions.top > pos.top - (options.adjustDistance.top || 0)),
        outXR = (windowDimensions.right < pos.left + jBoxDimensions.x + (options.adjustDistance.right || 0)),
        outYB = (windowDimensions.bottom < pos.top + jBoxDimensions.y + (options.adjustDistance.bottom || 0)),
        outXL = (windowDimensions.left > pos.left - (options.adjustDistance.left || 0)),
        outX = outXL ? 'left' : (outXR ? 'right' : null),
        outY = outYT ? 'top' : (outYB ? 'bottom' : null),
        out = outX || outY;
      
      // Only continue if jBox is out of view area
      if (out) {
        
        // Function to flip position
        var flipJBox = function (xy) {
          if (options.followMouse)
          {
            this.wrapper.css(this._getTL(xy), pos[this._getTL(xy)] + ((jBoxDimensions[this._getXY(xy)] + (options.offset[this._getXY(xy)] * (xy == 'top' || xy == 'left' ? -2 : 2))) * (xy == 'top' || xy == 'left' ? 1 : -1)));
          } else
          {
            this.wrapper.css(this._getTL(xy), pos[this._getTL(xy)] + ((jBoxDimensions[this._getXY(xy)] + (options.offset[this._getXY(xy)] * (xy == 'top' || xy == 'left' ? -2 : 2)) + targetDimensions[this._getXY(xy)]) * (xy == 'top' || xy == 'left' ? 1 : -1)));
          }
          
          this.pointer && this.wrapper.removeClass('jBox-pointerPosition-' + this.pointer.position).addClass('jBox-pointerPosition-' + this._getOpp(this.pointer.position)).css('padding', 0).css('padding-' + xy, this.pointer.dimensions[this._getXY(xy)]);
          this.pointer && this.pointer.element.attr('class', 'jBox-pointer jBox-pointer-' + xy);
          this.positionAdjusted = true;
          this.flipped = true;
        }.bind(this);
        
        // Flip jBox
        flip.x && flipJBox(this.options.position.x);
        flip.y && flipJBox(this.options.position.y);
        
        // Move jBox (only possible with pointer)
        var outMove = (this._getXY(this.outside) == 'x') ? outY : outX;
        
        if (this.pointer && options.pointTo == 'target' && options.adjustPosition != 'flip' && this._getXY(outMove) == this._getOpp(this._getXY(this.outside))) {
          
          // Get the maximum space we have availible to adjust
          if (this.pointer.align == 'center') {
            var spaceAvail = (jBoxDimensions[this._getXY(outMove)] / 2) - (this.pointer.dimensions[this._getOpp(this.pointer.xy)] / 2) - (parseInt(this.pointer.element.css('margin-' + this.pointer.alignAttribute)) * (outMove != this._getTL(outMove) ? -1 : 1));
          } else {
            var spaceAvail = (outMove == this.pointer.alignAttribute) ?
              parseInt(this.pointer.element.css('margin-' + this.pointer.alignAttribute)) :
              jBoxDimensions[this._getXY(outMove)] - parseInt(this.pointer.element.css('margin-' + this.pointer.alignAttribute)) - this.pointer.dimensions[this._getXY(outMove)];
          }
          
          // Get the overlapping space
          spaceDiff = (outMove == this._getTL(outMove)) ?
            windowDimensions[this._getTL(outMove)] - pos[this._getTL(outMove)] + options.adjustDistance[outMove] :
            (windowDimensions[this._getOpp(this._getTL(outMove))] - pos[this._getTL(outMove)] - options.adjustDistance[outMove] - jBoxDimensions[this._getXY(outMove)]) * -1;
            
          // Add overlapping space on left or top window edge
          if (outMove == this._getOpp(this._getTL(outMove)) && pos[this._getTL(outMove)] - spaceDiff < windowDimensions[this._getTL(outMove)] + options.adjustDistance[this._getTL(outMove)]) {
            spaceDiff -= windowDimensions[this._getTL(outMove)] + options.adjustDistance[this._getTL(outMove)] - (this.pos[this._getTL(outMove)] - spaceDiff);
          }
          
          // Only adjust the maximum availible
          spaceDiff = Math.min(spaceDiff, spaceAvail);
          
          // Move jBox
          if (spaceDiff <= spaceAvail && spaceDiff > 0) {
            this.pointer.element.css('margin-' + this.pointer.alignAttribute, parseInt(this.pointer.element.css('margin-' + this.pointer.alignAttribute)) - (spaceDiff * (outMove != this.pointer.alignAttribute ? -1 : 1)));
            this.wrapper.css(this._getTL(outMove), pos[this._getTL(outMove)] + (spaceDiff * (outMove != this._getTL(outMove) ? -1 : 1)));
            this.positionAdjusted = true;
          }
        }
      }
    }  
    
    // Fire onPosition event
    this._fireEvent('onPosition');
    
    return this;
  };
  
  
  // Open jBox
  
  jBox.prototype.open = function (options)
  {
    // Create blank options if none passed
    !options && (options = {});
    
    // Abort if jBox was destroyed
    if (this.isDestroyed) return false;
    
    // Construct jBox if not already constructed
    !this.wrapper && this._create();
    
    // Add css to header if not added already
    !this._styles && (this._styles = jQuery('<style/>').append(this._animationCSS).appendTo(jQuery('head')));
    
    // Abort any opening or closing timer
    this.timer && clearTimeout(this.timer);
    
    // Block body click for 10ms, so jBox can open on attached elements while closeOnClick = 'body'
    this._blockBodyClick();
    
    // Block opening
    if (this.isDisabled) return this;
    
    // Opening function
    var open = function () {
      
      // Set title from source element
      this.source && this.options.getTitle && (this.source.attr(this.options.getTitle) && this.setTitle(this.source.attr(this.options.getTitle)), true);
      
      // Set content from source element
      this.source && this.options.getContent && (this.source.data('jBox-getContent') ? this.setContent(this.source.data('jBox-getContent'), true) : (this.source.attr(this.options.getContent) ? this.setContent(this.source.attr(this.options.getContent), true) : (this.options.getContent == 'html' ? this.setContent(this.source.html(), true) : null)));
      
      // Fire onOpen event
      this._fireEvent('onOpen');
      
      // Get content from ajax
      if ((this.options.ajax && (this.options.ajax.url || (this.source && this.source.attr(this.options.ajax.getURL))) && (!this.ajaxLoaded || this.options.ajax.reload)) || (options.ajax && (options.ajax.url || options.ajax.data))) {
        // Send the content from stored data if there is any, otherwise load new data
        (this.options.ajax.reload != 'strict' && this.source && this.source.data('jBox-ajax-data') && !(options.ajax && (options.ajax.url || options.ajax.data))) ? this.setContent(this.source.data('jBox-ajax-data')) : this.ajax((options.ajax || null), true);
      }
      
      // Set position
      (!this.positionedOnOpen || this.options.repositionOnOpen) && this.position(options) && (this.positionedOnOpen = true);
      
      // Abort closing
      this.isClosing && this._abortAnimation();
      
      // Open functions to call when jBox is closed
      if (!this.isOpen) {
        
        // jBox is open now
        this.isOpen = true;
        
        // Automatically close jBox after some time
        this.options.autoClose && (this.options.delayClose = this.options.autoClose) && this.close();
        
        // Attach events
        this._attachEvents();
        
        // Block scrolling
        this.options.blockScroll && jQuery('body').addClass('jBox-blockScroll-' + this.id);
        
        // Show overlay
        this.options.overlay && this._showOverlay();
        
        // Only animate if jBox is completely closed
        this.options.animation && !this.isClosing && this._animate('open');
        
        // Play audio file
        this.options.audio && this.options.audio.open && this.audio(this.options.audio.open, this.options.volume.open);
        
        // Fading animation or show immediately
        if (this.options.fade) {
          this.wrapper.stop().animate({opacity: 1}, {
            queue: false,
            duration: this.options.fade,
            start: function () {
              this.isOpening = true;
              this.wrapper.css({display: 'block'});
            }.bind(this),
            always: function () {
              this.isOpening = false;
              
              // Delay positioning for ajax to prevent positioning during animation
              setTimeout(function () { this.positionOnFadeComplete && this.position() && (this.positionOnFadeComplete = false); }.bind(this), 10);
            }.bind(this)
          });
        } else {
          this.wrapper.css({display: 'block', opacity: 1});
          this.positionOnFadeComplete && this.position() && (this.positionOnFadeComplete = false);
        }
      }
    }.bind(this);
    
    // Open jBox
    this.options.delayOpen && !this.isOpen && !this.isClosing && !options.ignoreDelay ? (this.timer = setTimeout(open, this.options.delayOpen)) : open();
    
    return this;
  };
  
  
  // Close jBox
  
  jBox.prototype.close = function (options)
  {
    // Create blank options if none passed
    options || (options = {});
    
    // Abort if jBox was destroyed or is currently closing
    if (this.isDestroyed || this.isClosing) return false;
    
    // Abort opening
    this.timer && clearTimeout(this.timer);
    
    // Block body click for 10ms, so jBox can open on attached elements while closeOnClock = 'body' is true
    this._blockBodyClick();
    
    // Block closing
    if (this.isDisabled) return this;
    
    // Close function
    var close = function () {
      
      // Fire onClose event
      this._fireEvent('onClose');
      
      // Only close if jBox is open
      if (this.isOpen) {
        
        // jBox is not open anymore
        this.isOpen = false;
        
        // Detach events
        this._detachEvents();
        
        // Unblock scrolling
        this.options.blockScroll && jQuery('body').removeClass('jBox-blockScroll-' + this.id);
        
        // Hide overlay
        this.options.overlay && this._hideOverlay();
        
        // Only animate if jBox is compleately closed
        this.options.animation && !this.isOpening && this._animate('close');
        
        // Play audio file
        this.options.audio && this.options.audio.close && this.audio(this.options.audio.close, this.options.volume.close);
        
        // Fading animation or show immediately
        if (this.options.fade) {
          this.wrapper.stop().animate({opacity: 0}, {
            queue: false,
            duration: this.options.fade,
            start: function () {
              this.isClosing = true;
            }.bind(this),
            complete: function () {
              this.wrapper.css({display: 'none'});
              this._fireEvent('onCloseComplete');
            }.bind(this),
            always: function () {
              this.isClosing = false;
            }.bind(this)
          });
        } else {
          this.wrapper.css({display: 'none', opacity: 0});
          this._fireEvent('onCloseComplete');
        }
      }
    }.bind(this);
    
    // Close jBox
    if (options.ignoreDelay) {
      close();
    } else if ((this.options.delayOnHover || this.options.showCountdown) && this.options.delayClose > 10) {
      var self = this;
      var remaining = this.options.delayClose;
      var prevFrame = Date.now();
      if (this.options.showCountdown && !this.inner) {
        var outer = jQuery('<div class="jBox-countdown"></div>');
        this.inner = jQuery('<div class="jBox-countdown_inner"></div>');
        outer.prepend(this.inner);
        jQuery('#' + this.id).append(outer);
      }
      this.countdown = function(){
        var dateNow = Date.now();
        if (!self.isHovered) {
          remaining -= dateNow - prevFrame;
        }
        prevFrame = dateNow;
        if (remaining > 0) {
          if (self.options.showCountdown) {
            self.inner.css('width', (remaining * 100 / self.options.delayClose) + '%');
          }
          window.requestAnimationFrame(self.countdown);
        } else {
          close();
        }
      };
      window.requestAnimationFrame(this.countdown);
    } else {
      this.timer = setTimeout(close, Math.max(this.options.delayClose, 10));
    }
    
    return this;
  };
  
  
  // Open or close jBox
  
  jBox.prototype.toggle = function (options)
  {
    this[this.isOpen ? 'close' : 'open'](options);
    return this;
  };
  
  
  // Block opening and closing
  
  jBox.prototype.disable = function ()
  {
    this.isDisabled = true;
    return this;
  };
  
  
  // Unblock opening and closing
  
  jBox.prototype.enable = function ()
  {
    this.isDisabled = false;
    return this;
  };
  
  
  // Hide jBox
  
  jBox.prototype.hide = function ()
  {
    this.disable();
    this.wrapper && this.wrapper.css({display: 'none'});
    return this;
  };
  
  
  // Show jBox
  
  jBox.prototype.show = function ()
  {
    this.enable();
    this.wrapper && this.wrapper.css({display: 'block'});
    return this;
  };
  
  
  // Get content from ajax
  
  jBox.prototype.ajax = function (options, opening)
  {
    options || (options = {});
    
    // Add data or url from source element if none set in options
    jQuery.each([['getData', 'data'], ['getURL', 'url']], function (index, item) {
      (this.options.ajax[item[0]] && !options[item[1]] && this.source && this.source.attr(this.options.ajax[item[0]]) != undefined) && (options[item[1]] = this.source.attr(this.options.ajax[item[0]]) || '');
    }.bind(this));
    
    // Clone the system options
    var sysOptions = jQuery.extend(true, {}, this.options.ajax);
    
    // Abort running ajax call
    this.ajaxRequest && this.ajaxRequest.abort();
    
    // Extract events
    var beforeSend = options.beforeSend || sysOptions.beforeSend || function () {};
    var complete = options.complete || sysOptions.complete || function () {};
    var success = options.success || sysOptions.success || function () {};
    var error = options.error || sysOptions.error || function () {};
    
    // Merge options
    var userOptions = jQuery.extend(true, sysOptions, options);
    
    // Set new beforeSend event
    userOptions.beforeSend = function ()
    {
      // jBox is loading
      this.wrapper.addClass('jBox-loading');
      
      // Add loading spinner
      userOptions.spinner && (this.spinnerDelay = setTimeout(function ()
      {
        // If there is a dela
        this.wrapper.addClass('jBox-loading-spinner');
        
        // Reposition jBox
        // TODO: Only reposition if dimensions change
        userOptions.spinnerReposition && (opening ? (this.positionOnFadeComplete = true) : this.position());
        
        // Add spinner to container
        this.spinner = jQuery(userOptions.spinner !== true ? userOptions.spinner : '<div class="jBox-spinner"></div>').appendTo(this.container);
        
        // Fix spinners position if there is a title
        this.titleContainer && this.spinner.css('position') == 'absolute' && this.spinner.css({transform: 'translateY(' + (this.titleContainer.outerHeight() * 0.5) + 'px)'});
        
      }.bind(this), (this.content.html() == '' ? 0 : (userOptions.spinnerDelay || 0))));
      
      // Fire users beforeSend event
      (beforeSend.bind(this))();
      
    }.bind(this);
    
    // Set up new complete event
    userOptions.complete = function (response)
    {
      // Abort spinner timeout
      this.spinnerDelay && clearTimeout(this.spinnerDelay);
      
      // jBox finished loading
      this.wrapper.removeClass('jBox-loading jBox-loading-spinner jBox-loading-spinner-delay');
      
      // Remove spinner
      this.spinner && this.spinner.length && this.spinner.remove() && userOptions.spinnerReposition && (opening ? (this.positionOnFadeComplete = true) : this.position());
      
      // Store that ajax loading finished
      this.ajaxLoaded = true;
      
      // Fire users complete event
      (complete.bind(this))(response);
      
    }.bind(this);
    
    // Set up new success event
    userOptions.success = function (response)
    {
      // Set content
      userOptions.setContent && this.setContent(response, true) && (opening ? (this.positionOnFadeComplete = true) : this.position());
      
      // Store content in source element
      userOptions.setContent && this.source && this.source.data('jBox-ajax-data', response);
      
      // Fire users success event
      (success.bind(this))(response);
      
    }.bind(this);
    
    // Add error event
    userOptions.error = function (response) { (error.bind(this))(response); }.bind(this);
    
    // Send new ajax request
    this.ajaxRequest = jQuery.ajax(userOptions);
    
    return this;
  };
  
  
  // Play an audio file
  
  jBox.prototype.audio = function (url, volume)
  {
    // URL is required
    if (!url) return this;
    
    // Create intern audio object if it wasn't created already
    !jBox._audio && (jBox._audio = {});
    
    // Create an audio element specific to this audio file if it doesn't exist already
    if (!jBox._audio[url]) {
      var audio = jQuery('<audio/>');
      jQuery('<source/>', {src: url + '.mp3'}).appendTo(audio);
      jQuery('<source/>', {src: url + '.ogg'}).appendTo(audio);
      jBox._audio[url] = audio[0];
    }
    
    // Set volume
    jBox._audio[url].volume = Math.min(((volume != undefined ? volume : 100) / 100), 1);
    
    // Try to pause current audio
    try {
      jBox._audio[url].pause();
      jBox._audio[url].currentTime = 0;
    } catch (e) {}
    
    // Play audio
    jBox._audio[url].play();
    
    return this;
  };
  
  
  // Apply custom animations to jBox
  
  jBox._animationSpeeds = {
    'tada': 1000,
    'tadaSmall': 1000,
    'flash': 500,
    'shake': 400,
    'pulseUp': 250,
    'pulseDown': 250,
    'popIn': 250,
    'popOut': 250,
    'fadeIn': 200,
    'fadeOut': 200,
    'slideUp': 400,
    'slideRight': 400,
    'slideLeft': 400,
    'slideDown': 400
  };
  
  jBox.prototype.animate = function (animation, options)
  {
    // Options are required
    !options && (options = {});
    
    // Timout needs to be an object
    !this.animationTimeout && (this.animationTimeout = {});
    
    // Use jBox wrapper by default
    !options.element && (options.element = this.wrapper);
    
    // Give the element an unique id
    !options.element.data('jBox-animating-id') && options.element.data('jBox-animating-id', jBox._getUniqueElementID());
    
    // Abort if element is animating
    if (options.element.data('jBox-animating')) {
      options.element.removeClass(options.element.data('jBox-animating')).data('jBox-animating', null);
      this.animationTimeout[options.element.data('jBox-animating-id')] && clearTimeout(this.animationTimeout[options.element.data('jBox-animating-id')]);
    }
    
    // Animate the element
    options.element.addClass('jBox-animated-' + animation).data('jBox-animating', 'jBox-animated-' + animation);
    this.animationTimeout[options.element.data('jBox-animating-id')] = setTimeout((function() { options.element.removeClass(options.element.data('jBox-animating')).data('jBox-animating', null); options.complete && options.complete(); }), jBox._animationSpeeds[animation]);
  };
  
  
  // Destroy jBox and remove it from DOM
  
  jBox.prototype.destroy = function ()
  {
    // Detach from attached elements
    this.detach();
    
    // If jBox is open, close without delay
    this.isOpen && this.close({ignoreDelay: true});
    
    // Remove wrapper
    this.wrapper && this.wrapper.remove();
    
    // Remove overlay
    this.overlay && this.overlay.remove();
    
    // Remove styles
    this._styles && this._styles.remove();
    
    // Tell the jBox instance it is destroyed
    this.isDestroyed = true;
    
    return this;
  };
  
  
  // Get a unique ID for jBoxes
  
  jBox._getUniqueID = (function ()
  {
    var i = 1;
    return function () { return i++; };
  }());
  
  
  // Get a unique ID for animating elements
  
  jBox._getUniqueElementID = (function ()
  {
    var i = 1;
    return function () { return i++; };
  }());
  
  
  // Function to create jBox plugins
  
  jBox._pluginOptions = {};
  jBox.plugin = function (type, options)
  {
    jBox._pluginOptions[type] = options;
  };
  
  
  // Make jBox usable with jQuery selectors
  
  jQuery.fn.jBox = function (type, options)
  {
    // Variables type and object are required
    !type && (type = {});
    !options && (options = {});
    
    // Return a new instance of jBox with the selector as attached element
    return new jBox(type, jQuery.extend(options, {
      attach: this
    }));
  };
  
  return jBox;
}));
jQuery(document).ready(function(){new jBox.plugin("Confirm",{confirmButton:"Submit",cancelButton:"Cancel",confirm:null,cancel:null,closeOnConfirm:!0,target:window,addClass:"jBox-Modal",fixed:!0,attach:"[data-confirm]",getContent:"data-confirm",content:"Do you really want to do this?",minWidth:360,maxWidth:500,blockScroll:!0,closeOnEsc:!0,closeOnClick:!1,closeButton:!1,overlay:!0,animation:"zoomIn",preventDefault:!0,_onAttach:function(t){if(!this.options.confirm){var o=t.attr("onclick")?t.attr("onclick"):t.attr("href")?t.attr("target")?'window.open("'+t.attr("href")+'", "'+t.attr("target")+'");':'window.location.href = "'+t.attr("href")+'";':"";t.prop("onclick",null).data("jBox-Confirm-submit",o)}},_onCreated:function(){this.footer=jQuery('<div class="jBox-Confirm-footer"/>'),jQuery('<div class="jBox-Confirm-button jBox-Confirm-button-cancel"/>').html(this.options.cancelButton).click(function(){this.options.cancel&&this.options.cancel(),this.close()}.bind(this)).appendTo(this.footer),this.submitButton=jQuery('<div class="jBox-Confirm-button jBox-Confirm-button-submit"/>').html(this.options.confirmButton).appendTo(this.footer),this.footer.appendTo(this.container)},_onOpen:function(){this.submitButton.off("click.jBox-Confirm"+this.id).on("click.jBox-Confirm"+this.id,function(){this.options.confirm?this.options.confirm():eval(this.source.data("jBox-Confirm-submit")),this.options.closeOnConfirm&&this.close()}.bind(this))}})});
jQuery(document).ready(function(){new jBox.plugin("Image",{src:"href",gallery:"data-jbox-image",imageLabel:"title",imageFade:360,imageSize:"contain",imageCounter:false,imageCounterSeparator:"/",target:window,attach:"[data-jbox-image]",fixed:true,blockScroll:true,closeOnEsc:true,closeOnClick:"button",closeButton:true,overlay:true,animation:"zoomIn",preventDefault:true,width:"100%",height:"100%",adjustDistance:{top:40,right:5,bottom:40,left:5},_onAttach:function(b){this.images=this.images||{};
if(b.data("jBox-image-gallery")){return;}var a=b.attr(this.options.gallery)||"default";!this.images[a]&&(this.images[a]=[]);this.images[a].push({src:b.attr(this.options.src),label:(b.attr(this.options.imageLabel)||"")});
this.options.imageLabel=="title"&&b.removeAttr("title");b.data("jBox-image-gallery",a);b.data("jBox-image-id",(this.images[a].length-1));},_onInit:function(){this.currentImage={};
this.imageZIndex=1;var b=function(d,j,g,f,e,h,c){if(jQuery("#jBox-image-"+d+"-"+j).length){return;}var i=jQuery("<div/>",{id:"jBox-image-"+d+"-"+j,"class":"jBox-image-container"+(e?" jBox-image-not-found":"")+(!f&&!g?" jBox-image-"+d+"-current":""),"data-width":h,"data-height":c}).css({backgroundImage:e?"":'url("'+this.images[d][j].src+'")',backgroundSize:this.options.imageSize,opacity:(f?1:0),zIndex:(g?0:this.imageZIndex++)}).appendTo(this.content);
jQuery("<div/>",{id:"jBox-image-label-"+d+"-"+j,"class":"jBox-image-label"+(f?" active":"")}).html(this.images[d][j].label).click(function(){$(this).toggleClass("expanded");
}).appendTo(this.imageLabel);!f&&!g&&i.animate({opacity:1},this.options.imageFade);}.bind(this);var a=function(c,d){jQuery(".jBox-image-label.active").removeClass("active expanded");
jQuery("#jBox-image-label-"+c+"-"+d).addClass("active");};this.checkSize=function(c){if((this.content.width()<=c.data("width"))||(this.content.height()<=c.data("height"))){c.css("backgroundSize","contain");
}else{c.css("backgroundSize","auto");}};this.showImage=function(d){if(d!="open"){var c=this.currentImage.gallery;var f=this.currentImage.id+(1*(d=="prev")?-1:1);
f=f>(this.images[c].length-1)?0:(f<0?(this.images[c].length-1):f);}else{var c=this.source.data("jBox-image-gallery");var f=this.source.data("jBox-image-id");
jQuery(".jBox-image-pointer-prev, .jBox-image-pointer-next").css({display:(this.images[c].length>1?"block":"none")});}if(jQuery(".jBox-image-"+c+"-current").length){jQuery(".jBox-image-"+c+"-current").removeClass("jBox-image-"+c+"-current").animate({opacity:0},(d=="open")?0:this.options.imageFade);
}this.currentImage={gallery:c,id:f};if(jQuery("#jBox-image-"+c+"-"+f).length){jQuery("#jBox-image-"+c+"-"+f).addClass("jBox-image-"+c+"-current").css({zIndex:this.imageZIndex++,opacity:0}).animate({opacity:1},(d=="open")?0:this.options.imageFade);
this.checkSize(jQuery("#jBox-image-"+c+"-"+f));a(c,f);}else{this.wrapper.addClass("jBox-image-loading");jQuery('<img src="'+this.images[c][f].src+'"/>').each(function(){var g=new Image();
g.onload=function(){b(c,f,false,null,false,g.width,g.height);this.checkSize(jQuery("#jBox-image-"+c+"-"+f));a(c,f);this.wrapper.removeClass("jBox-image-loading");
}.bind(this);g.onerror=function(){b(c,f,false,null,true,g.width,g.height);a(c,f);this.wrapper.removeClass("jBox-image-loading");}.bind(this);g.src=this.images[c][f].src;
}.bind(this));}if(this.imageCounter){if(this.images[c].length>1){this.wrapper.addClass("jBox-image-has-counter");this.imageCounter.find(".jBox-image-counter-all").html(this.images[c].length);
this.imageCounter.find(".jBox-image-counter-current").html(f+1);}else{this.wrapper.removeClass("jBox-image-has-counter");}}if(this.images[c].length>1){var e=f+1;
e=e>(this.images[c].length-1)?0:(e<0?(this.images[c].length-1):e);(!jQuery("#jBox-image-"+c+"-"+e).length)&&jQuery('<img src="'+this.images[c][e].src+'"/>').each(function(){var g=new Image();
g.onload=function(){b(c,e,true,null,false,g.width,g.height);}.bind(this);g.onerror=function(){b(c,e,true,null,true,g.width,g.height);}.bind(this);g.src=this.images[c][e].src;
}.bind(this));}};},_onCreated:function(){this.imageLabel=jQuery("<div/>",{"class":"jBox-image-label-container"}).appendTo(this.wrapper);this.imageLabel.append(jQuery("<div/>",{"class":"jBox-image-pointer-prev",click:function(){this.showImage("prev");
}.bind(this)})).append(jQuery("<div/>",{"class":"jBox-image-pointer-next",click:function(){this.showImage("next");}.bind(this)}));if(this.options.imageCounter){this.imageCounter=jQuery("<div/>",{"class":"jBox-image-counter-container"}).appendTo(this.wrapper);
this.imageCounter.append(jQuery("<span/>",{"class":"jBox-image-counter-current"})).append(jQuery("<span/>").html(this.options.imageCounterSeparator)).append(jQuery("<span/>",{"class":"jBox-image-counter-all"}));
}},_onOpen:function(){jQuery(document).on("keyup.jBox-Image-"+this.id,function(a){(a.keyCode==37)&&this.showImage("prev");(a.keyCode==39)&&this.showImage("next");
}.bind(this));this.showImage("open");},_onClose:function(){jQuery(document).off("keyup.jBox-Image-"+this.id);},_onCloseComplete:function(){this.wrapper.find(".jBox-image-container").css("opacity",0);
}});});
jQuery(document).ready(function(){new jBox.plugin("Notice",{color:null,stack:!0,stackSpacing:10,autoClose:6e3,attributes:{x:"right",y:"top"},position:{x:15,y:15},responsivePositions:{500:{x:5,y:5},768:{x:10,y:10}},target:window,fixed:!0,animation:"zoomIn",closeOnClick:"box",zIndex:12e3,_onInit:function(){this.defaultNoticePosition=jQuery.extend({},this.options.position),this._adjustNoticePositon=function(){var t=jQuery(window),i={x:t.width(),y:t.height()};this.options.position=jQuery.extend({},this.defaultNoticePosition),jQuery.each(this.options.responsivePositions,function(t,o){if(i.x<=t)return this.options.position=o,!1}.bind(this)),this.options.adjustDistance={top:this.options.position.y,right:this.options.position.x,bottom:this.options.position.y,left:this.options.position.x}},this.options.content instanceof jQuery&&(this.options.content=this.options.content.clone().attr("id","")),jQuery(window).on("resize.responsivejBoxNotice-"+this.id,function(t){this.isOpen&&this._adjustNoticePositon()}.bind(this)),this.open()},_onCreated:function(){this.wrapper.addClass("jBox-Notice-color jBox-Notice-"+(this.options.color||"gray")),this.wrapper.data("jBox-Notice-position",this.options.attributes.x+"-"+this.options.attributes.y)},_onOpen:function(){this._adjustNoticePositon(),jQuery.each(jQuery(".jBox-Notice"),function(t,i){if(i=jQuery(i),i.attr("id")!=this.id&&i.data("jBox-Notice-position")==this.options.attributes.x+"-"+this.options.attributes.y){if(!this.options.stack)return void i.data("jBox").close({ignoreDelay:!0});var o=(i.data("jBoxNoticeMargin")?parseInt(i.data("jBoxNoticeMargin")):parseInt(i.css("margin-"+this.options.attributes.y)))+this.wrapper.outerHeight()+this.options.stackSpacing;i.data("jBoxNoticeMargin",o),i.css("margin-"+this.options.attributes.y,o)}}.bind(this))},_onCloseComplete:function(){this.destroy()}})});
//   jBox
window.msgErrorBox = {

	alert : function(title, message)
	{
		var options = {
			animation: {open: 'flip', close: 'zoomIn'},
			position: {
				x: 16,
				y: 16
			},
			color: 'red',
			zIndex: 12000,
			width: 250
		};

		if (title)
		{
			options['title'] = title;
		} else
		{
			options['title'] = '!';
		}
		if (message) options['content'] = message;
		new jBox('Notice', options);
	}
};

window.msgNoticeBox = {
	alert : function(title, message)
	{
		var options = {
			animation: {open: 'flip', close: 'zoomIn'},
			position: {
				x: 16,
				y: 16
			},
			color: 'green',
			zIndex: 12000,
			width: 250
		};

		if (title)
		{
			options['title'] = title;
		} else
		{
			options['title'] = '!';
		}
		if (message) options['content'] = message;
		new jBox('Notice', options);
	}
};
(function(a)
{
	(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4));
	jQuery.browser.mobile = jQuery.browser.mobile || a.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i);

})(navigator.userAgent||navigator.vendor||window.opera);


jQuery.cachedScript = function( url, options )
{
	// Allow user to set any option except for dataType, cache, and url
	options = $.extend( options || {},
	{
		dataType: "script",
		cache: true,
		url: url
	});
	// Use $.ajax() since it is more flexible than $.getScript
	// Return the jqXHR object so we can chain callbacks
	return jQuery.ajax( options );
};



$(document).ready(function()
{
	// 
	if (typeof(MutationObserver) != 'undefined')
	{
		var sContainer = '.content_plus_ad';
		var aLoadContainers = ['IFRAME', 'IMG'];
		var aResizeContainers = ['DIV'];
		
		var recalcBanners = function()
		{
			var nConiatnerHeight = $(sContainer).height();
			$('.sticky_block > div').each(function(i,e)
			{
				if ($(this).height() > 0) // sized
				{
					$(this).hide();
					if ($(sContainer).height() == nConiatnerHeight)
					{
						$(this).show();
						$(this).stick_in_parent({parent: sContainer, spacer: '.sticky_block'});
					} else
					{
						$(this).show();
						$(this).trigger('sticky_kit:detach');
					}
				}
			});
			$(document.body).trigger('sticky_kit:recalc');
			
			//    
			setTimeout(function()
			{
				$(document.body).trigger('sticky_kit:recalc');

			}, 500);
		};

		var bannerObserver = new MutationObserver(function(mutations)
		{
			var bRecalcBanners = false;
			for (var i = 0, j = mutations.length; i<j; i++)
			{
				if (mutations[i].type == 'childList')
				{
					if (mutations[i].addedNodes.length)
					{
						for (var k = 0, l = mutations[i].addedNodes.length; k<l; k++)
						{
							if (aLoadContainers.indexOf(mutations[i].addedNodes[k].nodeName) != -1)
							{
								mutations[i].addedNodes[k].addEventListener('load', recalcBanners, false);
							}

							if (aResizeContainers.indexOf(mutations[i].addedNodes[k].nodeName) != -1)
							{
								if (mutations[i].addedNodes[k].style.height && (mutations[i].addedNodes[k].style.height != 'auto')) bRecalcBanners = true;
								if (mutations[i].addedNodes[k].style.width && (mutations[i].addedNodes[k].style.width != 'auto')) bRecalcBanners = true;
							}
						}
					}

					if (mutations[i].removedNodes.length)
					{
						for (var k = 0, l = mutations[i].addedNodes.length; k<l; k++)
						{
							if (aLoadContainers.indexOf(mutations[i].addedNodes[k].nodeName) != -1)
							{
								mutations[i].addedNodes[k].removeEventListener('load', recalcBanners, false);
							}

							if (aResizeContainers.indexOf(mutations[i].addedNodes[k].nodeName) != -1)
							{
								bRecalcBanners = true;
							}
						}	
					}
				}
			}

			if (bRecalcBanners) recalcBanners();
		});

		$('.sticky_block').wrapInner('<div/>');
		$('.sticky_block > div').each(function(i,e)
		{
			bannerObserver.observe(this, {childList: true, subtree: true});

		});

		$(window).on('resize', recalcBanners);

	} else
	{
		$('.sticky_block').wrapInner('<div/>');
		$('.sticky_block > div').stick_in_parent({parent: '.content_plus_ad', spacer: '.sticky_block', recalc_every: 1});
	}

	//  "\
	$('#top, #bottom').css('position', 'fixed');

	$('a[href^="#top"]').on('click', function(e)
	{
		e.stopPropagation();
		$('body, html').animate({scrollTop: 0}, 1000);
		return false;
	});

	$('a[href^="#bottom"]').on('click', function(e)
	{
		e.stopPropagation();
		var offset = $('#bottom').offset().top - $('html').get(0).clientHeight - $('#bottom').height();
		$('body, html').animate({scrollTop: offset}, 1000);
		return false;
	});



	//  
	var _window = $(window);	
	$('.hidden_menu').on('click', function()
	{
		$(this).toggleClass('active');
		$('.company_bar').toggleClass('active');
	});

	$(window).on('scroll,resize', function()
	{
		var scrollTop = _window.scrollTop();

		if ( scrollTop > 40 && _window.width() < 1025 )
		{
			$('.hidden_menu').addClass('scrolled');
			$('.company_bar').addClass('scrolled');
		} else {
			$('.hidden_menu').removeClass('scrolled');
			$('.company_bar').removeClass('scrolled');
		}
	}).trigger('resize');

	$(document).on('mouseup', function(e)
	{
		var value = $('.company_bar, .hidden_menu');
		if (!$(value).is(e.target) && $(value).has(e.target).length === 0)
		{
			$('.hidden_menu').removeClass('active');
			$('.company_bar').removeClass('active');
		}

	}).on('click', '.mobile_search__toggle', function(e)
	{
		e.preventDefault();
		$(this).addClass('active');
		$(this).parent().addClass('active');
		$('.mobile_search__overlay').addClass('active');
		return false;
	}).on('click', '.mobile_search__toggle.active, .mobile_search__overlay', function(e)
	{
		e.preventDefault();
		$('.mobile_search').removeClass('active');
		$('.mobile_search__toggle').removeClass('active');
		$('.mobile_search__input').removeClass('active');
		$('.mobile_search__overlay').removeClass('active');
		return false;
	});

	$('.image_true').jBox('Tooltip', {
		maxWidth: '300px',
		position: {
          x: 'right',
          y: 'center'
        },
		outside: 'x'
	});

	function hideallDropdowns()
	{
		var aDropped = $('.drop-menu-main.dropped');
		if (aDropped.length)
		{
			aDropped.removeClass('dropped');
			aDropped.find('.drop-menu-main-sub').removeClass('showing');
			
			$('body').off('click', hideallDropdowns);
			return true;
		}
		return false;
	}

	$('body').on('click', '.drop-menu-main', function(e)
	{
		var t = $(this);
		if (!t.hasClass('dropped'))
		{
			e.preventDefault();
			hideallDropdowns();

			t.toggleClass('dropped');
			t.find('.drop-menu-main-sub').toggleClass('showing');
			
			e.stopPropagation();
			$('body').on('click', hideallDropdowns);
		}
	});

	function hideClickMenu(e)
	{
		$('.hamburger').removeClass('is-active');
		if (e.target.nodeName == 'A')
		{
			$('body').off('click', hideClickMenu);
			$('.clickmenu').hide();
			return;
		}

		var cm = $(e.target);
		if (!cm.hasClass('clickmenu') && !cm.hasClass('popupmenu')) cm = cm.parents('.clickmenu, .popupmenu');
		if (!cm.length)
		{
			$('body').off('click', hideClickMenu);
			$('.clickmenu').hide();
		}
	}

	$('.hamburger').on('click', function(e)
	{
		$(this).addClass('is-active');

		e.preventDefault();
		var menu = 'undermenu_more_main';
		var bOpened = ($('#'+menu).css('display') == 'block');

		$('.clickmenu').hide();
		if (!bOpened)
		{
			var menuitem = $('.hamburger');
			var offset = menuitem.offset();

			$('#'+menu).css({'left': offset.left + 'px', 'top': offset.top + menuitem.outerHeight() + 'px'});
			$('#'+menu).show();

			e.stopPropagation();
			$('body').on('click', hideClickMenu);
		}
	});

	if ($(window).width() < 700)
	{
		$('.flinks > div > span').on('click', function()
		{
			$('.flinks > div > a').hide();
			$(this).nextAll().slideToggle();
		});
	}

	$('.undermenu_more_main').on('mouseover', '.popupmenu', function(e)
	{
		var menuItem = $(e.target).parents('.submenu');
		if (!menuItem.hasClass('selected'))
		{
			menuItem.addClass('selected');
			var subMenu = $(e.target);
			if (!subMenu.hasClass('.popupmenu')) subMenu = subMenu.parents('.popupmenu');

			subMenu.on('mouseleave', function(e)
			{
				subMenu.off('mouseleave');
				menuItem.removeClass('selected');
			});
		}
	});



	//     
	$('[data-type="article"]').each(function(i, el)
	{
		var aId = $(el).data('id');
		$(el).find('a.imgpreview').attr('data-jbox-image', 'gallery_article_' + aId);
	});

	$('[data-type="comment"]').each(function(i, el)
	{
		var cId = $(el).data('id');
		$(el).find('a.imgpreview').attr('data-jbox-image', 'gallery_comment_' + cId);
	});	


	var widthOffset = 18+40;
	var heightOffset = 55+40;

	window.jbi = new jBox('Image');
	$(window).on('resize', function(e)
	{
		var jbiWidth = window.innerWidth - widthOffset;
		var jbiHeight = (window.innerWidth - widthOffset) / 1.5;
		if (jbiHeight > window.innerHeight)
		{
			jbiHeight = window.innerHeight - heightOffset;
			jbiWidth = jbiHeight * 1.5;
		}
		window.jbi.setWidth(jbiWidth);
		window.jbi.setHeight(jbiHeight);
	});
	$(window).trigger('resize');



	//  
	$('.sort-table').on('click', 'th', function()
	{
		var table = $(this).parents('table');
		var sortMode = !$(this).hasClass('asc');
		table.find('th').removeClass('active asc desc');
		$(this).addClass('active ' + (sortMode ? 'asc' : 'desc'));

		var col = table.find('th').index($(this));
		var trs = table.find('tr').get();
		var firstRow = trs.shift();
		var fCompareFunction = function(a,b){};

		$.each(trs, function(i,row)
		{
			var value = $($(row).find('td').get(col)).text();
			if ($.trim(value))
			{
				if (value.indexOf('%') !== -1)
				{
					fCompareFunction = function(a,b)
					{
						var a = parseFloat(a.replace('%',''));
						var b = parseFloat(b.replace('%',''));
						
						if (isNaN(a) || isNaN(b))
						{
							if (isNaN(a) && !isNaN(b)) return sortMode ? -1 : 1;
							if (!isNaN(a) && isNaN(b)) return sortMode ? 1 : -1;
							return 0;

						} else
						{
							return sortMode ? a - b : b - a;
						}
					};
					return false;
				
				} else if (value.match(/^[-+]?\b[0-9]*\.?[0-9]+\b$/))
				{
					fCompareFunction = function(a,b)
					{					
						var a = parseFloat(a);
						var b = parseFloat(b);
						
						if (isNaN(a) || isNaN(b))
						{
							if (isNaN(a) && !isNaN(b)) return sortMode ? -1 : 1;
							if (!isNaN(a) && isNaN(b)) return sortMode ? 1 : -1;
							return 0;

						} else
						{
							return sortMode ? a - b : b - a;
						}
					};
					return false;
				} else
				{
					fCompareFunction = function(a,b)
					{					
						return sortMode ? a.localeCompare(b) : b.localeCompare(a);
					};
					return false;
				}
			}
		});

		trs.sort(function(a,b)
		{
			var at = $($(a).find('td').get(col)).text();
			var bt = $($(b).find('td').get(col)).text();
			return fCompareFunction(at,bt);
		});

		table.empty();
		table.append($(firstRow));

		$.each(trs, function(i, v)
		{
			$(v).appendTo(table);
		});
	});

	$('.sort-table.collapsed + #collapse_wrapper').find('#collapse').on('click', function()
	{
		var table = $(this).parents('#collapse_wrapper').prev('.sort-table');
		if (table.length)
		{
			table.toggleClass('collapsed');
			if (table.hasClass('collapsed'))
			{
				$(this).text('  ');
			} else
			{
				$(this).text(' ');
			}
		}
	});


	//  
	if ($('.upbar_search').length)
	{
		var sServiceUrl = $('.upbar_search input[name="q"]').attr('autocompleter');
		$('.upbar_search input[name="q"]').autocomplete({
			containerClass: 'autocomplete-suggestions more_companies',
			serviceUrl: sServiceUrl,
			type: 'POST',
			dataType: 'json',
			paramName: 'value',
			params: {'json': 1, 'forums': 1},
			preventBadQueries: false,
			zIndex: 99999,
			transformResult: function(response)
			{
				return { suggestions: response['results'] };
			},

			beforeRender: function(container, suggestions)
			{
				$.each(suggestions, function(i,v)
				{
					if (('hilite' in v) && (v['hilite']))
					{
						container.find('.autocomplete-suggestion[data-index="' + i + '"]').addClass('hilite');
					}
				});
			},
			onSelect: function (suggestion)
			{
				document.location = suggestion.data;
			}
		});
	}



	//   
	var lastMessagesBlock = $('#forum_last_posts').first();
	if (lastMessagesBlock.length)
	{
		function lastMessagesBlockReloader()
		{
			window.setTimeout(function()
			{
				$.ajax({

					url: '/forum/ajax_forum_last_messages' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
					type: 'GET',
					data: {security_ls_key: LIVESTREET_SECURITY_KEY}

				}).then(function(result)
				{
					try
					{
						result = JSON.parse(result);
						if (result.js.bStateError)
						{
							msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
							return;
						}

					} catch (e) {}

					var block = $(result.js.sLastMessages);
					lastMessagesBlock.html(block.find('#forum_last_posts').html());
					lastMessagesBlockReloader();
				});

			}, 60000);
		}
		lastMessagesBlockReloader();
	}

	//  
	(function($)
	{
		if ($('#admin_new_bug').length)
		{
			$('#admin_new_bug').on('click', function()
			{
				JsHttpRequest.query('POST ' + aRouter.abuse + 'bug_clean_ajax/', {iBugId: $(this).attr('bug-id'), security_ls_key: LIVESTREET_SECURITY_KEY}, function(result, errors)
				{
					if (!result)
					{
						msgErrorBox.alert('Error', 'Please try again later');
					}
					
					if (result.bStateError)
					{
						msgErrorBox.alert(result.sMsgTitle, result.sMsg);
						if ('iNewBug' in result)
						{
							$('#admin_new_bug').attr('bug-id', result.iNewBug);
							$('.user_warned a').first().attr('href', aRouter['trading'] + 'smartlab-bugs/goto_comment_' + result.iNewComment + '/#comment' + result.iNewComment);
						}
					
					} else
					{
						document.location.reload();
					}
				}, true);	

			});
		}

		if ($('#admin_new_spam').length)
		{
			$('#admin_new_spam').on('click', function()
			{
				JsHttpRequest.query('POST ' + aRouter.abuse + 'spam_clean_ajax/', {iAbuseId: $(this).attr('abuse-id'), security_ls_key: LIVESTREET_SECURITY_KEY}, function(result, errors)
				{
					if (!result)
					{
						msgErrorBox.alert('Error', 'Please try again later');
					}
					
					if (result.bStateError)
					{
						msgErrorBox.alert(result.sMsgTitle, result.sMsg);
						if ('iNewAbuse' in result)
						{
							$('#admin_new_spam').attr('abuse-id', result.iNewAbuse);

							setTimeout(function()
							{
								document.location.reload();

							}, 1000);
						}
					
					} else
					{
						document.location.reload();
					}
				}, true);	

			});
		}


		$('body').on('click', '.youtube_video', function()
		{
			$(this).replaceWith($(this).attr('code'));
		});

	})(jQuery);

});
;
(function($)
{
	$(document).ready(function($)
	{
		$('body').on('click', '.blog_calendar', function()
		{
			if ($('.blog_dates').length)
			{
				$('.blog_dates').toggleClass('show');
			}
		});

		$('.input-daterange').datepicker({

			'toDisplay': 'dd.mm.yy',
			'toValue' : 'yyyy-mm-dd'

		}).on('hide', function(e) {e.preventDefault();});

		$('#my_blog_interval_form').on('submit', function(e)
		{
			e.preventDefault();

			var path = $('#my_blog_interval_form').attr('action');
				path += ($('#date_from').val()) ? $('#date_from').datepicker('getFormattedDate', 'yyyy-mm-dd') : '-';
				path += '/';

			if ($('#date_to').val())
			{
				path+= $('#date_to').datepicker('getFormattedDate', 'yyyy-mm-dd');
				path += '/';
			}

			location.replace(path);
			return false;
		});


		$('.place-btn').jBox('Tooltip', {
			maxWidth: '300px'
		});

	});

})(jQuery);
jQuery(document).ready(function($)
{

	//     
	$('[data-type="article"]').each(function(i, el)
	{
		var aId = $(el).data('id');
		$(el).find('a.imgpreview').attr('data-jbox-image', 'gallery_article_' + aId);
	});

	$('[data-type="comment"]').each(function(i, el)
	{
		var cId = $(el).data('id');
		$(el).find('a.imgpreview').attr('data-jbox-image', 'gallery_comment_' + cId);
	});	


	$('.topic').each(function(i, el)
	{
		var tId = $(el).attr('tid');
		$(el).find('a.imgpreview').attr('data-jbox-image', 'gallery_topic_' + tId);
	});

	$('.comment').each(function(i, el)
	{
		var cId = $(el).attr('id');
		if (typeof(cId) !== 'undefined')
		{
			var m = cId.match(/^comment_id_(\d+)$/);
			if (m !== null)
			{
				cId = m[1];
				$(el).find('a.imgpreview').attr('data-jbox-image', 'gallery_comment_' + cId);
			}
		}
	});	


	if (!('jbi' in window))
	{
		var widthOffset = 18+40;
		var heightOffset = 55+40;

		window.jbi = new jBox('Image');
		$(window).on('resize', function(e)
		{
			var jbiWidth = window.innerWidth - widthOffset;
			var jbiHeight = (window.innerWidth - widthOffset) / 1.5;
			if (jbiHeight > window.innerHeight)
			{
				jbiHeight = window.innerHeight - heightOffset;
				jbiWidth = jbiHeight * 1.5;
			}
			window.jbi.setWidth(jbiWidth);
			window.jbi.setHeight(jbiHeight);
		});
		$(window).trigger('resize');
	}

});
(function($)
{
	$(document).ready(function($)
	{
		$('body').on('click', '.chat_more__btn', function(e)
		{
			e.preventDefault();

			var nBtn = $(this);
			if (nBtn.next('.chat_more__overlay').length)
			{
				nBtn.find('~ .chat_more__overlay').show();
				nBtn.find('~ .chat_more__list').fadeIn('fast');
				nBtn.addClass('menu_active');

				return;
			}
			
			var sTargetType = null;
			var iTargetId = null;

			if (nBtn.parents('.topic[tid]').length)
			{
				sTargetType = 'topic';
				iTargetId = nBtn.parents('.topic[tid]').attr('tid');
			
			} else if (nBtn.parents('.comment[cid]').length)
			{
				sTargetType = 'comment';
				iTargetId = nBtn.parents('.comment[cid]').attr('cid');
			}

			if (iTargetId !== null)
			{
				var data = {target_id: iTargetId, security_ls_key: LIVESTREET_SECURITY_KEY}; 
				if ((sTargetType == 'comment') && ((typeof(lsCmtTree) !== 'undefined') && ('IsChat' in lsCmtTree))) data['chat'] = 1;

				$.ajax({

					url: aRouter['topic'] + 'ajax_' + sTargetType + '_menu/',
					type: 'POST',
					data: data
				}).then(function(result)
				{
					if (!result.bStateError)
					{
						nBtn.data('loaded', true);
						nBtn.after($(result.sHtml));
						nBtn.find('~ .chat_more__overlay').show();
						nBtn.find('~ .chat_more__list').fadeIn('fast');
						nBtn.addClass('menu_active');
					} else
					{
						msgErrorBox.alert(result.sMsgTitle, result.sMsg);
					}
				});
			}
		}).on('click', '.chat_more__item a.blacklist', function(e)
		{
			var data = {idUser: $(this).attr('user'), action: 'ban', security_ls_key: LIVESTREET_SECURITY_KEY};
			var url = '/blacklist/ajax/';
			
			$.ajax({

				url: url + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
				type: 'POST',
				data: data
			}).then(function(result)
			{
				try
				{
					result = JSON.parse(result);
				} catch (e)
				{
					msgErrorBox.alert('!', ' ');
					return;
				}

				if (result.js.bStateError)
				{
					return msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
				} else
				{
					if (result.js.sMsg) msgNoticeBox.alert(result.js.sMsgTitle, result.js.sMsg);
				}
			});
			
		}).on('click', '.chat_more__item a, .chat_more__overlay', function(e)
		{
			var nBtn = $(this).parents('.chat_more__wrapper').find('.chat_more__btn');
			nBtn.find('~ .chat_more__list').fadeOut('fast', function()
			{
				if (nBtn.data('loaded'))
				{
					$(this).remove();
					nBtn.find('~ .chat_more__overlay').remove();
					nBtn.removeClass('menu_active');
					nBtn.removeData('loaded');					
				} else
				{
					nBtn.removeClass('menu_active');
					nBtn.find('~ .chat_more__list').fadeOut('fast');
					nBtn.find('~ .chat_more__overlay').hide();
				}
			});
		});
	});

})(jQuery);								  ;
(function($)
{
	$(document).ready(function($)
	{
		$('#content .text > blockquote').each(function()
		{
			$(this).has('blockquote').addClass('bq_many');
			$(this).has('blockquote').children('blockquote').hide();
		});

		$('#content .text blockquote.bq_many').click(function()
		{
			$(this).children('blockquote').toggle();
			$(this).children('blockquote').toggleClass('bq_many_collapsed');
		});

	});

})(jQuery);
jQuery(document).ready(function($)
{
	$('#all_date').datepicker().on('hide', function(e)
	{
		e.preventDefault();

	}).on('changeDate', function(e)
	{
		if (('date' in e) && (e.format(0, 'yyyy-mm-dd')))
		{
			location.replace($(this).attr('route') + 'date/' + e.format(0, 'yyyy-mm-dd') + '/');
		} else
		{
			location.replace($(this).attr('route'));
		}
	});

	$('.refres_btn').on('click', function(e)
	{
		var button = $(this);
		button.toggleClass('enabled');

		var data = {};

		if (typeof(CURRENT_USER_ID) != 'undefined')
		{
			data['security_ls_key'] = LIVESTREET_SECURITY_KEY;
			data[button.attr('field')] = button.hasClass('enabled') ? 1 : 0;
		} else
		{
			// 
			if (localStorage) localStorage.setItem(button.attr('field'), button.hasClass('enabled') ? 1 : 0);
			return button.trigger('update');
		}

		$.ajax({

			url: '/settings/some_settings_ajax/' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
			type: 'POST',
			data: data

		}).then(function(result)
		{
			try
			{
				result = JSON.parse(result);
				if (result.js.bStateError)
				{
					msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
					return;
				} else
				{
					if ((button.attr('field') in result.js) && parseInt(result.js[button.attr('field')]))
					{
						button.addClass('enabled');
					} else
					{
						button.removeClass('enabled');
					}
					button.trigger('update');
				}
			} catch (e) {}
		});

	}).on('update', function(e)
	{
		var button = $(this);

		if ((typeof(CURRENT_USER_ID) == 'undefined') && localStorage)
		{
			if (parseInt(localStorage.getItem(button.attr('field'))))
			{
				button.addClass('enabled');
			} else
			{
				button.removeClass('enabled');
			}
		}

		if (button.data('timer'))
		{
			clearTimeout(button.data('timer'));
			button.removeData('timer');
		}

		if (button.hasClass('enabled'))
		{
			button.data('timer', setTimeout(function()
			{
				document.location.reload(true);

			}, 60000));
		}

	}).trigger('update');


	$('#disclosure-filters').on('click', 'span', function()
	{
		$(this).toggleClass('selected');
		
		var e = '';
		$(this).parents('.disclosureFilters').find('>.selected[act_code]').each(function(i,n)
		{
			if (e !='') e+='&';
			e+= encodeURIComponent('act_code[]') + '=' + encodeURIComponent($(n).attr('act_code'));
		});

		var h = document.location.href.toString().replace(/\/page\d+/, '').replace(/\?.*/, '');
		if (e) h += '?' + e;

		location.replace(h);
	});

	$('#allblog-filters').on('click', 'span', function()
	{
		$(this).toggleClass('selected');
		
		var e = '';
		$(this).parents('.disclosureFilters').find('>.selected[extra_id]').each(function(i,n)
		{
			if (e !='') e+='&';
			e+= encodeURIComponent('extra[]') + '=' + encodeURIComponent($(n).attr('extra_id'));
		});

		var h = document.location.href.toString().replace(/\/page\d+/, '').replace(/\?.*/, '');
		if (e) h += '?' + e;

		location.replace(h);
	});

});
var ls = ls || {};
ls.plugin = ls.plugin || {};

ls.plugin.autoopenid =( function ($) {

	var that=this;

	this.goServiceLogin = function(service)
	{
		var sBackUrl = window.location.href;

		$.each(document.cookie.split(';'), function(i, el)
		{
			var aCookie = $.trim(el).split('=');
			if (aCookie[0] == 'openidreferal')
			{
				sBackUrl = decodeURIComponent(aCookie[1]);
				return false;
			}
		});

		var data = { service: service, referal: sBackUrl};
		if (window.LIVESTREET_SECURITY_KEY) data['security_ls_key'] = LIVESTREET_SECURITY_KEY;

		$.ajax({

			url: DIR_WEB_ROOT + '/login/autoopenid/login-oauth' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
			type: 'POST',
			data: data

		}).then(function(result)
		{
			try
			{
				result = JSON.parse(result);
				if (!result.js.bStateError)
				{
					window.location.href=result.js.sUrl;

				} else
				{
					msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
				}

			} catch (e) {

				msgErrorBox.alert(null, '  '+service+'   .');
			}
		});
	};

	this.removeService = function(type,id)
	{
		var data = { type: type, id: id };
		if (window.LIVESTREET_SECURITY_KEY) data['security_ls_key'] = LIVESTREET_SECURITY_KEY;

 		
		$.ajax({

			url: DIR_WEB_ROOT + '/login/autoopenid/service-remove' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
			type: 'POST',
			data: data

		}).then(function(result)
		{
			try
			{
				result = JSON.parse(result);
				if (!result.js.bStateError)
				{
					$('#autoopenid-service-connect-item-'+res.id).remove();

				} else
				{
					msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
				}

			} catch (e) {

				msgErrorBox.alert(null, '  '+service+'   .');
			}
		});
	};

	this.showFormData = function() {
		$('#aoid-form-mail').hide();
		$('#aoid-form-data').show();
		$('#aoid-toggle-data').addClass('active');
		$('#aoid-toggle-mail').removeClass('active');
	};

	this.showFormMail = function() {
		$('#aoid-form-mail').show();
		$('#aoid-form-data').hide();
		$('#aoid-toggle-data').removeClass('active');
		$('#aoid-toggle-mail').addClass('active');
	};

	this.toggleFieldMail = function() {
		$('#aoid-field-mail').toggle();
	};

	$(function()
	{
		$(document).on('click', '.js-autoopenid-auth', function (e)
		{
			that.goServiceLogin($(this).data('service'));
			return false;
		});
		$(document).on('click', '.js-autoopenid-remove', function (e)
		{
			that.removeService($(this).data('serviceType'),$(this).attr('data-service-id'));
			return false;
		});
	}.bind(this));

	return this;

}).call(ls.plugin.autoopenid || {},jQuery);
jQuery(document).ready(function($)
{
	function hideProfileDropdown()
	{
		$('body').off('click', hideProfileDropdown);
		$('.profile .drop-menu-main').removeClass('dropped');
		$('.profile .drop-menu-main-sub').removeClass('showing');
	}

	$('.profile .drop-menu-main').on('click', function(e)
	{
		var bShowing = $('.profile .drop-menu-main-sub').hasClass('showing');

		$('.profile .drop-menu-main').toggleClass('dropped');
		$('.profile .drop-menu-main-sub').toggleClass('showing');

		if (!bShowing)
		{
			setTimeout(function()
			{
				//      ,    
				$('body').on('click', hideProfileDropdown);

			}, 1);
		} else
		{
			$('body').off('click', hideProfileDropdown);
		}
	});


	function setGlobalCounter(iCounter)
	{
		$('#notifies_link').find('.notify_round').text(iCounter);
		if (iCounter)
		{
			$('#notifies_link').removeClass('empty');
		} else
		{
			$('#notifies_link').addClass('empty');
		}
	};


	function clearTabCounter(sTab)
	{
		var d = $.Deferred();

		$.ajax({
			url: '/profile/ajaxnotifiesclear/',
			type: 'POST',
			data: {security_ls_key: LIVESTREET_SECURITY_KEY, tabs: [sTab]}
		}).then(function(response)
		{
			if (!response.bStateError)
			{
				d.resolve(response.iCounter);
			} else
			{
				d.reject(response.sMsgTitle, response.sMsg);
			}
		});

		return d;
	};	

	var nPopup = new jBox('Tooltip', 
	{
		id: 'notifiesPopover',
		trigger: 'click',
		adjustDistance: {top: 55, right: 5, bottom: 5, left: 5},
//		preventDefault: true,
//		closeOnClick: 'body',
		attach: $('#notifies_link'),
		zIndex: 12000,
		position: {
			x: 'center',
			y: 'bottom'
		},
		outside: 'y',
		pointer: 'right:20',
		clearTab: [$('#notifies_link').attr('tab') ? $('#notifies_link').attr('tab') : 'blog'],
		ajax: {
			url: '/profile/ajaxnotifies/',
			data: {
				security_ls_key: LIVESTREET_SECURITY_KEY,
				tab: $('#notifies_link').attr('tab') ? $('#notifies_link').attr('tab') : 'blog'
			},
			reload: 'strict',
			setContent: false,
			success: function(response)
			{
				if (response.bStateError)
				{
					this.close();
					return msgErrorBox.alert(response.sMsgTitle, response.sMsg);
				}
				this.setContent(response.sHtml);
				
				var nTab = this.content.find('.notify_tab.notify_tab__active');
				if (nTab.length && nTab.find('.notify_count > span').text() != '0')
				{
					var sTab = nTab.attr('tab');

					clearTabCounter(sTab).then(function(iCounter)
					{
						nPopup.options.globalCounter = iCounter;
					});
				} else
				{
					nPopup.options.globalCounter = parseInt($('#notifies_link > .notify_round').text());
				}
			},
			error: function()
			{
				msgErrorBox.alert('', ' !');
				this.close();
			}
		},

		onOpen: function()
		{
			var nContent = this.content;
			
			nContent.on('click', '.notify_tab', function()
			{
				var nTab = $(this);
				var sTab = nTab.attr('tab');

				var nTabs = nContent.find('.notify_tabs');
				if (nTabs.length)
				{
					var nActiveTab = nTabs.find('.notify_tab.notify_tab__active');
					if (nActiveTab.attr('tab') === nTab.attr('tab')) return;

					nActiveTab.removeClass('notify_tab__active').addClass('empty');
					setGlobalCounter(nPopup.options.globalCounter);

					nTab.addClass('notify_tab__active');
					nContent.find('.notify_content').hide();
					nContent.find('.notify_content[id="' + sTab + '"]').show();

					clearTabCounter(sTab).then(function(iCounter)
					{
						nPopup.options.globalCounter = iCounter;
					});
				}
			}).on('click', '.reply_section', function()
			{
				var sLink = $(this).attr('link');
				if (sLink)
				{
					nPopup.close();
					document.location.href = sLink;
				}
			}).on('click', 'a', function()
			{
				nPopup.close();
			});
		},

		onClose: function()
		{
			var nTab = this.content.find('.notify_tab.notify_tab__active');
			if (nTab.length)
			{
				clearTabCounter('all').then(function(iCounter)
				{
					nPopup.options.globalCounter = iCounter;
					setGlobalCounter(iCounter);
				});
			}
			this.content.off('click');
		}
	});

	//  
	$('body').on('click', function(e)
	{
		if ($(e.target).parents('#notifies_link').length) return;
		if ($(e.target).parents('#notifiesPopover').length) return;
		if (nPopup.isOpen) nPopup.close();
	});
});
(function ($) {

	function switchTheme(sTheme)
	{
		$('head').find('link[rel="stylesheet"]').filter(function($i)
		{
			return ($(this).attr('href').match(/^\/templates\/skin\/smart-lab-x3\/themes\//i) !== null);
		
		}).remove();

		if (sTheme != 'black') $('<link/>').attr({'rel':'stylesheet', 'type' : 'text/css', 'href' : '/templates/skin/smart-lab-x3/themes/' + sTheme + '.css'}).appendTo($('head'));
	}


	if (typeof(CURRENT_USER_ID) == 'undefined')
	{
		var sTheme = 'black';
		if ((typeof(localStorage) !== 'undefined') && (localStorage.getItem('sCurrentTheme') !== null)) sTheme = (['black', 'fullblack', 'white'].indexOf(localStorage.getItem('sCurrentTheme')) != -1) ? localStorage.getItem('sCurrentTheme') : 'black';
		switchTheme(sTheme);
	}

	jQuery(document).ready(function($)
	{
		$(document).on('click', '.toggle_fz', function(event)
		{
			event.preventDefault();
			var bActive = !$('body').hasClass('large_font') ? 1 : 0;

			if (typeof(CURRENT_USER_ID) != 'undefined')
			{
				var data = {security_ls_key: LIVESTREET_SECURITY_KEY, bPostsLargeFont: bActive};
				$.ajax({

					url: '/settings/some_settings_ajax/' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
					type: 'POST',
					data: data

				}).then(function(result)
				{
					try
					{
						result = JSON.parse(result);
						if (result.js.bStateError)
						{
							msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
							return;
						} else
						{
							if (('bPostsLargeFont' in result.js) && parseInt(result.js['bPostsLargeFont']))
							{
								$('body').addClass('large_font');
							} else
							{
								$('body').removeClass('large_font');
							}
						}
					} catch (e) {}
				});

			} else
			{
				// 
				if (typeof(localStorage) != 'undefined') localStorage.setItem('bPostsLargeFont', bActive);
				if (bActive)
				{
					$('body').addClass('large_font');
				} else
				{
					$('body').removeClass('large_font');
				}
			}
			return false;
		});

		if (typeof(CURRENT_USER_ID) == 'undefined')
		{
			var bActive = true;
			if ((typeof(localStorage) !== 'undefined') && (localStorage.getItem('bPostsLargeFont') !== null)) bActive = parseInt(localStorage.getItem('bPostsLargeFont')) ? true : false;

			if (bActive)
			{
				$('body').addClass('large_font');
			} else
			{
				$('body').removeClass('large_font');
			}
		}

		$(document).on('click', '.theme_switch_btn a', function(e)
		{
			e.preventDefault();

			var sTheme = $(this).attr('theme');
			if (typeof(CURRENT_USER_ID) != 'undefined')
			{
				document.location.href = '/settings/theme/' + sTheme + '/';

			} else
			{
				// 
				if (typeof(localStorage) != 'undefined') localStorage.setItem('sCurrentTheme', sTheme);
				switchTheme(sTheme);
			}
			return false;
		});		
	});


})(jQuery);
;

						jQuery(document).ready(function($)
						{
							// $('.flistlink').on('click', function(e)
							// {
							// 	var t = $(e.target);
							// 	var url =  '/profile/ajax' + t.attr('type') + 'list/';
							// 	var login = t.attr('user');

							// 	var c =	t.parents('tr').next('tr').find('.friends_w');
							// 	$.get(url, {'JsHttpRequest' : (new Date()).getTime(), 'login': login}, function(result, errors)
							// 	{
							// 		var res = result.match(/^JsHttpRequest\.dataReady\((.+)\)/);
							// 		if (res != null) res = JSON.parse(res[1]);

							// 		if (!res.js)
							// 		{
							// 			msgErrorBox.alert('Error','Please try again later');
							// 		}
							// 		if (res.js.bStateError)
							// 		{
							// 			msgErrorBox.alert(res.js.sMsgTitle,res.js.sMsg);
							// 		} else
							// 		{
							// 			c.empty();
							// 			$.each(res.js.aUsersList, function(i,a)
							// 			{
							// 				$('<a></a>').attr('href', '/profile/' + a.user_login + '/').text(a.user_profile_name).appendTo(c);
							// 			});

							// 			c.show();
							// 		}
							// 	});
							// 	t.remove();

							// });

							$('#plus100link').on('click', function(e)
							{
								var sLogin = $(e.target).attr('login');
								$.post('/profile/ajaxplus100/?JsHttpRequest=' + (new Date()).getTime() + '-xml', {'sLogin': sLogin, security_ls_key: LIVESTREET_SECURITY_KEY}, function(result)
								{
									try
									{
										result = JSON.parse(result);
									} catch (e)
									{
										return msgErrorBox.alert('Error', 'Please try again later');
									}
									if (!result) msgErrorBox.alert('Error', 'Please try again later');
									if (!result.js.bStateError)
									{
										$('#rating_span').text(result.js.sNewRating);
										msgNoticeBox.alert(result.js.sMsgTitle, result.js.sMsg);
									} else
									{
										msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
									}
								});
							});

							$('#allowPostNowlink').on('click', function(e)
							{
								var sLogin = $(e.target).attr('login');
								$.post('/profile/ajaxallownewbie/?JsHttpRequest=' + (new Date()).getTime() + '-xml', {'sLogin': sLogin, security_ls_key: LIVESTREET_SECURITY_KEY}, function(result)
								{
									try
									{
										result = JSON.parse(result);
									} catch (e)
									{
										return msgErrorBox.alert('Error', 'Please try again later');
									}
									if (!result) msgErrorBox.alert('Error', 'Please try again later');
									if (!result.js.bStateError)
									{
										msgNoticeBox.alert(result.js.sMsgTitle, result.js.sMsg);
									} else
									{
										msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
									}
								});
							});							

							$('#books_help_link').jBox('Tooltip', {
								position: {
									x: 'right',
									y: 'bottom'
								},
								width: '300px'
							});

							$('.detail_status .item, .user_status a, .reputation_item').jBox('Tooltip', {
								width: '300px'
							});
						});	
;
jQuery(document).ready(function($)
{
	//   - 
	var addEmployeeBtn = $('#add_company_employee').first();
	if (addEmployeeBtn.length && addEmployeeBtn.attr('company-id'))
	{
		var sWindowContent = '<div class="employeeBox">\
								<div>\
									<span> :</span><br/>\
									<div>\
										<input type="text"/>\
									</div>\
								</div><br/>\
								<span> :</span>\
								<ul>\
									<li>...</li>\
								</ul>\
						</div>';

		var employeeDialogParam = {

			id: 'employeeDialog',
			title: '  ',
			confirmButton: '',
			cancelButton: '',			
			content: sWindowContent,
			companyId: addEmployeeBtn.attr('company-id'),
			width: 450,

			onOpen: function()
			{
				var self = this;
				if ('confirmed' in this.options) delete this.options.confirmed;
				this.options.loadEmployeeList.call(this);
				
				var list = self.wrapper.find('ul');
				this.wrapper.on('click', '.removeFromEmployee', function()
				{
					$(this).parents('li').remove();
					if (!list.find('li').length) list.append('<li id="0"> .</li>');
				});

				this.wrapper.find('input:text').autocomplete({
					serviceUrl: '/summoner/nick_autocomplete2/',
					type: 'GET',
					dataType: 'json',
					paramName: 'q',
					preventBadQueries: false,
					zIndex: 99999,
					transformResult: function(response)
					{
						return { suggestions: response.results };
					},
					onSelect: function (suggestion)
					{
						var list = self.wrapper.find('ul');
						if (!list.find('li#' + suggestion.id).length)
						{
							var a = $('<a/>').attr('href', suggestion.url).text(suggestion.value);
							var li = $('<li/>').attr('id', suggestion.id);
							li.append(a);
							li.append($('<span class="removeFromEmployee" title="  ">&ndash;</span>'));
							list.append(li);
							$(this).val('');

							if (list.find('li#0').length) list.find('li#0').remove(); //  " "

							var iScroll = list[0].scrollHeight - list[0].clientHeight;
							list[0].scrollTop = iScroll ? iScroll : 0;
						}
					}
				});
			},

			loadEmployeeList: function()
			{
				var self = this;
				$.ajax({

					url: '/panel/ajaxemployeelist' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
					type: 'GET',
					data: {id: this.options.companyId, security_ls_key: LIVESTREET_SECURITY_KEY}

				}).then(function(result)
				{
					try
					{
						result = JSON.parse(result);
						if (result.js.bStateError)
						{
							msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
							return;
						}

					} catch (e) {}

					var list = self.wrapper.find('ul');
					list.empty();
					if (('employee' in result.js) && result.js.employee.length)
					{
						$.each(result.js.employee, function(i,v)
						{
							var li = $('<li/>');
							li.attr('id', v['id']);
							var a = $('<a/>').attr('href', v['url']).text(v['name']);
							li.append(a);

							li.append($('<span class="removeFromEmployee" title="  ">&ndash;</span>'));
							list.append(li);
						});

					} else
					{
						list.append('<li id="0"> .</li>');
					}
				});
			},

			saveEmployeeList: function()
			{
				var self = this;

				var aEmployee = [];
				this.wrapper.find('ul').find('li').each(function(i, n)
				{
					aEmployee.push(this.id);
				});

				if (aEmployee.indexOf(0) !== -1) aEmployee = aEmployee.splice(aEmployee.indexOf(0), 1);

				$.ajax({

					url: '/panel/ajaxemployeelist' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
					type: 'POST',
					data: {id: self.options.companyId, employee: aEmployee, security_ls_key: LIVESTREET_SECURITY_KEY}

				}).then(function(result)
				{
					try
					{
						result = JSON.parse(result);
					} catch (e)
					{
						msgErrorBox.alert('!', ' ');
						return;						
					}

					if (result.js.bStateError)
					{
						msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
					} else
					{
						if (result.js.sMsg) msgNoticeBox.alert(result.js.sMsgTitle, result.js.sMsg);
					}
				});
			},

			confirm: function()
			{
				this['confirmed'] = true;
			},

			onClose: function()
			{
				if (('confirmed' in this.options) && (this.options.confirmed)) this.options.saveEmployeeList.call(this);
				this.wrapper.off('click');
			}
		};

		addEmployeeBtn.on('click', function()
		{
			var box = new jBox('Confirm', employeeDialogParam);
			box.open();
		});
	}

});
(function(c){var b='<div class="book_popup">	<div class="book_thumbnail">		<a href="#" title="  ">			<img src="/plugins/books/templates/skin/default/img/nocover.png" />		</a>	</div>	<div class="book_info">		<div><a class="book_title" href="#" title="  ">           </a></div>		<div><span class="book_subtitle">   ,      </span></div>		<div class="book_authors"><a href="#"> </a>, <a href="#">  2</a></div>		<div class="book_rating">			<div style="width: 10%"></div>		</div>	</div>	<div class="profile_panel">		<div>			<a href="#"></a>			<a href="#"></a>			<a href="#">  </a>			<a href="#">  </a>		</div>	</div></div>';
function a(j){var d=c(b);d.find(".book_thumbnail img").attr("src",j.thumbnail?j.thumbnail:DIR_WEB_ROOT+"/plugins/books/templates/skin/default/img/nocover.png");
d.find(".book_thumbnail a").attr("href",j.profile);d.find(".book_title").attr("href",j.profile).text(j.title);if("title_second" in j){d.find(".book_subtitle").text(j.title_second);
}else{d.find(".book_subtitle").parent("div").remove();}if("authors" in j){var i=d.find(".book_authors").empty();var h=false;for(var g in j.authors){if(h){i.append(c(document.createTextNode(", ")));
}var f=c("<a></a>").attr("href",j.authors[g]).text(g);i.append(f);h=true;}}else{d.find(".book_authors").remove();}d.find(".book_rating > div").css("width",Math.round(parseFloat(j.rating)*20)+"%");
d.find(".book_rating").attr("title",": "+Math.round(parseFloat(j.rating)*100)/100+", : "+j.votes);var e=d.find(".profile_panel > div");
e.empty();if("buy_url" in j){e.append(c('<a href="'+j.buy_url+'" target="_blank"></a>'));}if("buy_in_english_url" in j){e.append(c('<a href="'+j.buy_in_english_url+'" target="_blank">Buy</a>'));
}if("download_url" in j){e.append(c('<a href="'+j.download_url+'" target="_blank"></a>'));}if(!("reviewed" in j)){if(!("wishlisted" in j)){e.append(c('<a href="'+(("guest_mode" in j)?"/login":"/books/book_add_to_wishlist/"+j.id)+'/" target="_blank">  </a>'));
}else{e.append(c('<a href="/books/book_remove_from_wishlist/'+j.id+'/" target="_blank">  </a>'));}e.append(c('<a href="'+(("guest_mode" in j)?"/login":"/review/add/for/"+j.id)+'/" target="_blank">  </a>'));
}if(d.scrollHeight>0){d.css("height",(d.height()+d.scrollHeight)+"px");e.css("bottom","0");}return d;}c(document).ready(function(){var g={};var f=new RegExp("^/books/([^\\/]+)/$","i");
var e=new RegExp("^/books/book_view/(\\d+)/?$","i");var d=["book_add_to_wishlist","book_remove_from_wishlist","wishlist_of","autocomplete","book_add","book_edit","book_delete","book_view","book_list","book_search","reviewed_by","genre_add","genre_edit","genre_up","genre_down","genre_delete","genre_list","publisher_add","publisher_edit","publisher_up","publisher_down","publisher_delete","publisher_list","top","list"];
new jBox("Tooltip",{id:"bookPopover",trigger:"mouseenter",adjustDistance:{top:55,right:5,bottom:5,left:5},delayOpen:500,closeOnMouseleave:true,animation:"move",attach:c('a[href^="/books/"]').filter(function(j){if(c(this).attr("href").match(e)!==null){return true;
}var h=c(this).attr("href").match(f);if(h&&(d.indexOf(h[1])==-1)){return true;}return false;}),zIndex:8000,position:{x:"center",y:"bottom"},followMouse:true,outside:"y",onOpen:function(){var j=this;
var n=null;var k=null;if(m=c(this.target).attr("href").match(e)){n=m[1];}if(m=c(this.target).attr("href").match(f)){k=m[1];}if(c(this.target).find("img").length){this.target=c(this.target).find("img");
}var l=function(o){this.setContent(a(o));};var i=(n!=null)?"id:"+n:"u:"+k;if(!(i in g)){var h={};if("LIVESTREET_SECURITY_KEY" in window){h.security_ls_key=LIVESTREET_SECURITY_KEY;
}if(k!=null){h.url=k;}if(n!=null){h.id=n;}JsHttpRequest.query("POST /books/ajaxprofile/",h,function(o,p){if(!o){return;}if(!o.bStateError){g[i]=o.aProfile;
l.call(j,g[i]);}},true);}else{l.call(this,g[i]);}},onCloseComplete:function(){c(".book_popup").remove();}});});})(jQuery);
/**
 * Cursor Functions
 *
 * Used for setting and getting text cursor position within an input
 * and textarea field. Also used to get and set selection range.
 * 
 * @author Branden Cash
 * @email brandencash@crutzdesigns.com
 */
 
(function( $ ){
  jQuery.fn.getCursorPosition = function(){
    if(this.lengh == 0) return -1;
    return $(this).getSelectionStart();
  }
  
  jQuery.fn.setCursorPosition = function(position){
    if(this.lengh == 0) return this;
    return $(this).setSelection(position, position);
  }
  
  jQuery.fn.getSelection = function(){
    if(this.lengh == 0) return -1;
    var s = $(this).getSelectionStart();
    var e = $(this).getSelectionEnd();
    return this[0].value.substring(s,e);
  }
  
  jQuery.fn.getSelectionStart = function(){
    if(this.lengh == 0) return -1;
    input = this[0];
    
    var pos = input.value.length;
    
    if (input.createTextRange) {
      var r = document.selection.createRange().duplicate();
      r.moveEnd('character', input.value.length);
      if (r.text == '') 
        pos = input.value.length;
      pos = input.value.lastIndexOf(r.text);
    } else if(typeof(input.selectionStart)!="undefined")
      pos = input.selectionStart;
    
    return pos;
  }
  
  jQuery.fn.getSelectionEnd = function(){
    if(this.lengh == 0) return -1;
    input = this[0];
    
    var pos = input.value.length;
    
    if (input.createTextRange) {
      var r = document.selection.createRange().duplicate();
      r.moveStart('character', -input.value.length);
      if (r.text == '') 
        pos = input.value.length;
      pos = input.value.lastIndexOf(r.text);
    } else if(typeof(input.selectionEnd)!="undefined")
      pos = input.selectionEnd;
    
    return pos;
  }
  
  jQuery.fn.setSelection = function(selectionStart, selectionEnd) {
    if(this.lengh == 0) return this;
    input = this[0];
    
    if (input.createTextRange) {
      var range = input.createTextRange();
      range.collapse(true);
      range.moveEnd('character', selectionEnd);
      range.moveStart('character', selectionStart);
      range.select();
    } else if (input.setSelectionRange) {
      input.focus();
      input.setSelectionRange(selectionStart, selectionEnd);
    }
    
    return this;
  }
})( jQuery );
(function($) {

	$.fn.smart_console = function(options)
	{
		var self = this;

		var input = this.find('input');
		var help = $('<div class="help"></div>').appendTo(this);
		var combo = $('<div class="console_combo"></div>').insertAfter(this);

		options = options || {};
		var settings = {

			combo_timeout : 100,
			commands : {},
			aliases : {},
			autocomplete_url : {

				'login' : '/summoner/nick_autocomplete/$query$/',
				'company' : '/company/autocomplete/$query$/',
				'forum' : '/console/ajaxCompany/?value=$query$',
				'symbol': '/g/autocomplete/$query$/',
				'tag' : '/include/ajax/tagAutocompleterConsole.php?q=$query$',
				'wiki' : '/include/ajax/dictionaryAutocompleterConsole.php?q=$query$',
				'book' : '/books/autocomplete/$query$/'
			}
		};

		var autocomplete = {

			box: null,
			search_empty : '',
			mode : '',
			cache: {login: {}, company:{}, forum:{}, symbol:{}, tag:{}, wiki:{}, book:{}}
		};

		if (options) $.extend(settings, options);

		/* -------------------- Autocompleter begin -------------------*/

		function autocomplete_from()
		{
			var command = input.val();
			var from_spaces = 0;
			var m = command.match(/^(\s*)?(.*)/);
			if (m !== null)
			{
				command = m[2];
				from_spaces = (typeof(m[1]) == 'undefined') ? 0 : m[1].length;
			}

			var params = command.split(' ');

			// $GAZP hack
			if (command[0] == '$')
			{
				params[0] = params[0].substr(1);
				params.unshift('$');
			}


			var cmd = $.trim(params.shift().toUpperCase());
			if (cmd in settings.aliases) cmd = settings.aliases[cmd];
			if (cmd in settings.commands)
			{
				function autocomplete_try(cmd, info)
				{
					autocomplete.mode = '';
					if ('ac' in info)
					{
						var param_test = $.trim(params.join(' '));
						var param_val = info.ac.exec(param_test);

						if (param_val !== null)
						{
							if ((info.ac.toString().indexOf('@') !== -1) && (info.ac.toString().indexOf('[^@') === -1))
							{
								// login
								autocomplete.mode = 'login';
								return command.indexOf('@') + 1;

							} else if (info.act == 'forum$')
							{
								// forum
								autocomplete.mode = 'forum';
								return cmd.length; // strlen corp (without space // for $GAZP)
							
							} else if ('act' in info)
							{
								autocomplete.mode = info.act;
								return cmd.length + 1 + param_val['index'] + param_val[0].search(param_val[1]);
							}
						}
					}
					return -1;
				}

				var res = false;
				if ('variants' in settings.commands[cmd])
				{
					try
					{
						$.each(settings.commands[cmd]['variants'], function(i, v)
						{
							res = autocomplete_try(cmd, v);
							if (res !== -1)
							{
								res += from_spaces;
								//console.log(res + ' ' + autocomplete.mode);
								throw true;
							}
						});

					} catch (e) {}
				} else
				{
					res = autocomplete_try(cmd, settings.commands[cmd]);
					if (res !== -1) res += from_spaces;
				}
				return (input.getCursorPosition() >= res) ? res : -1;
			}
			return -1;
		}
						
		function autocomplete_close()
		{
			if (autocomplete.search_ajax != null)
			{
				autocomplete.search_ajax.abort();
				autocomplete.search_ajax = null;
			}

			autocomplete.box.hide();
		}

		function autocomplete_fill()
		{
			if (autocomplete.search_ajax != null)
			{
				autocomplete.search_ajax.abort();
				autocomplete.search_ajax = null;
			}

			var word = $.trim(input.val().substr(autocomplete_from()));
			if (word !== '')
			{
				function autocomplete_fill_results(data)
				{
					if (data !== null)
					{
						autocomplete.search_empty = '';
						autocomplete.cache[autocomplete.mode][word] = data;
						autocomplete.box.trigger({type:'reset', message: {items: data, mode: autocomplete.mode}});
					} else
					{
						if (!autocomplete.search_empty) autocomplete.search_empty = word;
						autocomplete_close();
					}
				}

				if (autocomplete.search_empty && (autocomplete.search_empty.length <= word.length) && (word.indexOf(autocomplete.search_empty) == 0))
				{
					autocomplete_close();
				} else
				{
					if (word in autocomplete.cache[autocomplete.mode])
					{
						autocomplete_fill_results(autocomplete.cache[autocomplete.mode][word]);
					} else
					{
						autocomplete.search_ajax = $.getJSON(settings.autocomplete_url[autocomplete.mode].replace('$query$',  encodeURIComponent(word)), function(res)
						{
							var data = ((('results' in res) && res.results.length) ? res.results : null);
							autocomplete.cache[autocomplete.mode][word] = data;
							autocomplete_fill_results(data);
						});
					}
					return true;
				}
			} else
			{
				autocomplete_close();
			}
			return false;
		}

		function autocomplete_open()
		{
			var from = autocomplete_from();
			if (from !== -1)
			{
				var word = $.trim(input.val().substr(from));
				//   ,       .     , ..    3 
				if (autocomplete.search_empty && (autocomplete.search_empty.length > 3) && (autocomplete.search_empty.length <= word.length) && (word.indexOf(autocomplete.search_empty) == 0)) return false;
				if (word in autocomplete.cache[autocomplete.mode])
				{
					var ct = 0;
					var founded = false;
					$.each(autocomplete.cache[autocomplete.mode][word], function(i,v)
					{
						ct++;
						if (v.l === word) founded = true;
					});

					if (founded && (ct == 1))
					{
						if (autocomplete.box.css('display') != 'none') autocomplete_close();
						return false;
					}
				}

				if (autocomplete.box.css('display') == 'none')
				{
					autocomplete.search_empty = '';
					var offset = input.offset();
					autocomplete.box.css('top', offset.top + input.outerHeight() + 'px');
					autocomplete.box.css('left', offset.left + (from * 13) + 'px');
					autocomplete.box.trigger({type:'reset', message: {items:[]}});
					autocomplete.box.show();
				}

				return autocomplete_fill();
			} else
			{
				if (autocomplete.box.css('display') != 'none') autocomplete_close();
			}

			return false;
		}

		function autocomplete_done(unique)
		{
			var from = autocomplete_from();
			if (from != -1)
			{
				var word = $.trim(input.val().substr(from));
				var res = autocomplete.cache[autocomplete.mode][word];
				try
				{
					$.each(res, function(i,v)
					{
						if (v.l == unique)
						{
							var t = input.val().substr(0, from) + unique;
							input.val(t);
							input.setCursorPosition(t.length);
							throw true;
						}
					});
	
				} catch (e){}
			}
			autocomplete_close();
		}


		/* -------------------- Autocompleter end -------------------*/


		function tooltip_help(value)
		{
			if (help.length)
			{
				help.text(value);
				if (value.length)
				{
					help.show();
				} else
				{
					help.hide();
				}
			}
		}


		function need_auth(command)
		{
			return ((!('login' in settings)) && ('auth_required' in command) && (command.auth_required === true));
		}

		function help_func(command)
		{
			if (!command.length)
			{
				var data = [];
				var needed = ['FIND ', 'FIND @', 'BLOG @', '$', 'G', 'FIND B ', 'FIND F ', 'TAG '];
				$.each(needed, function(i, command)
				{
					for (var cmd in settings.commands)
					{
						if (cmd == command)
						{
							var v = settings.commands[cmd];
							var t = ('start_title' in v) ? v['start_title'] : v['title'];
							data.push({l: cmd, t: t, s: ('syntax' in v) ? v['syntax'] : cmd, a: need_auth(settings.commands[cmd]), oc:cmd});

						} else
						{
							var variants = ('variants' in settings.commands[cmd]) ? settings.commands[cmd]['variants'] : [settings.commands[cmd]];
							$.each(variants, function(i, v)
							{
								var u = ('command' in v) ? v['command'] : (('syntax' in v) ? v['syntax'] : i);
								if (u == command)
								{
									var t = ('start_title' in v) ? v['start_title'] : v['title'];
									data.push({l: u, t: t, s: ('syntax' in v) ? v['syntax'] : cmd, a: need_auth(v), oc:cmd});
									return false;
								}
							});
						}
					}
				});
				
				combo.trigger({type:'reset', message: {items: data, mode: 'help_reverse'}});
				return true;
			}

			var params = command.replace(/^\s+/, '').split(' ');
			var cmd = params.shift().toUpperCase();
			if (cmd in settings.aliases) cmd = settings.aliases[cmd];

			if (cmd in settings.commands)
			{
				var data = [];
				var variants = ('variants' in settings.commands[cmd]) ? settings.commands[cmd]['variants'] : [settings.commands[cmd]];
				$.each(variants, function(i, v)
				{
					if (!(('hidden' in v) && v['hidden']))
					{
						var u = ('command' in v) ? v['command'] : (('syntax' in v) ? v['syntax'] : cmd);
						data.push({l: u, t: v['title'], s: ('syntax' in v) ? v['syntax'] : cmd, a: need_auth(v), oc: cmd});
						if ((u == command.toUpperCase()) && ('tooltip' in v)) tooltip_help(v['tooltip']);
					}
				});
				combo.trigger({type:'reset', message: {items: data, mode: 'help_reverse'}});
				return true;

			} else if (cmd == 'HELP')
			{
				var data = [];
				for (var i in settings.commands)
				{
					if (('hidden' in settings.commands[i]) && (settings.commands[i]['hidden'])) continue;
					var item = {l: i, t: settings.commands[i]['title'], c: '   ' + i, a: need_auth(settings.commands[i])};
					data.push(item);
				}
				data.push({l: 'HELP', t: '  ', c: '    \'(', a: false});
				combo.trigger({type:'reset', message: {items: data, mode: 'help'}});

				return true;

			} else if (cmd)
			{
				var data = [];
				var rx = new RegExp('^' + cmd.replace('\\', '\\\\'),'i');
				for (var i in settings.commands)
				{
					var variants = ('variants' in settings.commands[i]) ? settings.commands[i]['variants'] : [settings.commands[i]];
					$.each(variants, function(ii,v)
					{
						var u = ('command' in v) ? v['command'] : (('syntax' in v) ? v['syntax'] : i);
						if (('command' in v) && rx.test(v['command']))
						{
							data.push({l: u, t: v['title'], s: ('syntax' in v) ? v['syntax'] : i, a: need_auth(v), oc: i});

						} else if (rx.test(i) && (!('params' in v)))
						{
							data.push({l: u, t: v['title'], s: ('syntax' in v) ? v['syntax'] : i, a: need_auth(v), oc: i});

						} else if (rx.test(v['title']))
						{
							data.push({l: u, t: v['title'], s: ('syntax' in v) ? v['syntax'] : i, a: need_auth(v), oc: i});
						} else if ('keywords' in v)
						{
							var aw = v['keywords'].split(',');
							$.each(aw, function(iii,w)
							{
								if (rx.test(w))
								{
									data.push({l: u, t: v['title'], s: ('syntax' in v) ? v['syntax'] : i, a: need_auth(v), oc: i});
									return false;
								}
							});
						}
					});
				}

				if (data.length)
				{
					combo.trigger({type:'reset', message: {items: data, mode: 'help_reverse'}});
					return true;
				}

			}
			return false;
		};


		function need_help(value, prepend)
		{
			var arglen = arguments.length; 
			//value = $.trim(value);

			if ('combo_timer' in settings)
			{
				clearTimeout(settings.combo_timer);
				delete settings.combo_timer;
			}

			settings.combo_timer = setTimeout(function()
			{
				var show = help_func(value);
				if (!show)
				{
					if (combo.css('display') != 'none') combo.slideToggle('fast');
				} else
				{
					if (arglen > 1) combo.prepend(prepend);
					combo.css('max-height') < combo.height() ? combo.css('overflow-y', 'scroll') : combo.css('overflow-y', 'auto');
					if (combo.css('display') == 'none') combo.slideToggle('fast');
				}

			}, settings.combo_timeout);
		};


		function redirect(url, new_tab)
		{
			new_tab = true;
		//	if (url[0] == '/') url = 'http://smart-lab.ru' + url;

			if (new_tab)
			{
				window.open(url,'_blank');
			} else
			{
				document.location = url;
			}
		}


		function command_func(command)
		{
			var params = $.trim(command).split(' ');

			// $GAZP hack
			if (command[0] == '$')
			{
				params[0] = params[0].substr(1);
				params.unshift('$');
			}

			var cmd = params.shift().toUpperCase();
			if (cmd in settings.aliases) cmd = settings.aliases[cmd];
			if (cmd in settings.commands)
			{
				var ERR_OK = 0;
				var ERR_SYNTAX = 1;
				var ERR_UNKNOWN = 2;
				var ERR_AUTH = 3;

				var err_msg = {};
				err_msg[ERR_SYNTAX] = ' .';
				err_msg[ERR_UNKNOWN] = ' .';
				err_msg[ERR_AUTH] = ' .';

				function notifyStat(sCommand)
				{
					$.get('/console/ajaxCommand', {'command': sCommand, 'line': command});
				}

				function execute(info, sCommand)
				{
					function execute_simple()
					{
						if ('redirect_url' in info)
						{
							if (need_auth(info)) return ERR_AUTH;
							redirect(info['redirect_url']);
							return ERR_OK;

						} else if ('url' in info)
						{
							if (need_auth(info)) return ERR_AUTH;

							var u = info['url'];
							if (u.indexOf('$login') !== -1) u = u.replace('$login', encodeURIComponent(settings.login));
							redirect(u);
							return ERR_OK;

						} else if ('func' in info)
						{
							if (need_auth(info)) return ERR_AUTH;
							var func = (info['func'] in window) ? window[info['func']] : info['func'];
							if (typeof(func)) func.call(window, settings.login);
							return ERR_OK;
						}
						return ERR_SYNTAX;
					}


					if (params.length == 0)
					{
						if (!('params' in info)) return execute_simple();

					} else
					{
						if ('params' in info)
						{
							var param_val = info.params.exec(params.join(' '));
							if (param_val !== null)
							{
								if ('url' in info)
								{
									if (need_auth(info)) return ERR_AUTH;

									var u = info['url'];
									for (var i = 1; i < param_val.length; i++)
									{
										u = u.replace('$'+i, encodeURIComponent(param_val[i]));
									}
									if (u.indexOf('$login') !== -1) u = u.replace('$login', encodeURIComponent(settings.login));
									redirect(u);
									return ERR_OK;

								} else if ('func' in info)
								{
									if (need_auth(info)) return ERR_AUTH;
									var func = (info['func'] in window) ? window[info['func']] : info['func'];
									if (typeof(func)) func.apply(window, param_val.slice(1));
									return ERR_OK;
								}
							}

						} else
						{
							var cmp = ('command' in info) ? info['command'] : (('syntax' in info) ? info['syntax'] : '');
							if (cmp == command.toUpperCase()) return execute_simple();
						}
					}
					return ERR_SYNTAX;
				}

				var res = ERR_UNKNOWN;
				if ('variants' in settings.commands[cmd])
				{
					try
					{
						$.each(settings.commands[cmd]['variants'], function(i, v)
						{
							res = execute(v, cmd);
							if ((res === ERR_OK) || (res === ERR_AUTH)) throw true;
						});

					} catch (e) {}
				} else
				{
					res = execute(settings.commands[cmd], cmd);
				}

				if (res !== ERR_OK)
				{
					need_help(cmd, $('<div class="console_error">' + err_msg[res] + '</div>'));
					return false;
				} else
				{
					notifyStat(cmd);
					return true;
				}

			} else if ((cmd === 'HELP') || (cmd === ''))
			{
				document.location = '/page/help/';
				return true;
			} else
			{
				//  
				document.location = '/search/topics/?q=' + encodeURIComponent(command);
				return true;
			}
			return false;
		};


		input.on('keydown', function(e)
		{
			switch (e.which)
			{
				case 27:
				{
					if (autocomplete.box.css('display') != 'none')
					{
						autocomplete_close();
						e.preventDefault();

					} else if (combo.css('display') != 'none') combo.slideToggle('fast');
					break;
				}

				case 13:
				{
					if ((autocomplete.box.css('display') == 'none') && (combo.css('display') == 'none'))
					{
						e.preventDefault();

						if ('combo_timer' in settings)
						{
							clearTimeout(settings.combo_timer);
							delete settings.combo_timer;
						}

						if (command_func($(this).val().replace(/^\s+/, ''))) $(this).val('');
						break;

					} 

					//      
				}
				case 38:
				case 40:
				{
					if (autocomplete.box.css('display') != 'none')
					{
						e.preventDefault();
						autocomplete.box.trigger(jQuery.Event('keypress', {keyCode: e.which}));

					} else if (combo.css('display') != 'none')
					{
						e.preventDefault();
						combo.trigger(jQuery.Event('keypress', {keyCode: e.which}));
					}
					break;
				}

				default:
				{
					setTimeout(function(e)
					{
						if (!autocomplete_open()) need_help(input.val());

					}, 1);
					break;
				}
			}

		}).on('change', function(e)
		{
			need_help($(this).val());

		}).on('command', function(e)
		{
			if ('fromPopup' in e)
			{
				if (e.fromPopup == autocomplete.box)
				{
					if (autocomplete.box.css('display') != 'none') autocomplete_done(e.message);

				} else if (e.fromPopup == combo)
				{
					if (combo.css('display') != 'none')
					{
						var cmd = e.message; //$.trim(); - you should not do this
						var command = $(this).val().replace(/^\s+/, '');

						var command_cmd = command.split(' ').shift().toUpperCase();
						if (command_cmd[0] == '$') command_cmd = '$';

						if (command_cmd in settings.aliases)
						{
							command = settings.aliases[command_cmd] + command.substr(command_cmd.length);
							command_cmd = settings.aliases[command_cmd].toUpperCase();
						}


						if (command.substr(0, cmd.length).toUpperCase() == cmd.toUpperCase())
						{
							if (command_cmd in settings.commands)
							{
								if (command.length > cmd.length)
								{
									if (command_func($(this).val())) $(this).val('');
								} else
								{
									var variants = ('variants' in settings.commands[command_cmd]) ? settings.commands[command_cmd]['variants'] : [settings.commands[command_cmd]];
									var input = $(this);
									var bExec = false;

									$.each(variants, function(i,v)
									{
										bExec = false;
										if (!('params' in v))
										{
											if ('command' in v)
											{
												if (v['command'].toUpperCase() == command.toUpperCase()) bExec = true;

											} else if ('syntax' in v)
											{
												if (v['syntax'].toUpperCase() == command.toUpperCase()) bExec = true;

											} else if (command_cmd == cmd) bExec = true;
										}

										if (bExec)
										{
											if (command_func(input.val())) input.val('');
											return false;
										}
									});

									if (!bExec)
									{
										$(this).val(cmd);
										need_help($(this).val());
									}
								}

							} else
							{
								$(this).val(cmd);
								need_help($(this).val());
							}
						} else
						{
							$(this).val(cmd);
							need_help($(this).val());
						}
					}
				}
			}

		}).on('blur', function(e)
		{
			if (autocomplete.box.css('display') != 'none')
			{
				if (!autocomplete.box.attr('mouse_pressed')) autocomplete_close();
			}

			if (combo.css('display') != 'none')
			{
				if (!combo.attr('mouse_pressed')) combo.slideToggle('fast');
			}
			tooltip_help('');

		}).on('focus', function(e)
		{
			if (!$.trim($(this).val()))
			{
				tooltip_help(',       ');
				need_help('', '');
			} else
			{
				need_help($(this).val());
			}
		});

		combo.on('click', 'span.helplink, span.authlink', function(e)
		{
			if ($(this).hasClass('helplink'))
			{
				input.val($(this).text()).focus();
				need_help($(this).text());

			} else if ($(this).hasClass('authlink'))
			{
				if ('login_url' in settings) document.location = settings.login_url;
			}
		});

		combo.smart_console_dropdown({ parent: input, filler: function(mode, item)
		{
			switch (mode)
			{
				case 'help':
				{
					return $('<div><span class="helplink" title="' + item.c + '">' + item.l + '</span> &mdash; <span>' + item.t + '</span>' + (item.a ? ' [<span class="authlink"> </span>]' : '') + '</div>');
				}

				case 'help_reverse':
				{

					var link = ('oc' in item) ? item.s.replace(item['oc'], '<span class="helplink"' + (('c' in item) ? ' title="' + item.c + '"': '') + '>' + item['oc'] + '</span>') : '<span class="helplink"' + (('c' in item) ? ' title="' + item.c + '"': '') + '>' + item.s + '</span>';
					return $('<div><span>' + item.t + '</span> ' + link + (item.a ? ' [<span class="authlink"> </span>]' : '') + '</div>');
				}

				default:
				{
					return null;
				}
			}

		}});

		if (autocomplete.box === null)
		{
			autocomplete.box = $('<div class="console_acc_menu"></div>').hide();
			autocomplete.box.insertAfter(input);
			autocomplete.box.smart_console_dropdown({ parent: input, filler: function(mode, item) 
			{
				switch (mode)
				{
					case 'book':
					{
						return $('<div class="dbi"><div class="dbdd"><div>' + item.t + '</div><div>' + item.c + '</div></div></div>');
					}
					case 'wiki':
					case 'tag':
					{
						return $('<div class="dbi"><div class="dbst"><div>' + item.t + '</div></div></div>');
					}
					case 'symbol':
					{
						return $('<div class="dbi"><div class="dbsb"><div>' + item.l + '</div><div>' + item.t + '</div></div></div>');
					}
					default:
					{
						return $('<div class="dbi"><div class="dbid"><img src="' + item.i + '" /></div><div class="dbdd"><div>' + item.t + '</div><div>' + item.c + '</div></div></div>');
					}
				}

			}});
		}

		return self;
	};

})(jQuery);
;
(function($) {


	$.fn.smart_console_dropdown = function(options)
	{
		var self = this;

		options = options || {};
		var settings = {
		
			filler: null,
			parent : null
		};

		if (options) $.extend(settings, options);

		this.on('mousedown', '> div', function(e)
		{
			$('> div', self).removeClass('hilited');
			$(this).addClass('hilited');

			self.attr('mouse_pressed', true);

		}).on('mouseup', '> div', function(e)
		{
			if (self.attr('mouse_pressed'))
			{
				self.removeAttr('mouse_pressed');
				settings.parent.trigger({type: 'command', fromPopup: self, message: $(this).attr('unique')});
				settings.parent.focus();
			}

		}).on('reset', function(e)
		{
			e.preventDefault();

			var selected = $('.hilited', self).attr('unique');
			self.empty();
			self.attr('mode', e.message.mode);

			$.each(e.message.items, function(i,v)
			{
				var d = settings.filler(e.message.mode, v);
				d.attr('unique', v.l);
				self.append(d);
			});

			if (typeof(selected) != 'undefined') self.find('[unique="' + selected + '"]').first().addClass('hilited');
			if (!self.find('.hilited').length) self.find('> div').first().addClass('hilited');

		}).on('keypress', function(e)
		{
			switch (e.keyCode)
			{
				case 38: //up
				{
					var i = self.find('.hilited');
					self.find('> div').removeClass('hilited');
					((i.prev().length) ? i.prev() : self.find('> div:last')).addClass('hilited');
					break;
				}

				case 40: // down
				{
					var i = self.find('.hilited');
					self.find('> div').removeClass('hilited');
					((i.next().length) ? i.next() : self.find('> div:first')).addClass('hilited');
					break;
				}

				case 13: // enter
				{
					var selected = self.find('.hilited');
					settings.parent.trigger({type: 'command', fromPopup: self, message: selected.length ? selected.attr('unique') : null});
					settings.parent.focus();
					break;
				}
			}

			// visible item ?
			if (self.find('.hilited').length)
			{
				var i = self.find('.hilited').get(0);
				var s = self.get(0);

				var ifrom = i.offsetTop;
				var from = s.scrollTop;
				var to = s.scrollTop + s.clientHeight;

				if (from - ifrom > 0) s.scrollTop -= from - ifrom;
				if (to - (ifrom + i.clientHeight) < 0) s.scrollTop -= to - (ifrom + i.clientHeight);
			}
		});
	};
	
})(jQuery);	;
	var console_commands = {
		'FIND': {title: '', variants:
				[
					{title: '  ', start_title: ' ', command: 'FIND F ', syntax: 'FIND F ', params: /^F\s(.*)$/i, ac: /^F\s([^@]+)$/i, act:'wiki', url: '/search/results/?q=$1&in=articles', tooltip: ' '},
					{title: ' ', start_title: '', command: 'FIND B ', syntax: 'FIND B ', params: /^B\s(.*)$/i, ac: /^B\s([^@]+)$/i, act: 'book', url: '/books/book_search?q=$1', tooltip: '  ', keywords:' , '},
					{title: ' ', start_title: '', command: 'FIND @', syntax: 'FIND @login', params: /^\@([0-9a-z\_\-]+)$/i, ac: /^\@(.*)$/i, url: '/search/results/?q=$1&in=users', tooltip: '   ', keywords:' , '},
					{title: '  ', start_title: '  ', command: 'FIND ', syntax: 'FIND ', params: /^(.*)$/, url: '/search/results/?q=$1&in=topics', tooltip: ' ', keywords: ' , '}, // ac: /^([^@]+)$/i, act: 'tag',
					{title: '    ', command: 'FIND ', syntax: 'FIND @login', params: /^(.*)$/, ac: /(.+)\@(.*)$/i, url: '/search/results/?q=$1&in=topics'}
				]
			},
		'BLOG': {title: '', variants:
				[
					{title: ' ', url: '/my/$login/blog/', auth_required : true, keywords: ' '},
					{title: '  ', syntax: 'BLOG @RomanAndreev', redirect_url: '/my/RomanAndreev/blog/', keywords: ' '},
					{title: ' ', start_title: ' ', command: 'BLOG @', syntax: 'BLOG @login', params: /^\@([0-9a-z\_\-]+)$/i, ac: /^\@(.*)/i, url: '/my/$1/blog/', tooltip: '   '}
				]
			},
		'TAG' : {title: '  ', start_title: '', command: 'TAG ', syntax: 'TAG ', params: /^(.*)$/, ac: /^(.*)/i, act: 'tag', url: '/tag/$1/', tooltip: ' '},
		'MSG':{title: ' ', auth_required : true, variants:
				[
					{title: ' ', command: 'MSG @', syntax: 'MSG @login', params: /^\@([0-9a-z\_\-]+)$/i, ac: /^\@(.*)$/i, func: 'mailto_func', auth_required : true, keywords: ' , , ', tooltip: '  '}
				]
			},

		'ALL':  {title: '  ', command: 'ALL', syntax: 'ALL  BLOGS', redirect_url: '/allblog/', keywords: '  '},
		'ECO':  {title: '  ', redirect_url: '/calendar/', keywords: ''},
		'WIKI': {title: ' ', variants:
				[
					{title: ' ', redirect_url: '/finansoviy-slovar/', keywords:''},
					{title: '   ', syntax: 'WIKI ADD', redirect_url: '/finansoviy-slovar/add/', auth_required : true, keywords: '   '},
					{title: '  ', command: 'WIKI ', syntax: 'WIKI ', params: /^(.*)$/, ac: /^(.*)/i, act: 'wiki', url: '/finansoviy-slovar/$1'}
				]
			},
		'G':	{title: ' ', variants:
				[
					{title: '  ', start_title: '', redirect_url: '/g/', keywords: ''},
					{title: ' ', command: 'G ', syntax: 'G ticker timeframe', params: /^([0-9a-z]+)(?:\s(\d+|H|D|W|M))?$/i, ac: /^([A-Z]+)/i, act: 'symbol', url: '/g/$1/$2/', tooltip: '  '}
				]
			},

		'Q': {title: '', variants:
				[
					{title: '   ', redirect_url: '/q/shares/', keywords: ' , , '},
					{title: '   ', command: 'Q ', syntax: 'Q ticker-', params: /^(.*)$/, ac: /^(.*)/i, act: 'forum', url: '/forum/company_go/$1/'} // params: /^([0-9a-z]+)$/i,
				]
			},

		'OIL': {title: ': , , ', redirect_url: '/oil/', keywords: ''},
		'B': {title: ' ', redirect_url: '/books/', keywords: ''},
		'TOP' : {title: '  ', redirect_url: '/top/', keywords: ' , '},
		'SGNL': {title: '  ', redirect_url: '/blog/tradesignals/', keywords: ' ,, '},
		'TAGS': {title: '  ', redirect_url: '/tags/', keywords: ' '},
		'CORP': {title:' ', variants:
				[
					{title: ' ', redirect_url: '/company/', keywords: ' , '},
					{title: '  ', syntax:'CORP ADD', redirect_url: '/company/add/', keywords: '  ,  '},
					{title: '  ', command: 'CORP ', syntax:'CORP ', params: /^(.*)$/, ac: /^(.*)$/i, act: 'company', url: '/company/$1/'}
				]
			},

		'$' : {title: ' ', start_title: ' ', command: '$', syntax: '$  ', params: /^(.*)$/, ac: /^(.*)/i, act: 'forum$', url: '/forum/company_go/$1/', tooltip: '  ', keywords: ' ,  '}, // hardcoded
		
		'FAV' : {title:'', variants:
				[
					{title: '  ', url: '/profile/$login/favourites/', auth_required : true, keywords:' , '},
					{title: ' ', command: 'FAV @', syntax: 'FAV @login', params: /^\@([0-9a-z\_\-]+)$/i, ac: /^\@(.*)$/i, url: '/profile/$1/favourites/', tooltip: '    ', keywords:' '}
				]
			},

		'FRND': {title:'', variants:
				[
					{title: '  ', url: '/friends/$login/', auth_required : true, keywords: ' ,'},
					{title: ' ', command: 'FRND @', syntax: 'FRND @login', params: /^\@([0-9a-z\_\-]+)$/i, ac: /^\@(.*)$/i, url: '/friends/$1/'}
				]
			},

		'LINKS':{title:'', variants:
				[
					{title: '  ', url: '/my/$login/tree/links/', auth_required : true, keywords: ' , '},
					{title: ' ', command: 'LINKS @', syntax: 'LINKS @login', params: /^\@([0-9a-z\_\-]+)$/i, ac: /^\@(.*)$/i, url: '/my/$1/tree/links/'}
				]
			},

		'CMT':  {title:'', variants:
				[
					{title: ' ', url: '/my/$login/comment/', auth_required : true, keywords: ' , '},
					{title: ' ', command: 'CMT @', syntax: 'CMT @login', params: /^\@([0-9a-z\_\-]+)$/i, ac: /^\@(.*)$/i, url: '/my/$1/comment/'}
				]
			},


		'TV':  {title: '  ', redirect_url: '/smartlab-tv/', keywords: '  '},
		'POST':{title: '    ', redirect_url: '/topic/add/', auth_required : true, keywords: ' , '},
		'ACC': {title: '  ', redirect_url: '/my-trading-account/', auth_required : true, keywords: ' , '},
		'MAIL':{title: ' ', auth_required : true, variants:
				[
					{title: ' ', command: 'MAIL', syntax: 'MAIL  PM', redirect_url: '/talk/', auth_required : true},
					{title: ' ', command: 'MAIL TO @', syntax: 'MAIL TO @login', params: /^TO\s\@([0-9a-z\_\-]+)$/i, ac: /^TO\s\@(.*)$/i, func: 'mailto_func', auth_required : true}
				]
			},

		'CCI':{title: '  ', redirect_url: '/consumer-confidence-russia/'},
		'CHAT':{title: ' ', redirect_url: '/chat/', hidden : true},
		'CAT': {title: '  ', redirect_url: '/page/catalog/'},
		'ADV': {title: ' ', redirect_url: 'https://smart-lab.ru/blog/mytrading/7053.php'},
		'MAIN':{title: '  ', redirect_url: '/'},
		'FINAM':{title: ' ', redirect_url: 'http://www.finam.ru/'},
		'MAP':{title: '  ,   ', redirect_url: '/q/map/', keywords: '  , '},
		'FLOW':{title: '   ', redirect_url: '/flow/', keywords: '   '},
		'FXPF':{title: '-  Forexpf', redirect_url: 'http://www.forexpf.ru/chart/'},
		'NEWS':{title: '   ', variants:
			[
				{title: ' ', redirect_url: '/news/', keywords: ' ,'},
				{title: '  ', syntax:'NEWS $SBER', redirect_url: '/forum/news/SBER/'},
				{title: '   ', syntax:'NEWS $TICKER', params: /^\$([0-9a-z\_\-]+)$/i, ac: /^\$(.*)$/i, act: 'forum', url: '/forum/$1/attached/'}
			]
		},
		'OFFTOP':{title: '', variants:
			[
				{title: '  ', redirect_url: '/blog/offtop/', keywords: ' '},
				{title: '     ', syntax:'OFFTOP ADD', redirect_url: '/topic/add/?blog_id=4107', keywords:'  , ', auth_required : true}
			]
		},
		'EVENTS':{title: ' ', redirect_url: '/calendar/index/party/'},
		'SWITCH':{title: '   ', auth_required : true, variants:
				[
					{title: ' ', syntax: 'SWITCH BLACK', redirect_url: '/settings/theme/black', auth_required : true},
					{title: ' ', syntax: 'SWITCH WHITE', redirect_url: '/settings/theme/white', auth_required : true, keywords:'  '},
					{title: '  ', syntax: 'SWITCH FULLBLACK', redirect_url: '/settings/theme/fullblack', auth_required : true, keywords: '   '},
					{title: ' ', syntax: 'SWITCH ORIGINAL', redirect_url: '/settings/theme/original', auth_required : true, keywords: '    '}
				]
			},
		'LINK' : {title: '  -', command: 'LINK ', syntax: 'LINK name', params: /^(.*)$/, url: '/console/link/$1/'},
		'EXIT':{title: '', redirect_url: '/login/exit/', auth_required : true},


		'STOCKS': {title: '  ', redirect_url: '/forum/', keywords: ' , '},
		'BONDS': {title: '  ', redirect_url: '/bonds/', keywords: ' '},
		'FX': {title: '  Forex', redirect_url: '/forex/', keywords: ', forex'},
		'BANKS': {title: '  ', redirect_url: '/banki/', keywords: ' '},
		'OPT': {title: '  ', redirect_url: '/options/', keywords: ' '},
		'ALGO': {title: '   ', redirect_url: '/algotrading/', keywords: ' ,  '},
		'BROK': {title: '   ', redirect_url: '/brokers-rating/', keywords: ', , '},

		'ECOS': {title: '   ', redirect_url: '/calendar/stocks/', keywords: ' , '},
		'FA': {title: '  ', redirect_url: '/q/shares_fundamental/', keywords: ' ., ,  '},
		'QBO': {title: ' ', redirect_url: '/q/ofz/', keywords: ' , , ,'},
		'BROKG': {title: '  ', redirect_url: '/brokers-rating/global/', keywords: ' '},
		'BROKR': {title: '  ', redirect_url: '/brokers-rating/russia/', keywords: ' '},
		'BROKF': {title: '  ', redirect_url: '/brokers-rating/forex/', keywords: ' Forex'},
		'ASK': {title: '   ', redirect_url: '/vopros/add/', keywords: ' , ', auth_required : true},
		'ANSWER': {title: '  ', redirect_url: '/vopros/', keywords: ' , ,  '},
		'W': {title: '  (portfolio)', auth_required : true,  variants:[
			{title: '  (portfolio)', command: 'W', redirect_url: '/q/portfolio', keywords: ', ,,  ,portfolio', auth_required : true},
			{title: ' ', command: 'W ADD', syntax: 'W ADD', func: 'new_portfolio_func', keywords: ' , ', auth_required : true},
		]},
		'DIV': {title: '    ', redirect_url: '/dividends/', keywords: ',  , , '},
		'DIVR': {title: '   ', redirect_url: '/forum/%20/', keywords: ' , '},

		'QBE': {title: ' ', redirect_url: '/q/eurobonds/', keywords: ', '},
		'REG': {title: '   ', redirect_url: '/calendar/index/stocks_otsechka', keywords: '  '},
		'PICS': {title: '  ', redirect_url: '/pics/', keywords: ', '},
		'BR': {title: ' ', variants:[

			{title: '  ', syntax: 'BR', redirect_url: '/blog/reviews/', keywords: ' , '},
			{title: '   ', syntax: 'BR ADD', redirect_url: '/review/add/', keywords: '   , ', auth_required : true}
		]},
		
		'TOPB': {title: '100  ', redirect_url: '/books/top/', keywords: ' -100, '},
		'CMTS': {title: '  ', redirect_url: '/comments/', keywords: ' , '},
		'CMTME': {title: '   ', redirect_url: '/my/$login/comment-to-me/', auth_required : true, keywords: '   '},
		'QA': {title: ' ', redirect_url: '/q/adr/', keywords: ' '},
		'QW': {title: '    Forex', redirect_url: '/q/world-quotes/', keywords: ' , '},
		'QBC': {title: '  ', redirect_url: '/q/bonds/', keywords: '  , '},
		'QBS': {title: '   ', redirect_url: '/q/subfed/', keywords: '  , '},
		'QR': {title: '   ', redirect_url: '/q/currencies/', keywords: ' , '},
		'QF': {title: '   ', redirect_url: '/q/futures/', keywords: ' '},
		'FORUMS': {title: '   ', redirect_url: '/forums/', keywords: ' , '},
		'READS': {title: '   ( )', redirect_url: '/tradingreads/', keywords: '    ,,  '},
		'PEOPLE': {title: '  ', redirect_url: '/people/', keywords: ', , '},
		'MOB': {title: '   ', redirect_url: '/mobile/', keywords: ' '},
		'BL': {title: '  ', redirect_url: '/blacklist/', keywords: '  , ,', auth_required : true},
		'FORUMMY': {title: '   ', redirect_url: '/my/$login/comment-forum/', keywords: '   ', auth_required : true},
		'BOOKSDONE': {title: ',     ', redirect_url: '/books/reviewed_by/$login/', keywords: '  ', auth_required : true},
		'REPORTS': {title: '    ', redirect_url: '/q/shares_fundamental3?&type=MSFO', keywords: ''},
		'SETPROFILE': {title: '  ', redirect_url: '/settings/profile/', keywords: ' ', auth_required : true},
		'SETTINGS': {title: '  ', redirect_url: '/settings/notifications/', keywords: ' ', auth_required : true},
		'QBI': {title: '  ', redirect_url: '/q/index_bonds/', keywords: ' '},
		'ECOB': {title: '   ', redirect_url: '/calendar/bonds/', keywords: ' '},

		'POLL': {title: '', variants:[

			{title: ' ', syntax:'POLL ADD', redirect_url: '/question/add/', keywords: ' ', auth_required : true}

		]},

		'REPLY': {title: '   ', redirect_url: '/my/$login/reply-to-me/', keywords: '   ', auth_required : true},
		'FREPLY': {title: '   ', redirect_url: '/my/$login/reply-to-me-forum/', keywords: '   ', auth_required : true},
		'RULES': {title: ' ', redirect_url: '/blog/mytrading/5161.php', keywords: ' '},
		'FORUMERS': {title: '  ', redirect_url: '/people/all/order_by_stocks/desc/', keywords: ' '},
		'READERS': {title: '  ', redirect_url: '/people/all/order_by_books/desc/', keywords: ' '},
		'RAS': {title: '    ', redirect_url: '/q/shares_fundamental3?&type=RSBU', keywords: ''},
		'SOFT': {title: '   ', redirect_url: '/trading-software/', keywords: ' '},

		

		

		

		

	};

	var console_aliases = {'1': 'POST', '2': 'BLOG', '3': 'CMT', '4' : 'LINKS', '5' : 'FAV', '6' : 'ACC', '7' : 'FRND', 'BLOGS':'ALL', 'PM' : 'MAIL', '/' : 'MAIN', 'PPL' : 'PEOPLE'};
	window['mailto_func'] = function(login)
	{
		window.open('/talk/add/?talk_users=' + encodeURIComponent(login), '_blank');
	};


	window['new_portfolio_func'] = function(login)
	{
		if (!('cachedScript' in jQuery))
		{
			jQuery.cachedScript = function( url, options )
			{
				// Allow user to set any option except for dataType, cache, and url
				options = jQuery.extend( options || {},
				{
					dataType: "script",
					cache: true,
					url: url
				});
				// Use $.ajax() since it is more flexible than $.getScript
				// Return the jqXHR object so we can chain callbacks
				return jQuery.ajax( options );
			};
		}

		jQuery.cachedScript('/plugins/trade/templates/skin/default/actions/ActionQ/js/portfolio.js').done(function( script, textStatus )
		{
			var od = $;
			$ = jQuery;
			AddPortfolioEvent('  ', 'add_list').then(function(sMsgTitle, sMsg, iListId, sListTitle)
			{
				msgNoticeBox.alert(sMsgTitle, sMsg);
				if (typeof(CURRENT_USER_LOGIN) != 'undefined')
				{
					setTimeout(function(e)
					{
						document.location.href = '/q/portfolio/' + encodeURIComponent(CURRENT_USER_LOGIN) + '/' + iListId + '/';
					}, 1000);
				}

			}, function(sMsgTitle, sMsg)
			{
				msgErrorBox.alert(sMsgTitle, sMsg);

			}).always(function()
			{
				$ = od;
			});
		});
	};
(function ($)
	{
		$(document).ready(function()
		{
			var symbols = [];
			function success(data)
			{
				//console.log(data.short_name, data.original_name);
				var tr = $('.trade tr[tkr="' + data.original_name.replace(':', '.') + '"]');
				if (tr.length)
				{
					var chg = (Math.round(parseFloat(data.change_percent) * 10) / 10);
					var val = parseFloat(data.last_price);
					
					switch (data.original_name)
					{
						case 'CME_MINI_DL:ES1!':
						case 'BITSTAMP:BTCUSD':
						case 'FX_IDC:USDRUB':
						case 'FX_IDC:XAUUSD':
						{
							val = val.toFixed(1);
							break;
						}

						case 'FX:USDJPY':
						case 'FX_IDC:USDBRO':
						case 'FX_IDC:XAGUSD':
						{
							val = val.toFixed(2);
							break;
						}						

						case 'EUSTX50':
						case 'UK100':
						case 'OANDA:DE30EUR':
						case 'FRA40':
						case 'SHCOMP':
						case 'ESP35':
						case 'OANDA:JP225USD':
						case 'OANDA:EU50EUR':
						case 'AUS200':
						{
							val = val.toFixed(0);
							break;
						}

						case 'OANDA:CN50USD':
						{
							val = Math.round(data.last_price);
							break;
						}

						default:
						{
							val = val.toFixed(4);
							break;
						}
					}
					

					$($('td', tr)[1]).text(val.toString().replace('.', ','));
					$($('td', tr)[2]).text(((chg > 0) ? '+' : '') + chg.toString().replace('.', ',') + '%');
					if (chg < 0)
					{
						$($('td', tr)[2]).addClass('down');

					} else
					{
						$($('td', tr)[2]).removeClass('down');
					}
				}
			}

			if ($('.trades').length)
			{
				$.ajax({url: 'https://s3.tradingview.com/tv.js', dataType: 'script', cache: true}).done(function()
				{
					$('.trade tr[tkr]').each(function(i, el)
					{
						symbols.push({'symbol' : ($(el).attr('tkr')).replace('.', ':'), success: success, error : function(){}});
					});

					if (symbols.length)
					{
						new TradingView.QuotesProvider({container_id: 'hif', symbols:symbols});
					};
				});
			}
		});

	})(jQuery);
(function(b){function a(){b('<div id="abuse_dialog_tpl" style="display: none;"><div id="abuse_dialog"><fieldset class="abuse_title"><legend>  ( 60 ):</legend><textarea id="abuse_text" maxlength="64"></textarea></fieldset></div></div>').appendTo(b("body"));
var c=b("#abuse_dialog");function d(g,h){var f={topic:"",comment:"",profile:""};var e=new jBox("Confirm",{id:"abuseDialog",title:"  "+(h in f?f[h]:" "),confirmButton:"",cancelButton:"",content:c,confirm:function(){var j=this;
var k={targetId:g,targetType:h,security_ls_key:LIVESTREET_SECURITY_KEY};var i=c.find("textarea#abuse_text");if(i.length){k.text=i.val();}b.post("/abuse/abuse_ajax/",k,function(l,m){if(!l){msgErrorBox.alert("Error","Please try again later");
}if(l.bStateError){msgErrorBox.alert(l.sMsgTitle,l.sMsg);}else{msgNoticeBox.alert(l.sMsgTitle,l.sMsg);}});},onOpen:function(){var i=c.find("textarea#abuse_text");
i.val("");},onCloseComplete:function(){this.destroy();}});e.open();}window.abuse=d;}b(document).ready(function(){if(typeof(CURRENT_USER_ID)!=="undefined"){a();
}});})(jQuery);
function Summoner(textbox, url, sid)
{
	var properties = ['direction', 'boxSizing', 'width', 'height', 'overflowX', 'overflowY', 'borderTopWidth', 'borderRightWidth', 'borderBottomWidth', 'borderLeftWidth', 'borderStyle', 'paddingTop', 'paddingRight', 'paddingBottom', 'paddingLeft', 'fontStyle', 'fontVariant', 'fontWeight', 'fontStretch', 'fontSize', 'fontSizeAdjust', 'lineHeight', 'fontFamily', 'textAlign', 'textTransform', 'textIndent', 'textDecoration', 'letterSpacing', 'wordSpacing', 'tabSize', 'MozTabSize'];
	var isFirefox = (window.mozInnerScreenX != null);

	function getCaretCoordinates(element, position, options)
	{
		var debug = options && options.debug || false;
		if (debug)
		{
			var el = document.querySelector('#input-textarea-caret-position-mirror-div');
			if (el) el.parentNode.removeChild(el);
		}

		var div = document.createElement('div');
		div.id = 'input-textarea-caret-position-mirror-div';
		document.body.appendChild(div);

		var style = div.style;
		var computed = window.getComputedStyle ? window.getComputedStyle(element) : element.currentStyle;  // currentStyle for IE < 9
		var isInput = element.nodeName === 'INPUT';

		style.whiteSpace = 'pre-wrap';
		if (!isInput) style.wordWrap = 'break-word';

		style.position = 'absolute';
		if (!debug) style.visibility = 'hidden';

		properties.forEach(function (prop)
		{
			if (isInput && prop === 'lineHeight')
			{
				style.lineHeight = computed.height;
			} else {
				style[prop] = computed[prop];
			}
		});

		if (isFirefox)
		{
			if (element.scrollHeight > parseInt(computed.height)) style.overflowY = 'scroll';
		} else
		{
			//style.overflow = 'hidden';
		}

		div.textContent = element.value.substring(0, position);
		if (isInput) div.textContent = div.textContent.replace(/\s/g, '\u00a0');

		var span = document.createElement('span');
	  	span.textContent = element.value.substring(position) || '.';
		div.appendChild(span);

		var coordinates = {
			top: span.offsetTop + parseInt(computed['borderTopWidth']),
			left: span.offsetLeft + parseInt(computed['borderLeftWidth']),
			height: parseInt(computed['lineHeight'])
		};

		if (isNaN(coordinates.height)) coordinates.height = parseInt(computed['fontSize']) * 1.25;

		if (debug)
		{
			span.style.backgroundColor = '#aaa';
		} else
		{
			document.body.removeChild(div);
		}
		return coordinates;
	}


	// popup
	function summonerDropdown(parentAutocomplete)
	{
		var self = this;
		this.currentItems = null;
		this.mousePressed = false;

		this.navigate = function(e)
		{
			return (function(e)
			{
				switch (e.keyCode)
				{
					case 38: //up
					{
						var prev = this.dropdown.find('.dbi.hilited').prev('.dbi');
						if (!prev.length) prev = this.dropdown.find('.dbi').last();

						this.dropdown.find('.dbi').removeClass('hilited');
						prev.addClass('hilited');
						break;
					}

					case 40: // down
					{
						var next = this.dropdown.find('.dbi.hilited').next('.dbi');
						if (!next.length) next = this.dropdown.find('.dbi').first();

						this.dropdown.find('.dbi').removeClass('hilited');
						next.addClass('hilited');
						break;
					}

					case 13: // enter
					{
						var selected = this.dropdown.find('.dbi.hilited');
						if (selected.length) this.command(selected.attr('login').length ? selected.attr('login') : null);
						break;
					}
				}
			}).call(self, e);
		};

		this.command = function(login)
		{
			$.each(this.currentItems, function(i, v)
			{
				if (v.l == login)
				{
					parentAutocomplete.insertUserLink(login, v.t, v.p);
					return false;
				}
			});

			this.close();
			textbox.focus();
		};

		this.reset = function(res)
		{
			var selectedLogin = this.dropdown.find('.dbi.hilited').length ? this.dropdown.find('.dbi.hilited').attr('login') : '';
			var bSelect = false;
			this.dropdown.empty();

			jQuery.each(res, function(i,v)
			{
				var di = $('<div class="dbi" unselectable="on"><div class="dbid" unselectable="on"><img unselectable="on" /></div><div class="dbdd" unselectable="on"><div unselectable="on"></div><div unselectable="on"></div></div></div>');
				di.attr('login', v.l);
				di.find('img').attr('src', v.i);
				var it = di.find('.dbdd').find('div').text(v.t).next('div').text(v.c);

				if (v.l == selectedLogin)
				{
					di.addClass('hilited');
					bSelect = true;
				}

				self.dropdown.append(di);
			});

			if (!bSelect) this.dropdown.find('.dbi').first().addClass('hilited');
			this.currentItems = res;
		};

		this.onMouseOver = function(e)
		{
			self.dropdown.find('.dbi').removeClass('hilited');
			$(e.currentTarget).addClass('hilited');
		};

		this.onMouseUp = function(e)
		{
			$(document).off('mouseup', self.onMouseUp);

			var selected = ($(e.target).hasClass('dbi')) ? $(e.target) : $(e.target).parents('.dbi');
			if (selected.length)
			{
				self.command(selected.attr('login').length ? selected.attr('login') : null);
			} else
			{
				self.mousePressed = false;
				textbox.trigger('blur');
			}
		};

		this.onMouseDown = function(e)
		{
			self.mousePressed = true;
			$(document).on('mouseup', self.onMouseUp);
		};


		this.close = function()
		{
			if (this.dropdown)
			{
				this.dropdown.off('mouseover', this.onMouseMove);
				this.dropdown.off('mousedown', this.onMouseDown);
				this.dropdown.remove();
				this.dropdown = null;
			}
			parentAutocomplete = null;
		};

		this.dropdown = $('<div class="db_menu" unselectable="on"></div>');
		
		var suggestState = parentAutocomplete.getSuggestState();
		var cursorCoordinates = getCaretCoordinates(textbox.get(0), suggestState.from, { debug: false });
		var offsetCoordinates = textbox.offset();
	
		this.dropdown.css('top', (cursorCoordinates.height + cursorCoordinates.top + offsetCoordinates.top - textbox.get(0).scrollTop) + 'px');
		this.dropdown.css('left', (cursorCoordinates.left + offsetCoordinates.left - textbox.get(0).scrollLeft) + 'px');

		$(document).find('body').append(this.dropdown);

		this.dropdown.on('mouseover', '.dbi', this.onMouseOver);
		this.dropdown.on('mousedown', this.onMouseDown);
	}

	// textarea nick completer
	function summonerAutocomplete(item)
	{
		var stopcharsBefore = [' ', "\r", "\n"];
		var stopcharsAfter = ['.', ',', ';', '-', '?', '!', '/', '\\', '"', '\'', "\r", "\n"];

		var self = this;
		this.suggest = 
		{
			opened : false,
			from : 0,
			word : ''
		};

		this.searchBox = null;
		this.searchAjax = null;
		this.searchEmpty = '';

		this.getCaretPos = function(obj)
		{
			obj.focus();
			if (obj.selectionStart) return obj.selectionStart;
			else if (document.selection)
			{
				var sel = document.selection.createRange();
				var clone = sel.duplicate();
				sel.collapse(true);
				clone.moveToElementText(obj);
				clone.setEndPoint('EndToEnd', sel);
				return clone.text.length;
			}
			return 0;
		};

		this.setCaretPos = function(obj, pos)
		{
			if (obj.setSelectionRange)
			{
				obj.focus();
				obj.setSelectionRange(pos,pos);

			} else if (obj.createTextRange)
			{
				var range = obj.createTextRange();
				range.collapse(true);

				var txcr = 0;
				for (var i = 0, j = pos; i < j; i++)
				{
					if (obj.value.charCodeAt(i) == 10) txcr ++;
				}

				range.moveEnd('character', pos - txcr);
				range.moveStart('character', pos - txcr);
				range.select();
			}
		};

		this.getSuggestState = function()
		{
			var suggest = 
			{
				opened : false,
				from : 0,
				word : ''
			};

			var htmlItem = item.get(0);

			var p = this.getCaretPos(htmlItem);
			if (htmlItem.value.length + 1 > p)
			{
				var isOpened = false;
				for (var i = p, j = i - 100; (i > j) && (i >= 0); i --)
				{	
					if (htmlItem.value.charAt(i) == '@')
					{
						if ((i != 0) && (stopcharsBefore.indexOf(htmlItem.value.charAt(i - 1)) == -1)) break;
						suggest = {'opened' : true, 'from' : i, 'word' : htmlItem.value.substring(i + 1, p)};
						break;
					} else if ((i < p) && ((htmlItem.value.charCodeAt(i) < 32) || (stopcharsAfter.indexOf(htmlItem.value.charAt(i)) != -1)))
					{
						break;
					} else if (htmlItem.value.charCodeAt(i) == 32)
					{
						if ((i != 0) && (htmlItem.value.charCodeAt(i-1) <= 32)) break;
					}
				}
				if (i < 0) suggest.opened = false;
			} else
			{
				suggest.opened = false;
			}
			return suggest;
		};

		this.applySuggestState = function(nsg)
		{
			if (nsg.opened)
			{
				if ((nsg.opened != this.suggest.opened) || (nsg.word != this.suggest.word))
				{
					this.suggest = nsg;
					this.searchStart();
				}
			} else
			{
				if (this.suggest.opened)
				{
					this.suggest = nsg;
					this.searchStop();
				}
			}
		};

		this.searchStart = function()
		{
			if (this.searchAjax != null)
			{
				this.searchAjax.abort();
				this.searchAjax = null;
			}

			var word = this.suggest.word;
			if (word)
			{
				if (this.searchEmpty && (this.searchEmpty.length <= word.length) && (word.indexOf(this.searchEmpty) == 0))
				{
					this.searchUpdate(null, word);
				} else
				{
					this.searchAjax = $.getJSON(url + encodeURIComponent(word) + '?security_ls_key=' + sid).done(function(res)
					{
						self.searchUpdate.call(self, ((('results' in res) && res.results.length) ? res.results : null), word);

					}).always(function()
					{
						this.searchAjax = null;
					});
				}
			}
		};

		this.searchUpdate = function(res, word)
		{
			if (this.suggest.opened)
			{
				if (res != null)
				{
					if (this.searchBox == null) this.searchBox = new summonerDropdown(self);
					this.searchBox.reset(res);
					this.searchEmpty = '';
				} else
				{
					if (!this.searchEmpty) this.searchEmpty = word;
					this.suggest.opened = false;
					this.searchStop();
				}
			} else
			{
				this.searchStop();
			}
		};

		this.searchStop = function()
		{
			if (this.searchAjax != null)
			{
				this.searchAjax.abort();
				this.searchAjax = null;
			}

			if (this.searchBox)
			{
				this.searchBox.close();
				this.searchBox = null;
			}
		};

		this.insertUserLink = function(nick, title, profile)
		{
			this.suggest.opened = false;
			this.searchStop();

			var htmlItem = item.get(0);
			var p = this.getCaretPos(htmlItem);
			var ss = this.getSuggestState();
			if ('from' in ss)
			{
				var a = htmlItem.value.substr(0, ss.from);
				var c = htmlItem.value.substr(p);
				var b = '<a href="' + profile + '" title="' + nick + '" class="summoner">@' + title + '</a>';
				htmlItem.value = a + b + c;
				this.setCaretPos(htmlItem, ss.from + b.length);
			}
		};

		this.onKeydown = function(e)
		{
			switch (e.keyCode)
			{
				case 27:
				{
					var nsg = self.getSuggestState();
					nsg.opened = false;
					self.applySuggestState(nsg);
					e.preventDefault();
					e.returnValue = false;
					break;
				}

				case 13:
				case 38:
				case 40:
				{
					if (self.searchBox != null)
					{
						e.preventDefault();
						e.returnValue = false;
						return self.searchBox.navigate(e);
					}
					break;
				}

				default: 
				{
					setTimeout(function(e)
					{
						var nsg = self.getSuggestState();
						self.applySuggestState(nsg);
					}, 1);
				}
			}
		};

		this.onClick = function(e)
		{
			self.onBlur(e);
			var nsg = self.getSuggestState();
			self.applySuggestState(nsg);
		};

		this.onBlur = function(e)
		{
			if (self.searchBox && !self.searchBox.mousePressed)
			{
				self.suggest.opened = false;
				self.searchStop();
			}
		};

		this.kill = function()
		{
			this.searchStop();

			item.off('keydown', this.onKeydown);
			item.off('click', this.onClick);
			item.off('blur', this.onBlur);
		};

		item.on('keydown', this.onKeydown);
		item.on('click', this.onClick);
		item.on('blur, scroll', this.onBlur);
	}


	return new summonerAutocomplete(textbox);
};
function commentsForm(commentBox, commentsRoot)
{
	var self = this;
	this.commentId = null;
	this.files = [];
	this.targetId = null;
	this.targetType = null;
	this.commentBlur = null;
	this.summoner = null;
	this.bImagesInit = false;

	function insertTextAtCursor(el, text, offset) {
		var val = el.value, endIndex, range, doc = el.ownerDocument;
		if ((typeof el.selectionStart == 'number') && (typeof el.selectionEnd == 'number'))
		{
			endIndex = el.selectionEnd;
			el.value = val.slice(0, endIndex) + text + val.slice(endIndex);
			el.selectionStart = el.selectionEnd = endIndex + text.length+(offset?offset:0);
		} else if (doc.selection != undefined && doc.selection.createRange)
		{
			el.focus();
			range = doc.selection.createRange();
			range.collapse(false);
			range.text = text;
			range.select();
		}
	}

	this.reset = function()
	{
		if (this.commentId) commentsRoot.find('[data-type="comment"][data-id="' + this.commentId + '"]').show();

		this.files = [];
		this.targetId = null;
		this.targetType = null;		
		this.commentId = null;

		commentBox.find('.submit').val('').data('type', 'reply');
		commentBox.find('.cancel').remove();

		if (this.summoner)
		{
			if (typeof(Summoner) != 'undefined') this.summoner.kill();
			this.summoner = null;
		}
	};

	this.enableCommentForm = function(bEnabled)
	{
		if (bEnabled)
		{
			commentBox.find('.write_comment').removeClass('disabled');
			commentBox.find('.write_comment_box').removeAttr('readonly').css('overflow', 'auto');
			commentBox.find('.file').removeAttr('disabled');
			commentBox.find('input:button').removeAttr('disabled');

		} else
		{
			commentBox.find('.write_comment').addClass('disabled');
			commentBox.find('.write_comment_box').attr('readonly', true).css('overflow','hidden');
			commentBox.find('.file').attr('disabled', true);
			commentBox.find('input:button').attr('disabled', true);
		}
	};

	this.placeCommentForm = function(options)
	{
		if (options == undefined) options = {};
		var params = jQuery.extend({node: null, scroll: true, quote: false, edit: false}, options);

		this.reset();

		if (params.node)
		{
			var nTarget = params.node.attr('data-target-id') ? params.node : params.node.parents('[data-target-id]').first();
			if (!nTarget.length) return false;

			this.targetId = nTarget.data('target-id');
			this.targetType = nTarget.data('target-type');

			commentBox.insertAfter(params.node).show();
			this.commentId = params.node.data('id');

		} else
		{
			if (commentBox.attr('chatmode'))
			{
				var nTarget = commentBox.parents('[data-target-type]').first();
				if (nTarget.length) this.targetType = nTarget.data('target-type');
				
				commentBox.hide();
				return false;
			}

			if (params.edit) return false;

			var nTarget = commentBox.parents('[data-target-id]').first();
			if (!nTarget.length) return false;

			this.targetId = nTarget.data('target-id');
			this.targetType = nTarget.data('target-type');

			if (commentsRoot.attr('mode') == 'reverse')
			{
				commentsRoot.prepend(commentBox).show();

			} else
			{
				commentsRoot.append(commentBox).show();
			}
			this.commentId = null;
		}

		var textArea = commentBox.find('.write_comment_box');
		textArea.css({height: '', minHeight:'46px'}).removeAttr('rows');

		var nodeText = '';
		if (params.node)
		{
			var h = params.node.find('.text').clone(true);
			h.find('a.imgpreview').removeAttr('data-jbox-image');
			nodeText = h.html().replace(/<br\s*?\/?>\r?\n?/g, "\n");
		}

		if (params.edit)
		{
			textArea.val(nodeText);
			commentBox.find('.submit').data('type', 'save').val('').after('<input type="button" class="cancel" value="" data-type="cancel" />');
			params.node.hide();

		} else
		{
			textArea.val((params.node && params.quote) ? '<blockquote class="reply">' + nodeText + '</blockquote>' + "\r\n" : '');
			if (params.node) textArea.val(textArea.val() + params.node.find('.a_name').text() + ', ');
		}

		if (typeof(Summoner) != 'undefined') this.summoner = new Summoner(textArea, '/summoner/nick_autocomplete/', LIVESTREET_SECURITY_KEY);

		commentBox.find('.write_comment_images').empty().removeClass('active');
		this.enableCommentForm(true);

		if (params.scroll)
		{
			textArea.css('minHeight', '10em');
			textArea.focus();
			textArea.trigger('input');

			textArea.scrollTop(textArea.get(0).scrollHeight - textArea.get(0).clientHeight);

			var commentBoxBottom = commentBox.offset().top + commentBox.height();
			var documetntScrolledBottom = $('body').scrollTop() + $('html').get(0).clientHeight;
			if (commentBoxBottom > documetntScrolledBottom) $('body').animate({ scrollTop: $('body').scrollTop() + commentBoxBottom - documetntScrolledBottom}, 500);
			//if (commentBoxBottom > documetntScrolledBottom) $('body').scrollTop($('body').scrollTop() + commentBoxBottom - documetntScrolledBottom);
		}
		return true;
	};

	this.sendImagesInit = function()
	{
		var isIOS = navigator.platform.match(/(iPhone|iPod|iPad)/i)?true:false;
		var isIE10 = document.all;
		
		var aScripts = []; //['exif.js'];
		if (isIE10) aScripts.unshift('/engine/lib/external/lie/lie.polyfill.min.js');
		aScripts.push(isIOS ? '/engine/lib/external/megapix/megapix-image.js' : '/engine/lib/external/pica/pica.min.js');

		var promise = $.when();
		if (!this.bImagesInit)
		{
			$.each(aScripts, function(i,v)
			{
				promise = promise.then(function()
				{
					return $.cachedScript(v);
				});
			});
			promise.then(function()
			{
				self.bImagesInit = true;
				jQuery.resize2Blob = function(file, maxWidth)
				{
					if (typeof(maxWidth) === 'undefined') maxWidth = 1024;
					var d = $.Deferred();
					var callback = function(blob)
					{
						d.resolve(blob);
					};

					var img = new Image();
					img.onload = function()
					{
						var w = img.width;
						var h = img.height;
						if (w > h)
						{
							if (w > maxWidth)
							{
								h *= maxWidth / w;
								w = maxWidth;
							}

						} else
						{
							if (h > maxWidth)
							{
								w *= maxWidth / h;
								h = maxWidth;
							}
						}

						w = Math.round(w);
						h = Math.round(h);

						var canvas = document.createElement('canvas');
						canvas.width = w;
						canvas.height = h;

						function cleanUp()
						{
							URL.revokeObjectURL(img.src);
							img.src = 'about:blank';
							img = null;
							canvas.width = 1;
							canvas.height = 1;
							canvas = null;
						}

						function onRender()
						{
							URL.revokeObjectURL(img.src);
							img.src = 'about:blank';
							img = null;
							canvas.toBlob(callback, file.type, 0.67);
							canvas.width = 1;
							canvas.height = 1;
							canvas = null;
						}

						if (isIOS)
						{
							try
							{
								var mpx = new MegaPixImage(img);
								mpx.render(canvas, { width: w, height: h, quality: 0.67 }, onRender);
							} catch (e)
							{
								cleanUp();
								d.reject(e);
							}

						} else
						{
							var resizer = window.pica({ features: ['js', 'wasm', 'ww'] }); // 'cib', 
							resizer.resize(img, canvas,
							{
								quality: 3,
								alpha: true,
								unsharpAmount: 80,
								unsharpRadius: 0.6,
								unsharpThreshold: 2,
								transferable: true

							}).then(onRender)
							.catch(function(err)
							{
								cleanUp();
								d.reject(err);
  							});
						}
					};
					img.src = URL.createObjectURL(file);
					return d.promise();
				};
			});
		}

		return promise;
	};


	this.sendImages = function()
	{
		if (this.files.length)
		{
			var promise = this.sendImagesInit();
			$.each(this.files, function(i, file)
			{
				promise = promise.then(function()
				{
					return $.resize2Blob(file).then(function(blob)
					{
						var formData = new FormData();
						formData.append('type_add', 'preview');
						formData.append('img_file', blob);
						formData.append('preview_size', self.files.length > 1 ? (self.files.length > 2 ? 'small' : 'medium') : 'large');
						formData.append('security_ls_key', LIVESTREET_SECURITY_KEY);

						return $.ajax({
							url: '/include/ajax/uploadImg.php?JsHttpRequest=' + (new Date()).getTime() + '-form', //    JsHttpRequest
							type: 'POST',
							contentType: false,
							processData: false,
							data: formData
						}).then(function(result)
						{
							try
							{
								result = result.match(/top\.JsHttpRequestGlobal\.dataReady\((.+)\)/); //    JsHttpRequest
								if (result != null) result = JSON.parse(result[1]);

							} catch (e) { result = null; }

							if (result == null)
							{
								msgErrorBox.alert('', '    .');
								return;
							}

							if (result.js.bStateError)
							{
								msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
							} else
							{
								var textArea = commentBox.find('.write_comment_box');
								if (textArea.length) textArea.val(textArea.val() + result.js.sText);
							}
						});
					});
				});
			});
		} else
		{
			var promise = $.when();
		}
		return promise;
	};

	this.loadComments = function(lastCommentId, append)
	{
		if (lastCommentId == undefined) lastCommentId = null;
		if (append == undefined) append = true;

		if (!lastCommentId)
		{
			commentsRoot.find('[data-type="comment"]').each(function(i, el)
			{
				var commentId = $(el).data('id');
				lastCommentId = (lastCommentId === null) ? commentId : Math.max(lastCommentId, commentId);
			});
		}

		var promise = $.when();
		promise = promise.then(function()
		{
			var sUrl = commentsRoot.attr('update') ? commentsRoot.attr('update') : '/forum/lastcomment/';
			return $.ajax({

				url: sUrl + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
				type: 'POST',
				data: {security_ls_key: LIVESTREET_SECURITY_KEY, targetId: self.targetId, targetType: self.targetType, lastCommentId: lastCommentId, chatMode: commentBox.attr('chatmode') ? 1 : 0}

			});
		}).then(function(result)
		{
			try
			{
				result = JSON.parse(result);
				if (!result.js.bStateError)
				{
					$aNewComments = $(result.js.sComments);
					if (append)
					{
						commentsRoot.append($aNewComments);
					} else
					{
						commentsRoot.prepend($aNewComments); // result.js.sComments
					}
					self.commentGalleryAttach.call(self);
				}
			} catch (e) {}
		});

		return promise;
	};

	this.commentGalleryAttach  = function()
	{
		$('[data-type="comment"]', commentsRoot).each(function(i, el)
		{
			var cId = $(el).data('id');
			$(el).find('a.imgpreview').attr('data-jbox-image', 'gallery_comment_' + cId);
		});
		window.jbi = new jBox('Image');
		$(window).trigger('resize');
	};

	this.onCommentBlur = function()
	{
		var textArea = commentBox.find('.write_comment_box');
		if(textArea.val() == '')
		{
			commentBox.find('.cmt_actions').fadeOut();
			textArea.css('minHeight', '46px');
		}
		this.commentBlur = null;
	};
	
	this.openSmileDialog = function()
	{
		var aSmiles = ['air_kiss', 'bomb', 'dance', 'give_heart', 'i_am_so_happy', 'mad', 'pardon', 'shout', 'wink', 'bad', 'bye2', 'diablo', 'give_rose', 'ireful', 'man_in_love', 'rofl', 'smile', 'yahoo', 'biggrin', 'cool', 'drinks', 'good', 'kiss3', 'mocking', 'sad', 'sorry', 'yes', 'blum1', 'cray', 'gamer', 'hang1', 'kiss', 'music', 'scratch_one-s_head', 'unknown', 'blush', 'crazy', 'girl_angel', 'hi', 'lol', 'nea', 'shok', 'wacko1'];
		var sWindowContent = '<div class="smilesBox">';
		for (var i = 0, j = aSmiles.length; i < j; i++)
		{
			sWindowContent+='<div code="' + aSmiles[i] + '"><img smile="' + aSmiles[i] + '" /></div>';
		}
		sWindowContent+= '</div>';

		var textArea = commentBox.find('.write_comment_box');
		var smilesDialogParam = {

			title: ' ',
			content: sWindowContent,
			onOpen: function()
			{
				var self = this;
				if ('smileCode' in self) delete self.smileCode;
				this.wrapper.on('click', 'div[code]', function(e)
				{
					self.smileCode = $(e.currentTarget).attr('code');
					self.close();
				});
			},

			onClose: function()
			{
				if ('smileCode' in this)
				{
					var codeText = '<img smile="' + this.smileCode + '" />';
					insertTextAtCursor(textArea.get(0), codeText);
				}					

				this.wrapper.off('click');
				textArea.focus();
			}
		};

		var box = new jBox('Modal', smilesDialogParam);
		box.open();
	};

	commentsRoot.on('click', 'a.reply, .edit, .abuse, .delete, .favorite, .th.up, .th.dn', function(e)
	{
		e.preventDefault();

		var el = $(e.currentTarget);
		if (el.attr('href')) return;
		if (!el.parents('.cm_ftr').length) return;

		var commentNode = el.parents('.cm_wrap').first();
		if (el.hasClass('edit') || el.hasClass('reply'))
		{
			self.placeCommentForm.call(self, {node: commentNode, quote: el.hasClass('reply'), edit: el.hasClass('edit')});

		} else if (el.hasClass('abuse'))
		{
			if ('abuse' in window) abuse(parseInt(commentNode.data('id')), 'comment');

		} else if (el.hasClass('delete'))
		{
			$.ajax({

				url: '/include/ajax/commentToggle.php' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
				type: 'POST',
				data: {idComment: commentNode.data('id'), security_ls_key: LIVESTREET_SECURITY_KEY}
			}).then(function(result)
			{
				try
				{
					result = JSON.parse(result);
					if (!result.js.bStateError)
					{
						if ('bComments' in result.js)
						{
							$.each(result.js.bComments, function(i,commentId)
							{
								commentsRoot.find('[data-type="comment"][data-id="' + commentId + '"]').fadeOut('fast', function()
								{
									$(this).remove();
								});
							})
						}
						msgNoticeBox.alert(result.js.sMsgTitle, result.js.sMsg);						

					} else
					{
						msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
					}

				} catch (e) {}
			});
		} else if (el.hasClass('favorite'))
		{
			$.ajax({

				url: '/include/ajax/commentFavourite.php' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
				type: 'POST',
				data: {type: el.hasClass('active') ? 0 : 1, idComment: commentNode.data('id'), security_ls_key: LIVESTREET_SECURITY_KEY}
			}).then(function(result)
			{
				try
				{
					result = JSON.parse(result);
					if (!result.js.bStateError)
					{
						el.toggleClass('active');
						msgNoticeBox.alert(result.js.sMsgTitle, result.js.sMsg);						
					} else
					{
						msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
					}

				} catch (e) {}
			});
		} else if (el.hasClass('th') && (el.hasClass('up') || el.hasClass('dn')))
		{
			var nTarget = commentNode.attr('data-target-id') ? commentNode : commentNode.parents('[data-target-id]').first();
			if (!nTarget.length) return false;

			// this.targetId = nTarget.data('target-id');
			// this.targetType = nTarget.data('target-type');


			var url = '/include/ajax/voteComment.php';
			if (nTarget.data('target-type') == 'broker') url = '/brokers-rating/ajaxvotecomment/';


			$.ajax({

				url: url + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
				type: 'POST',
				data: {value: el.hasClass('up') ? 1 : -1, idComment: commentNode.data('id'), security_ls_key: LIVESTREET_SECURITY_KEY}
			}).then(function(result)
			{
				try
				{
					result = JSON.parse(result);
					if (!result.js.bStateError)
					{
						if (el.hasClass('up'))
						{
							el.removeClass('up').addClass('up-p');
							el.siblings('.th').removeClass('dn-p').addClass('dn');
						}
						
						if (el.hasClass('dn'))
						{
							el.removeClass('dn').addClass('dn-p');
							el.siblings('.th').removeClass('up-p').addClass('up');
						}

						var r = commentNode.find('.cm_mrk');
						r.text((result.js.iRating > 0 ? '+' : '') +result.js.iRating);
						r.removeClass('grn').removeClass('red');
						
						if (result.js.iRating > 0)
						{
							r.addClass('grn');
						} else if (result.js.iRating < 0)
						{
							r.addClass('red');
						}

						msgNoticeBox.alert(result.js.sMsgTitle, result.js.sMsg);						
					} else
					{
						msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
					}

				} catch (e) {}
			});


		}
	});

	commentBox.on('click', '.submit', function(e)
	{
		e.preventDefault();
		var btn = $(e.currentTarget);

		var textArea = commentBox.find('.write_comment_box');
		if (self.files.length || textArea.val())
		{
			var targetId = self.targetId;
			var targetType = self.targetType;
			var commentId = self.commentId;

			self.enableCommentForm.call(self, false);

			if (self.files.length && textArea.val()) textArea.val(textArea.val() + '<br />');

			var promise = self.sendImages.call(self);
			promise.then(function()
			{
				if (btn.data('type') == 'reply')
				{
					promise = promise.then(function()
					{
						var sUrl = '';
						switch (targetType)
						{
							default:
							case 'article':
							{
								sUrl = '/finansoviy-slovar/ajaxaddcomment/';
								break;
							}

							case 'forum':
							{
								sUrl = '/forum/ajaxaddcomment/';
								break;
							}
						}

						return 	$.ajax({
							url: sUrl + '?JsHttpRequest=' + (new Date()).getTime() + '-form', //    JsHttpRequest
							type: 'POST',
							data: {comment_text: textArea.val().replace(/\r\n|\r|\n/g, "<br />"), reply: commentId, cmt_target_id: targetId, security_ls_key: LIVESTREET_SECURITY_KEY}
						});
						
					}).then(function(result)
					{
						try
						{
							result = result.match(/top\.JsHttpRequestGlobal\.dataReady\((.+)\)/); //    JsHttpRequest
							if (result != null) result = JSON.parse(result[1]);

						} catch (e) { result = null; }

						if (result == null)
						{
							msgErrorBox.alert('', '   ');
							self.enableCommentForm.call(self, true);
							return;
						}

						if (result.js.bStateError)
						{
							msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
							self.enableCommentForm.call(self, true);
							return;
						} else
						{
							if ($('#comments-autouptate').length || commentsRoot.attr('last-page'))
							{
								var aLCArgs = [];
								if (commentsRoot.attr('mode') == 'reverse')
								{
									aLCArgs.push(null);
									aLCArgs.push(false);
								}

								return self.loadComments.apply(self, aLCArgs).then(function()
								{
									self.placeCommentForm.call(self, {scroll: false});
								});
							} else
							{
								// #comments-autouptate      /  (    )
								// ,   ,       .
								msgNoticeBox.alert('', '   .');
								self.placeCommentForm.call(self, {scroll: false});
							}
						}
					});

				} else if (btn.data('type') == 'save')
				{
					promise = promise.then(function()
					{
						return 	$.ajax({
							url: '/topic/ajax_edit_comment/?JsHttpRequest=' + (new Date()).getTime() + '-form', //    JsHttpRequest
							type: 'POST',
							data: {comment_text: textArea.val().replace(/\r\n|\r|\n/g, "<br />"), commentId: self.commentId, security_ls_key: LIVESTREET_SECURITY_KEY}
						});
						
					}).then(function(result)
					{
						try
						{
							result = result.match(/top\.JsHttpRequestGlobal\.dataReady\((.+)\)/); //    JsHttpRequest
							if (result != null) result = JSON.parse(result[1]);

						} catch (e) { result = null; }

						if (result == null)
						{
							msgErrorBox.alert('', '   ');
							self.enableCommentForm.call(self, true);
							return;
						}

						if (result.js.bStateError)
						{
							msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
							self.enableCommentForm.call(self, true);
							return;
						} else
						{
							if (self.commentId)
							{
								var commentNode = commentsRoot.find('[data-type="comment"][data-id="' + self.commentId + '"]');
								if (commentNode.length)
								{
									commentNode.find('.cmt_body .text').html(result.js.sComment).find('a.imgpreview').attr('data-jbox-image', 'gallery_comment_' + self.commentId);
									commentNode.show();

									self.commentGalleryAttach.call(self);
								}
							}
							self.placeCommentForm.call(self, {scroll: false});
						}
					});
				}
			});
		}

	}).on('click', '.cancel', function(e)
	{
		e.preventDefault();
		commentBox.fadeOut('fast', function()
		{
			self.placeCommentForm.call(self, {scroll: false});
			commentBox.fadeIn('fast');
		});

	}).on('focus', '.write_comment_box', function(e)
	{
		commentBox.find('.cmt_actions').fadeIn();
		if ($(e.target).css('minHeight') == '46px')	$(e.target).css('minHeight', '10em');

	}).on('blur', '.write_comment_box', function(e)
	{
		self.commentBlur = setTimeout(function()
		{
			self.onCommentBlur.call(self);

		}, 300);

		// if($(this).val() == '')
		// {
		// 	commentBox.find('.cmt_actions').fadeOut();
		// 	$(e.target).css('minHeight', '46px');
		// }

	}).on('change', '#write_comment_image', function()
	{
		if (('files' in this) && (this.files.length))
		{
			$.each(this.files, function(i, file)
			{
				if(!file.type.match(/(.png)|(.jpeg)|(.jpg)|(.gif)|(.webp)$/i))
				{
					// not an image
					msgErrorBox.alert(file.name, '  ,  : <b>gif</b>, <b>jpg</b>, <b>png</b>, <b>webp</b>');
					return;
				}

				// if ((file.size / 1024).toFixed(0) > 1024)
				// {
				// 	// too large
				// 	msgErrorBox.alert(file.name, '  ,   <b> 1</b>');
				// 	return;
				// }

				try
				{
					var r = new FileReader();
					if (r)
					{
						r.onload = function(e)
						{
							var pasteImage = '<div class="image"><div class="remove"></div><img src=' + e.target.result + ' /></div>';
							$('.write_comment_images').append(pasteImage);
							self.files.push(file);

							$('.write_comment_images').addClass('active')
						};
						r.readAsDataURL(file);
					}

				} catch (e) {}
			});

			$(this).after('<input class="file" type="file" id="write_comment_image" multiple="true" />').remove();
		}
	}).on('click', '.write_comment_images .remove', function(e)
	{
		var image = $(e.currentTarget).parents('.image');
		var fileIndex = image.siblings().addBack().index(image);

		if (fileIndex < self.files.length)
		{
			self.files.splice(fileIndex, 1);
			image.remove();
		}

	}).on('click', '.cmt_select-image', function(e)
	{
		commentBox.find('.cmt_actions').fadeIn();
	}).on('click', '.cmt_select-smile', function(e)
	{
		if (commentBox.find('.write_comment').hasClass('disabled')) return false;

		commentBox.find('.cmt_actions').fadeIn();
		if (self.commentBlur)
		{
			clearTimeout(self.commentBlur);
			self.commentBlur = null;
		}
		self.openSmileDialog.call(self);
	}).on('click', '.cmt_select-quote', function(e)
	{
		if (commentBox.find('.write_comment').hasClass('disabled')) return false;
		
		commentBox.find('.cmt_actions').fadeIn();
		if (self.commentBlur)
		{
			clearTimeout(self.commentBlur);
			self.commentBlur = null;
		}

		var textArea = commentBox.find('.write_comment_box');
		insertTextAtCursor(textArea.get(0), '<blockquote></blockquote>', -13);
		textArea.focus();
	});

	commentBox.find('.write_comment_box').on('keydown', function(e)
	{
		if (e.ctrlKey && e.keyCode == 13)
		{
			e.stopPropagation();
			commentBox.find('.submit').trigger('click');
		}
	});

	// textarea autoExpand
	$(document).one('focus.autoExpand', 'textarea.autoExpand', function()
	{
		var savedValue = this.value;
		this.value = '';
		this.baseScrollHeight = this.scrollHeight;
		this.value = savedValue;
	
	}).on('input.autoExpand', 'textarea.autoExpand', function()
	{
		var minRows = this.getAttribute('data-min-rows') | 0,
				rows;

		try
		{
			this.rows = minRows;
			rows = Math.ceil((this.scrollHeight - this.baseScrollHeight) / 17.5);
			this.rows = minRows + rows;

		} catch (e) {} // IE
	});


	var bDoublePagination = $('.pagination1').parents('[double-pagination]').length;
	$('#comments-reverse').on('click', function(e)
	{
		var button = $(this);
		button.toggleClass('reversed');
		var bReverse = button.hasClass('reversed');

		$.ajax({

			url: '/settings/some_settings_ajax/' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
			type: 'POST',
			data: {bReverseComments: bReverse ? 1 : 0, security_ls_key: LIVESTREET_SECURITY_KEY}
		}).then(function(result)
		{
			try
			{
				result = JSON.parse(result);
				if (result.js.bStateError)
				{
					msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
					return;
				} else
				{
					bReverse = parseInt(result.js.bReverseComments);
					if (bReverse)
					{
						button.addClass('reversed');
						commentsRoot.attr('mode', 'reverse');
						if (!bDoublePagination && ($('.pagination1').length > 1)) $('.pagination1').first().remove();

					} else
					{
						button.removeClass('reversed');
						commentsRoot.removeAttr('mode');
						if ($('.pagination1').length < 2) $('.pagination1').first().clone(false).insertBefore('.forum_cmts');
					}
					
					commentsRoot.append($(commentsRoot.find('> li').get().reverse()));
					if (self.commentId) commentsRoot.find('[data-type="comment"][data-id="' + self.commentId + '"]').after(commentBox);
				}
			} catch (e) {}
		});
	});

	$('#comments-autouptate').on('click', function(e)
	{
		var button = $(this);
		button.toggleClass('enabled');
		var bAutoupdate = button.hasClass('enabled');

		$.ajax({

			url: '/settings/some_settings_ajax/' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
			type: 'POST',
			data: {bRefreshComments: bAutoupdate ? 1 : 0, security_ls_key: LIVESTREET_SECURITY_KEY}
		}).then(function(result)
		{
			try
			{
				result = JSON.parse(result);
				if (result.js.bStateError)
				{
					msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
					return;
				} else
				{
					bAutoupdate = parseInt(result.js.bRefreshComments);
					if (bAutoupdate)
					{
						button.addClass('enabled');
						

					} else
					{
						button.removeClass('enabled');
					}

					button.trigger('update');
				}
			} catch (e) {}
		});

	}).on('update', function()
	{
		var button = $(this);

		if (button.data('timer'))
		{
			clearTimeout(button.data('timer'));
			button.removeData('timer');
		}					

		if (button.hasClass('enabled'))
		{
			button.data('timer', setTimeout(function()
			{
				var aLCArgs = [];
				if (commentsRoot.attr('mode') == 'reverse')
				{
					aLCArgs.push(null);
					aLCArgs.push(false);
				}

				return self.loadComments.apply(self, aLCArgs).then(function()
				{
					if (self.commentId == null)
					{
						if (commentsRoot.attr('mode') == 'reverse')
						{
							commentsRoot.prepend(commentBox);
						} else
						{
							commentsRoot.append(commentBox);
						}
					}
					button.trigger('update');
				});

			}, 60000));
		}
	}).trigger('update');
}


$(document).ready(function()
{
	if ($('.content_wrapper').length) $('.content_wrapper').get(0).scrollTop = 0; //  
	if (document.location.hash)
	{
		//  ,   - .
		setTimeout(function()
		{
			var m = document.location.hash.match(/^#comment(\d+)$/)
			if (m != null)
			{
				var c = $('[data-type="comment"][data-id="' + m[1]+'"]');
				if (c.length)
				{
					var o = c.offset();
					if (o.top > $('html').get(0).clientHeight) $('html').get(0).scrollTop = o.top;
				}
			}
		}, 0);
	}	

	$('body').on('click', '.cmt_body .text > blockquote.reply', function()
	{
		$(this).toggleClass('opened');
	});

	if ($('#commentBox').length)
	{
		if ($('.upbar_login').length)
		{
			$('#commentBox').on('input click', function(e)
			{
				document.location.href = '/login/';
			});

		} else
		{
			if (typeof(Summoner) !== 'undefined')
			{
				var c = new commentsForm($('#commentBox'), $('.forum_cmts'));
				c.placeCommentForm({scroll: false});
			} else
			{
				$.cachedScript(DIR_STATIC_SKIN + '/js/summoner.js').done(function()
				{
					var c = new commentsForm($('#commentBox'), $('.forum_cmts'));
					c.placeCommentForm({scroll: false});
				});
			}
		}
	}
});
$(document).ready(function()
{

	function Vote(sTargetId, sTargetType, sValue)
	{
		var d = $.Deferred();

		var sUrl = null;
		var sTargetName = null;
		switch (sTargetType)
		{
			case 'article':
			{
				sUrl = '/finansoviy-slovar/vote/';
				sTargetName = 'idArticle';
				break;
			}

			case 'broker':
			{
				sUrl = '/brokers-rating/vote/';
				sTargetName = 'idBroker';
				break;
			}

			case 'bank':
			{
				sUrl = '/banki/vote/';
				sTargetName = 'idBank';
				break;
			}
		}

		if (!sUrl)
		{
			d.reject({sMsgTitle:'Error', sMsg:'Unknown target type'});
			return d;
		}

		var data = {value: sValue, security_ls_key: LIVESTREET_SECURITY_KEY};
		data[sTargetName] = sTargetId;
		$.ajax({

			url: sUrl + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
			type: 'POST',
			data: data
		}).then(function(result)
		{
			try
			{
				result = JSON.parse(result);
			} catch (e)
			{
				d.reject({sMsgTitle:'Error', sMsg:'Server Error'});
				return;
			}

			if (!result.js.bStateError)
			{
				d.resolve(result.js);
			} else
			{
				d.reject(result.js);
			}
		});
		return d;
	}


	if ($('.vote_up,.vote_down').length)
	{
		$('body').on('click', '.vote_up,.vote_down', function(e)
		{
			e.stopPropagation();
			
			var link = $(e.currentTarget);
			var parent = link.parents('[data-target-id]');
			if (!parent.length) return false;
			
			var sTargetId = parent.data('target-id');
			var sTargetType = parent.data('target-type');
			var iValue = null;

			switch (sTargetType)
			{
				case 'broker':
				case 'article':
				{
					iValue = link.hasClass('vote_up') ? 1 : -1;
					break;
				}
			}

			Vote(sTargetId, sTargetType, iValue).then(function(data)
			{
				msgNoticeBox.alert(data.sMsgTitle, data.sMsg);

				var iRating=Math.round(parseFloat(data.iRating));
				var iCountVote = data.iCountVote;

				var r = parent.find('.vote_counter');
				if (r.length)
				{
					r.text((iRating > 0 ? '+' : '') + iRating);
					r.removeClass('up').removeClass('down');
					
					if (iRating > 0)
					{
						r.addClass('up');
					} else if (iRating < 0)
					{
						r.addClass('down');
					}
				}

			}, function(data)
			{
				msgErrorBox.alert(data.sMsgTitle, data.sMsg);
			});
		});
	}

	if ($('.rating-block').length)
	{
		if (!$('.rating-block').hasClass('enabled'))
		{
			$('.rating-block input:radio').prop('disabled', true);
			return;
		}

		$('body').on('click', '.rating-block input:radio', function(e)
		{
			if (!$(this).parents('.rating-block').hasClass('enabled')) return;

			var link = $(this);
			var parent = link.parents('[data-target-id]');
			if (!parent.length) return false;
			
			var sTargetId = parent.data('target-id');
			var sTargetType = parent.data('target-type');
			var iValue = null;

			switch (sTargetType)
			{
				case 'bank':
				{
					iValue = link.val();
					break;					
				}
			}

			Vote(sTargetId, sTargetType, iValue).then(function(data)
			{
				msgNoticeBox.alert(data.sMsgTitle, data.sMsg);

				var iRating=Math.round(parseFloat(data.iRating));
				var iCountVote = data.iCountVote;

				var r = parent.find('.folk_rating__value');
				if (r.length) r.text((iRating > 0 ? '+' : '') + iRating);

				parent.find('.rating-block').removeClass('enabled');
				parent.find('.rating-block input:radio').prop('disabled', true);

			}, function(data)
			{
				msgErrorBox.alert(data.sMsgTitle, data.sMsg);
			});

		});
	}
});

$(document).ready(function()
{
	//  TradingView
	function LoadTradingView()
	{
		if ($('#trading_view_container').length && $('#trading_view_container').attr('ticker'))
		{
			var bNeeded = true;
			if ($('.graph_button').length && $('.graph_button').hasClass('hidden')) bNeeded = false;
			if (typeof(TradingView) !== 'undefined') bNeeded = false;

			if (bNeeded)
			{
				$.cachedScript('https://d33t3vvu2t2yu5.cloudfront.net/tv.js').done(function()
				{
					if ($('#trading_view_container').length && $('#trading_view_container').attr('ticker'))
					{
						if ($('#trading_view_container').attr('type'))
						{
							new TradingView.widget({
								'width': '100%',
								'height': 400,
								'symbol': $('#trading_view_container').attr('ticker').replace('.', ':'),
								'interval': $('#trading_view_container').attr('interval') ? $('#trading_view_container').attr('interval') : '60',
								'style': '1',
								'hideideas': true,
								'locale': 'ru',
								'enable_publishing': false,
								'timezone': 'Europe/Moscow',
								'range': '2m',
								'customer': 'smartlab-custom',
								'referral_id': '1339',
								'container_id' : 'trading_view_container',
								'disabled_features':['create_volume_indicator_by_default']
								});
						} else
						{
							new TradingView.widget({
								'width': '100%',
								'height': 400,
								'symbol': $('#trading_view_container').attr('ticker').replace('.', ':'),
								'interval': $('#trading_view_container').attr('interval') ? $('#trading_view_container').attr('interval') : '60',
								'style': '3',
								'hideideas': true,
								'locale': 'ru',
								'enable_publishing': false,
								'timezone': 'Europe/Moscow',
								'range': '6m',
								'customer': 'smartlab-custom',
								'referral_id': '1339',
								'container_id' : 'trading_view_container'
								});
						}
					}
				});
			}
		}
	}

	//  Portfolio
	if ($('.new-portfolio').length && (!$('.new-portfolio').attr('href')))
	{
		function LoadPortfolio()
		{
			var d = $.Deferred();

			if (typeof(AddPortfolioStockEvent) !== 'undefined')
			{
				d.resolve();
			} else
			{
				$.cachedScript('/plugins/trade/templates/skin/default/actions/ActionQ/js/portfolio.js').done(function( script, textStatus )
				{
					d.resolve();
				
				}).fail(function()
				{
					d.reject();
				});
			}
			return d;
		}

		$('body').on('click', '#portfolio_dropdown .add_portfolio_item', function(e)
		{
			var node = $(e.target);
			LoadPortfolio().then(function()
			{
				AddPortfolioStockEvent(node.attr('type'), node.attr('symbol'), node.attr('sec-last'), node.attr('list-id'));
			});
		
		}).on('click', '.new-portfolio', function(e)
		{
			var node = $(e.target);
			LoadPortfolio().then(function()
			{
				AddPortfolioEvent('  ', 'add_list').then(function(sMsgTitle, sMsg, iListId, sListTitle)
				{
					msgNoticeBox.alert(sMsgTitle, sMsg);

					var link = $('<a class="add_portfolio_item"></a>').attr('type', 'buy').attr('list-id', iListId).text(sListTitle);
					link.attr('sec-title', node.attr('sec-title')).attr('sec-last', node.attr('sec-last')).attr('symbol', node.attr('symbol'));

					$('#portfolio_dropdown').find('.drop-menu-main-sub').append(link);
					link.trigger('click');

				}, function(sMsgTitle, sMsg)
				{
					msgErrorBox.alert(sMsgTitle, sMsg);
				});
			});
		});
	}

	//  Watchlist
	if ($('.new-watchlist').length && (!$('.new-watchlist').attr('href')))
	{
		function LoadWatchlist()
		{
			var d = $.Deferred();

			if (typeof(AddWatchlistStockEvent) !== 'undefined')
			{
				d.resolve();
			} else
			{
				$.cachedScript('/plugins/trade/templates/skin/default/actions/ActionQ/js/watchlist.js').done(function( script, textStatus )
				{
					d.resolve();
				
				}).fail(function()
				{
					d.reject();
				});
			}
			return d;
		}

		$('body').on('click', '#watchlist_dropdown .add_watchlist_item', function(e)
		{
			var node = $(e.target);
			LoadWatchlist().then(function()
			{
				AddWatchlistStockEvent(node.attr('type'), node.attr('symbol'), node.attr('list-id'));
			});
		
		}).on('click', '.new-watchlist', function(e)
		{
			var node = $(e.target);
			LoadWatchlist().then(function()
			{
				AddWatchlistEvent('  ', 'add_list').then(function(sMsgTitle, sMsg, iListId, sListTitle)
				{
					msgNoticeBox.alert(sMsgTitle, sMsg);

					var link = $('<a class="add_watchlist_item"></a>').attr('type', 'buy').attr('list-id', iListId).text(sListTitle);
					link.attr('sec-title', node.attr('sec-title')).attr('sec-last', node.attr('sec-last')).attr('symbol', node.attr('symbol'));

					$('#watchlist_dropdown').find('.drop-menu-main-sub').append(link);
					link.trigger('click');

				}, function(sMsgTitle, sMsg)
				{
					msgErrorBox.alert(sMsgTitle, sMsg);
				});
			});
		});
	}

	//   
	$('body').on('click', '.article_subscribe', function(e)
	{
		var btn = $(this);
		var sArticleId = btn.data('target-id');
		var sType = btn.data('subscribe-type');
		var bSubscribe = !btn.hasClass('subscribed');

		if (sType && sArticleId)
		{
			e.preventDefault();
			$.ajax({

				url: '/finansoviy-slovar/ajaxsubscribe/' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
				type: 'POST',
				data: {id: sArticleId, type: sType, subscribe: bSubscribe ? 1 : 0, security_ls_key: LIVESTREET_SECURITY_KEY}
			}).then(function(result)
			{
				try
				{
					result = JSON.parse(result);
				} catch (e)
				{
					msgErrorBox.alert('!', ' ');
					return;
				}

				if (result.js.bStateError)
				{
					msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
					return;
				} else
				{
					msgNoticeBox.alert(result.js.sMsgTitle, result.js.sMsg);
					btn.toggleClass('subscribed');
				}
			});
		}
	});

	//    TradingView
	$('.graph_button').on('click', function(e)
	{
		var btn = $(e.target);

		$.ajax({

			url: '/settings/some_settings_ajax/' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
			type: 'POST',
			data: {bDisplayGraph: btn.hasClass('hidden') ? 1 : 0, security_ls_key: LIVESTREET_SECURITY_KEY}
		}).then(function(result)
		{
			try
			{
				result = JSON.parse(result);
				if (result.js.bStateError)
				{
					msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
					return;
				}

			} catch (e) {}

			$('.graph_button').toggleClass('hidden');
			LoadTradingView();
		});
	});

	//       TradingView
	if ($.browser.mobile)
	{
		$('.graph_button').addClass('hidden');
	}

	LoadTradingView();

	$('.fundam_table.calendar').on('click', 'a', function(e)
	{
		if ($.trim($(this).text()) == 'X')
		{
			e.preventDefault();
			var nLink = $(this);
			var sDeleteUrl = nLink[0].href;
			var confirmDialog = new jBox('Confirm', 
			{
				id: 'deleteEventDialog',
				title: '!',
				confirmButton: '',
				cancelButton: '',
				content: '  ?',
				confirm: function()
				{
					$.get(sDeleteUrl, {}, function(result)
					{
						//      -       ;)
						nLink.parents('tr').remove();
					});

				}, onCloseComplete: function()
				{
					this.destroy();
				}
			});
			confirmDialog.open();
		}
	});


	//   -  
	var readersBlock = $('#readers').first();
	if (readersBlock.length && readersBlock.attr('url'))
	{
		function readersBlockReloader()
		{
			window.setTimeout(function()
			{
				$.getScript(readersBlock.attr('url'));

			}, 60000);
		};

		window['readersBlockBuilder'] = function(data)
		{
			readersBlockReloader();
			readersBlock.empty();

			if (!('page' in data)) return;
			if (!('guests' in data)) data['guests'] = 0;
			if (!('usersCount' in data)) data['usersCount'] = 0;

			if ((data['guests'] > 0) || (data['usersCount'] > 0))
			{
				var guestsTitle = ['', '', ''];
				var usersTitle = ['', '', ''];

				function i2i(i)
				{
					var l2d = parseInt(i.toString().substr(-2, 2));
					if ([11,12,13,14].indexOf(l2d) !== -1) return 2;

					var ld = parseInt(i.toString().substr(-1, 1));
					switch (ld)
					{
						case 1:
							return 0;

						case 2:
						case 3:
						case 4:
							return 1;

						default:
							return 2;
					}
				}

				var sRead = '';
				if (data['guests'] > 0) sRead += data['guests'] + ' ' + guestsTitle[i2i(data['guests'])];
				if (data['usersCount'] && sRead.length) sRead += '  ';
				if (data['usersCount'] > 0) sRead += data['usersCount'] + ' ' + usersTitle[i2i(data['usersCount'])];
				readersBlock.append($('<li></li>').text(': ' + sRead));
			} else
			{
				readersBlock.append($('<li>    .</li>'));
			}

			if ('users' in data)
			{
				$.each(data['users'], function(i,v)
				{
					var a = $('<a></a>').text(v.title).attr('href', '/profile/' + v.login + '/');
					readersBlock.append($('<li></li>').append(a));
				});
			}
		};

		$.getScript(readersBlock.attr('url'));
	}


	//   -  
	var moderatorsBlock = $('#moderators').first();
	if (moderatorsBlock.length && moderatorsBlock.attr('article-id'))
	{
		var sWindowContent = '<div class="moderatorsBox">\
									<div>\
										<span> :</span><br/>\
										<div>\
											<input type="text"/>\
										</div>\
									</div><br/>\
									<span> :</span>\
									<ul>\
										<li>...</li>\
									</ul>\
							</div>';

		var moderatorsDialogParam = {

			id: 'moderatorsDialog',
			title: '  ',
			confirmButton: '',
			cancelButton: '',			
			content: sWindowContent,
			articleId: moderatorsBlock.attr('article-id'),
			width: 450,

			onOpen: function()
			{
				var self = this;
				if ('confirmed' in this.options) delete this.options.confirmed;
				this.options.loadModerators.call(this);
				
				var list = self.wrapper.find('ul');
				this.wrapper.on('click', '.removeModerator', function()
				{
					$(this).parents('li').remove();
					if (!list.find('li').length) list.append('<li id="0"> .</li>');

				});

				this.wrapper.find('input:text').autocomplete({
					serviceUrl: '/summoner/nick_autocomplete2/',
					type: 'GET',
					dataType: 'json',
					paramName: 'q',
					preventBadQueries: false,
					zIndex: 99999,
					transformResult: function(response)
					{
						return { suggestions: response.results };
					},
					onSelect: function (suggestion)
					{
						var list = self.wrapper.find('ul');
						if (!list.find('li#' + suggestion.id).length)
						{
							var a = $('<a/>').attr('href', suggestion.url).text(suggestion.value);
							var li = $('<li/>').attr('id', suggestion.id);
							li.append(a);
							li.append($('<span class="removeModerator" title=" ">&ndash;</span>'));
							list.append(li);
							$(this).val('');

							if (list.find('li#0').length) list.find('li#0').remove();

							var iScroll = list[0].scrollHeight - list[0].clientHeight;
							list[0].scrollTop = iScroll ? iScroll : 0;							
						}
					}
				}).on('change', function()
				{
					$(this).removeAttr('uid');
					self.wrapper.find('input:button').attr('disabled', true);
				});

				self.wrapper.find('input:button').attr('disabled', true);
			},

			loadModerators: function()
			{
				var self = this;
				$.ajax({

					url: '/finansoviy-slovar/ajaxarticlemoderators' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
					type: 'GET',
					data: {id: this.options.articleId, security_ls_key: LIVESTREET_SECURITY_KEY}

				}).then(function(result)
				{
					try
					{
						result = JSON.parse(result);
						if (result.js.bStateError)
						{
							msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
							return;
						}

					} catch (e) {}

					var list = self.wrapper.find('ul');
					list.empty();
					if (('moderators' in result.js) && result.js.moderators.length)
					{
						$.each(result.js.moderators, function(i,v)
						{
							var li = $('<li/>');
							li.attr('id', v['id']);
							var a = $('<a/>').attr('href', v['url']).text(v['name']);
							li.append(a);

							li.append($('<span class="removeModerator" title=" ">&ndash;</span>'));
							list.append(li);
						});

					} else
					{
						list.append('<li id="0"> .</li>');
					}
				});
			},

			saveModerators: function()
			{
				var self = this;

				var aModerators = [];
				this.wrapper.find('ul').find('li').each(function(i, n)
				{
					aModerators.push(this.id);
				});

				if (aModerators.indexOf(0) !== -1) aModerators = aModerators.splice(aModerators.indexOf(0), 1);

				$.ajax({

					url: '/finansoviy-slovar/ajaxarticlemoderators' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
					type: 'POST',
					data: {id: self.options.articleId, moderators: aModerators, security_ls_key: LIVESTREET_SECURITY_KEY}

				}).then(function(result)
				{
					try
					{
						result = JSON.parse(result);
						if (result.js.bStateError)
						{
							msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
							return;
						}

					} catch (e) {}

					moderatorsBlock.find('li').not(':first-child').remove();
					if (('moderators' in result.js) && result.js.moderators.length)
					{
						$.each(result.js.moderators, function(i,v)
						{
							var li = $('<li/>');
							var a = $('<a/>').attr('href', v['url']).text(v['name']);
							li.append(a);
							moderatorsBlock.append(li);
						});

					} else
					{
						moderatorsBlock.append('<li id="0"> .</li>');
					}
				});
			},

			confirm: function()
			{
				this['confirmed'] = true;
			},

			onClose: function()
			{
				if (('confirmed' in this.options) && (this.options.confirmed)) this.options.saveModerators.call(this);
				this.wrapper.off('click');
			}
		};

		var mNode = moderatorsBlock.find('li').first();
		if (mNode.length)
		{
			var plus = $('<span class="addModerator" title=" ">+</span>');
			mNode.append(plus);

			plus.on('click', function()
			{
				var box = new jBox('Confirm', moderatorsDialogParam);
				box.open();
			});
		}
	}


	//   - 
	var bannedBlock = $('#banlist').first();
	if (bannedBlock.length && bannedBlock.attr('article-id'))
	{
		var sWindowContent = '<div class="bannedBox">\
								<div>\
									<span> :</span><br/>\
									<div>\
										<input type="text"/>\
									</div>\
								</div><br/>\
								<span> :</span>\
								<ul>\
									<li>...</li>\
								</ul>\
						</div>';

		var banlistDialogParam = {

			id: 'banlistDialog',
			title: '   ',
			confirmButton: '',
			cancelButton: '',			
			content: sWindowContent,
			articleId: bannedBlock.attr('article-id'),
			width: 450,

			onOpen: function()
			{
				var self = this;
				if ('confirmed' in this.options) delete this.options.confirmed;
				this.options.loadBannedList.call(this);
				
				var list = self.wrapper.find('ul');
				this.wrapper.on('click', '.removeFromBan', function()
				{
					$(this).parents('li').remove();
					if (!list.find('li').length) list.append('<li id="0"> .</li>');
				});

				this.wrapper.find('input:text').autocomplete({
					serviceUrl: '/summoner/nick_autocomplete2/',
					type: 'GET',
					dataType: 'json',
					paramName: 'q',
					preventBadQueries: false,
					zIndex: 99999,
					transformResult: function(response)
					{
						return { suggestions: response.results };
					},
					onSelect: function (suggestion)
					{
						var list = self.wrapper.find('ul');
						if (!list.find('li#' + suggestion.id).length)
						{
							var a = $('<a/>').attr('href', suggestion.url).text(suggestion.value);
							var li = $('<li/>').attr('id', suggestion.id);
							li.append(a);
							li.append($('<span class="removeFromBan" title="  ">&ndash;</span>'));
							list.append(li);
							$(this).val('');

							if (list.find('li#0').length) list.find('li#0').remove(); //  " "

							var iScroll = list[0].scrollHeight - list[0].clientHeight;
							list[0].scrollTop = iScroll ? iScroll : 0;
						}
					}
				});
			},

			loadBannedList: function()
			{
				var self = this;
				$.ajax({

					url: '/finansoviy-slovar/ajaxarticlebanlist' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
					type: 'GET',
					data: {id: this.options.articleId, security_ls_key: LIVESTREET_SECURITY_KEY}

				}).then(function(result)
				{
					try
					{
						result = JSON.parse(result);
						if (result.js.bStateError)
						{
							msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
							return;
						}

					} catch (e) {}

					var list = self.wrapper.find('ul');
					list.empty();
					if (('banned' in result.js) && result.js.banned.length)
					{
						$.each(result.js.banned, function(i,v)
						{
							var li = $('<li/>');
							li.attr('id', v['id']);
							var a = $('<a/>').attr('href', v['url']).text(v['name']);
							li.append(a);

							li.append($('<span class="removeFromBan" title="  ">&ndash;</span>'));
							list.append(li);
						});

					} else
					{
						list.append('<li id="0"> .</li>');
					}
				});
			},

			saveBannedList: function()
			{
				var self = this;

				var aBanned = [];
				this.wrapper.find('ul').find('li').each(function(i, n)
				{
					aBanned.push(this.id);
				});

				if (aBanned.indexOf(0) !== -1) aBanned = aBanned.splice(aBanned.indexOf(0), 1);

				$.ajax({

					url: '/finansoviy-slovar/ajaxarticlebanlist' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
					type: 'POST',
					data: {id: self.options.articleId, banned: aBanned, security_ls_key: LIVESTREET_SECURITY_KEY}

				}).then(function(result)
				{
					try
					{
						result = JSON.parse(result);
						if (result.js.bStateError)
						{
							msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
							return;
						}

					} catch (e) {}

					bannedBlock.find('li').not(':first-child').remove();
					if (('banned' in result.js) && result.js.banned.length)
					{
						$.each(result.js.banned, function(i,v)
						{
							var li = $('<li/>');
							var a = $('<a/>').attr('href', v['url']).text(v['name']);
							li.append(a);
							bannedBlock.append(li);
						});

					} else
					{
						bannedBlock.append('<li id="0"> .</li>');
					}
				});
			},

			confirm: function()
			{
				this['confirmed'] = true;
			},

			onClose: function()
			{
				if (('confirmed' in this.options) && (this.options.confirmed)) this.options.saveBannedList.call(this);
				this.wrapper.off('click');
			}
		};

		var mNode = bannedBlock.find('li').first();
		if (mNode.length)
		{
			var plus = $('<span class="addToBan" title="  ">+</span>');
			mNode.append(plus);

			plus.on('click', function()
			{
				var box = new jBox('Confirm', banlistDialogParam);
				box.open();
			});
		}
	}


	// -  :     Ajax  trading.
	if ($('#trading_add').length)
	{
		$('#trading_add').on('click', function(e)
		{
			e.preventDefault();

			var sWindowContent = '<div class="input_field">\
				<input type="text" name="topic_name" placeholder="  " id="topic_name" autocomplete="off">\
			</div>\
			<div class="input_field">\
				<textarea name="topic_text" id="topic_text" placeholder="  "></textarea>\
			</div>\
			<div class="input_field input_field__buttons">\
				<div class="modal_checkbox">\
					<input type="checkbox" name="hide_in_chat" id="hide_in_chat">\
					<label for="hide_in_chat">     <a href="/chat/" target="_blank"></a></label>\
				</div>\
				<div class="modal_button">\
					<button type="submit" id="new_topic__submit"></button>\
				</div>\
			</div>';

			var addArticleDialogParam = {

				id: 'addArticleDialog',
				title: ' /',
				confirmButton: '',
				cancelButton: '',
				content: sWindowContent,
				closeOnConfirm: false,
				maxWidth: 'auto',

				_onCreated: function ()
				{
					this.submitButton = jQuery(this.content.find('button:submit'));
					jQuery('<button class="close"></button>').click(function () { this.options.cancel && this.options.cancel(); this.close(); }.bind(this)).appendTo(this.container.find('.jBox-title'));
				},

				confirm: function()
				{
					box.container.find('.error').remove();

					var sTitle = box.container.find('#topic_name').val();
					var sText = box.container.find('#topic_text').val();
					var bHide = box.container.find('#hide_in_chat').is(':checked');

					var data = {topic_name: sTitle, topic_text: sText, security_ls_key: LIVESTREET_SECURITY_KEY};
					if (bHide) data['hide_in_chat'] = 1;

					$.ajax({

						url: '/trading/ajax_add/' + '?JsHttpRequest=' + (new Date()).getTime() + '-form',
						type: 'POST',
						data: data

					}).then(function(result)
					{
						try
						{
							result = result.match(/top\.JsHttpRequestGlobal\.dataReady\((.+)\)/); //    JsHttpRequest,    -form -      ))  ))
							if (result != null) result = JSON.parse(result[1]);

						} catch (e) { result = null; }

						if (result.js.bStateError)
						{
							var oErrorAfterMap = {'submit': '#new_topic__submit', 'topic_name' : '#topic_name', 'topic_text': '#topic_text'};
							for (var i in result.js.aError)
							{
								if (i in oErrorAfterMap)
								{
									$('<span/>').addClass('error').text(result.js.aError[i]).insertAfter($(oErrorAfterMap[i]));
								}
							}
						} else
						{
							box.close();
							document.location.href = result.js.sUrl;
						}
					});
				}, 

				onCloseComplete: function()
				{
					this.destroy();
				}
			};

			var box = new jBox('Confirm', addArticleDialogParam);
			box.open();
		});
	}


	//    - 
	if ($('#active_thread_graph').length)
	{
		$.cachedScript('/engine/lib/external/HighCharts/highcharts.js').done(function()
		{
			Highcharts.setOptions({

				global: {
					useUTC: false,
					timezoneOffset: 4
				},

				lang:{
					months:['', '', '', '', '', '', '', '', '', '', '', ''],
					shortMonths:['', '', '', '', '', '', '', '', '', '', '', ''],
					weekdays:['', '', '', '', '', '', ''],
					resetZoom: ' '
				}
			});
	
			var forumChart = 
			{
				chart:
				{
					renderTo: 'active_thread_graph',
					zoomType: 'x',
					type: 'line'
				},

				title:
				{
					align: 'left',
					text: null
				},

				subtitle:
				{
					align: 'left',
					text: '    '
				},

				xAxis:
				{
					type: 'datetime',
					maxZoom: 14 * 24 * 3600000, // fourteen days
					title:
					{
						text: null
					}
				},

				yAxis:
				{
					title:
					{
						text: ''
					},
					startOnTick: false,
					showFirstLabel: false
				},

				tooltip: {
					xDateFormat: ((data['pointIntervalUnit'] == 'day') ? '%A, %e %b.' : '%B %Y'),
					shared: true
				},

				legend:
				{
					enabled: true,
					align: 'right',
					verticalAlign: 'top',
					layout: 'vertical'
				},

				credits:
				{
					enabled: false
				},

				series: []
			};

			for (var i in data['series'])
			{
				var oSeries = {

					name: data['series'][i]['title'],
					data: data['series'][i]['data'],
					pointStart: data['series'][i]['time'] * 1000,
					pointInterval: data['pointInterval'],
					pointIntervalUnit: data['pointIntervalUnit']
				};

				if ('visible' in data['series'][i]) oSeries['visible'] = data['series'][i]['visible'];
				forumChart.series.push(oSeries);
			}

			new Highcharts.Chart(forumChart);
		});
	}

	//   ""
	$('#more_disclosure_commented').on('click', function(e)
	{
		e.preventDefault();

		var action = document.location.pathname;
		if (action.substr(-1,1) != '/') action += '/';

		$.ajax({

			url: action + 'ajax_forum_disclosure_commented/' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
			type: 'POST',
			data: { skip: $('li:not(.popCommented, .more)', '#disclosure_commented_block').length, security_ls_key: LIVESTREET_SECURITY_KEY }

		}).then(function(result)
		{
			try
			{
				result = JSON.parse(result);
				if (!result.js.bStateError)
				{
					if ('aComments' in result.js)
					{
						var before = $('#more_disclosure_commented').parent('li');
						if (before.length)
						{
							$.each(result.js.aComments, function(i, el)
							{
								var li = $('<li></li>');
								li.addClass('bluid_' + el.comment_author_id);
								
								li.text(el.date);
								$('<a></a>').attr('href', el.company_url).text(el.company_title).appendTo($('<i></i>').appendTo(li));
								li.append($('<a title="  "></a>').attr('href', el.comment_url).text(el.comment_title));
								before.before(li);
							});
						}
					}

					if (result.js.aComments.length < 10) $('#more_disclosure_commented').attr('href', action + 'comments/').off('click');
					if ($('li', '#disclosure_commented_block').length > 30) $('#more_disclosure_commented').attr('href', action + 'comments/').off('click');
				} else
				{
					msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
				}

			} catch (e) {}
		});
	});	

	//   v1
	$('#more_last_commented').on('click', function(e)
	{
		e.preventDefault();

		var action = document.location.pathname;
		if (action.substr(-1,1) != '/') action += '/';

		$.ajax({

			url: action + 'ajax_forum_index_commented/' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
			type: 'POST',
			data: { skip: $('li:not(.popCommented, .more)', '#last_commented_block').length, security_ls_key: LIVESTREET_SECURITY_KEY }

		}).then(function(result)
		{
			try
			{
				result = JSON.parse(result);
				if (!result.js.bStateError)
				{
					if ('aComments' in result.js)
					{
						var before = $('#more_last_commented').parent('li');
						if (before.length)
						{
							$.each(result.js.aComments, function(i, el)
							{
								var li = $('<li></li>');
								li.addClass('bluid_' + el.comment_author_id);


								li.text(el.date);
								$('<a></a>').attr('href', el.company_url).text(el.company_title).appendTo($('<i></i>').appendTo(li));
								li.append($('<a title="  "></a>').attr('href', el.comment_url).text(el.comment_title));
								before.before(li);
							});
						}
					}

					if (result.js.aComments.length < 10) $('#more_last_commented').attr('href', action + 'comments/').off('click');
					if ($('li', '#last_commented_block').length > 30) $('#more_last_commented').attr('href', action + 'comments/').off('click');
				} else
				{
					msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
				}

			} catch (e) {}
		});
	});

	//   v2
	$('#more_last_commented2').on('click', function(e)
	{
		e.preventDefault();

		var action = document.location.pathname;
		if (action.substr(-1,1) != '/') action += '/';

		$.ajax({

			url: action + 'ajax_forum_index_commented/' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
			type: 'POST',
			data: { skip: $('.post', '#last_commented_block').length, security_ls_key: LIVESTREET_SECURITY_KEY }

		}).then(function(result)
		{
			try
			{
				result = JSON.parse(result);
				if (!result.js.bStateError)
				{
					if ('aComments' in result.js)
					{
						var before = $('#more_last_commented2').parent('div');
						if (before.length)
						{
							var t = $('.post', '#last_commented_block').first().clone();
							$.each(result.js.aComments, function(i, el)
							{
								var p = t.clone();
								
								var prc = [];
								$.each(p.attr('class').split(' '), function(ii, cl)
								{
									if (cl.match(/^bluid_\d+/)) prc.push(cl);
								});
								if (prc.length) p.removeClass(prc.join(' '));
								p.addClass('bluid_' + el.comment_author_id);

								p.find('.post_inner').attr('href', el.comment_url);
								p.find('.time').text(el.date);
								p.find('.author').text(el.comment_author);
								p.find('.title').text(el.company_title);
								p.find('.comments_count').attr('href', el.company_url).text(el.company_comments);
								p.find('.last_comment__body').text(el.comment_title);
								p.find('.logo img').attr('src', el.company_thumbnail ? el.company_thumbnail : '/plugins/mobile/templates/skin/default/actions/ActionMobile/images/logo.png').attr('alt', el.company_thumbnail ? ' ' + el.company_title : '');
								before.before(p);
							});
						}
					}

					if (result.js.aComments.length < 10) $('#more_last_commented2').attr('href', action + 'comments/').off('click');
					if ($('.post', '#last_commented_block').length > 30) $('#more_last_commented2').attr('href', action + 'comments/').off('click');
				} else
				{
					msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
				}

			} catch (e) {}
		});
	});



	// -------------     ---------------

	//    
	// ,  ,    ,      .
	//   -     mediaquery.
	var brokerCells = function(x)
	{
		if (x.matches)
		{
			$('.my_table_tr_left').removeClass('opened');
			$('.my_table_tr_right').removeAttr('style');
		}
	};

	var mm1024 = window.matchMedia('(min-width: 1025px)');
	mm1024.addListener(brokerCells);
	brokerCells(mm1024);

	$(document).on('click', '.my_table_tr_left', function(e)
	{
		if (!mm1024.matches && (e.target.nodeName != 'A'))
		{
			e.preventDefault();
			var btn = $(this);

			if (btn.hasClass('opened'))
			{
				btn.next('.my_table_tr_right').hide();
				btn.removeClass('opened');
			} else
			{
				$('.my_table_tr_left').removeClass('opened');
				$('.my_table_tr_right').hide();

				btn.next('.my_table_tr_right').toggle();
				btn.addClass('opened');
			}
			return false;
		}
	});

	//    "   300 "
	$('.brokers a[title]').jBox('Tooltip', {
		addClass: 'jBox-TooltipForum',
		maxWidth: '300px',
		position: {y: 'bottom'}
	});

	//       
	if ($('.pagination1').length)
	{
		var datepicker = $('.pagination1').find('.page.clock');
		if (datepicker.length)
		{
			var sCurrentDate = null;
			var aCurrentDateMatch = document.location.href.toString().match(/^https?:\/\/[^\/]+\/[^\/]+\/[^\/]+\/(\d{4}-\d{2}-\d{2})/i);
			if (aCurrentDateMatch !== null) sCurrentDate = aCurrentDateMatch[1];

			$('body').on('click', '.pagination1 .clock', function(e)
			{
				var datepicker = $(this);

				datepicker.datepicker({clearBtn: true, format:'yyyy-mm-dd'});
				if (sCurrentDate !== null) datepicker.datepicker('setDate', sCurrentDate);
				datepicker.datepicker('show');

			}).on('changeDate', '.pagination1 .clock', function(e)
			{
				var sDate = ('date' in e) ? e.format(0, 'yyyy-mm-dd') : null;
				if (sDate !== sCurrentDate)
				{
					var aMatch = document.location.href.toString().match(/(^https?:\/\/[^\/]+\/[^\/]+\/[^\/\?\#]+)/i);
					if (aMatch !== null)
					{
						var sNewPath = aMatch[1] + (sDate !== null ? '/' + encodeURIComponent(sDate) : '');
						document.location.href = sNewPath;
					}
				}
			});
		}
	}

});
;
(function($)
{
	function getSelectedText()
	{
		var text = "";
		if (window.getSelection) {
			text = window.getSelection();
		}else if (document.getSelection) {
			text = document.getSelection();
		}else if (document.selection) {
			text = document.selection.createRange().text;
		}
		return text;
	}


	$(document).ready(function($)
	{
		$(document).on('keydown', function(e)
		{
			if ((e.keyCode == 13) && (e.ctrlKey))
			{
				if (typeof(CURRENT_USER_ID) === 'undefined') return;
				var text = getSelectedText().toString().replace(/\s{2,}/gm, ' ').replace(/[\r\n]/gm, ' ');
				if (!text.length) return;

				if (text.length > 4096)
				{
					msgErrorBox.alert('', '     .   .');
					return;
				}

				e.stopPropagation();
				if ($('#mistakeDialog').length) return;

				var dialog = new jBox('Confirm',
				{
					id: 'mistakeDialog',
					title: '     ',
					closeOnConfirm: false,
					confirmButton: '',
					cancelButton: '',
					content: '<label for="selectedText"> :</label><br/><textarea id="selectedText" disabled="true"></textarea><br/><label for="commentText">:</label><br/><textarea id="commentText"></textarea>',

					confirm: function()
					{
						var data = {url: document.location.href.toString(),text: dialog.wrapper.find('#selectedText').val(), comment: dialog.wrapper.find('#commentText').val(), security_ls_key: LIVESTREET_SECURITY_KEY};
						$.post('/abuse/bug_ajax/', data, function(result)
						{
							if (!result)
							{
								msgErrorBox.alert('Error', 'Please try again later');
							}

							if (result.bStateError)
							{
								msgErrorBox.alert(result.sMsgTitle, result.sMsg);
							} else
							{
								msgNoticeBox.alert(result.sMsgTitle, result.sMsg);
								dialog.close();
							}
						});
					},

					onOpen: function()
					{
						this.wrapper.find('#selectedText').val(text);
					},

					onCloseComplete: function()
					{
						this.destroy();
					}
				});

				dialog.open();
			}
		});

	});

})(jQuery);     ;
