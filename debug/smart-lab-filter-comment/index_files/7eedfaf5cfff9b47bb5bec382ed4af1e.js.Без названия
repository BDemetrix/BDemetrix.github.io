// Automatic generation on 2021-08-13 13:12:38
var aRouter = new Array();
aRouter['error'] = '/error/';
aRouter['registration'] = '/registration/';
aRouter['profile'] = '/profile/';
aRouter['blog'] = '/blog/';
aRouter['top'] = '/top/';
aRouter['index'] = '/index/';
aRouter['topic'] = '/topic/';
aRouter['login'] = '/login/';
aRouter['people'] = '/people/';
aRouter['settings'] = '/settings/';
aRouter['tag'] = '/tag/';
aRouter['talk'] = '/talk/';
aRouter['allcomments'] = '/allcomments/';
aRouter['rss'] = '/rss/';
aRouter['link'] = '/link/';
aRouter['question'] = '/question/';
aRouter['blogs'] = '/blogs/';
aRouter['search'] = '/search/';
aRouter['admin'] = '/admin/';
aRouter['page'] = '/page/';
aRouter['allblog'] = '/allblog/';
aRouter['news'] = '/news/';
aRouter['allsignals'] = '/allsignals/';
aRouter['disclosure'] = '/disclosure/';
aRouter['votes'] = '/votes/';
aRouter['vopros'] = '/vopros/';
aRouter['pushes'] = '/pushes/';
aRouter['tags'] = '/tags/';
aRouter['flow'] = '/flow/';
aRouter['smm'] = '/smm/';
aRouter['zen'] = '/zen/';
aRouter['thisday'] = '/thisday/';
aRouter['print'] = '/print/';
aRouter['maintheme'] = '/maintheme/';
aRouter['my'] = '/my/';
aRouter['allvotes'] = '/allvotes/';
aRouter['money'] = '/money/';
aRouter['tradingreads'] = '/tradingreads/';
aRouter['friends'] = '/friends/';
aRouter['my-trading-account'] = '/my-trading-account/';
aRouter['user-trading-account'] = '/user-trading-account/';
aRouter['finansoviy-slovar'] = '/finansoviy-slovar/';
aRouter['forums'] = '/forums/';
aRouter['forum'] = '/forum/';
aRouter['kompanii'] = '/kompanii/';
aRouter['bonds'] = '/bonds/';
aRouter['banki'] = '/banki/';
aRouter['options'] = '/options/';
aRouter['algotrading'] = '/algotrading/';
aRouter['brokers-rating'] = '/brokers-rating/';
aRouter['brokers'] = '/brokers/';
aRouter['forex'] = '/forex/';
aRouter['trading-software'] = '/trading-software/';
aRouter['dividends'] = '/dividends/';
aRouter['dividends_us'] = '/dividends_us/';
aRouter['trading'] = '/trading/';
aRouter['crypto'] = '/crypto/';
aRouter['chat'] = '/chat/';
aRouter['stocks'] = '/stocks/';
aRouter['company'] = '/company/';
aRouter['companytag'] = '/companytag/';
aRouter['panel'] = '/panel/';
aRouter['books'] = '/books/';
aRouter['review'] = '/review/';
aRouter['e'] = '/e/';
aRouter['g'] = '/g/';
aRouter['gr'] = '/gr/';
aRouter['q'] = '/q/';
aRouter['poll'] = '/poll/';
aRouter['consumer-confidence-russia'] = '/consumer-confidence-russia/';
aRouter['console'] = '/console/';
aRouter['oil'] = '/oil/';
aRouter['lchi2016'] = '/lchi2016/';
aRouter['lchi2017'] = '/lchi2017/';
aRouter['lchi2018'] = '/lchi2018/';
aRouter['lchi2019'] = '/lchi2019/';
aRouter['lchi2020'] = '/lchi2020/';
aRouter['summoner'] = '/summoner/';
aRouter['calendar'] = '/calendar/';
aRouter['stat'] = '/stat/';
aRouter['statx'] = '/statx/';
aRouter['favtop'] = '/favtop/';
aRouter['vtop'] = '/vtop/';
aRouter['smartlab-tv'] = '/smartlab-tv/';
aRouter['blacklist'] = '/blacklist/';
aRouter['abuse'] = '/abuse/';
aRouter['mobile'] = '/mobile/';
aRouter['read'] = '/read/';
aRouter['rest'] = '/rest/';
;
/**
 * JsHttpRequest: JavaScript "AJAX" data loader
 * Minimized version: see debug directory for the complete one.
 *
 * @license LGPL
 * @author Dmitry Koterov, http://en.dklab.ru/lib/JsHttpRequest/
 * @version 5.x $Id$
 */
function JsHttpRequest(){
var t=this;
t.onreadystatechange=null;
t.readyState=0;
t.responseText=null;
t.responseXML=null;
t.status=200;
t.statusText="OK";
t.responseJS=null;
t.caching=false;
t.loader=null;
t.session_name="PHPSESSID";
t._ldObj=null;
t._reqHeaders=[];
t._openArgs=null;
t._errors={inv_form_el:"Invalid FORM element detected: name=%, tag=%",must_be_single_el:"If used, <form> must be a single HTML element in the list.",js_invalid:"JavaScript code generated by backend is invalid!\n%",url_too_long:"Cannot use so long query with GET request (URL is larger than % bytes)",unk_loader:"Unknown loader: %",no_loaders:"No loaders registered at all, please check JsHttpRequest.LOADERS array",no_loader_matched:"Cannot find a loader which may process the request. Notices are:\n%"};
t.abort=function(){
with(this){
if(_ldObj&&_ldObj.abort){
_ldObj.abort();
}
_cleanup();
if(readyState==0){
return;
}
if(readyState==1&&!_ldObj){
readyState=0;
return;
}
_changeReadyState(4,true);
}
};
t.open=function(_2,_3,_4,_5,_6){
with(this){
if(_3.match(/^((\w+)\.)?(GET|POST)\s+(.*)/i)){
this.loader=RegExp.$2?RegExp.$2:null;
_2=RegExp.$3;
_3=RegExp.$4;
}
try{
if(document.location.search.match(new RegExp("[&?]"+session_name+"=([^&?]*)"))||document.cookie.match(new RegExp("(?:;|^)\\s*"+session_name+"=([^;]*)"))){
_3+=(_3.indexOf("?")>=0?"&":"?")+session_name+"="+this.escape(RegExp.$1);
}
}
catch(e){
}
_openArgs={method:(_2||"").toUpperCase(),url:_3,asyncFlag:_4,username:_5!=null?_5:"",password:_6!=null?_6:""};
_ldObj=null;
_changeReadyState(1,true);
return true;
}
};
t.send=function(_7){
if(!this.readyState){
return;
}
this._changeReadyState(1,true);
this._ldObj=null;
var _8=[];
var _9=[];
if(!this._hash2query(_7,null,_8,_9)){
return;
}
var _a=null;
if(this.caching&&!_9.length){
_a=this._openArgs.username+":"+this._openArgs.password+"@"+this._openArgs.url+"|"+_8+"#"+this._openArgs.method;
var _b=JsHttpRequest.CACHE[_a];
if(_b){
this._dataReady(_b[0],_b[1]);
return false;
}
}
var _c=(this.loader||"").toLowerCase();
if(_c&&!JsHttpRequest.LOADERS[_c]){
return this._error("unk_loader",_c);
}
var _d=[];
var _e=JsHttpRequest.LOADERS;
for(var _f in _e){
var ldr=_e[_f].loader;
if(!ldr){
continue;
}
if(_c&&_f!=_c){
continue;
}
var _11=new ldr(this);
JsHttpRequest.extend(_11,this._openArgs);
JsHttpRequest.extend(_11,{queryText:_8.join("&"),queryElem:_9,id:(new Date().getTime())+""+JsHttpRequest.COUNT++,hash:_a,span:null});
var _12=_11.load();
if(!_12){
this._ldObj=_11;
JsHttpRequest.PENDING[_11.id]=this;
return true;
}
if(!_c){
_d[_d.length]="- "+_f.toUpperCase()+": "+this._l(_12);
}else{
return this._error(_12);
}
}
return _f?this._error("no_loader_matched",_d.join("\n")):this._error("no_loaders");
};
t.getAllResponseHeaders=function(){
with(this){
return _ldObj&&_ldObj.getAllResponseHeaders?_ldObj.getAllResponseHeaders():[];
}
};
t.getResponseHeader=function(_13){
with(this){
return _ldObj&&_ldObj.getResponseHeader?_ldObj.getResponseHeader(_13):null;
}
};
t.setRequestHeader=function(_14,_15){
with(this){
_reqHeaders[_reqHeaders.length]=[_14,_15];
}
};
t._dataReady=function(_16,js){
with(this){
if(caching&&_ldObj){
JsHttpRequest.CACHE[_ldObj.hash]=[_16,js];
}
responseText=responseXML=_16;
responseJS=js;
if(js!==null){
status=200;
statusText="OK";
}else{
status=500;
statusText="Internal Server Error";
}
_changeReadyState(2);
_changeReadyState(3);
_changeReadyState(4);
_cleanup();
}
};
t._l=function(_18){
var i=0,p=0,msg=this._errors[_18[0]];
while((p=msg.indexOf("%",p))>=0){
var a=_18[++i]+"";
msg=msg.substring(0,p)+a+msg.substring(p+1,msg.length);
p+=1+a.length;
}
return msg;
};
t._error=function(msg){
msg=this._l(typeof (msg)=="string"?arguments:msg);
msg="JsHttpRequest: "+msg;
if(!window.Error){
throw msg;
}else{
if((new Error(1,"test")).description=="test"){
throw new Error(1,msg);
}else{
throw new Error(msg);
}
}
};
t._hash2query=function(_1e,_1f,_20,_21){
if(_1f==null){
_1f="";
}
if((""+typeof (_1e)).toLowerCase()=="object"){
var _22=false;
if(_1e&&_1e.parentNode&&_1e.parentNode.appendChild&&_1e.tagName&&_1e.tagName.toUpperCase()=="FORM"){
_1e={form:_1e};
}
for(var k in _1e){
var v=_1e[k];
if(v instanceof Function){
continue;
}
var _25=_1f?_1f+"["+this.escape(k)+"]":this.escape(k);
var _26=v&&v.parentNode&&v.parentNode.appendChild&&v.tagName;
if(_26){
var tn=v.tagName.toUpperCase();
if(tn=="FORM"){
_22=true;
}else{
if(tn=="INPUT"||tn=="TEXTAREA"||tn=="SELECT"){
}else{
return this._error("inv_form_el",(v.name||""),v.tagName);
}
}
_21[_21.length]={name:_25,e:v};
}else{
if(v instanceof Object){
this._hash2query(v,_25,_20,_21);
}else{
if(v===null){
continue;
}
if(v===true){
v=1;
}
if(v===false){
v="";
}
_20[_20.length]=_25+"="+this.escape(""+v);
}
}
if(_22&&_21.length>1){
return this._error("must_be_single_el");
}
}
}else{
_20[_20.length]=_1e;
}
return true;
};
t._cleanup=function(){
var _28=this._ldObj;
if(!_28){
return;
}
JsHttpRequest.PENDING[_28.id]=false;
var _29=_28.span;
if(!_29){
return;
}
_28.span=null;
var _2a=function(){
_29.parentNode.removeChild(_29);
};
JsHttpRequest.setTimeout(_2a,50);
};
t._changeReadyState=function(s,_2c){
with(this){
if(_2c){
status=statusText=responseJS=null;
responseText="";
}
readyState=s;
if(onreadystatechange){
onreadystatechange();
}
}
};
t.escape=function(s){
return escape(s).replace(new RegExp("\\+","g"),"%2B");
};
}
JsHttpRequest.COUNT=0;
JsHttpRequest.MAX_URL_LEN=2000;
JsHttpRequest.CACHE={};
JsHttpRequest.PENDING={};
JsHttpRequest.LOADERS={};
JsHttpRequest._dummy=function(){
};
JsHttpRequest.TIMEOUTS={s:window.setTimeout,c:window.clearTimeout};
JsHttpRequest.setTimeout=function(_2e,dt){
window.JsHttpRequest_tmp=JsHttpRequest.TIMEOUTS.s;
if(typeof (_2e)=="string"){
id=window.JsHttpRequest_tmp(_2e,dt);
}else{
var id=null;
var _31=function(){
_2e();
delete JsHttpRequest.TIMEOUTS[id];
};
id=window.JsHttpRequest_tmp(_31,dt);
JsHttpRequest.TIMEOUTS[id]=_31;
}
window.JsHttpRequest_tmp=null;
return id;
};
JsHttpRequest.clearTimeout=function(id){
window.JsHttpRequest_tmp=JsHttpRequest.TIMEOUTS.c;
delete JsHttpRequest.TIMEOUTS[id];
var r=window.JsHttpRequest_tmp(id);
window.JsHttpRequest_tmp=null;
return r;
};
JsHttpRequest.query=function(url,_35,_36,_37){
var req=new this();
req.caching=!_37;
req.onreadystatechange=function(){
if(req.readyState==4){
_36(req.responseJS,req.responseText);
}
};
req.open(null,url,true);
req.send(_35);
};
JsHttpRequest.dataReady=function(d){
var th=this.PENDING[d.id];
delete this.PENDING[d.id];
if(th){
th._dataReady(d.text,d.js);
}else{
if(th!==false){
throw "dataReady(): unknown pending id: "+d.id;
}
}
};
JsHttpRequest.extend=function(_3b,src){
for(var k in src){
_3b[k]=src[k];
}
};
JsHttpRequest.LOADERS.xml={loader:function(req){
JsHttpRequest.extend(req._errors,{xml_no:"Cannot use XMLHttpRequest or ActiveX loader: not supported",xml_no_diffdom:"Cannot use XMLHttpRequest to load data from different domain %",xml_no_headers:"Cannot use XMLHttpRequest loader or ActiveX loader, POST method: headers setting is not supported, needed to work with encodings correctly",xml_no_form_upl:"Cannot use XMLHttpRequest loader: direct form elements using and uploading are not implemented"});
this.load=function(){
if(this.queryElem.length){
return ["xml_no_form_upl"];
}
if(this.url.match(new RegExp("^([a-z]+://[^\\/]+)(.*)","i"))){
if(RegExp.$1.toLowerCase()!=document.location.protocol+"//"+document.location.hostname.toLowerCase()){
return ["xml_no_diffdom",RegExp.$1];
}
}
var xr=null;
if(window.XMLHttpRequest){
try{
xr=new XMLHttpRequest();
}
catch(e){
}
}else{
if(window.ActiveXObject){
try{
xr=new ActiveXObject("Microsoft.XMLHTTP");
}
catch(e){
}
if(!xr){
try{
xr=new ActiveXObject("Msxml2.XMLHTTP");
}
catch(e){
}
}
}
}
if(!xr){
return ["xml_no"];
}
var _40=window.ActiveXObject||xr.setRequestHeader;
if(!this.method){
this.method=_40&&this.queryText.length?"POST":"GET";
}
if(this.method=="GET"){
if(this.queryText){
this.url+=(this.url.indexOf("?")>=0?"&":"?")+this.queryText;
}
this.queryText="";
if(this.url.length>JsHttpRequest.MAX_URL_LEN){
return ["url_too_long",JsHttpRequest.MAX_URL_LEN];
}
}else{
if(this.method=="POST"&&!_40){
return ["xml_no_headers"];
}
}
this.url+=(this.url.indexOf("?")>=0?"&":"?")+"JsHttpRequest="+(req.caching?"0":this.id)+"-xml";
var id=this.id;
xr.onreadystatechange=function(){
if(xr.readyState!=4){
return;
}
xr.onreadystatechange=JsHttpRequest._dummy;
req.status=null;
try{
req.status=xr.status;
req.responseText=xr.responseText;
}
catch(e){
}
if(!req.status){
return;
}
try{
eval("JsHttpRequest._tmp = function(id) { var d = "+req.responseText+"; d.id = id; JsHttpRequest.dataReady(d); }");
}
catch(e){
return req._error("js_invalid",req.responseText);
}
JsHttpRequest._tmp(id);
JsHttpRequest._tmp=null;
};
xr.open(this.method,this.url,true,this.username,this.password);
if(_40){
for(var i=0;i<req._reqHeaders.length;i++){
xr.setRequestHeader(req._reqHeaders[i][0],req._reqHeaders[i][1]);
}
xr.setRequestHeader("Content-Type","application/octet-stream");
}
xr.send(this.queryText);
this.span=null;
this.xr=xr;
return null;
};
this.getAllResponseHeaders=function(){
return this.xr.getAllResponseHeaders();
};
this.getResponseHeader=function(_43){
return this.xr.getResponseHeader(_43);
};
this.abort=function(){
this.xr.abort();
this.xr=null;
};
}};
JsHttpRequest.LOADERS.script={loader:function(req){
JsHttpRequest.extend(req._errors,{script_only_get:"Cannot use SCRIPT loader: it supports only GET method",script_no_form:"Cannot use SCRIPT loader: direct form elements using and uploading are not implemented"});
this.load=function(){
if(this.queryText){
this.url+=(this.url.indexOf("?")>=0?"&":"?")+this.queryText;
}
this.url+=(this.url.indexOf("?")>=0?"&":"?")+"JsHttpRequest="+this.id+"-"+"script";
this.queryText="";
if(!this.method){
this.method="GET";
}
if(this.method!=="GET"){
return ["script_only_get"];
}
if(this.queryElem.length){
return ["script_no_form"];
}
if(this.url.length>JsHttpRequest.MAX_URL_LEN){
return ["url_too_long",JsHttpRequest.MAX_URL_LEN];
}
var th=this,d=document,s=null,b=d.body;
if(!window.opera){
this.span=s=d.createElement("SCRIPT");
var _49=function(){
s.language="JavaScript";
if(s.setAttribute){
s.setAttribute("src",th.url);
}else{
s.src=th.url;
}
b.insertBefore(s,b.lastChild);
};
}else{
this.span=s=d.createElement("SPAN");
s.style.display="none";
b.insertBefore(s,b.lastChild);
s.innerHTML="Workaround for IE.<s"+"cript></"+"script>";
var _49=function(){
s=s.getElementsByTagName("SCRIPT")[0];
s.language="JavaScript";
if(s.setAttribute){
s.setAttribute("src",th.url);
}else{
s.src=th.url;
}
};
}
JsHttpRequest.setTimeout(_49,10);
return null;
};
}};
JsHttpRequest.LOADERS.form={loader:function(req){
JsHttpRequest.extend(req._errors,{form_el_not_belong:"Element \"%\" does not belong to any form!",form_el_belong_diff:"Element \"%\" belongs to a different form. All elements must belong to the same form!",form_el_inv_enctype:"Attribute \"enctype\" of the form must be \"%\" (for IE), \"%\" given."});
this.load=function(){
var th=this;
if(!th.method){
th.method="POST";
}
th.url+=(th.url.indexOf("?")>=0?"&":"?")+"JsHttpRequest="+th.id+"-"+"form";
if(th.method=="GET"){
if(th.queryText){
th.url+=(th.url.indexOf("?")>=0?"&":"?")+th.queryText;
}
if(th.url.length>JsHttpRequest.MAX_URL_LEN){
return ["url_too_long",JsHttpRequest.MAX_URL_LEN];
}
var p=th.url.split("?",2);
th.url=p[0];
th.queryText=p[1]||"";
}
var _4d=null;
var _4e=false;
if(th.queryElem.length){
if(th.queryElem[0].e.tagName.toUpperCase()=="FORM"){
_4d=th.queryElem[0].e;
_4e=true;
th.queryElem=[];
}else{
_4d=th.queryElem[0].e.form;
for(var i=0;i<th.queryElem.length;i++){
var e=th.queryElem[i].e;
if(!e.form){
return ["form_el_not_belong",e.name];
}
if(e.form!=_4d){
return ["form_el_belong_diff",e.name];
}
}
}
if(th.method=="POST"){
var _51="multipart/form-data";
var _52=(_4d.attributes.encType&&_4d.attributes.encType.nodeValue)||(_4d.attributes.enctype&&_4d.attributes.enctype.value)||_4d.enctype;
if(_52!=_51){
return ["form_el_inv_enctype",_51,_52];
}
}
}
var d=_4d&&(_4d.ownerDocument||_4d.document)||document;
var _54="jshr_i_"+th.id;
var s=th.span=d.createElement("DIV");
s.style.position="absolute";
s.style.display="none";
s.style.visibility="hidden";
s.innerHTML=(_4d?"":"<form"+(th.method=="POST"?" enctype=\"multipart/form-data\" method=\"post\"":"")+"></form>")+"<iframe name=\""+_54+"\" id=\""+_54+"\" style=\"width:0px; height:0px; overflow:hidden; border:none\"></iframe>";
if(!_4d){
_4d=th.span.firstChild;
}
d.body.insertBefore(s,d.body.lastChild);
var _56=function(e,_58){
var sv=[];
var _5a=e;
if(e.mergeAttributes){
var _5a=d.createElement("form");
_5a.mergeAttributes(e,false);
}
for(var i=0;i<_58.length;i++){
var k=_58[i][0],v=_58[i][1];
sv[sv.length]=[k,_5a.getAttribute(k)];
_5a.setAttribute(k,v);
}
if(e.mergeAttributes){
e.mergeAttributes(_5a,false);
}
return sv;
};
var _5e=function(){
top.JsHttpRequestGlobal=JsHttpRequest;
var _5f=[];
if(!_4e){
for(var i=0,n=_4d.elements.length;i<n;i++){
_5f[i]=_4d.elements[i].name;
_4d.elements[i].name="";
}
}
var qt=th.queryText.split("&");
for(var i=qt.length-1;i>=0;i--){
var _63=qt[i].split("=",2);
var e=d.createElement("INPUT");
e.type="hidden";
e.name=unescape(_63[0]);
e.value=_63[1]!=null?unescape(_63[1]):"";
_4d.appendChild(e);
}
for(var i=0;i<th.queryElem.length;i++){
th.queryElem[i].e.name=th.queryElem[i].name;
}
var sv=_56(_4d,[["action",th.url],["method",th.method],["onsubmit",null],["target",_54]]);
_4d.submit();
_56(_4d,sv);
for(var i=0;i<qt.length;i++){
_4d.lastChild.parentNode.removeChild(_4d.lastChild);
}
if(!_4e){
for(var i=0,n=_4d.elements.length;i<n;i++){
_4d.elements[i].name=_5f[i];
}
}
};
JsHttpRequest.setTimeout(_5e,100);
return null;
};
}};

;
/*! jQuery v3.6.0 | (c) OpenJS Foundation and other contributors | jquery.org/license */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(C,e){"use strict";var t=[],r=Object.getPrototypeOf,s=t.slice,g=t.flat?function(e){return t.flat.call(e)}:function(e){return t.concat.apply([],e)},u=t.push,i=t.indexOf,n={},o=n.toString,v=n.hasOwnProperty,a=v.toString,l=a.call(Object),y={},m=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},x=function(e){return null!=e&&e===e.window},E=C.document,c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||E).createElement("script");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[o.call(e)]||"object":typeof e}var f="3.6.0",S=function(e,t){return new S.fn.init(e,t)};function p(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!m(e)&&!x(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}S.fn=S.prototype={jquery:f,constructor:S,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=S.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return S.each(this,e)},map:function(n){return this.pushStack(S.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(S.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(S.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},S.extend=S.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||m(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(S.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||S.isPlainObject(n)?n:{},i=!1,a[t]=S.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},S.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==o.call(e))&&(!(t=r(e))||"function"==typeof(n=v.call(t,"constructor")&&t.constructor)&&a.call(n)===l)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(p(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(p(Object(e))?S.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(p(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:y}),"function"==typeof Symbol&&(S.fn[Symbol.iterator]=t[Symbol.iterator]),S.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var d=function(n){var e,d,b,o,i,h,f,g,w,u,l,T,C,a,E,v,s,c,y,S="sizzle"+1*new Date,p=n.document,k=0,r=0,m=ue(),x=ue(),A=ue(),N=ue(),j=function(e,t){return e===t&&(l=!0),0},D={}.hasOwnProperty,t=[],q=t.pop,L=t.push,H=t.push,O=t.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",I="(?:\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",W="\\["+M+"*("+I+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+M+"*\\]",F=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",B=new RegExp(M+"+","g"),$=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=new RegExp("^"+M+"*,"+M+"*"),z=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"|>"),X=new RegExp(F),V=new RegExp("^"+I+"$"),G={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){T()},ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{H.apply(t=O.call(p.childNodes),p.childNodes),t[p.childNodes.length].nodeType}catch(e){H={apply:t.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function se(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(T(e),e=e||C,E)){if(11!==p&&(u=Z.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&y(e,a)&&a.id===i)return n.push(a),n}else{if(u[2])return H.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&d.getElementsByClassName&&e.getElementsByClassName)return H.apply(n,e.getElementsByClassName(i)),n}if(d.qsa&&!N[t+" "]&&(!v||!v.test(t))&&(1!==p||"object"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===p&&(U.test(t)||z.test(t))){(f=ee.test(t)&&ye(e.parentNode)||e)===e&&d.scope||((s=e.getAttribute("id"))?s=s.replace(re,ie):e.setAttribute("id",s=S)),o=(l=h(t)).length;while(o--)l[o]=(s?"#"+s:":scope")+" "+xe(l[o]);c=l.join(",")}try{return H.apply(n,f.querySelectorAll(c)),n}catch(e){N(t,!0)}finally{s===S&&e.removeAttribute("id")}}}return g(t.replace($,"$1"),e,n,r)}function ue(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function le(e){return e[S]=!0,e}function ce(e){var t=C.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){var n=e.split("|"),r=n.length;while(r--)b.attrHandle[n[r]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function de(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function he(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}function ge(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ve(a){return le(function(o){return o=+o,le(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ye(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}for(e in d=se.support={},i=se.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},T=se.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:p;return r!=C&&9===r.nodeType&&r.documentElement&&(a=(C=r).documentElement,E=!i(C),p!=C&&(n=C.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",oe,!1):n.attachEvent&&n.attachEvent("onunload",oe)),d.scope=ce(function(e){return a.appendChild(e).appendChild(C.createElement("div")),"undefined"!=typeof e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),d.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),d.getElementsByTagName=ce(function(e){return e.appendChild(C.createComment("")),!e.getElementsByTagName("*").length}),d.getElementsByClassName=K.test(C.getElementsByClassName),d.getById=ce(function(e){return a.appendChild(e).id=S,!C.getElementsByName||!C.getElementsByName(S).length}),d.getById?(b.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(te,ne);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=d.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):d.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},b.find.CLASS=d.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&E)return t.getElementsByClassName(e)},s=[],v=[],(d.qsa=K.test(C.querySelectorAll))&&(ce(function(e){var t;a.appendChild(e).innerHTML="<a id='"+S+"'></a><select id='"+S+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+S+"-]").length||v.push("~="),(t=C.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||v.push("\\["+M+"*name"+M+"*="+M+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+S+"+*").length||v.push(".#.+[+~]"),e.querySelectorAll("\\\f"),v.push("[\\r\\n\\f]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=C.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(d.matchesSelector=K.test(c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ce(function(e){d.disconnectedMatch=c.call(e,"*"),c.call(e,"[s!='']:x"),s.push("!=",F)}),v=v.length&&new RegExp(v.join("|")),s=s.length&&new RegExp(s.join("|")),t=K.test(a.compareDocumentPosition),y=t||K.test(a.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},j=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!d.sortDetached&&t.compareDocumentPosition(e)===n?e==C||e.ownerDocument==p&&y(p,e)?-1:t==C||t.ownerDocument==p&&y(p,t)?1:u?P(u,e)-P(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e==C?-1:t==C?1:i?-1:o?1:u?P(u,e)-P(u,t):0;if(i===o)return pe(e,t);n=e;while(n=n.parentNode)a.unshift(n);n=t;while(n=n.parentNode)s.unshift(n);while(a[r]===s[r])r++;return r?pe(a[r],s[r]):a[r]==p?-1:s[r]==p?1:0}),C},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(T(e),d.matchesSelector&&E&&!N[t+" "]&&(!s||!s.test(t))&&(!v||!v.test(t)))try{var n=c.call(e,t);if(n||d.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){N(t,!0)}return 0<se(t,C,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!=C&&T(e),y(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=C&&T(e);var n=b.attrHandle[t.toLowerCase()],r=n&&D.call(b.attrHandle,t.toLowerCase())?n(e,t,!E):void 0;return void 0!==r?r:d.attributes||!E?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!d.detectDuplicates,u=!d.sortStable&&e.slice(0),e.sort(j),l){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else while(t=e[r++])n+=o(t);return n},(b=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=h(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=m[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&m(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=se.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(B," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(h,e,t,g,v){var y="nth"!==h.slice(0,3),m="last"!==h.slice(-4),x="of-type"===e;return 1===g&&0===v?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=y!==m?"nextSibling":"previousSibling",c=e.parentNode,f=x&&e.nodeName.toLowerCase(),p=!n&&!x,d=!1;if(c){if(y){while(l){a=e;while(a=a[l])if(x?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l="only"===h&&!u&&"nextSibling"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&p){d=(s=(r=(i=(o=(a=c)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1])&&r[2],a=s&&c.childNodes[s];while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if(1===a.nodeType&&++d&&a===e){i[h]=[k,s,d];break}}else if(p&&(d=s=(r=(i=(o=(a=e)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1]),!1===d)while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if((x?a.nodeName.toLowerCase()===f:1===a.nodeType)&&++d&&(p&&((i=(o=a[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[k,d]),a===e))break;return(d-=v)===g||d%g==0&&0<=d/g}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[S]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=P(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=f(e.replace($,"$1"));return s[S]?le(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(te,ne),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return V.test(n||"")||se.error("unsupported lang: "+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=E?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,n){return[n<0?n+t:n]}),even:ve(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ve(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ve(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:ve(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=de(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=he(e);function me(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function be(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&"parentNode"===c,p=r++;return e.first?function(e,t,n){while(e=e[u])if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var r,i,o,a=[k,p];if(n){while(e=e[u])if((1===e.nodeType||f)&&s(e,t,n))return!0}else while(e=e[u])if(1===e.nodeType||f)if(i=(o=e[S]||(e[S]={}))[e.uniqueID]||(o[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===k&&r[1]===p)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function we(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ce(d,h,g,v,y,e){return v&&!v[S]&&(v=Ce(v)),y&&!y[S]&&(y=Ce(y,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),f=!d||!e&&h?c:Te(c,s,d,n,r),p=g?y||(e?d:l||v)?[]:t:f;if(g&&g(f,p,n,r),v){i=Te(p,u),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(p[u[o]]=!(f[u[o]]=a))}if(e){if(y||d){if(y){i=[],o=p.length;while(o--)(a=p[o])&&i.push(f[o]=a);y(null,p=[],i,r)}o=p.length;while(o--)(a=p[o])&&-1<(i=y?P(e,a):s[o])&&(e[i]=!(t[i]=a))}}else p=Te(p===t?p.splice(l,p.length):p),y?y(null,t,p,r):H.apply(t,p)})}function Ee(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=be(function(e){return e===i},a,!0),l=be(function(e){return-1<P(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!==w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[be(we(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return Ce(1<s&&we(c),1<s&&xe(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace($,"$1"),t,s<n&&Ee(e.slice(s,n)),n<r&&Ee(e=e.slice(n)),n<r&&xe(e))}c.push(t)}return we(c)}return me.prototype=b.filters=b.pseudos,b.setFilters=new me,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=x[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=_.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=z.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace($," ")}),a=a.slice(n.length)),b.filter)!(r=G[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):x(e,s).slice(0)},f=se.compile=function(e,t){var n,v,y,m,x,r,i=[],o=[],a=A[e+" "];if(!a){t||(t=h(e)),n=t.length;while(n--)(a=Ee(t[n]))[S]?i.push(a):o.push(a);(a=A(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=k+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==C||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==C||(T(o),n=!E);while(s=v[a++])if(s(o,t||C,n)){r.push(o);break}i&&(k=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=q.call(r));f=Te(f)}H.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&se.uniqueSort(r)}return i&&(k=h,w=p),c},m?le(r):r))).selector=e}return a},g=se.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&E&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(te,ne),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=G.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(te,ne),ee.test(o[0].type)&&ye(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&xe(o)))return H.apply(n,r),n;break}}}return(l||f(e,c))(r,t,!E,n,!t||ee.test(e)&&ye(t.parentNode)||t),n},d.sortStable=S.split("").sort(j).join("")===S,d.detectDuplicates=!!l,T(),d.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(C.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),d.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(C);S.find=d,S.expr=d.selectors,S.expr[":"]=S.expr.pseudos,S.uniqueSort=S.unique=d.uniqueSort,S.text=d.getText,S.isXMLDoc=d.isXML,S.contains=d.contains,S.escapeSelector=d.escape;var h=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&S(e).is(n))break;r.push(e)}return r},T=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},k=S.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var N=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,n,r){return m(n)?S.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?S.grep(e,function(e){return e===n!==r}):"string"!=typeof n?S.grep(e,function(e){return-1<i.call(n,e)!==r}):S.filter(n,e,r)}S.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?S.find.matchesSelector(r,e)?[r]:[]:S.find.matches(e,S.grep(t,function(e){return 1===e.nodeType}))},S.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(S(e).filter(function(){for(t=0;t<r;t++)if(S.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)S.find(e,i[t],n);return 1<r?S.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&k.test(e)?S(e):e||[],!1).length}});var D,q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(S.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||D,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:q.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof S?t[0]:t,S.merge(this,S.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:E,!0)),N.test(r[1])&&S.isPlainObject(t))for(r in t)m(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=E.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):m(e)?void 0!==n.ready?n.ready(e):e(S):S.makeArray(e,this)}).prototype=S.fn,D=S(E);var L=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function O(e,t){while((e=e[t])&&1!==e.nodeType);return e}S.fn.extend({has:function(e){var t=S(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(S.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&S(e);if(!k.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&S.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?S.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(S(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(S.uniqueSort(S.merge(this.get(),S(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),S.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return h(e,"parentNode")},parentsUntil:function(e,t,n){return h(e,"parentNode",n)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return h(e,"nextSibling")},prevAll:function(e){return h(e,"previousSibling")},nextUntil:function(e,t,n){return h(e,"nextSibling",n)},prevUntil:function(e,t,n){return h(e,"previousSibling",n)},siblings:function(e){return T((e.parentNode||{}).firstChild,e)},children:function(e){return T(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(A(e,"template")&&(e=e.content||e),S.merge([],e.childNodes))}},function(r,i){S.fn[r]=function(e,t){var n=S.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=S.filter(t,n)),1<this.length&&(H[r]||S.uniqueSort(n),L.test(r)&&n.reverse()),this.pushStack(n)}});var P=/[^\x20\t\r\n\f]+/g;function R(e){return e}function M(e){throw e}function I(e,t,n,r){var i;try{e&&m(i=e.promise)?i.call(e).done(t).fail(n):e&&m(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}S.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},S.each(e.match(P)||[],function(e,t){n[t]=!0}),n):S.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){S.each(e,function(e,t){m(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==w(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return S.each(arguments,function(e,t){var n;while(-1<(n=S.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<S.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},S.extend({Deferred:function(e){var o=[["notify","progress",S.Callbacks("memory"),S.Callbacks("memory"),2],["resolve","done",S.Callbacks("once memory"),S.Callbacks("once memory"),0,"resolved"],["reject","fail",S.Callbacks("once memory"),S.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return S.Deferred(function(r){S.each(o,function(e,t){var n=m(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&m(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,m(t)?s?t.call(e,l(u,o,R,s),l(u,o,M,s)):(u++,t.call(e,l(u,o,R,s),l(u,o,M,s),l(u,o,R,o.notifyWith))):(a!==R&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){S.Deferred.exceptionHook&&S.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==M&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(S.Deferred.getStackHook&&(t.stackTrace=S.Deferred.getStackHook()),C.setTimeout(t))}}return S.Deferred(function(e){o[0][3].add(l(0,e,m(r)?r:R,e.notifyWith)),o[1][3].add(l(0,e,m(t)?t:R)),o[2][3].add(l(0,e,m(n)?n:M))}).promise()},promise:function(e){return null!=e?S.extend(e,a):a}},s={};return S.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=s.call(arguments),o=S.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(I(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||m(i[t]&&i[t].then)))return o.then();while(t--)I(i[t],a(t),o.reject);return o.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;S.Deferred.exceptionHook=function(e,t){C.console&&C.console.warn&&e&&W.test(e.name)&&C.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},S.readyException=function(e){C.setTimeout(function(){throw e})};var F=S.Deferred();function B(){E.removeEventListener("DOMContentLoaded",B),C.removeEventListener("load",B),S.ready()}S.fn.ready=function(e){return F.then(e)["catch"](function(e){S.readyException(e)}),this},S.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--S.readyWait:S.isReady)||(S.isReady=!0)!==e&&0<--S.readyWait||F.resolveWith(E,[S])}}),S.ready.then=F.then,"complete"===E.readyState||"loading"!==E.readyState&&!E.documentElement.doScroll?C.setTimeout(S.ready):(E.addEventListener("DOMContentLoaded",B),C.addEventListener("load",B));var $=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===w(n))for(s in i=!0,n)$(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,m(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(S(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},_=/^-ms-/,z=/-([a-z])/g;function U(e,t){return t.toUpperCase()}function X(e){return e.replace(_,"ms-").replace(z,U)}var V=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function G(){this.expando=S.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t={},V(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[X(t)]=n;else for(r in t)i[X(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(X):(t=X(t))in r?[t]:t.match(P)||[]).length;while(n--)delete r[t[n]]}(void 0===t||S.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!S.isEmptyObject(t)}};var Y=new G,Q=new G,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,K=/[A-Z]/g;function Z(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(K,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:J.test(i)?JSON.parse(i):i)}catch(e){}Q.set(e,t,n)}else n=void 0;return n}S.extend({hasData:function(e){return Q.hasData(e)||Y.hasData(e)},data:function(e,t,n){return Q.access(e,t,n)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,n){return Y.access(e,t,n)},_removeData:function(e,t){Y.remove(e,t)}}),S.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=Q.get(o),1===o.nodeType&&!Y.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=X(r.slice(5)),Z(o,r,i[r]));Y.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){Q.set(this,n)}):$(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=Q.get(o,n))?t:void 0!==(t=Z(o,n))?t:void 0;this.each(function(){Q.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){Q.remove(this,e)})}}),S.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Y.get(e,t),n&&(!r||Array.isArray(n)?r=Y.access(e,t,S.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=S.queue(e,t),r=n.length,i=n.shift(),o=S._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){S.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Y.get(e,n)||Y.access(e,n,{empty:S.Callbacks("once memory").add(function(){Y.remove(e,[t+"queue",n])})})}}),S.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?S.queue(this[0],t):void 0===n?this:this.each(function(){var e=S.queue(this,t,n);S._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&S.dequeue(this,t)})},dequeue:function(e){return this.each(function(){S.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=S.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=Y.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var ee=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,te=new RegExp("^(?:([+-])=|)("+ee+")([a-z%]*)$","i"),ne=["Top","Right","Bottom","Left"],re=E.documentElement,ie=function(e){return S.contains(e.ownerDocument,e)},oe={composed:!0};re.getRootNode&&(ie=function(e){return S.contains(e.ownerDocument,e)||e.getRootNode(oe)===e.ownerDocument});var ae=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ie(e)&&"none"===S.css(e,"display")};function se(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return S.css(e,t,"")},u=s(),l=n&&n[3]||(S.cssNumber[t]?"":"px"),c=e.nodeType&&(S.cssNumber[t]||"px"!==l&&+u)&&te.exec(S.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)S.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,S.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ue={};function le(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=Y.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ae(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ue[s])||(o=a.body.appendChild(a.createElement(s)),u=S.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ue[s]=u)))):"none"!==n&&(l[c]="none",Y.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}S.fn.extend({show:function(){return le(this,!0)},hide:function(){return le(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?S(this).show():S(this).hide()})}});var ce,fe,pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i;ce=E.createDocumentFragment().appendChild(E.createElement("div")),(fe=E.createElement("input")).setAttribute("type","radio"),fe.setAttribute("checked","checked"),fe.setAttribute("name","t"),ce.appendChild(fe),y.checkClone=ce.cloneNode(!0).cloneNode(!0).lastChild.checked,ce.innerHTML="<textarea>x</textarea>",y.noCloneChecked=!!ce.cloneNode(!0).lastChild.defaultValue,ce.innerHTML="<option></option>",y.option=!!ce.lastChild;var ge={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ve(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&A(e,t)?S.merge([e],n):n}function ye(e,t){for(var n=0,r=e.length;n<r;n++)Y.set(e[n],"globalEval",!t||Y.get(t[n],"globalEval"))}ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td,y.option||(ge.optgroup=ge.option=[1,"<select multiple='multiple'>","</select>"]);var me=/<|&#?\w+;/;function xe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===w(o))S.merge(p,o.nodeType?[o]:o);else if(me.test(o)){a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+S.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;S.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&-1<S.inArray(o,r))i&&i.push(o);else if(l=ie(o),a=ve(f.appendChild(o),"script"),l&&ye(a),n){c=0;while(o=a[c++])he.test(o.type||"")&&n.push(o)}return f}var be=/^([^.]*)(?:\.(.+)|)/;function we(){return!0}function Te(){return!1}function Ce(e,t){return e===function(){try{return E.activeElement}catch(e){}}()==("focus"===t)}function Ee(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Ee(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Te;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return S().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=S.guid++)),e.each(function(){S.event.add(this,t,i,r,n)})}function Se(e,i,o){o?(Y.set(e,i,!1),S.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=Y.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(S.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),Y.set(this,i,r),t=o(this,i),this[i](),r!==(n=Y.get(this,i))||t?Y.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n&&n.value}else r.length&&(Y.set(this,i,{value:S.event.trigger(S.extend(r[0],S.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Y.get(e,i)&&S.event.add(e,i,we)}S.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.get(t);if(V(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&S.find.matchesSelector(re,i),n.guid||(n.guid=S.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return"undefined"!=typeof S&&S.event.triggered!==e.type?S.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(P)||[""]).length;while(l--)d=g=(s=be.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=S.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=S.event.special[d]||{},c=S.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&S.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),S.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.hasData(e)&&Y.get(e);if(v&&(u=v.events)){l=(t=(t||"").match(P)||[""]).length;while(l--)if(d=g=(s=be.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){f=S.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||S.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)S.event.remove(e,d+t[l],n,r,!0);S.isEmptyObject(u)&&Y.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=S.event.fix(e),l=(Y.get(this,"events")||Object.create(null))[u.type]||[],c=S.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=S.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((S.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<S(i,this).index(l):S.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(S.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[S.expando]?e:new S.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click",we),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&A(t,"input")&&Y.get(t,"click")||A(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},S.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},S.Event=function(e,t){if(!(this instanceof S.Event))return new S.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?we:Te,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&S.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[S.expando]=!0},S.Event.prototype={constructor:S.Event,isDefaultPrevented:Te,isPropagationStopped:Te,isImmediatePropagationStopped:Te,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=we,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=we,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=we,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},S.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},S.event.addProp),S.each({focus:"focusin",blur:"focusout"},function(e,t){S.event.special[e]={setup:function(){return Se(this,e,Ce),!1},trigger:function(){return Se(this,e),!0},_default:function(){return!0},delegateType:t}}),S.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){S.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||S.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),S.fn.extend({on:function(e,t,n,r){return Ee(this,e,t,n,r)},one:function(e,t,n,r){return Ee(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,S(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Te),this.each(function(){S.event.remove(this,e,n,t)})}});var ke=/<script|<style|<link/i,Ae=/checked\s*(?:[^=]|=\s*.checked.)/i,Ne=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function je(e,t){return A(e,"table")&&A(11!==t.nodeType?t:t.firstChild,"tr")&&S(e).children("tbody")[0]||e}function De(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function qe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Le(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(Y.hasData(e)&&(s=Y.get(e).events))for(i in Y.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)S.event.add(t,i,s[i][n]);Q.hasData(e)&&(o=Q.access(e),a=S.extend({},o),Q.set(t,a))}}function He(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=m(d);if(h||1<f&&"string"==typeof d&&!y.checkClone&&Ae.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),He(t,r,i,o)});if(f&&(t=(e=xe(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=S.map(ve(e,"script"),De)).length;c<f;c++)u=e,c!==p&&(u=S.clone(u,!0,!0),s&&S.merge(a,ve(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,S.map(a,qe),c=0;c<s;c++)u=a[c],he.test(u.type||"")&&!Y.access(u,"globalEval")&&S.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?S._evalUrl&&!u.noModule&&S._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):b(u.textContent.replace(Ne,""),u,l))}return n}function Oe(e,t,n){for(var r,i=t?S.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||S.cleanData(ve(r)),r.parentNode&&(n&&ie(r)&&ye(ve(r,"script")),r.parentNode.removeChild(r));return e}S.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=ie(e);if(!(y.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||S.isXMLDoc(e)))for(a=ve(c),r=0,i=(o=ve(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ve(e),a=a||ve(c),r=0,i=o.length;r<i;r++)Le(o[r],a[r]);else Le(e,c);return 0<(a=ve(c,"script")).length&&ye(a,!f&&ve(e,"script")),c},cleanData:function(e){for(var t,n,r,i=S.event.special,o=0;void 0!==(n=e[o]);o++)if(V(n)){if(t=n[Y.expando]){if(t.events)for(r in t.events)i[r]?S.event.remove(n,r):S.removeEvent(n,r,t.handle);n[Y.expando]=void 0}n[Q.expando]&&(n[Q.expando]=void 0)}}}),S.fn.extend({detach:function(e){return Oe(this,e,!0)},remove:function(e){return Oe(this,e)},text:function(e){return $(this,function(e){return void 0===e?S.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return He(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||je(this,e).appendChild(e)})},prepend:function(){return He(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=je(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(S.cleanData(ve(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return S.clone(this,e,t)})},html:function(e){return $(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!ke.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=S.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(S.cleanData(ve(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return He(this,arguments,function(e){var t=this.parentNode;S.inArray(this,n)<0&&(S.cleanData(ve(this)),t&&t.replaceChild(e,this))},n)}}),S.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){S.fn[e]=function(e){for(var t,n=[],r=S(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),S(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});var Pe=new RegExp("^("+ee+")(?!px)[a-z%]+$","i"),Re=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=C),t.getComputedStyle(e)},Me=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Ie=new RegExp(ne.join("|"),"i");function We(e,t,n){var r,i,o,a,s=e.style;return(n=n||Re(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||ie(e)||(a=S.style(e,t)),!y.pixelBoxStyles()&&Pe.test(a)&&Ie.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function Fe(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",re.appendChild(u).appendChild(l);var e=C.getComputedStyle(l);n="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),re.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=E.createElement("div"),l=E.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",y.clearCloneStyle="content-box"===l.style.backgroundClip,S.extend(y,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=E.createElement("table"),t=E.createElement("tr"),n=E.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",re.appendChild(e).appendChild(t).appendChild(n),r=C.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,re.removeChild(e)),a}}))}();var Be=["Webkit","Moz","ms"],$e=E.createElement("div").style,_e={};function ze(e){var t=S.cssProps[e]||_e[e];return t||(e in $e?e:_e[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Be.length;while(n--)if((e=Be[n]+t)in $e)return e}(e)||e)}var Ue=/^(none|table(?!-c[ea]).+)/,Xe=/^--/,Ve={position:"absolute",visibility:"hidden",display:"block"},Ge={letterSpacing:"0",fontWeight:"400"};function Ye(e,t,n){var r=te.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Qe(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=S.css(e,n+ne[a],!0,i)),r?("content"===n&&(u-=S.css(e,"padding"+ne[a],!0,i)),"margin"!==n&&(u-=S.css(e,"border"+ne[a]+"Width",!0,i))):(u+=S.css(e,"padding"+ne[a],!0,i),"padding"!==n?u+=S.css(e,"border"+ne[a]+"Width",!0,i):s+=S.css(e,"border"+ne[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function Je(e,t,n){var r=Re(e),i=(!y.boxSizingReliable()||n)&&"border-box"===S.css(e,"boxSizing",!1,r),o=i,a=We(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Pe.test(a)){if(!n)return a;a="auto"}return(!y.boxSizingReliable()&&i||!y.reliableTrDimensions()&&A(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===S.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===S.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+Qe(e,t,n||(i?"border":"content"),o,r,a)+"px"}function Ke(e,t,n,r,i){return new Ke.prototype.init(e,t,n,r,i)}S.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=We(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=X(t),u=Xe.test(t),l=e.style;if(u||(t=ze(s)),a=S.cssHooks[t]||S.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=te.exec(n))&&i[1]&&(n=se(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(S.cssNumber[s]?"":"px")),y.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=X(t);return Xe.test(t)||(t=ze(s)),(a=S.cssHooks[t]||S.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=We(e,t,r)),"normal"===i&&t in Ge&&(i=Ge[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),S.each(["height","width"],function(e,u){S.cssHooks[u]={get:function(e,t,n){if(t)return!Ue.test(S.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Je(e,u,n):Me(e,Ve,function(){return Je(e,u,n)})},set:function(e,t,n){var r,i=Re(e),o=!y.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===S.css(e,"boxSizing",!1,i),s=n?Qe(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-Qe(e,u,"border",!1,i)-.5)),s&&(r=te.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=S.css(e,u)),Ye(0,t,s)}}}),S.cssHooks.marginLeft=Fe(y.reliableMarginLeft,function(e,t){if(t)return(parseFloat(We(e,"marginLeft"))||e.getBoundingClientRect().left-Me(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),S.each({margin:"",padding:"",border:"Width"},function(i,o){S.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+ne[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(S.cssHooks[i+o].set=Ye)}),S.fn.extend({css:function(e,t){return $(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Re(e),i=t.length;a<i;a++)o[t[a]]=S.css(e,t[a],!1,r);return o}return void 0!==n?S.style(e,t,n):S.css(e,t)},e,t,1<arguments.length)}}),((S.Tween=Ke).prototype={constructor:Ke,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||S.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(S.cssNumber[n]?"":"px")},cur:function(){var e=Ke.propHooks[this.prop];return e&&e.get?e.get(this):Ke.propHooks._default.get(this)},run:function(e){var t,n=Ke.propHooks[this.prop];return this.options.duration?this.pos=t=S.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Ke.propHooks._default.set(this),this}}).init.prototype=Ke.prototype,(Ke.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=S.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){S.fx.step[e.prop]?S.fx.step[e.prop](e):1!==e.elem.nodeType||!S.cssHooks[e.prop]&&null==e.elem.style[ze(e.prop)]?e.elem[e.prop]=e.now:S.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=Ke.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},S.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},S.fx=Ke.prototype.init,S.fx.step={};var Ze,et,tt,nt,rt=/^(?:toggle|show|hide)$/,it=/queueHooks$/;function ot(){et&&(!1===E.hidden&&C.requestAnimationFrame?C.requestAnimationFrame(ot):C.setTimeout(ot,S.fx.interval),S.fx.tick())}function at(){return C.setTimeout(function(){Ze=void 0}),Ze=Date.now()}function st(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=ne[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function ut(e,t,n){for(var r,i=(lt.tweeners[t]||[]).concat(lt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function lt(o,e,t){var n,a,r=0,i=lt.prefilters.length,s=S.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=Ze||at(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:S.extend({},e),opts:S.extend(!0,{specialEasing:{},easing:S.easing._default},t),originalProperties:e,originalOptions:t,startTime:Ze||at(),duration:t.duration,tweens:[],createTween:function(e,t){var n=S.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=X(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=S.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=lt.prefilters[r].call(l,o,c,l.opts))return m(n.stop)&&(S._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return S.map(c,ut,l),m(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),S.fx.timer(S.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}S.Animation=S.extend(lt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return se(n.elem,e,te.exec(t),n),n}]},tweener:function(e,t){m(e)?(t=e,e=["*"]):e=e.match(P);for(var n,r=0,i=e.length;r<i;r++)n=e[r],lt.tweeners[n]=lt.tweeners[n]||[],lt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ae(e),v=Y.get(e,"fxshow");for(r in n.queue||(null==(a=S._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,S.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],rt.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||S.style(e,r)}if((u=!S.isEmptyObject(t))||!S.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=Y.get(e,"display")),"none"===(c=S.css(e,"display"))&&(l?c=l:(le([e],!0),l=e.style.display||l,c=S.css(e,"display"),le([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===S.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=Y.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&le([e],!0),p.done(function(){for(r in g||le([e]),Y.remove(e,"fxshow"),d)S.style(e,r,d[r])})),u=ut(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?lt.prefilters.unshift(e):lt.prefilters.push(e)}}),S.speed=function(e,t,n){var r=e&&"object"==typeof e?S.extend({},e):{complete:n||!n&&t||m(e)&&e,duration:e,easing:n&&t||t&&!m(t)&&t};return S.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in S.fx.speeds?r.duration=S.fx.speeds[r.duration]:r.duration=S.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){m(r.old)&&r.old.call(this),r.queue&&S.dequeue(this,r.queue)},r},S.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=S.isEmptyObject(t),o=S.speed(e,n,r),a=function(){var e=lt(this,S.extend({},t),o);(i||Y.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=S.timers,r=Y.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&it.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||S.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=Y.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=S.timers,o=n?n.length:0;for(t.finish=!0,S.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),S.each(["toggle","show","hide"],function(e,r){var i=S.fn[r];S.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(st(r,!0),e,t,n)}}),S.each({slideDown:st("show"),slideUp:st("hide"),slideToggle:st("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){S.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),S.timers=[],S.fx.tick=function(){var e,t=0,n=S.timers;for(Ze=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||S.fx.stop(),Ze=void 0},S.fx.timer=function(e){S.timers.push(e),S.fx.start()},S.fx.interval=13,S.fx.start=function(){et||(et=!0,ot())},S.fx.stop=function(){et=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(r,e){return r=S.fx&&S.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=C.setTimeout(e,r);t.stop=function(){C.clearTimeout(n)}})},tt=E.createElement("input"),nt=E.createElement("select").appendChild(E.createElement("option")),tt.type="checkbox",y.checkOn=""!==tt.value,y.optSelected=nt.selected,(tt=E.createElement("input")).value="t",tt.type="radio",y.radioValue="t"===tt.value;var ct,ft=S.expr.attrHandle;S.fn.extend({attr:function(e,t){return $(this,S.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){S.removeAttr(this,e)})}}),S.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?S.prop(e,t,n):(1===o&&S.isXMLDoc(e)||(i=S.attrHooks[t.toLowerCase()]||(S.expr.match.bool.test(t)?ct:void 0)),void 0!==n?null===n?void S.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=S.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!y.radioValue&&"radio"===t&&A(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(P);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),ct={set:function(e,t,n){return!1===t?S.removeAttr(e,n):e.setAttribute(n,n),n}},S.each(S.expr.match.bool.source.match(/\w+/g),function(e,t){var a=ft[t]||S.find.attr;ft[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=ft[o],ft[o]=r,r=null!=a(e,t,n)?o:null,ft[o]=i),r}});var pt=/^(?:input|select|textarea|button)$/i,dt=/^(?:a|area)$/i;function ht(e){return(e.match(P)||[]).join(" ")}function gt(e){return e.getAttribute&&e.getAttribute("class")||""}function vt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(P)||[]}S.fn.extend({prop:function(e,t){return $(this,S.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[S.propFix[e]||e]})}}),S.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&S.isXMLDoc(e)||(t=S.propFix[t]||t,i=S.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=S.find.attr(e,"tabindex");return t?parseInt(t,10):pt.test(e.nodeName)||dt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),y.optSelected||(S.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),S.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){S.propFix[this.toLowerCase()]=this}),S.fn.extend({addClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).addClass(t.call(this,e,gt(this)))});if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){a=0;while(o=e[a++])r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},removeClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).removeClass(t.call(this,e,gt(this)))});if(!arguments.length)return this.attr("class","");if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){a=0;while(o=e[a++])while(-1<r.indexOf(" "+o+" "))r=r.replace(" "+o+" "," ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},toggleClass:function(i,t){var o=typeof i,a="string"===o||Array.isArray(i);return"boolean"==typeof t&&a?t?this.addClass(i):this.removeClass(i):m(i)?this.each(function(e){S(this).toggleClass(i.call(this,e,gt(this),t),t)}):this.each(function(){var e,t,n,r;if(a){t=0,n=S(this),r=vt(i);while(e=r[t++])n.hasClass(e)?n.removeClass(e):n.addClass(e)}else void 0!==i&&"boolean"!==o||((e=gt(this))&&Y.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===i?"":Y.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+ht(gt(n))+" ").indexOf(t))return!0;return!1}});var yt=/\r/g;S.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=m(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,S(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=S.map(t,function(e){return null==e?"":e+""})),(r=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=S.valHooks[t.type]||S.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(yt,""):null==e?"":e:void 0}}),S.extend({valHooks:{option:{get:function(e){var t=S.find.attr(e,"value");return null!=t?t:ht(S.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!A(n.parentNode,"optgroup"))){if(t=S(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=S.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<S.inArray(S.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),S.each(["radio","checkbox"],function(){S.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<S.inArray(S(e).val(),t)}},y.checkOn||(S.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),y.focusin="onfocusin"in C;var mt=/^(?:focusinfocus|focusoutblur)$/,xt=function(e){e.stopPropagation()};S.extend(S.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||E],d=v.call(e,"type")?e.type:e,h=v.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||E,3!==n.nodeType&&8!==n.nodeType&&!mt.test(d+S.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[S.expando]?e:new S.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:S.makeArray(t,[e]),c=S.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!x(n)){for(s=c.delegateType||d,mt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||E)&&p.push(a.defaultView||a.parentWindow||C)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(Y.get(o,"events")||Object.create(null))[e.type]&&Y.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&V(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!V(n)||u&&m(n[d])&&!x(n)&&((a=n[u])&&(n[u]=null),S.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,xt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,xt),S.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=S.extend(new S.Event,n,{type:e,isSimulated:!0});S.event.trigger(r,null,t)}}),S.fn.extend({trigger:function(e,t){return this.each(function(){S.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return S.event.trigger(e,t,n,!0)}}),y.focusin||S.each({focus:"focusin",blur:"focusout"},function(n,r){var i=function(e){S.event.simulate(r,e.target,S.event.fix(e))};S.event.special[r]={setup:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r);t||e.addEventListener(n,i,!0),Y.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r)-1;t?Y.access(e,r,t):(e.removeEventListener(n,i,!0),Y.remove(e,r))}}});var bt=C.location,wt={guid:Date.now()},Tt=/\?/;S.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new C.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||S.error("Invalid XML: "+(n?S.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t};var Ct=/\[\]$/,Et=/\r?\n/g,St=/^(?:submit|button|image|reset|file)$/i,kt=/^(?:input|select|textarea|keygen)/i;function At(n,e,r,i){var t;if(Array.isArray(e))S.each(e,function(e,t){r||Ct.test(n)?i(n,t):At(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==w(e))i(n,e);else for(t in e)At(n+"["+t+"]",e[t],r,i)}S.param=function(e,t){var n,r=[],i=function(e,t){var n=m(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!S.isPlainObject(e))S.each(e,function(){i(this.name,this.value)});else for(n in e)At(n,e[n],t,i);return r.join("&")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=S.prop(this,"elements");return e?S.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!S(this).is(":disabled")&&kt.test(this.nodeName)&&!St.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=S(this).val();return null==n?null:Array.isArray(n)?S.map(n,function(e){return{name:t.name,value:e.replace(Et,"\r\n")}}):{name:t.name,value:n.replace(Et,"\r\n")}}).get()}});var Nt=/%20/g,jt=/#.*$/,Dt=/([?&])_=[^&]*/,qt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Lt=/^(?:GET|HEAD)$/,Ht=/^\/\//,Ot={},Pt={},Rt="*/".concat("*"),Mt=E.createElement("a");function It(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(P)||[];if(m(t))while(n=i[r++])"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Wt(t,i,o,a){var s={},u=t===Pt;function l(e){var r;return s[e]=!0,S.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function Ft(e,t){var n,r,i=S.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&S.extend(!0,e,r),e}Mt.href=bt.href,S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:bt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(bt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Rt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ft(Ft(e,S.ajaxSettings),t):Ft(S.ajaxSettings,e)},ajaxPrefilter:It(Ot),ajaxTransport:It(Pt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=S.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?S(y):S.event,x=S.Deferred(),b=S.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=qt.exec(p))n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2])}t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||bt.href)+"").replace(Ht,bt.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(P)||[""],null==v.crossDomain){r=E.createElement("a");try{r.href=v.url,r.href=r.href,v.crossDomain=Mt.protocol+"//"+Mt.host!=r.protocol+"//"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=S.param(v.data,v.traditional)),Wt(Ot,v,t,T),h)return T;for(i in(g=S.event&&v.global)&&0==S.active++&&S.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Lt.test(v.type),f=v.url.replace(jt,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(Nt,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(Tt.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(Dt,"$1"),o=(Tt.test(f)?"&":"?")+"_="+wt.guid+++o),v.url=f+o),v.ifModified&&(S.lastModified[f]&&T.setRequestHeader("If-Modified-Since",S.lastModified[f]),S.etag[f]&&T.setRequestHeader("If-None-Match",S.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+Rt+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Wt(Pt,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=C.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&C.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),!i&&-1<S.inArray("script",v.dataTypes)&&S.inArray("json",v.dataTypes)<0&&(v.converters["text script"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(S.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(S.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--S.active||S.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return S.get(e,t,n,"json")},getScript:function(e,t){return S.get(e,void 0,t,"script")}}),S.each(["get","post"],function(e,i){S[i]=function(e,t,n,r){return m(t)&&(r=r||n,n=t,t=void 0),S.ajax(S.extend({url:e,type:i,dataType:r,data:t,success:n},S.isPlainObject(e)&&e))}}),S.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),S._evalUrl=function(e,t,n){return S.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){S.globalEval(e,t,n)}})},S.fn.extend({wrapAll:function(e){var t;return this[0]&&(m(e)&&(e=e.call(this[0])),t=S(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return m(n)?this.each(function(e){S(this).wrapInner(n.call(this,e))}):this.each(function(){var e=S(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=m(t);return this.each(function(e){S(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){S(this).replaceWith(this.childNodes)}),this}}),S.expr.pseudos.hidden=function(e){return!S.expr.pseudos.visible(e)},S.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},S.ajaxSettings.xhr=function(){try{return new C.XMLHttpRequest}catch(e){}};var Bt={0:200,1223:204},$t=S.ajaxSettings.xhr();y.cors=!!$t&&"withCredentials"in $t,y.ajax=$t=!!$t,S.ajaxTransport(function(i){var o,a;if(y.cors||$t&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(Bt[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&C.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),S.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),S.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return S.globalEval(e),e}}}),S.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),S.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=S("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),E.head.appendChild(r[0])},abort:function(){i&&i()}}});var _t,zt=[],Ut=/(=)\?(?=&|$)|\?\?/;S.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=zt.pop()||S.expando+"_"+wt.guid++;return this[e]=!0,e}}),S.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Ut.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ut.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Ut,"$1"+r):!1!==e.jsonp&&(e.url+=(Tt.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||S.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=C[r],C[r]=function(){o=arguments},n.always(function(){void 0===i?S(C).removeProp(r):C[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,zt.push(r)),o&&m(i)&&i(o[0]),o=i=void 0}),"script"}),y.createHTMLDocument=((_t=E.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===_t.childNodes.length),S.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(y.createHTMLDocument?((r=(t=E.implementation.createHTMLDocument("")).createElement("base")).href=E.location.href,t.head.appendChild(r)):t=E),o=!n&&[],(i=N.exec(e))?[t.createElement(i[1])]:(i=xe([e],t,o),o&&o.length&&S(o).remove(),S.merge([],i.childNodes)));var r,i,o},S.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=ht(e.slice(s)),e=e.slice(0,s)),m(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&S.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?S("<div>").append(S.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},S.expr.pseudos.animated=function(t){return S.grep(S.timers,function(e){return t===e.elem}).length},S.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=S.css(e,"position"),c=S(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=S.css(e,"top"),u=S.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),m(t)&&(t=t.call(e,n,S.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},S.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){S.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===S.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===S.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=S(e).offset()).top+=S.css(e,"borderTopWidth",!0),i.left+=S.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-S.css(r,"marginTop",!0),left:t.left-i.left-S.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===S.css(e,"position"))e=e.offsetParent;return e||re})}}),S.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;S.fn[t]=function(e){return $(this,function(e,t,n){var r;if(x(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),S.each(["top","left"],function(e,n){S.cssHooks[n]=Fe(y.pixelPosition,function(e,t){if(t)return t=We(e,n),Pe.test(t)?S(e).position()[n]+"px":t})}),S.each({Height:"height",Width:"width"},function(a,s){S.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){S.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return $(this,function(e,t,n){var r;return x(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?S.css(e,t,i):S.style(e,t,n,i)},s,n?e:void 0,n)}})}),S.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){S.fn[t]=function(e){return this.on(t,e)}}),S.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),S.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){S.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var Xt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;S.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),m(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||S.guid++,i},S.holdReady=function(e){e?S.readyWait++:S.ready(!0)},S.isArray=Array.isArray,S.parseJSON=JSON.parse,S.nodeName=A,S.isFunction=m,S.isWindow=x,S.camelCase=X,S.type=w,S.now=Date.now,S.isNumeric=function(e){var t=S.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},S.trim=function(e){return null==e?"":(e+"").replace(Xt,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return S});var Vt=C.jQuery,Gt=C.$;return S.noConflict=function(e){return C.$===S&&(C.$=Gt),e&&C.jQuery===S&&(C.jQuery=Vt),S},"undefined"==typeof e&&(C.jQuery=C.$=S),S});
;
jQuery.noConflict();
/*! jQuery Color v@2.1.2 http://github.com/jquery/jquery-color | jquery.org/license */
(function(a,b){function m(a,b,c){var d=h[b.type]||{};return a==null?c||!b.def?null:b.def:(a=d.floor?~~a:parseFloat(a),isNaN(a)?b.def:d.mod?(a+d.mod)%d.mod:0>a?0:d.max<a?d.max:a)}function n(b){var c=f(),d=c._rgba=[];return b=b.toLowerCase(),l(e,function(a,e){var f,h=e.re.exec(b),i=h&&e.parse(h),j=e.space||"rgba";if(i)return f=c[j](i),c[g[j].cache]=f[g[j].cache],d=c._rgba=f._rgba,!1}),d.length?(d.join()==="0,0,0,0"&&a.extend(d,k.transparent),c):k[b]}function o(a,b,c){return c=(c+1)%1,c*6<1?a+(b-a)*c*6:c*2<1?b:c*3<2?a+(b-a)*(2/3-c)*6:a}var c="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",d=/^([\-+])=\s*(\d+\.?\d*)/,e=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1]*2.55,a[2]*2.55,a[3]*2.55,a[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(a){return[a[1],a[2]/100,a[3]/100,a[4]]}}],f=a.Color=function(b,c,d,e){return new a.Color.fn.parse(b,c,d,e)},g={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},h={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},i=f.support={},j=a("<p>")[0],k,l=a.each;j.style.cssText="background-color:rgba(1,1,1,.5)",i.rgba=j.style.backgroundColor.indexOf("rgba")>-1,l(g,function(a,b){b.cache="_"+a,b.props.alpha={idx:3,type:"percent",def:1}}),f.fn=a.extend(f.prototype,{parse:function(c,d,e,h){if(c===b)return this._rgba=[null,null,null,null],this;if(c.jquery||c.nodeType)c=a(c).css(d),d=b;var i=this,j=a.type(c),o=this._rgba=[];d!==b&&(c=[c,d,e,h],j="array");if(j==="string")return this.parse(n(c)||k._default);if(j==="array")return l(g.rgba.props,function(a,b){o[b.idx]=m(c[b.idx],b)}),this;if(j==="object")return c instanceof f?l(g,function(a,b){c[b.cache]&&(i[b.cache]=c[b.cache].slice())}):l(g,function(b,d){var e=d.cache;l(d.props,function(a,b){if(!i[e]&&d.to){if(a==="alpha"||c[a]==null)return;i[e]=d.to(i._rgba)}i[e][b.idx]=m(c[a],b,!0)}),i[e]&&a.inArray(null,i[e].slice(0,3))<0&&(i[e][3]=1,d.from&&(i._rgba=d.from(i[e])))}),this},is:function(a){var b=f(a),c=!0,d=this;return l(g,function(a,e){var f,g=b[e.cache];return g&&(f=d[e.cache]||e.to&&e.to(d._rgba)||[],l(e.props,function(a,b){if(g[b.idx]!=null)return c=g[b.idx]===f[b.idx],c})),c}),c},_space:function(){var a=[],b=this;return l(g,function(c,d){b[d.cache]&&a.push(c)}),a.pop()},transition:function(a,b){var c=f(a),d=c._space(),e=g[d],i=this.alpha()===0?f("transparent"):this,j=i[e.cache]||e.to(i._rgba),k=j.slice();return c=c[e.cache],l(e.props,function(a,d){var e=d.idx,f=j[e],g=c[e],i=h[d.type]||{};if(g===null)return;f===null?k[e]=g:(i.mod&&(g-f>i.mod/2?f+=i.mod:f-g>i.mod/2&&(f-=i.mod)),k[e]=m((g-f)*b+f,d))}),this[d](k)},blend:function(b){if(this._rgba[3]===1)return this;var c=this._rgba.slice(),d=c.pop(),e=f(b)._rgba;return f(a.map(c,function(a,b){return(1-d)*e[b]+d*a}))},toRgbaString:function(){var b="rgba(",c=a.map(this._rgba,function(a,b){return a==null?b>2?1:0:a});return c[3]===1&&(c.pop(),b="rgb("),b+c.join()+")"},toHslaString:function(){var b="hsla(",c=a.map(this.hsla(),function(a,b){return a==null&&(a=b>2?1:0),b&&b<3&&(a=Math.round(a*100)+"%"),a});return c[3]===1&&(c.pop(),b="hsl("),b+c.join()+")"},toHexString:function(b){var c=this._rgba.slice(),d=c.pop();return b&&c.push(~~(d*255)),"#"+a.map(c,function(a){return a=(a||0).toString(16),a.length===1?"0"+a:a}).join("")},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString()}}),f.fn.parse.prototype=f.fn,g.hsla.to=function(a){if(a[0]==null||a[1]==null||a[2]==null)return[null,null,null,a[3]];var b=a[0]/255,c=a[1]/255,d=a[2]/255,e=a[3],f=Math.max(b,c,d),g=Math.min(b,c,d),h=f-g,i=f+g,j=i*.5,k,l;return g===f?k=0:b===f?k=60*(c-d)/h+360:c===f?k=60*(d-b)/h+120:k=60*(b-c)/h+240,h===0?l=0:j<=.5?l=h/i:l=h/(2-i),[Math.round(k)%360,l,j,e==null?1:e]},g.hsla.from=function(a){if(a[0]==null||a[1]==null||a[2]==null)return[null,null,null,a[3]];var b=a[0]/360,c=a[1],d=a[2],e=a[3],f=d<=.5?d*(1+c):d+c-d*c,g=2*d-f;return[Math.round(o(g,f,b+1/3)*255),Math.round(o(g,f,b)*255),Math.round(o(g,f,b-1/3)*255),e]},l(g,function(c,e){var g=e.props,h=e.cache,i=e.to,j=e.from;f.fn[c]=function(c){i&&!this[h]&&(this[h]=i(this._rgba));if(c===b)return this[h].slice();var d,e=a.type(c),k=e==="array"||e==="object"?c:arguments,n=this[h].slice();return l(g,function(a,b){var c=k[e==="object"?a:b.idx];c==null&&(c=n[b.idx]),n[b.idx]=m(c,b)}),j?(d=f(j(n)),d[h]=n,d):f(n)},l(g,function(b,e){if(f.fn[b])return;f.fn[b]=function(f){var g=a.type(f),h=b==="alpha"?this._hsla?"hsla":"rgba":c,i=this[h](),j=i[e.idx],k;return g==="undefined"?j:(g==="function"&&(f=f.call(this,j),g=a.type(f)),f==null&&e.empty?this:(g==="string"&&(k=d.exec(f),k&&(f=j+parseFloat(k[2])*(k[1]==="+"?1:-1))),i[e.idx]=f,this[h](i)))}})}),f.hook=function(b){var c=b.split(" ");l(c,function(b,c){a.cssHooks[c]={set:function(b,d){var e,g,h="";if(d!=="transparent"&&(a.type(d)!=="string"||(e=n(d)))){d=f(e||d);if(!i.rgba&&d._rgba[3]!==1){g=c==="backgroundColor"?b.parentNode:b;while((h===""||h==="transparent")&&g&&g.style)try{h=a.css(g,"backgroundColor"),g=g.parentNode}catch(j){}d=d.blend(h&&h!=="transparent"?h:"_default")}d=d.toRgbaString()}try{b.style[c]=d}catch(j){}}},a.fx.step[c]=function(b){b.colorInit||(b.start=f(b.elem,c),b.end=f(b.end),b.colorInit=!0),a.cssHooks[c].set(b.elem,b.start.transition(b.end,b.pos))}})},f.hook(c),a.cssHooks.borderColor={expand:function(a){var b={};return l(["Top","Right","Bottom","Left"],function(c,d){b["border"+d+"Color"]=a}),b}},k=a.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}})(jQuery);
/**
 * Copyright (c) 2007-2015 Ariel Flesler - aflesler<a>gmail<d>com | http://flesler.blogspot.com
 * Licensed under MIT
 * @author Ariel Flesler
 * @version 2.1.2
 */
;(function(f){"use strict";"function"===typeof define&&define.amd?define(["jquery"],f):"undefined"!==typeof module&&module.exports?module.exports=f(require("jquery")):f(jQuery)})(function($){"use strict";function n(a){return!a.nodeName||-1!==$.inArray(a.nodeName.toLowerCase(),["iframe","#document","html","body"])}function h(a){return $.isFunction(a)||$.isPlainObject(a)?a:{top:a,left:a}}var p=$.scrollTo=function(a,d,b){return $(window).scrollTo(a,d,b)};p.defaults={axis:"xy",duration:0,limit:!0};$.fn.scrollTo=function(a,d,b){"object"=== typeof d&&(b=d,d=0);"function"===typeof b&&(b={onAfter:b});"max"===a&&(a=9E9);b=$.extend({},p.defaults,b);d=d||b.duration;var u=b.queue&&1<b.axis.length;u&&(d/=2);b.offset=h(b.offset);b.over=h(b.over);return this.each(function(){function k(a){var k=$.extend({},b,{queue:!0,duration:d,complete:a&&function(){a.call(q,e,b)}});r.animate(f,k)}if(null!==a){var l=n(this),q=l?this.contentWindow||window:this,r=$(q),e=a,f={},t;switch(typeof e){case "number":case "string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(e)){e= h(e);break}e=l?$(e):$(e,q);case "object":if(e.length===0)return;if(e.is||e.style)t=(e=$(e)).offset()}var v=$.isFunction(b.offset)&&b.offset(q,e)||b.offset;$.each(b.axis.split(""),function(a,c){var d="x"===c?"Left":"Top",m=d.toLowerCase(),g="scroll"+d,h=r[g](),n=p.max(q,c);t?(f[g]=t[m]+(l?0:h-r.offset()[m]),b.margin&&(f[g]-=parseInt(e.css("margin"+d),10)||0,f[g]-=parseInt(e.css("border"+d+"Width"),10)||0),f[g]+=v[m]||0,b.over[m]&&(f[g]+=e["x"===c?"width":"height"]()*b.over[m])):(d=e[m],f[g]=d.slice&& "%"===d.slice(-1)?parseFloat(d)/100*n:d);b.limit&&/^\d+$/.test(f[g])&&(f[g]=0>=f[g]?0:Math.min(f[g],n));!a&&1<b.axis.length&&(h===f[g]?f={}:u&&(k(b.onAfterFirst),f={}))});k(b.onAfter)}})};p.max=function(a,d){var b="x"===d?"Width":"Height",h="scroll"+b;if(!n(a))return a[h]-$(a)[b.toLowerCase()]();var b="client"+b,k=a.ownerDocument||a.document,l=k.documentElement,k=k.body;return Math.max(l[h],k[h])-Math.min(l[b],k[b])};$.Tween.propHooks.scrollLeft=$.Tween.propHooks.scrollTop={get:function(a){return $(a.elem)[a.prop]()}, set:function(a){var d=this.get(a);if(a.options.interrupt&&a._last&&a._last!==d)return $(a.elem).stop();var b=Math.round(a.now);d!==b&&($(a.elem)[a.prop](b),a._last=this.get(a))}};return p});
/*
 Sticky-kit v1.1.3 | MIT | Leaf Corcoran 2015 | http://leafo.net
*/
(function(){var c,f;c=window.jQuery;f=c(window);c.fn.stick_in_parent=function(b){var A,w,J,n,B,K,p,q,L,k,E,t;null==b&&(b={});t=b.sticky_class;B=b.inner_scrolling;E=b.recalc_every;k=b.parent;q=b.offset_top;p=b.spacer;w=b.bottoming;null==q&&(q=0);null==k&&(k=void 0);null==B&&(B=!0);null==t&&(t="is_stuck");A=c(document);null==w&&(w=!0);L=function(a){var b;return window.getComputedStyle?(a=window.getComputedStyle(a[0]),b=parseFloat(a.getPropertyValue("width"))+parseFloat(a.getPropertyValue("margin-left"))+
parseFloat(a.getPropertyValue("margin-right")),"border-box"!==a.getPropertyValue("box-sizing")&&(b+=parseFloat(a.getPropertyValue("border-left-width"))+parseFloat(a.getPropertyValue("border-right-width"))+parseFloat(a.getPropertyValue("padding-left"))+parseFloat(a.getPropertyValue("padding-right"))),b):a.outerWidth(!0)};J=function(a,b,n,C,F,u,r,G){var v,H,m,D,I,d,g,x,y,z,h,l;if(!a.data("sticky_kit")){a.data("sticky_kit",!0);I=A.height();g=a.parent();null!=k&&(g=g.closest(k));if(!g.length)throw"failed to find stick parent";
v=m=!1;(h=null!=p?p&&a.closest(p):c("<div />"))&&h.css("position",a.css("position"));x=function(){var d,f,e;if(!G&&(I=A.height(),d=parseInt(g.css("border-top-width"),10),f=parseInt(g.css("padding-top"),10),b=parseInt(g.css("padding-bottom"),10),n=g.offset().top+d+f,C=g.height(),m&&(v=m=!1,null==p&&(a.insertAfter(h),h.detach()),a.css({position:"",top:"",width:"",bottom:""}).removeClass(t),e=!0),F=a.offset().top-(parseInt(a.css("margin-top"),10)||0)-q,u=a.outerHeight(!0),r=a.css("float"),h&&h.css({width:L(a),
height:u,display:a.css("display"),"vertical-align":a.css("vertical-align"),"float":r}),e))return l()};x();if(u!==C)return D=void 0,d=q,z=E,l=function(){var c,l,e,k;if(!G&&(e=!1,null!=z&&(--z,0>=z&&(z=E,x(),e=!0)),e||A.height()===I||x(),e=f.scrollTop(),null!=D&&(l=e-D),D=e,m?(w&&(k=e+u+d>C+n,v&&!k&&(v=!1,a.css({position:"fixed",bottom:"",top:d}).trigger("sticky_kit:unbottom"))),e<F&&(m=!1,d=q,null==p&&("left"!==r&&"right"!==r||a.insertAfter(h),h.detach()),c={position:"",width:"",top:""},a.css(c).removeClass(t).trigger("sticky_kit:unstick")),
B&&(c=f.height(),u+q>c&&!v&&(d-=l,d=Math.max(c-u,d),d=Math.min(q,d),m&&a.css({top:d+"px"})))):e>F&&(m=!0,c={position:"fixed",top:d},c.width="border-box"===a.css("box-sizing")?a.outerWidth()+"px":a.width()+"px",a.css(c).addClass(t),null==p&&(a.after(h),"left"!==r&&"right"!==r||h.append(a)),a.trigger("sticky_kit:stick")),m&&w&&(null==k&&(k=e+u+d>C+n),!v&&k)))return v=!0,"static"===g.css("position")&&g.css({position:"relative"}),a.css({position:"absolute",bottom:b,top:"auto"}).trigger("sticky_kit:bottom")},
y=function(){x();return l()},H=function(){G=!0;f.off("touchmove",l);f.off("scroll",l);f.off("resize",y);c(document.body).off("sticky_kit:recalc",y);a.off("sticky_kit:detach",H);a.removeData("sticky_kit");a.css({position:"",bottom:"",top:"",width:""});g.position("position","");if(m)return null==p&&("left"!==r&&"right"!==r||a.insertAfter(h),h.remove()),a.removeClass(t)},f.on("touchmove",l),f.on("scroll",l),f.on("resize",y),c(document.body).on("sticky_kit:recalc",y),a.on("sticky_kit:detach",H),setTimeout(l,
0)}};n=0;for(K=this.length;n<K;n++)b=this[n],J(c(b));return this}}).call(this);
;
/**
 * jBox is a jQuery plugin that makes it easy to create customizable tooltips, modal windows, image galleries and more.
 *
 * Author: Stephan Wagner (https://stephanwagner.me)
 *
 * License: MIT (https://opensource.org/licenses/MIT)
 *
 * Requires: jQuery 3.2.1 (https://code.jquery.com/jquery-3.2.1.min.js)
 *
 * Documentation: https://stephanwagner.me/jBox/documentation
 *
 * Demos: https://stephanwagner.me/jBox/demos
 */


// AMD and CommonJS support: http://ifandelse.com/its-not-hard-making-your-library-support-amd-and-commonjs

(function (root, factory) {
  
  // AMD support

  if (typeof define === 'function' && define.amd) {
    
    define(['jquery'], function(jQuery) {
      return (root.jBox = factory(jQuery));
    });
  
  // CommonJS support
  
  } else if (typeof module === 'object' && module.exports) {
    
    module.exports = (root.jBox = factory(require('jquery')));
  
  // Browser
  
  } else {
    
    root.jBox = factory(root.jQuery);
    
  }

}(this, function (jQuery) {
    
    
  // The actual jBox plugin starts here
    
  var jBox = function jBox(type, options) {
    
    
    // Options (https://stephanwagner.me/jBox/options)
    
    this.options = {
      
      // jBox ID
      id: null,                    // Choose a unique id, otherwise jBox will set one for you (jBox1, jBox2, ...)
      
      // Dimensions
      width: 'auto',               // The width of the content area, e.g. 'auto', 200, '80%'
      height: 'auto',              // The height of the content area
      minWidth: null,              // Minimal width
      minHeight: null,             // Minimal height
      maxWidth: null,              // Maximal width
      maxHeight: null,             // Maximal height
      
      // Responsive dimensions
      responsiveWidth: true,       // Adjusts the width to fit the viewport
      responsiveHeight: true,      // Adjusts the height to fit the viewport
      responsiveMinWidth: 100,     // Don't adjust width below this value (in pixel)
      responsiveMinHeight: 100,    // Don't adjust height below this value (in pixel)
      
      // Attach
      attach: null,                // A jQuery selector to elements that will open and close your jBox, e.g. '.tooltip'
      trigger: 'click',            // The event to open or close your jBox, use 'click', 'touchclick' or 'mouseenter'
      preventDefault: false,       // Prevent the default event when opening jBox, e.g. don't follow the href in a link
      
      // Content
      content: null,               // You can use HTML or a jQuery element, e.g. jQuery('#jBox-content'). The elements will be appended to the content element and then made visible, so hide them with style="display: none" beforehand
      getContent: null,            // Get the content from an attribute when jBox opens, e.g. getContent: 'data-content'. Use 'html' to get the attached elements HTML as content
      title: null,                 // Adds a title to your jBox
      getTitle: null,              // Get the title from an attribute when jBox opens, e.g. getTitle: 'data-title'
      footer: null,                // Adds a footer to your jBox
      isolateScroll: true,         // Isolates scrolling to the content container
      
      // AJAX
      ajax: {                      // Setting an URL will make an AJAX request when jBox opens. Optional you can add any jQuery AJAX option (http://api.jquery.com/jquery.ajax/)
        url: null,                 // The URL to send the AJAX request to
        data: '',                  // Data to send with your AJAX request, e.g. {id: 82, limit: 10}
        reload: false,             // Resend the AJAX request when jBox opens. Use true to send the AJAX request only once for every attached element or 'strict' to resend every time jBox opens
        getURL: 'data-url',        // The attribute in the source element where the AJAX request will look for the URL, e.g. data-url="https://ajaxresponse.com"
        getData: 'data-ajax',      // The attribute in the source element where the AJAX request will look for the data, e.g. data-ajax="id=82&limit=10"
        setContent: true,          // Automatically set the response as new content when the AJAX request is finished
        spinner: true,             // Hides the current content and adds a spinner while loading. You can pass HTML content to add your own spinner, e.g. spinner: '<div class="mySpinner"></div>'
        spinnerDelay: 300,         // Milliseconds to wait until spinner appears
        spinnerReposition: true    // Repositions jBox when the spinner is added or removed
      },
      
      // Position
      followMouse: false,          // open in mouse position

      target: null,                // The jQuery selector to the target element where jBox will be opened. If no element is found, jBox will use the attached element as target
      position: {
        x: 'center',               // Horizontal position, use a number, 'left', 'right' or 'center'
        y: 'center'                // Vertical position, use a number, 'top', 'bottom' or 'center'
      },
      outside: null,               // Use 'x', 'y', or 'xy' to move your jBox outside of the target element
      offset: 0,                   // Offset to final position, you can set different values for x and y with an object, e.g. {x: 20, y: 10}
      attributes: {                // Note that attributes can only be 'left' or 'right' when using numbers for position, e.g. {x: 300, y: 20}
        x: 'left',                 // Horizontal position, use 'left' or 'right'
        y: 'top'                   // Vertical position, use 'top' or 'bottom'
      },
      fixed: false,                // Your jBox will stay on position when scrolling
      adjustPosition: true,        // Adjusts your jBoxes position if there is not enough space, use 'flip', 'move' or true for both. This option overrides the reposition options
      adjustTracker: false,        // By default jBox adjusts its position when it opens or when the window size changes, set to true to also adjust when scrolling
      adjustDistance: 5,           // The minimal distance to the viewport edge while adjusting. Use an object to set different values, e.g. {top: 50, right: 5, bottom: 20, left: 5}
      reposition: true,            // Calculates new position when the window-size changes
      repositionOnOpen: true,      // Calculates new position each time jBox opens (rather than only when it opens the first time)
      repositionOnContent: true,   // Calculates new position when the content changes with .setContent() or .setTitle()
      
      // Pointer
      pointer: false,              // Your pointer will always point towards the target element, so the option outside needs to be 'x' or 'y'. By default the pointer is centered, set a position to move it to any side. You can also add an offset, e.g. 'left:30' or 'center:-20'
      pointTo: 'target',           // Setting something else than 'target' will add a pointer even if there is no target element set or found. Use 'top', 'right', 'bottom' or 'left'
      
      // Animations
      fade: 180,                   // Fade duration in ms, set to 0 or false to disable
      animation: null,             // Animation when opening or closing, use 'pulse', 'zoomIn', 'zoomOut', 'move', 'slide', 'flip', 'tada' (CSS inspired from Daniel Edens Animate.css: http://daneden.me/animate)
      
      // Appearance
      theme: 'Default',            // Set a jBox theme class
      addClass: null,              // Adds classes to the wrapper
      overlay: false,              // Adds an overlay to hide page content when jBox opens (adjust color and opacity with CSS)
      zIndex: 10000,               // Use a high z-index
      
      // Delays
      delayOpen: 0,                // Delay opening in ms. Note that the delay will be ignored if your jBox didn't finish closing
      delayClose: 0,               // Delay closing in ms. Nnote that there is always a closing delay of at least 10ms to ensure jBox won't be closed when opening right away
      
      // Closing
      closeOnEsc: false,           // Close jBox when pressing [esc] key
      closeOnClick: false,         // Close jBox with mouseclick. Use true (click anywhere), 'box' (click on jBox itself), 'overlay' (click on the overlay), 'body' (click anywhere but jBox)
      closeOnMouseleave: false,    // Close jBox when the mouse leaves the jBox area or the area of the attached element
      closeButton: false,          // Adds a close button to your jBox. Use 'title', 'box', 'overlay' or true (true will add the button to the overlay, title or the jBox itself, in that order if any of those elements can be found)
      
      // Other options
      appendTo: jQuery('body'),    // The element your jBox will be appended to. Any other element than jQuery('body') is only useful for fixed positions or when position values are numbers
      createOnInit: false,         // Creates jBox and makes it available in DOM when it's being initialized, otherwise it will be created when it opens for the first time
      blockScroll: false,          // Blocks scrolling when jBox is open
      draggable: false,            // Make your jBox draggable (use 'true', 'title' or provide an element as handle) (inspired from Chris Coyiers CSS-Tricks http://css-tricks.com/snippets/jquery/draggable-without-jquery-ui/)
      dragOver: true,              // When you have multiple draggable jBoxes, the one you select will always move over the other ones
      autoClose: false,            // Time in ms when jBox will close automatically after it was opened
      delayOnHover: false,         // Delay auto-closing while mouse is hovered
      showCountdown: false,        // Display a nice progress-indicator when autoClose is enabled
      
      // Audio                     // You can use the integrated audio function whenever you'd like to play an audio file, e.g. onInit: function () { this.audio('url_to_audio_file_without_file_extension', 75); }
      preloadAudio: true,          // Preloads the audio files set in option audio. You can also preload other audio files, e.g. ['src_to_file.mp3', 'src_to_file.ogg']
      audio: null,                 // The URL to an audio file to play when jBox opens. Set the URL without file extension, jBox will look for an .mp3 and .ogg file. To play audio when jBox closes, use an object, e.g. {open: 'src_to_audio1', close: 'src_to_audio2'}
      volume: 100,                 // The volume in percent. To have different volumes for opening and closeing, use an object, e.g. {open: 75, close: 100}
      
      // Events                    // Note that you can use 'this' in all event functions, it refers to your jBox object (e.g. onInit: function () { this.open(); })
      onInit: null,                // Fired when jBox is initialized
      onAttach: null,              // Fired when jBox attached itself to elements, the attached element will be passed as a parameter, e.g. onAttach: function (element) { element.css({color: 'red'}); }
      onPosition: null,            // Fired when jBox is positioned
      onCreated: null,             // Fired when jBox is created and availible in DOM
      onOpen: null,                // Fired when jBox opens
      onClose: null,               // Fired when jBox closes
      onCloseComplete: null        // Fired when jBox is completely closed (when fading is finished)
    };
    
    
    // Default plugin options
    
    this._pluginOptions = {
      
      // Default options for tooltips
      'Tooltip': {
        getContent: 'title',
        trigger: 'mouseenter',
        position: {
          x: 'center',
          y: 'top'
        },
        outside: 'y',
        pointer: true
      },
      
      // Default options for mouse tooltips
      'Mouse': {
        responsiveWidth: false,
        responsiveHeight: false,
        adjustPosition: 'flip',
        target: 'mouse',
        trigger: 'mouseenter',
        position: {
          x: 'right',
          y: 'bottom'
        },
        outside: 'xy',
        offset: 5
      },
      
      // Default options for modal windows
      'Modal': {
        target: jQuery(window),
        fixed: true,
        blockScroll: true,
        closeOnEsc: true,
        closeOnClick: 'overlay',
        closeButton: true,
        overlay: true,
        animation: 'zoomIn'
      },
    };
    
    
    // Merge options
    
    this.options = jQuery.extend(true, this.options, this._pluginOptions[type] ? this._pluginOptions[type] : jBox._pluginOptions[type], options);
    
    
    // Set the jBox type
    
    jQuery.type(type) == 'string' && (this.type = type);
    
    
    // Local function to fire events
    
    this._fireEvent = function (event, pass)
    {
      this.options['_' + event] && (this.options['_' + event].bind(this))(pass);
      this.options[event] && (this.options[event].bind(this))(pass);
    };
    
    
    // Get a unique jBox ID
    
    this.options.id === null && (this.options.id = 'jBox' + jBox._getUniqueID());
    this.id = this.options.id;
    
    
    // Correct impossible options
    
    ((this.options.position.x == 'center' && this.options.outside == 'x') || (this.options.position.y == 'center' && this.options.outside == 'y')) && (this.options.outside = null);
    this.options.pointTo == 'target' && (!this.options.outside || this.options.outside == 'xy') && (this.options.pointer = false);
    
    
    // Correct multiple choice options
    
    jQuery.type(this.options.offset) != 'object' ? (this.options.offset = {x: this.options.offset, y: this.options.offset}) : (this.options.offset = jQuery.extend({x: 0, y: 0}, this.options.offset));
    jQuery.type(this.options.adjustDistance) != 'object' ? (this.options.adjustDistance = {top: this.options.adjustDistance, right: this.options.adjustDistance, bottom: this.options.adjustDistance, left: this.options.adjustDistance}) : (this.options.adjustDistance = jQuery.extend({top: 5, left: 5, right: 5, bottom: 5}, this.options.adjustDistance));
    
    
    // Save default outside position
    
    this.outside = this.options.outside && this.options.outside != 'xy' ? this.options.position[this.options.outside] : false;
    
    
    // Save where the jBox is aligned to
    
    this.align = this.outside ? this.outside : (this.options.position.y != 'center' && jQuery.type(this.options.position.y) != 'number' ? this.options.position.x : (this.options.position.x != 'center' && jQuery.type(this.options.position.x) != 'number' ? this.options.position.y : this.options.attributes.x));
    
    
    // Internal positioning functions
    
    this._getOpp = function (opp) { return {left: 'right', right: 'left', top: 'bottom', bottom: 'top', x: 'y', y: 'x'}[opp]; };
    this._getXY = function (xy) { return {left: 'x', right: 'x', top: 'y', bottom: 'y', center: 'x'}[xy]; };
    this._getTL = function (tl) { return {left: 'left', right: 'left', top: 'top', bottom: 'top', center: 'left', x: 'left', y: 'top'}[tl]; };
    
    
    // Get a dimension value in integer pixel dependent on appended element
    
    this._getInt = function (value, dimension) {
      if (value == 'auto') return 'auto';
      if (value && jQuery.type(value) == 'string' && value.slice(-1) == '%') {
        return jQuery(window)[dimension == 'height' ? 'innerHeight' : 'innerWidth']() * parseInt(value.replace('%', '')) / 100;
      }
      return value;
    };
    
    
    // Create an svg element
    
    this._createSVG = function (type, options)
    {
      var svg = document.createElementNS('http://www.w3.org/2000/svg', type);
      jQuery.each(options, function (index, item) {
        svg.setAttribute(item[0], (item[1] || ''));
      });
      return svg;
    };
    
    
    // Isolate scrolling in a container
    
    this._isolateScroll = function (el)
    {
      // Abort if element not found
      if (!el || !el.length) return;
      
      el.on('DOMMouseScroll.jBoxIsolateScroll mousewheel.jBoxIsolateScroll', function (ev) {
        var delta = ev.wheelDelta || (ev.originalEvent && ev.originalEvent.wheelDelta) || -ev.detail;
        var overflowBottom = this.scrollTop + el.outerHeight() - this.scrollHeight >= 0;
        var overflowTop = this.scrollTop <= 0;
        ((delta < 0 && overflowBottom) || (delta > 0 && overflowTop)) && ev.preventDefault();
      });
    };
    
    
    // Set the title width to content width 
    
    this._setTitleWidth = function ()
    {
      // Abort if there is no title or width of content is auto
      if (!this.titleContainer || (this.content[0].style.width == 'auto' && !this.content[0].style.maxWidth)) return null;
      
      // Expose wrapper to get actual width
      if (this.wrapper.css('display') == 'none') {
        this.wrapper.css('display', 'block');
        var contentWidth = this.content.outerWidth();
        this.wrapper.css('display', 'none');
      } else {
        var contentWidth = this.content.outerWidth();
      }
      
      // Set max-width only
      this.titleContainer.css({maxWidth: (Math.max(contentWidth, parseInt(this.content[0].style.maxWidth)) || null)});
    }
    
    
    // Make jBox draggable
    
    this._draggable = function ()
    {
      // Abort if jBox is not draggable
      if (!this.options.draggable) return false;
      
      // Get the handle where jBox will be dragged with
      var handle = this.options.draggable == 'title' ? this.titleContainer : (this.options.draggable instanceof jQuery ? this.options.draggable : (jQuery.type(this.options.draggable) == 'string' ? jQuery(this.options.draggable) : this.wrapper));
      
      // Abort if no handle or if draggable was set already
      if (!handle || !(handle instanceof jQuery) || !handle.length || handle.data('jBox-draggable')) return false;
      
      // Add mouse events
      handle.addClass('jBox-draggable').data('jBox-draggable', true).on('mousedown', function (ev)
      {
        if (ev.button == 2 || jQuery(ev.target).hasClass('jBox-noDrag') || jQuery(ev.target).parents('.jBox-noDrag').length) return;
        
        // Adjust z-index when dragging jBox over another draggable jBox
        if (this.options.dragOver && this.wrapper.css('zIndex') <= jBox.zIndexMax) {
          jBox.zIndexMax += 1;
          this.wrapper.css('zIndex', jBox.zIndexMax);
        }
        
        var drg_h = this.wrapper.outerHeight();
        var drg_w = this.wrapper.outerWidth();
        var pos_y = this.wrapper.offset().top + drg_h - ev.pageY;
        var pos_x = this.wrapper.offset().left + drg_w - ev.pageX;
        
        jQuery(document).on('mousemove.jBox-draggable-' + this.id, function (ev) {
          this.wrapper.offset({
            top: ev.pageY + pos_y - drg_h,
            left: ev.pageX + pos_x - drg_w
          });
        }.bind(this));
        ev.preventDefault();
        
      }.bind(this)).on('mouseup', function () { jQuery(document).off('mousemove.jBox-draggable-' + this.id); }.bind(this));
      
      // Get highest z-index
      jBox.zIndexMax = !jBox.zIndexMax ? this.options.zIndex : Math.max(jBox.zIndexMax, this.options.zIndex);
      
      
      
      return this;
    };
    
    // Create jBox
    
    this._create = function ()
    {
      // Abort if jBox was created already
      if (this.wrapper) return;
      
      // Create wrapper
      this.wrapper = jQuery('<div/>', {
        id: this.id,
        'class': 'jBox-wrapper' + (this.type ? ' jBox-' + this.type : '') + (this.options.theme ? ' jBox-' + this.options.theme : '') + (this.options.addClass ? ' ' + this.options.addClass : '')
      }).css({
        position: (this.options.fixed ? 'fixed' : 'absolute'),
        display: 'none',
        opacity: 0,
        zIndex: this.options.zIndex
        
        // Save the jBox instance in the wrapper, so you can get access to your jBox when you only have the element
      }).data('jBox', this);
      
      // Add mouseleave event, only close jBox when the new target is not the source element
      this.options.closeOnMouseleave && this.wrapper.on('mouseleave', function (ev) {
        !this.source || !(ev.relatedTarget == this.source[0] || jQuery.inArray(this.source[0], jQuery(ev.relatedTarget).parents('*')) !== -1) && this.close();
      }.bind(this));
      
      // Add closeOnClick: 'box' events
      (this.options.closeOnClick == 'box') && this.wrapper.on('touchend click', function () { this.close({ignoreDelay: true}); }.bind(this));
      
      // Create container
      this.container = jQuery('<div class="jBox-container"/>').appendTo(this.wrapper);
      
      // Create content
      this.content = jQuery('<div class="jBox-content"/>').appendTo(this.container);
      
      // Create footer
      this.options.footer && (this.footer = jQuery('<div class="jBox-footer"/>').append(this.options.footer).appendTo(this.container));
      
      // Isolate scrolling
      this.options.isolateScroll && this._isolateScroll(this.content);
      
      // Create close button
      if (this.options.closeButton) {
        var closeButtonSVG = this._createSVG('svg', [['viewBox', '0 0 24 24']]);
        closeButtonSVG.appendChild(this._createSVG('path', [['d', 'M22.2,4c0,0,0.5,0.6,0,1.1l-6.8,6.8l6.9,6.9c0.5,0.5,0,1.1,0,1.1L20,22.3c0,0-0.6,0.5-1.1,0L12,15.4l-6.9,6.9c-0.5,0.5-1.1,0-1.1,0L1.7,20c0,0-0.5-0.6,0-1.1L8.6,12L1.7,5.1C1.2,4.6,1.7,4,1.7,4L4,1.7c0,0,0.6-0.5,1.1,0L12,8.5l6.8-6.8c0.5-0.5,1.1,0,1.1,0L22.2,4z']]));
        this.closeButton = jQuery('<div class="jBox-closeButton jBox-noDrag"/>').on('touchend click', function (ev) { this.close({ignoreDelay: true}); }.bind(this)).append(closeButtonSVG);
        
        // Add close button to jBox container
        if (this.options.closeButton == 'box' || (this.options.closeButton === true && !this.options.overlay && !this.options.title && !this.options.getTitle)) {
          this.wrapper.addClass('jBox-closeButton-box');
          this.closeButton.appendTo(this.container);
        }
      }
      
      // Append jBox to DOM
      this.wrapper.appendTo(this.options.appendTo);
      
      // Fix adjustDistance if there is a close button in the box
      this.wrapper.find('.jBox-closeButton').length &&  jQuery.each(['top', 'right', 'bottom', 'left'], function (index, pos) {
        this.wrapper.find('.jBox-closeButton').css(pos) && this.wrapper.find('.jBox-closeButton').css(pos) != 'auto' && (this.options.adjustDistance[pos] = Math.max(this.options.adjustDistance[pos], this.options.adjustDistance[pos] + (((parseInt(this.wrapper.find('.jBox-closeButton').css(pos)) || 0) + (parseInt(this.container.css('border-' + pos + '-width')) || 0)) * -1)));
      }.bind(this));
      
      // Create pointer
      if (this.options.pointer) {
        
        // Get pointer vars and save globally
        this.pointer = {
          position: (this.options.pointTo != 'target') ? this.options.pointTo : this._getOpp(this.outside),
          xy: (this.options.pointTo != 'target') ? this._getXY(this.options.pointTo) : this._getXY(this.outside),
          align: 'center',
          offset: 0
        };
        
        this.pointer.element = jQuery('<div class="jBox-pointer jBox-pointer-' + this.pointer.position + '"/>').appendTo(this.wrapper);
        this.pointer.dimensions = {
          x: this.pointer.element.outerWidth(),
          y: this.pointer.element.outerHeight()
        };
        
        if (jQuery.type(this.options.pointer) == 'string') {
          var split = this.options.pointer.split(':');
          split[0] && (this.pointer.align = split[0]);
          split[1] && (this.pointer.offset = parseInt(split[1]));
        }
        this.pointer.alignAttribute = (this.pointer.xy == 'x' ? (this.pointer.align == 'bottom' ? 'bottom' : 'top') : (this.pointer.align == 'right' ? 'right' : 'left'));
        
        // Set wrapper CSS
        this.wrapper.css('padding-' + this.pointer.position, this.pointer.dimensions[this.pointer.xy]);
        
        // Set pointer CSS
        this.pointer.element.css(this.pointer.alignAttribute, (this.pointer.align == 'center' ? '50%' : 0)).css('margin-' + this.pointer.alignAttribute, this.pointer.offset);
        this.pointer.margin = {};
        this.pointer.margin['margin-' + this.pointer.alignAttribute] = this.pointer.offset;
        
        // Add a transform to fix centered position
        (this.pointer.align == 'center') && this.pointer.element.css('transform', 'translate(' + (this.pointer.xy == 'y' ? (this.pointer.dimensions.x * -0.5 + 'px') : 0) + ', ' + (this.pointer.xy == 'x' ? (this.pointer.dimensions.y * -0.5 + 'px') : 0) + ')');
        
        this.pointer.element.css((this.pointer.xy == 'x' ? 'width' : 'height'), parseInt(this.pointer.dimensions[this.pointer.xy]) + parseInt(this.container.css('border-' + this.pointer.alignAttribute + '-width')));
        
        // Add class to wrapper for CSS access
        this.wrapper.addClass('jBox-pointerPosition-' + this.pointer.position);
      }
      
      // Set title and content
      this.setContent(this.options.content, true);
      this.setTitle(this.options.title, true);
      
      this.options.draggable && this._draggable();
      
      // Fire onCreated event
      this._fireEvent('onCreated');
    };
    
    
    // Create jBox onInit
    
    this.options.createOnInit && this._create();
    
    
    // Attach jBox
    
    this.options.attach && this.attach();
    
    
    // Attach document and window events
    
    this._attachEvents = function ()
    {
      // Closing event: closeOnEsc
      this.options.closeOnEsc && jQuery(document).on('keyup.jBox-' + this.id, function (ev) { if (ev.keyCode == 27) { this.close({ignoreDelay: true}); }}.bind(this));
      
      // Closing event: closeOnClick
      if (this.options.closeOnClick === true || this.options.closeOnClick == 'body') {
        jQuery(document).on('touchend.jBox-' + this.id + ' click.jBox-' + this.id, function (ev) {
          if (this.blockBodyClick || (this.options.closeOnClick == 'body' && (ev.target == this.wrapper[0] || this.wrapper.has(ev.target).length))) return;
          this.close({ignoreDelay: true});
        }.bind(this));
      }
      
      // Cancel countdown on mouseenter if delayOnHover
      this.options.delayOnHover && jQuery('#' + this.id).on('mouseenter', function (ev) { this.isHovered = true; }.bind(this));
      // Resume countdown on mouseleave if delayOnHover
      this.options.delayOnHover && jQuery('#' + this.id).on('mouseleave', function (ev) { this.isHovered = false; }.bind(this));
      
      // Positioning events
      if ((this.options.adjustPosition || this.options.reposition) && !this.fixed && this.outside) {
        
        // Trigger position events when scrolling
        this.options.adjustTracker && jQuery(window).on('scroll.jBox-' + this.id, function (ev) { this.position(); }.bind(this));
        
        // Trigger position events when resizing
        (this.options.adjustPosition || this.options.reposition) && jQuery(window).on('resize.jBox-' + this.id, function (ev) { this.position(); }.bind(this));
      }
      
      // Mousemove events
      this.options.target == 'mouse' && jQuery('body').on('mousemove.jBox-' + this.id, function (ev) { this.position({mouseTarget: {top: ev.pageY, left: ev.pageX}}); }.bind(this));
    };
    
    
    // Detach document and window events
    
    this._detachEvents = function ()
    {
      // Closing event: closeOnEsc
      this.options.closeOnEsc && jQuery(document).off('keyup.jBox-' + this.id);
      
      // Closing event: closeOnClick
      (this.options.closeOnClick === true || this.options.closeOnClick == 'body') && jQuery(document).off('touchend.jBox-' + this.id + ' click.jBox-' + this.id);
      
      // Positioning events
      this.options.adjustTracker && jQuery(window).off('scroll.jBox-' + this.id);
      (this.options.adjustPosition || this.options.reposition) && jQuery(window).off('resize.jBox-' + this.id);
      
      // Mousemove events
      this.options.target == 'mouse' && jQuery('body').off('mousemove.jBox-' + this.id);
    };
    
    
    // Show overlay
    
    this._showOverlay = function ()
    {
      // Create the overlay if wasn't created already
      if (!this.overlay) {
        
        // Create element and append to the element where jBox is appended to
        this.overlay = jQuery('<div id="' + this.id + '-overlay"/>').addClass('jBox-overlay' + (this.type ? ' jBox-overlay-' + this.type : '')).css({
          display: 'none',
          opacity: 0,
          zIndex: this.options.zIndex - 1
        }).appendTo(this.options.appendTo);
        
        // Add close button to overlay
        (this.options.closeButton == 'overlay' || this.options.closeButton === true) && this.overlay.append(this.closeButton);
        
        // Add closeOnClick: 'overlay' events
        this.options.closeOnClick == 'overlay' && this.overlay.on('touchend click', function () { this.close({ignoreDelay: true}); }.bind(this));
        
        // Adjust option adjustDistance if there is a close button in the overlay
        jQuery('#' + this.id + '-overlay .jBox-closeButton').length && (this.options.adjustDistance.top = Math.max(jQuery('#' + this.id + '-overlay .jBox-closeButton').outerHeight(), this.options.adjustDistance.top));
      }
      
      // Abort if overlay is already visible
      if (this.overlay.css('display') == 'block') return;
      
      // Show overlay
      this.options.fade ? (this.overlay.stop() && this.overlay.animate({opacity: 1}, {
        queue: false,
        duration: this.options.fade,
        start: function () { this.overlay.css({display: 'block'}); }.bind(this)
      })) : this.overlay.css({display: 'block', opacity: 1});
    };
    
    
    // Hide overlay
    
    this._hideOverlay = function ()
    {
      // Abort if the overlay wasn't created yet
      if (!this.overlay) return;
      
      // Hide overlay if no other jBox needs it
      this.options.fade ? (this.overlay.stop() && this.overlay.animate({opacity: 0}, {
        queue: false,
        duration: this.options.fade,
        complete: function () { this.overlay.css({display: 'none'}); }.bind(this)
      })) : this.overlay.css({display: 'none', opacity: 0});
    };
    
    
    // Get the correct jBox dimensions by moving jBox out of viewport
    
    this._exposeDimensions = function ()
    {
      // Move wrapper out of viewport
      this.wrapper.css({
        top: -10000,
        left: -10000,
        right: 'auto',
        bottom: 'auto'
      });
    
      // Get jBox dimensions
      var jBoxDimensions = {
        x: this.wrapper.outerWidth(),
        y: this.wrapper.outerHeight()
      };
      
      // Reset position to viewport
      this.wrapper.css({
        top: 'auto',
        left: 'auto'
      });
      
      return jBoxDimensions;
    };
    
    
    // Generate CSS for animations and append to header
    
    this._generateAnimationCSS = function ()
    {
      // Get open and close animations if none provided
      (jQuery.type(this.options.animation) != 'object') && (this.options.animation = {
        pulse: {open: 'pulse', close: 'zoomOut'},
        zoomIn: {open: 'zoomIn', close: 'zoomIn'},
        zoomOut: {open: 'zoomOut', close: 'zoomOut'},
        move: {open: 'move', close: 'move'},
        slide: {open: 'slide', close: 'slide'},
        flip: {open: 'flip', close: 'flip'},
        tada: {open: 'tada', close: 'zoomOut'}
      }[this.options.animation]);
      
      // Abort if animation not found
      if (!this.options.animation) return null;
      
      // Get direction var
      this.options.animation.open && (this.options.animation.open = this.options.animation.open.split(':'));
      this.options.animation.close && (this.options.animation.close = this.options.animation.close.split(':'));
      this.options.animation.openDirection = this.options.animation.open[1] ? this.options.animation.open[1] : null;
      this.options.animation.closeDirection = this.options.animation.close[1] ? this.options.animation.close[1] : null;
      this.options.animation.open && (this.options.animation.open = this.options.animation.open[0]);
      this.options.animation.close && (this.options.animation.close = this.options.animation.close[0]);
      
      // Add 'Open' and 'Close' to animation names
      this.options.animation.open && (this.options.animation.open += 'Open');
      this.options.animation.close && (this.options.animation.close += 'Close');
      
      // All animations
      var animations = {
        pulse: {
          duration: 350,
          css: [['0%', 'scale(1)'], ['50%', 'scale(1.1)'], ['100%', 'scale(1)']]
        },
        zoomInOpen: {
          duration: (this.options.fade || 180),
          css: [['0%', 'scale(0.9)'], ['100%', 'scale(1)']]
        },
        zoomInClose: {
          duration: (this.options.fade || 180),
          css: [['0%', 'scale(1)'], ['100%', 'scale(0.9)']]
        },
        zoomOutOpen: {
          duration: (this.options.fade || 180),
          css: [['0%', 'scale(1.1)'], ['100%', 'scale(1)']]
        },
        zoomOutClose: {
          duration: (this.options.fade || 180),
          css: [['0%', 'scale(1)'], ['100%', 'scale(1.1)']]
        },
        moveOpen: {
          duration: (this.options.fade || 180),
          positions: {top: {'0%': -12}, right: {'0%': 12}, bottom: {'0%': 12}, left: {'0%': -12}},
          css: [['0%', 'translate%XY(%Vpx)'], ['100%', 'translate%XY(0px)']]
        },
        moveClose: {
          duration: (this.options.fade || 180),
          timing: 'ease-in',
          positions: {top: {'100%': -12}, right: {'100%': 12}, bottom: {'100%': 12}, left: {'100%': -12}},
          css: [['0%', 'translate%XY(0px)'], ['100%', 'translate%XY(%Vpx)']]
        },
        slideOpen: {
          duration: 400,
          positions: {top: {'0%': -400}, right: {'0%': 400}, bottom: {'0%': 400}, left: {'0%': -400}},
          css: [['0%', 'translate%XY(%Vpx)'], ['100%', 'translate%XY(0px)']]
        },
        slideClose: {
          duration: 400,
          timing: 'ease-in',
          positions: {top: {'100%': -400}, right: {'100%': 400}, bottom: {'100%': 400}, left: {'100%': -400}},
          css: [['0%', 'translate%XY(0px)'], ['100%', 'translate%XY(%Vpx)']]
        },
        flipOpen: {
          duration: 600,
          css: [['0%', 'perspective(400px) rotateX(90deg)'], ['40%', 'perspective(400px) rotateX(-15deg)'], ['70%', 'perspective(400px) rotateX(15deg)'], ['100%', 'perspective(400px) rotateX(0deg)']]
        },
        flipClose: {
          duration: (this.options.fade || 300),
          css: [['0%', 'perspective(400px) rotateX(0deg)'], ['100%', 'perspective(400px) rotateX(90deg)']]
        },
        tada: {
          duration: 800,
          css: [['0%', 'scale(1)'], ['10%, 20%', 'scale(0.9) rotate(-3deg)'], ['30%, 50%, 70%, 90%', 'scale(1.1) rotate(3deg)'], ['40%, 60%, 80%', 'scale(1.1) rotate(-3deg)'], ['100%', 'scale(1) rotate(0)']]
        }
      };
      
      // Set Open and Close names for standalone animations
      jQuery.each(['pulse', 'tada'], function (index, item) { animations[item + 'Open'] = animations[item + 'Close'] = animations[item]; });
      
      // Function to generate the CSS for the keyframes
      var generateKeyframeCSS = function (ev, position)
      {  
        // Generate keyframes CSS
        keyframe_css = '@keyframes jBox-' + this.id + '-animation-' + this.options.animation[ev] + '-' + ev + (position ? '-' + position : '') + ' {';
        jQuery.each(animations[this.options.animation[ev]].css, function (index, item) {
          var translate = position ? item[1].replace('%XY', this._getXY(position).toUpperCase()) : item[1];
          animations[this.options.animation[ev]].positions && (translate = translate.replace('%V', animations[this.options.animation[ev]].positions[position][item[0]]));
          keyframe_css += item[0] + ' {transform:' + translate + ';}';
        }.bind(this));
        keyframe_css += '}';
        
        // Generate class CSS
        keyframe_css += '.jBox-' + this.id + '-animation-' + this.options.animation[ev] + '-' + ev + (position ? '-' + position : '') + ' {';
        keyframe_css += 'animation-duration: ' + animations[this.options.animation[ev]].duration + 'ms;';
        keyframe_css += 'animation-name: jBox-' + this.id + '-animation-' + this.options.animation[ev] + '-' + ev + (position ? '-' + position : '') + ';';
        keyframe_css += animations[this.options.animation[ev]].timing ? ('animation-timing-function: ' + animations[this.options.animation[ev]].timing + ';') : '';
        keyframe_css += '}';
        
        return keyframe_css;
      }.bind(this);
      
      // Generate css for each event and positions
      this._animationCSS = '';
      jQuery.each(['open', 'close'], function (index, ev)
      {
        // No CSS needed for closing with no fade
        if (!this.options.animation[ev] || !animations[this.options.animation[ev]] || (ev == 'close' && !this.options.fade)) return '';
        
        // Generate CSS
        animations[this.options.animation[ev]].positions ?
          jQuery.each(['top', 'right', 'bottom', 'left'], function (index2, position) { this._animationCSS += generateKeyframeCSS(ev, position); }.bind(this)) :
          this._animationCSS += generateKeyframeCSS(ev);
      }.bind(this));
      
    };
    
    
    // Add css for animations
    
    this.options.animation && this._generateAnimationCSS();
    
    
    // Block body clicks for 10ms to prevent extra event triggering
    
    this._blockBodyClick = function ()
    {
      this.blockBodyClick = true;
      setTimeout(function () { this.blockBodyClick = false; }.bind(this), 10);
    };
    
    
    // Animations
    
    this._animate = function (ev)
    {
      // The event which triggers the animation
      !ev && (ev = this.isOpen ? 'open' : 'close');
      
      // Don't animate when closing with no fade duration
      if (!this.options.fade && ev == 'close') return null;
      
      // Get the current position, use opposite if jBox is flipped
      var animationDirection = (this.options.animation[ev + 'Direction'] || ((this.align != 'center') ? this.align : this.options.attributes.x));
      this.flipped && this._getXY(animationDirection) == (this._getXY(this.align)) && (animationDirection = this._getOpp(animationDirection));
      
      // Add event and position classes
      var classnames = 'jBox-' + this.id + '-animation-' + this.options.animation[ev] + '-' + ev + ' jBox-' + this.id + '-animation-' + this.options.animation[ev] + '-' + ev + '-' + animationDirection;
      this.wrapper.addClass(classnames);
      
      // Get duration of animation
      var animationDuration = parseFloat(this.wrapper.css('animation-duration')) * 1000;
      ev == 'close' && (animationDuration = Math.min(animationDuration, this.options.fade));
      
      // Remove animation classes when animation is finished
      setTimeout(function () { this.wrapper.removeClass(classnames); }.bind(this), animationDuration);
    };
    
    
    // Abort an animation
    
    this._abortAnimation = function ()
    {
      // Remove all animation classes
      var classes = this.wrapper.attr('class').split(' ').filter(function (c) {
        return c.lastIndexOf('jBox-' + this.id + '-animation', 0) !== 0;
      }.bind(this));
      this.wrapper.attr('class', classes.join(' '));
    };
    
    
    // Adjust dimensions when browser is resized
    
    if (this.options.responsiveWidth || this.options.responsiveHeight)
    {
      // Responsive positioning overrides options adjustPosition and reposition
      // TODO: Only add this resize event when the other one from adjustPosition and reposition was not set
      jQuery(window).on('resize.responsivejBox-' + this.id, function (ev) { if (this.isOpen) { this.position(); } }.bind(this));
    }
    
    
    // Fix audio options
    
    jQuery.type(this.options.preloadAudio) === 'string' && (this.options.preloadAudio = [this.options.preloadAudio]);
    jQuery.type(this.options.audio) === 'string' && (this.options.audio = {open: this.options.audio});
    jQuery.type(this.options.volume) === 'number' && (this.options.volume = {open: this.options.volume, close: this.options.volume});
    
    if (this.options.preloadAudio === true && this.options.audio) {
      this.options.preloadAudio = [];
      jQuery.each(this.options.audio, function (index, url) {
        this.options.preloadAudio.push(url + '.mp3');
        this.options.preloadAudio.push(url + '.ogg');
      }.bind(this));
    }
    
    
    // Preload audio files
    
    this.options.preloadAudio.length && jQuery.each(this.options.preloadAudio, function (index, url) {
      var audio = new Audio();
      audio.src = url;
      audio.preload = 'auto';
    });
    
    
    // Fire onInit event
    if (this.options.followMouse)
    {
      jQuery(document).on('mousemove', function(ev)
      {
        this.mouse = {x: ev.pageX, y: ev.pageY };
      }.bind(this));
    }

    
    this._fireEvent('onInit');
  
    
    return this;
  };
  
  
  // Attach jBox to elements
  
  jBox.prototype.attach = function (elements, trigger)
  {
    // Get elements from options if none passed
    !elements && (elements = this.options.attach);
    
    // Convert selectors to jQuery objects
    jQuery.type(elements) == 'string' && (elements = jQuery(elements));
    
    // Get trigger event from options if not passed
    !trigger && (trigger = this.options.trigger);
    
    // Loop through elements and attach jBox
    elements && elements.length && jQuery.each(elements, function (index, el) {
      el = jQuery(el);
      
      // Only attach if the element wasn't attached to this jBox already
      if (!el.data('jBox-attached-' + this.id)) {
        
        // Remove title attribute and store content on element
        (this.options.getContent == 'title' && el.attr('title') != undefined) && el.data('jBox-getContent', el.attr('title')).removeAttr('title');
        
        // Add Element to collection
        this.attachedElements || (this.attachedElements = []);
        this.attachedElements.push(el[0]);
        
        // Add click or mouseenter event, click events can prevent default as well
        el.on(trigger + '.jBox-attach-' + this.id, function (ev)
        {  
          // Clear timer
          this.timer && clearTimeout(this.timer);
          
          // Block opening when jbox is open and the source element is triggering
          if (trigger == 'mouseenter' && this.isOpen && this.source[0] == el[0]) return;
          
          // Only close jBox if you click the current target element, otherwise open at new target
          if (this.isOpen && this.source && this.source[0] != el[0]) var forceOpen = true;
          
          // Set new source element
          this.source = el;
          
          // Set new target
          !this.options.target && (this.target = el);
          
          // Prevent default action on click
          trigger == 'click' && this.options.preventDefault && ev.preventDefault();
          
          // Toggle or open jBox
          this[trigger == 'click' && !forceOpen ? 'toggle' : 'open']();
          
        }.bind(this));
        
        // Add close event for trigger event mouseenter
        (this.options.trigger == 'mouseenter') && el.on('mouseleave', function (ev)
        {
          // Abort if jBox wasn't created yet
          if (!this.wrapper) return null;
          
          // If we have set closeOnMouseleave, do not close jBox when leaving attached element and mouse is over jBox
          if (!this.options.closeOnMouseleave || !(ev.relatedTarget == this.wrapper[0] || jQuery(ev.relatedTarget).parents('#' + this.id).length)) this.close();
        }.bind(this));
        
        // Store 
        el.data('jBox-attached-' + this.id, trigger);
        
        // Fire onAttach event
        this._fireEvent('onAttach', el);
      }
      
    }.bind(this));
    
    return this;
  };
  
  
  // Detach jBox from elements
  
  jBox.prototype.detach = function (elements)
  {
    // Get elements from stores elements if none passed
    !elements && (elements = this.attachedElements || []);
    
    elements && elements.length && jQuery.each(elements, function (index, el) {
      el = jQuery(el);
      
      // Remove events
      if (el.data('jBox-attached-' + this.id)) {
        el.off(el.data('jBox-attached-' + this.id) + '.jBox-attach-' + this.id);
        el.data('jBox-attached-' + this.id, null);
      }
      // Remove element from collection
      this.attachedElements = jQuery.grep(this.attachedElements, function (value) {
        return value != el[0];
      });
    }.bind(this));
    
    return this;
  };
  
  
  // Set title
  
  jBox.prototype.setTitle = function (title, ignore_positioning)
  {
    // Abort if title to set
    if (title == null || title == undefined) return this;
    
    // Create jBox if it wasn't created already
    !this.wrapper && this._create();
    
    // Get the width and height of wrapper, only if they change we need to reposition
    var wrapperHeight = this.wrapper.outerHeight();
    var wrapperWidth = this.wrapper.outerWidth();
    
    // Create title elements if they weren't created already
    if (!this.title) {
      this.titleContainer = jQuery('<div class="jBox-title"/>');
      this.title = jQuery('<div/>').appendTo(this.titleContainer);
      this.wrapper.addClass('jBox-hasTitle');
      if (this.options.closeButton == 'title' || (this.options.closeButton === true && !this.options.overlay)) {
        this.wrapper.addClass('jBox-closeButton-title');
        this.closeButton.appendTo(this.titleContainer);
      }
      this.titleContainer.insertBefore(this.content);
      this._setTitleWidth();
    }
    this.title.html(title);
    
    // Adjust width of title
    wrapperWidth != this.wrapper.outerWidth() && this._setTitleWidth();
    
    // Make jBox draggable
    this.options.draggable && this._draggable();
    
    // Reposition if dimensions changed
    !ignore_positioning && this.options.repositionOnContent && (wrapperHeight != this.wrapper.outerHeight() || wrapperWidth != this.wrapper.outerWidth()) && this.position();
    
    return this;
  };
  
  
  // Set content
  
  jBox.prototype.setContent = function (content, ignore_positioning)
  {
    // Abort if no content to set
    if (content == null || content == undefined) return this;
    
    // Create jBox if it wasn't created already
    !this.wrapper && this._create();
    
    // Get the width and height of wrapper, only if they change we need to reposition
    var wrapperHeight = this.wrapper.outerHeight();
    var wrapperWidth = this.wrapper.outerWidth();
    
    // Move all appended containers to body
    this.content.children('[data-jbox-content-appended]').appendTo('body').css({display: 'none'});
    
    // Set the new content
    switch (jQuery.type(content)) {
      case 'string': this.content.html(content); break;
      case 'object': this.content.html(''); content.attr('data-jbox-content-appended', 1).appendTo(this.content).css({display: 'block'}); break;
     }
     
    // Adjust title width
    wrapperWidth != this.wrapper.outerWidth() && this._setTitleWidth();
    
    // Make jBox draggable
    this.options.draggable && this._draggable();
      
    // Reposition if dimensions changed
    !ignore_positioning && this.options.repositionOnContent && (wrapperHeight != this.wrapper.outerHeight() || wrapperWidth != this.wrapper.outerWidth()) && this.position();
    
    return this;
  };
  
  
  // Set jBox dimensions
  
  jBox.prototype.setDimensions = function (type, value, pos)
  {
    // Create jBox if it wasn't created already
    !this.wrapper && this._create();
    
    // Default value is 'auto'
    value == undefined && (value = 'auto');
    
    // Set CSS of content and title
    this.content.css(type, this._getInt(value));
    
    // Adjust title width
    type == 'width' && this._setTitleWidth();
    
    // Reposition by default
    (pos == undefined || pos) && this.position();
  };
  
  
  // Set jBox width or height
  
  jBox.prototype.setWidth = function (value, pos) { this.setDimensions('width', value, pos); };
  jBox.prototype.setHeight = function (value, pos) { this.setDimensions('height', value, pos); };
  
  
  // Position jBox
  
  jBox.prototype.position = function (options)
  {
    // Options are required
    !options && (options = {});
    
    // Combine passed options with jBox options
    options = jQuery.extend(true, this.options, options);
    
    // Get the target
    this.target = options.target || this.target || jQuery(window);
    
    // Make sure target is a jQuery element
    !(this.target instanceof jQuery || this.target == 'mouse') && (this.target = jQuery(this.target));
    
    // Abort if target is missing
    if (!this.target.length) return this;
    
    // Reset content css to get original dimensions
    this.content.css({
      width: this._getInt(options.width, 'width'),
      height: this._getInt(options.height, 'height'),
      minWidth: this._getInt(options.minWidth, 'width'),
      minHeight: this._getInt(options.minHeight, 'height'),
      maxWidth: this._getInt(options.maxWidth, 'width'),
      maxHeight: this._getInt(options.maxHeight, 'height'),
    });
    
    // Reset width of title
    this._setTitleWidth();
    
    // Get jBox dimensions
    var jBoxDimensions = this._exposeDimensions();
    
    // Check if target has fixed position, store in elements data
    this.target != 'mouse' && !this.target.data('jBox-' + this.id + '-fixed') && this.target.data('jBox-' + this.id + '-fixed', (this.target[0] != jQuery(window)[0] && (this.target.css('position') == 'fixed' || this.target.parents().filter(function () { return jQuery(this).css('position') == 'fixed'; }).length > 0)) ? 'fixed' : 'static');
    
    // Get the window dimensions
    var windowDimensions = {
      x: jQuery(window).outerWidth(),
      y: jQuery(window).outerHeight(),
      top: (options.fixed && this.target.data('jBox-' + this.id + '-fixed') ? 0 : jQuery(window).scrollTop()),
      left: (options.fixed && this.target.data('jBox-' + this.id + '-fixed') ? 0 : jQuery(window).scrollLeft())
    };
    windowDimensions.bottom = windowDimensions.top + windowDimensions.y;
    windowDimensions.right = windowDimensions.left + windowDimensions.x;
    
    // Get target offset
    try { var targetOffset = this.target.offset(); } catch (e) { var targetOffset = {top: 0, left: 0}; };
    
    // When the target is fixed and jBox is fixed, remove scroll offset
    if (this.target != 'mouse' && this.target.data('jBox-' + this.id + '-fixed') == 'fixed' && options.fixed) {
      targetOffset.top = targetOffset.top - jQuery(window).scrollTop();
      targetOffset.left = targetOffset.left - jQuery(window).scrollLeft();
    }
    
    // Get target dimensions
    var targetDimensions = {
      x: this.target == 'mouse' ? 12 : this.target.outerWidth(),
      y: this.target == 'mouse' ? 20 : this.target.outerHeight(),
      top: this.target == 'mouse' && options.mouseTarget ? options.mouseTarget.top : (targetOffset ? targetOffset.top : 0),
      left: this.target == 'mouse' && options.mouseTarget ? options.mouseTarget.left : (targetOffset ? targetOffset.left : 0)
    };
    
    // Check if jBox is outside
    var outside = options.outside && !(options.position.x == 'center' && options.position.y == 'center');
    
    // Get the available space on all sides
    var availableSpace = {
      x: windowDimensions.x - options.adjustDistance.left - options.adjustDistance.right, // TODO: substract position.x when they are numbers
      y: windowDimensions.y - options.adjustDistance.top - options.adjustDistance.bottom, // TODO: substract position.x when they are numbers
      left: !outside ? 0 : (targetDimensions.left - jQuery(window).scrollLeft() - options.adjustDistance.left),
      right: !outside ? 0 : (windowDimensions.x - targetDimensions.left + jQuery(window).scrollLeft() - targetDimensions.x - options.adjustDistance.right),
      top: !outside ? 0 : (targetDimensions.top - jQuery(window).scrollTop() - this.options.adjustDistance.top),
      bottom: !outside ? 0 : (windowDimensions.y - targetDimensions.top + jQuery(window).scrollTop() - targetDimensions.y - options.adjustDistance.bottom),
    };
    
    // Get the default outside position, check if box will be flipped
    var jBoxOutsidePosition = {
      x: (options.outside == 'x' || options.outside == 'xy') && jQuery.type(options.position.x) != 'number' ? options.position.x : null,
      y: (options.outside == 'y' || options.outside == 'xy') && jQuery.type(options.position.y) != 'number' ? options.position.y : null
    };
    var flip = {x: false, y: false};
    (jBoxOutsidePosition.x && jBoxDimensions.x > availableSpace[jBoxOutsidePosition.x] && availableSpace[this._getOpp(jBoxOutsidePosition.x)] > availableSpace[jBoxOutsidePosition.x]) && (jBoxOutsidePosition.x = this._getOpp(jBoxOutsidePosition.x)) && (flip.x = true);
    (jBoxOutsidePosition.y && jBoxDimensions.y > availableSpace[jBoxOutsidePosition.y] && availableSpace[this._getOpp(jBoxOutsidePosition.y)] > availableSpace[jBoxOutsidePosition.y]) && (jBoxOutsidePosition.y = this._getOpp(jBoxOutsidePosition.y)) && (flip.y = true);
    
    // Adjust responsive dimensions
    if (options.responsiveWidth || options.responsiveHeight) {
      
      // Adjust width and height according to default outside position
      var adjustResponsiveWidth = function ()
      {
        if (options.responsiveWidth && jBoxDimensions.x > availableSpace[jBoxOutsidePosition.x || 'x']) {
          var contentWidth = availableSpace[jBoxOutsidePosition.x || 'x'] - (this.pointer && outside && options.outside == 'x' ? this.pointer.dimensions.x : 0) - parseInt(this.container.css('border-left-width')) - parseInt(this.container.css('border-right-width'));
          this.content.css({
            width: contentWidth > this.options.responsiveMinWidth ? contentWidth : null,
            minWidth: contentWidth < parseInt(this.content.css('minWidth')) ? 0 : null
          });
          this._setTitleWidth();
        }
        jBoxDimensions = this._exposeDimensions();
        
      }.bind(this);
      options.responsiveWidth && adjustResponsiveWidth();
      
      // After adjusting width, check if jBox will be flipped for y
      options.responsiveWidth && !flip.y && (jBoxOutsidePosition.y && jBoxDimensions.y > availableSpace[jBoxOutsidePosition.y] && availableSpace[this._getOpp(jBoxOutsidePosition.y)] > availableSpace[jBoxOutsidePosition.y]) && (jBoxOutsidePosition.y = this._getOpp(jBoxOutsidePosition.y)) && (flip.y = true);
        
      // Adjust width and height according to default outside position
      var adjustResponsiveHeight = function ()
      {
        if (options.responsiveHeight && jBoxDimensions.y > availableSpace[jBoxOutsidePosition.y || 'y']) {
          
          // Expose wrapper to get correct title height
          var exposeTitleFooterHeight = function () {
            if (!this.titleContainer && !this.footer) return 0;
            if (this.wrapper.css('display') == 'none') {
              this.wrapper.css('display', 'block');
              var height = (this.titleContainer ? this.titleContainer.outerHeight() : 0) + (this.footer ? this.footer.outerHeight() : 0);
              this.wrapper.css('display', 'none');
            } else {
              var height = (this.titleContainer ? this.titleContainer.outerHeight() : 0) + (this.footer ? this.footer.outerHeight() : 0);
            }
            return height || 0;
          }.bind(this);
          
          var contentHeight = availableSpace[jBoxOutsidePosition.y || 'y'] - (this.pointer && outside && options.outside == 'y' ? this.pointer.dimensions.y : 0) - exposeTitleFooterHeight() - parseInt(this.container.css('border-top-width')) - parseInt(this.container.css('border-bottom-width'));
          this.content.css({height: contentHeight > this.options.responsiveMinHeight ? contentHeight : null});
          this._setTitleWidth();
        }
        jBoxDimensions = this._exposeDimensions();
        
      }.bind(this);
      options.responsiveHeight && adjustResponsiveHeight();
      
      // After adjusting height, check if jBox will be flipped for x
      options.responsiveHeight && !flip.x && (jBoxOutsidePosition.x && jBoxDimensions.x > availableSpace[jBoxOutsidePosition.x] && availableSpace[this._getOpp(jBoxOutsidePosition.x)] > availableSpace[jBoxOutsidePosition.x]) && (jBoxOutsidePosition.x = this._getOpp(jBoxOutsidePosition.x)) && (flip.x = true);
        
      // Adjust width and height if jBox will be flipped
      if (options.adjustPosition && options.adjustPosition != 'move') {
        flip.x && adjustResponsiveWidth();
        flip.y && adjustResponsiveHeight();
      }
    }
    
    // Store new positioning vars in local var
    var pos = {};
    
    // Calculate positions
    var setPosition = function (p)
    {
      // Set number positions
      if (jQuery.type(options.position[p]) == 'number') {
        pos[options.attributes[p]] = options.position[p];
        return;
      }
      
      // We have a target, so use 'left' or 'top' as attributes
      var a = options.attributes[p] = (p == 'x' ? 'left' : 'top');
      
      // Start at target position
      pos[a] = targetDimensions[a];
      
      // Set centered position
      if (options.position[p] == 'center') {

        if (options.followMouse)
        {
          pos[a] = Math.ceil(this.mouse[p] - jBoxDimensions[p] / 2);
        } else
        {
          pos[a] += Math.ceil((targetDimensions[p] - jBoxDimensions[p]) / 2);
        }
       
        // If the target is the window, adjust centered position depending on adjustDistance
        (this.target != 'mouse' && this.target[0] && this.target[0] == jQuery(window)[0]) && (pos[a] += (options.adjustDistance[a] - options.adjustDistance[this._getOpp(a)]) * 0.5);
        return;
      }
      
      if (options.followMouse)
      {
        pos[a] = this.mouse[p];

      } else
      {
        // Move inside
        (a != options.position[p]) && (pos[a] += targetDimensions[p] - jBoxDimensions[p]);
        
        // Move outside
        (options.outside == p || options.outside == 'xy') && (pos[a] += jBoxDimensions[p] * (a != options.position[p] ? 1 : -1));
      }
      
    }.bind(this);
    
    // Set position including offset
    setPosition('x');
    setPosition('y');
    
    // Adjust position depending on pointer align
    if (this.pointer && options.pointTo == 'target' && jQuery.type(options.position.x) != 'number' && jQuery.type(options.position.y) != 'number') {
      
      var adjustWrapper = 0;
      
      // Where is the pointer aligned? Add or substract accordingly
      switch (this.pointer.align) {
        case 'center':
        if (options.position[this._getOpp(options.outside)] != 'center') {
          adjustWrapper += (jBoxDimensions[this._getOpp(options.outside)] / 2);
        }
        break;
        default:
        switch (options.position[this._getOpp(options.outside)]) {
          case 'center':
            adjustWrapper += ((jBoxDimensions[this._getOpp(options.outside)] / 2) - (this.pointer.dimensions[this._getOpp(options.outside)] / 2)) * (this.pointer.align == this._getTL(this.pointer.align) ? 1 : -1);
          break;
          default:
            adjustWrapper += (this.pointer.align != options.position[this._getOpp(options.outside)]) ?
              
            // If pointer align is different to position align
            (this.dimensions[this._getOpp(options.outside)] * (jQuery.inArray(this.pointer.align, ['top', 'left']) !== -1 ? 1 : -1)) + ((this.pointer.dimensions[this._getOpp(options.outside)] / 2) * (jQuery.inArray(this.pointer.align, ['top', 'left']) !== -1 ? -1 : 1)) :
              
            // If pointer align is same as position align
            (this.pointer.dimensions[this._getOpp(options.outside)] / 2) * (jQuery.inArray(this.pointer.align, ['top', 'left']) !== -1 ? 1 : -1);
          break;
        }
        break;
      }
    
      adjustWrapper *= (options.position[this._getOpp(options.outside)] == this.pointer.alignAttribute ? -1 : 1);
      adjustWrapper += this.pointer.offset * (this.pointer.align == this._getOpp(this._getTL(this.pointer.align)) ? 1 : -1);
      
      pos[this._getTL(this._getOpp(this.pointer.xy))] += adjustWrapper;
    }
    
    // Add final offset
    pos[options.attributes.x] += options.offset.x;
    pos[options.attributes.y] += options.offset.y;
    
    // Set CSS
    this.wrapper.css(pos);
    
    // Adjust position
    if (options.adjustPosition) {
      
      // Reset cached pointer position
      if (this.positionAdjusted) {
        this.pointer && this.wrapper.css('padding', 0).css('padding-' + this._getOpp(this.outside), this.pointer.dimensions[this._getXY(this.outside)]).removeClass('jBox-pointerPosition-' + this._getOpp(this.pointer.position)).addClass('jBox-pointerPosition-' + this.pointer.position);
        this.pointer && this.pointer.element.attr('class', 'jBox-pointer jBox-pointer-' + this._getOpp(this.outside)).css(this.pointer.margin);
        this.positionAdjusted = false;
        this.flipped = false;
      }
      
      // Find out where the jBox is out of view area
      var outYT = (windowDimensions.top > pos.top - (options.adjustDistance.top || 0)),
        outXR = (windowDimensions.right < pos.left + jBoxDimensions.x + (options.adjustDistance.right || 0)),
        outYB = (windowDimensions.bottom < pos.top + jBoxDimensions.y + (options.adjustDistance.bottom || 0)),
        outXL = (windowDimensions.left > pos.left - (options.adjustDistance.left || 0)),
        outX = outXL ? 'left' : (outXR ? 'right' : null),
        outY = outYT ? 'top' : (outYB ? 'bottom' : null),
        out = outX || outY;
      
      // Only continue if jBox is out of view area
      if (out) {
        
        // Function to flip position
        var flipJBox = function (xy) {
          if (options.followMouse)
          {
            this.wrapper.css(this._getTL(xy), pos[this._getTL(xy)] + ((jBoxDimensions[this._getXY(xy)] + (options.offset[this._getXY(xy)] * (xy == 'top' || xy == 'left' ? -2 : 2))) * (xy == 'top' || xy == 'left' ? 1 : -1)));
          } else
          {
            this.wrapper.css(this._getTL(xy), pos[this._getTL(xy)] + ((jBoxDimensions[this._getXY(xy)] + (options.offset[this._getXY(xy)] * (xy == 'top' || xy == 'left' ? -2 : 2)) + targetDimensions[this._getXY(xy)]) * (xy == 'top' || xy == 'left' ? 1 : -1)));
          }
          
          this.pointer && this.wrapper.removeClass('jBox-pointerPosition-' + this.pointer.position).addClass('jBox-pointerPosition-' + this._getOpp(this.pointer.position)).css('padding', 0).css('padding-' + xy, this.pointer.dimensions[this._getXY(xy)]);
          this.pointer && this.pointer.element.attr('class', 'jBox-pointer jBox-pointer-' + xy);
          this.positionAdjusted = true;
          this.flipped = true;
        }.bind(this);
        
        // Flip jBox
        flip.x && flipJBox(this.options.position.x);
        flip.y && flipJBox(this.options.position.y);
        
        // Move jBox (only possible with pointer)
        var outMove = (this._getXY(this.outside) == 'x') ? outY : outX;
        
        if (this.pointer && options.pointTo == 'target' && options.adjustPosition != 'flip' && this._getXY(outMove) == this._getOpp(this._getXY(this.outside))) {
          
          // Get the maximum space we have availible to adjust
          if (this.pointer.align == 'center') {
            var spaceAvail = (jBoxDimensions[this._getXY(outMove)] / 2) - (this.pointer.dimensions[this._getOpp(this.pointer.xy)] / 2) - (parseInt(this.pointer.element.css('margin-' + this.pointer.alignAttribute)) * (outMove != this._getTL(outMove) ? -1 : 1));
          } else {
            var spaceAvail = (outMove == this.pointer.alignAttribute) ?
              parseInt(this.pointer.element.css('margin-' + this.pointer.alignAttribute)) :
              jBoxDimensions[this._getXY(outMove)] - parseInt(this.pointer.element.css('margin-' + this.pointer.alignAttribute)) - this.pointer.dimensions[this._getXY(outMove)];
          }
          
          // Get the overlapping space
          spaceDiff = (outMove == this._getTL(outMove)) ?
            windowDimensions[this._getTL(outMove)] - pos[this._getTL(outMove)] + options.adjustDistance[outMove] :
            (windowDimensions[this._getOpp(this._getTL(outMove))] - pos[this._getTL(outMove)] - options.adjustDistance[outMove] - jBoxDimensions[this._getXY(outMove)]) * -1;
            
          // Add overlapping space on left or top window edge
          if (outMove == this._getOpp(this._getTL(outMove)) && pos[this._getTL(outMove)] - spaceDiff < windowDimensions[this._getTL(outMove)] + options.adjustDistance[this._getTL(outMove)]) {
            spaceDiff -= windowDimensions[this._getTL(outMove)] + options.adjustDistance[this._getTL(outMove)] - (this.pos[this._getTL(outMove)] - spaceDiff);
          }
          
          // Only adjust the maximum availible
          spaceDiff = Math.min(spaceDiff, spaceAvail);
          
          // Move jBox
          if (spaceDiff <= spaceAvail && spaceDiff > 0) {
            this.pointer.element.css('margin-' + this.pointer.alignAttribute, parseInt(this.pointer.element.css('margin-' + this.pointer.alignAttribute)) - (spaceDiff * (outMove != this.pointer.alignAttribute ? -1 : 1)));
            this.wrapper.css(this._getTL(outMove), pos[this._getTL(outMove)] + (spaceDiff * (outMove != this._getTL(outMove) ? -1 : 1)));
            this.positionAdjusted = true;
          }
        }
      }
    }  
    
    // Fire onPosition event
    this._fireEvent('onPosition');
    
    return this;
  };
  
  
  // Open jBox
  
  jBox.prototype.open = function (options)
  {
    // Create blank options if none passed
    !options && (options = {});
    
    // Abort if jBox was destroyed
    if (this.isDestroyed) return false;
    
    // Construct jBox if not already constructed
    !this.wrapper && this._create();
    
    // Add css to header if not added already
    !this._styles && (this._styles = jQuery('<style/>').append(this._animationCSS).appendTo(jQuery('head')));
    
    // Abort any opening or closing timer
    this.timer && clearTimeout(this.timer);
    
    // Block body click for 10ms, so jBox can open on attached elements while closeOnClick = 'body'
    this._blockBodyClick();
    
    // Block opening
    if (this.isDisabled) return this;
    
    // Opening function
    var open = function () {
      
      // Set title from source element
      this.source && this.options.getTitle && (this.source.attr(this.options.getTitle) && this.setTitle(this.source.attr(this.options.getTitle)), true);
      
      // Set content from source element
      this.source && this.options.getContent && (this.source.data('jBox-getContent') ? this.setContent(this.source.data('jBox-getContent'), true) : (this.source.attr(this.options.getContent) ? this.setContent(this.source.attr(this.options.getContent), true) : (this.options.getContent == 'html' ? this.setContent(this.source.html(), true) : null)));
      
      // Fire onOpen event
      this._fireEvent('onOpen');
      
      // Get content from ajax
      if ((this.options.ajax && (this.options.ajax.url || (this.source && this.source.attr(this.options.ajax.getURL))) && (!this.ajaxLoaded || this.options.ajax.reload)) || (options.ajax && (options.ajax.url || options.ajax.data))) {
        // Send the content from stored data if there is any, otherwise load new data
        (this.options.ajax.reload != 'strict' && this.source && this.source.data('jBox-ajax-data') && !(options.ajax && (options.ajax.url || options.ajax.data))) ? this.setContent(this.source.data('jBox-ajax-data')) : this.ajax((options.ajax || null), true);
      }
      
      // Set position
      (!this.positionedOnOpen || this.options.repositionOnOpen) && this.position(options) && (this.positionedOnOpen = true);
      
      // Abort closing
      this.isClosing && this._abortAnimation();
      
      // Open functions to call when jBox is closed
      if (!this.isOpen) {
        
        // jBox is open now
        this.isOpen = true;
        
        // Automatically close jBox after some time
        this.options.autoClose && (this.options.delayClose = this.options.autoClose) && this.close();
        
        // Attach events
        this._attachEvents();
        
        // Block scrolling
        this.options.blockScroll && jQuery('body').addClass('jBox-blockScroll-' + this.id);
        
        // Show overlay
        this.options.overlay && this._showOverlay();
        
        // Only animate if jBox is completely closed
        this.options.animation && !this.isClosing && this._animate('open');
        
        // Play audio file
        this.options.audio && this.options.audio.open && this.audio(this.options.audio.open, this.options.volume.open);
        
        // Fading animation or show immediately
        if (this.options.fade) {
          this.wrapper.stop().animate({opacity: 1}, {
            queue: false,
            duration: this.options.fade,
            start: function () {
              this.isOpening = true;
              this.wrapper.css({display: 'block'});
            }.bind(this),
            always: function () {
              this.isOpening = false;
              
              // Delay positioning for ajax to prevent positioning during animation
              setTimeout(function () { this.positionOnFadeComplete && this.position() && (this.positionOnFadeComplete = false); }.bind(this), 10);
            }.bind(this)
          });
        } else {
          this.wrapper.css({display: 'block', opacity: 1});
          this.positionOnFadeComplete && this.position() && (this.positionOnFadeComplete = false);
        }
      }
    }.bind(this);
    
    // Open jBox
    this.options.delayOpen && !this.isOpen && !this.isClosing && !options.ignoreDelay ? (this.timer = setTimeout(open, this.options.delayOpen)) : open();
    
    return this;
  };
  
  
  // Close jBox
  
  jBox.prototype.close = function (options)
  {
    // Create blank options if none passed
    options || (options = {});
    
    // Abort if jBox was destroyed or is currently closing
    if (this.isDestroyed || this.isClosing) return false;
    
    // Abort opening
    this.timer && clearTimeout(this.timer);
    
    // Block body click for 10ms, so jBox can open on attached elements while closeOnClock = 'body' is true
    this._blockBodyClick();
    
    // Block closing
    if (this.isDisabled) return this;
    
    // Close function
    var close = function () {
      
      // Fire onClose event
      this._fireEvent('onClose');
      
      // Only close if jBox is open
      if (this.isOpen) {
        
        // jBox is not open anymore
        this.isOpen = false;
        
        // Detach events
        this._detachEvents();
        
        // Unblock scrolling
        this.options.blockScroll && jQuery('body').removeClass('jBox-blockScroll-' + this.id);
        
        // Hide overlay
        this.options.overlay && this._hideOverlay();
        
        // Only animate if jBox is compleately closed
        this.options.animation && !this.isOpening && this._animate('close');
        
        // Play audio file
        this.options.audio && this.options.audio.close && this.audio(this.options.audio.close, this.options.volume.close);
        
        // Fading animation or show immediately
        if (this.options.fade) {
          this.wrapper.stop().animate({opacity: 0}, {
            queue: false,
            duration: this.options.fade,
            start: function () {
              this.isClosing = true;
            }.bind(this),
            complete: function () {
              this.wrapper.css({display: 'none'});
              this._fireEvent('onCloseComplete');
            }.bind(this),
            always: function () {
              this.isClosing = false;
            }.bind(this)
          });
        } else {
          this.wrapper.css({display: 'none', opacity: 0});
          this._fireEvent('onCloseComplete');
        }
      }
    }.bind(this);
    
    // Close jBox
    if (options.ignoreDelay) {
      close();
    } else if ((this.options.delayOnHover || this.options.showCountdown) && this.options.delayClose > 10) {
      var self = this;
      var remaining = this.options.delayClose;
      var prevFrame = Date.now();
      if (this.options.showCountdown && !this.inner) {
        var outer = jQuery('<div class="jBox-countdown"></div>');
        this.inner = jQuery('<div class="jBox-countdown_inner"></div>');
        outer.prepend(this.inner);
        jQuery('#' + this.id).append(outer);
      }
      this.countdown = function(){
        var dateNow = Date.now();
        if (!self.isHovered) {
          remaining -= dateNow - prevFrame;
        }
        prevFrame = dateNow;
        if (remaining > 0) {
          if (self.options.showCountdown) {
            self.inner.css('width', (remaining * 100 / self.options.delayClose) + '%');
          }
          window.requestAnimationFrame(self.countdown);
        } else {
          close();
        }
      };
      window.requestAnimationFrame(this.countdown);
    } else {
      this.timer = setTimeout(close, Math.max(this.options.delayClose, 10));
    }
    
    return this;
  };
  
  
  // Open or close jBox
  
  jBox.prototype.toggle = function (options)
  {
    this[this.isOpen ? 'close' : 'open'](options);
    return this;
  };
  
  
  // Block opening and closing
  
  jBox.prototype.disable = function ()
  {
    this.isDisabled = true;
    return this;
  };
  
  
  // Unblock opening and closing
  
  jBox.prototype.enable = function ()
  {
    this.isDisabled = false;
    return this;
  };
  
  
  // Hide jBox
  
  jBox.prototype.hide = function ()
  {
    this.disable();
    this.wrapper && this.wrapper.css({display: 'none'});
    return this;
  };
  
  
  // Show jBox
  
  jBox.prototype.show = function ()
  {
    this.enable();
    this.wrapper && this.wrapper.css({display: 'block'});
    return this;
  };
  
  
  // Get content from ajax
  
  jBox.prototype.ajax = function (options, opening)
  {
    options || (options = {});
    
    // Add data or url from source element if none set in options
    jQuery.each([['getData', 'data'], ['getURL', 'url']], function (index, item) {
      (this.options.ajax[item[0]] && !options[item[1]] && this.source && this.source.attr(this.options.ajax[item[0]]) != undefined) && (options[item[1]] = this.source.attr(this.options.ajax[item[0]]) || '');
    }.bind(this));
    
    // Clone the system options
    var sysOptions = jQuery.extend(true, {}, this.options.ajax);
    
    // Abort running ajax call
    this.ajaxRequest && this.ajaxRequest.abort();
    
    // Extract events
    var beforeSend = options.beforeSend || sysOptions.beforeSend || function () {};
    var complete = options.complete || sysOptions.complete || function () {};
    var success = options.success || sysOptions.success || function () {};
    var error = options.error || sysOptions.error || function () {};
    
    // Merge options
    var userOptions = jQuery.extend(true, sysOptions, options);
    
    // Set new beforeSend event
    userOptions.beforeSend = function ()
    {
      // jBox is loading
      this.wrapper.addClass('jBox-loading');
      
      // Add loading spinner
      userOptions.spinner && (this.spinnerDelay = setTimeout(function ()
      {
        // If there is a dela
        this.wrapper.addClass('jBox-loading-spinner');
        
        // Reposition jBox
        // TODO: Only reposition if dimensions change
        userOptions.spinnerReposition && (opening ? (this.positionOnFadeComplete = true) : this.position());
        
        // Add spinner to container
        this.spinner = jQuery(userOptions.spinner !== true ? userOptions.spinner : '<div class="jBox-spinner"></div>').appendTo(this.container);
        
        // Fix spinners position if there is a title
        this.titleContainer && this.spinner.css('position') == 'absolute' && this.spinner.css({transform: 'translateY(' + (this.titleContainer.outerHeight() * 0.5) + 'px)'});
        
      }.bind(this), (this.content.html() == '' ? 0 : (userOptions.spinnerDelay || 0))));
      
      // Fire users beforeSend event
      (beforeSend.bind(this))();
      
    }.bind(this);
    
    // Set up new complete event
    userOptions.complete = function (response)
    {
      // Abort spinner timeout
      this.spinnerDelay && clearTimeout(this.spinnerDelay);
      
      // jBox finished loading
      this.wrapper.removeClass('jBox-loading jBox-loading-spinner jBox-loading-spinner-delay');
      
      // Remove spinner
      this.spinner && this.spinner.length && this.spinner.remove() && userOptions.spinnerReposition && (opening ? (this.positionOnFadeComplete = true) : this.position());
      
      // Store that ajax loading finished
      this.ajaxLoaded = true;
      
      // Fire users complete event
      (complete.bind(this))(response);
      
    }.bind(this);
    
    // Set up new success event
    userOptions.success = function (response)
    {
      // Set content
      userOptions.setContent && this.setContent(response, true) && (opening ? (this.positionOnFadeComplete = true) : this.position());
      
      // Store content in source element
      userOptions.setContent && this.source && this.source.data('jBox-ajax-data', response);
      
      // Fire users success event
      (success.bind(this))(response);
      
    }.bind(this);
    
    // Add error event
    userOptions.error = function (response) { (error.bind(this))(response); }.bind(this);
    
    // Send new ajax request
    this.ajaxRequest = jQuery.ajax(userOptions);
    
    return this;
  };
  
  
  // Play an audio file
  
  jBox.prototype.audio = function (url, volume)
  {
    // URL is required
    if (!url) return this;
    
    // Create intern audio object if it wasn't created already
    !jBox._audio && (jBox._audio = {});
    
    // Create an audio element specific to this audio file if it doesn't exist already
    if (!jBox._audio[url]) {
      var audio = jQuery('<audio/>');
      jQuery('<source/>', {src: url + '.mp3'}).appendTo(audio);
      jQuery('<source/>', {src: url + '.ogg'}).appendTo(audio);
      jBox._audio[url] = audio[0];
    }
    
    // Set volume
    jBox._audio[url].volume = Math.min(((volume != undefined ? volume : 100) / 100), 1);
    
    // Try to pause current audio
    try {
      jBox._audio[url].pause();
      jBox._audio[url].currentTime = 0;
    } catch (e) {}
    
    // Play audio
    jBox._audio[url].play();
    
    return this;
  };
  
  
  // Apply custom animations to jBox
  
  jBox._animationSpeeds = {
    'tada': 1000,
    'tadaSmall': 1000,
    'flash': 500,
    'shake': 400,
    'pulseUp': 250,
    'pulseDown': 250,
    'popIn': 250,
    'popOut': 250,
    'fadeIn': 200,
    'fadeOut': 200,
    'slideUp': 400,
    'slideRight': 400,
    'slideLeft': 400,
    'slideDown': 400
  };
  
  jBox.prototype.animate = function (animation, options)
  {
    // Options are required
    !options && (options = {});
    
    // Timout needs to be an object
    !this.animationTimeout && (this.animationTimeout = {});
    
    // Use jBox wrapper by default
    !options.element && (options.element = this.wrapper);
    
    // Give the element an unique id
    !options.element.data('jBox-animating-id') && options.element.data('jBox-animating-id', jBox._getUniqueElementID());
    
    // Abort if element is animating
    if (options.element.data('jBox-animating')) {
      options.element.removeClass(options.element.data('jBox-animating')).data('jBox-animating', null);
      this.animationTimeout[options.element.data('jBox-animating-id')] && clearTimeout(this.animationTimeout[options.element.data('jBox-animating-id')]);
    }
    
    // Animate the element
    options.element.addClass('jBox-animated-' + animation).data('jBox-animating', 'jBox-animated-' + animation);
    this.animationTimeout[options.element.data('jBox-animating-id')] = setTimeout((function() { options.element.removeClass(options.element.data('jBox-animating')).data('jBox-animating', null); options.complete && options.complete(); }), jBox._animationSpeeds[animation]);
  };
  
  
  // Destroy jBox and remove it from DOM
  
  jBox.prototype.destroy = function ()
  {
    // Detach from attached elements
    this.detach();
    
    // If jBox is open, close without delay
    this.isOpen && this.close({ignoreDelay: true});
    
    // Remove wrapper
    this.wrapper && this.wrapper.remove();
    
    // Remove overlay
    this.overlay && this.overlay.remove();
    
    // Remove styles
    this._styles && this._styles.remove();
    
    // Tell the jBox instance it is destroyed
    this.isDestroyed = true;
    
    return this;
  };
  
  
  // Get a unique ID for jBoxes
  
  jBox._getUniqueID = (function ()
  {
    var i = 1;
    return function () { return i++; };
  }());
  
  
  // Get a unique ID for animating elements
  
  jBox._getUniqueElementID = (function ()
  {
    var i = 1;
    return function () { return i++; };
  }());
  
  
  // Function to create jBox plugins
  
  jBox._pluginOptions = {};
  jBox.plugin = function (type, options)
  {
    jBox._pluginOptions[type] = options;
  };
  
  
  // Make jBox usable with jQuery selectors
  
  jQuery.fn.jBox = function (type, options)
  {
    // Variables type and object are required
    !type && (type = {});
    !options && (options = {});
    
    // Return a new instance of jBox with the selector as attached element
    return new jBox(type, jQuery.extend(options, {
      attach: this
    }));
  };
  
  return jBox;
}));
jQuery(document).ready(function(){new jBox.plugin("Confirm",{confirmButton:"Submit",cancelButton:"Cancel",confirm:null,cancel:null,closeOnConfirm:!0,target:window,addClass:"jBox-Modal",fixed:!0,attach:"[data-confirm]",getContent:"data-confirm",content:"Do you really want to do this?",minWidth:360,maxWidth:500,blockScroll:!0,closeOnEsc:!0,closeOnClick:!1,closeButton:!1,overlay:!0,animation:"zoomIn",preventDefault:!0,_onAttach:function(t){if(!this.options.confirm){var o=t.attr("onclick")?t.attr("onclick"):t.attr("href")?t.attr("target")?'window.open("'+t.attr("href")+'", "'+t.attr("target")+'");':'window.location.href = "'+t.attr("href")+'";':"";t.prop("onclick",null).data("jBox-Confirm-submit",o)}},_onCreated:function(){this.footer=jQuery('<div class="jBox-Confirm-footer"/>'),jQuery('<div class="jBox-Confirm-button jBox-Confirm-button-cancel"/>').html(this.options.cancelButton).click(function(){this.options.cancel&&this.options.cancel(),this.close()}.bind(this)).appendTo(this.footer),this.submitButton=jQuery('<div class="jBox-Confirm-button jBox-Confirm-button-submit"/>').html(this.options.confirmButton).appendTo(this.footer),this.footer.appendTo(this.container)},_onOpen:function(){this.submitButton.off("click.jBox-Confirm"+this.id).on("click.jBox-Confirm"+this.id,function(){this.options.confirm?this.options.confirm():eval(this.source.data("jBox-Confirm-submit")),this.options.closeOnConfirm&&this.close()}.bind(this))}})});
jQuery(document).ready(function(){new jBox.plugin("Image",{src:"href",gallery:"data-jbox-image",imageLabel:"title",imageFade:360,imageSize:"contain",imageCounter:false,imageCounterSeparator:"/",target:window,attach:"[data-jbox-image]",fixed:true,blockScroll:true,closeOnEsc:true,closeOnClick:"button",closeButton:true,overlay:true,animation:"zoomIn",preventDefault:true,width:"100%",height:"100%",adjustDistance:{top:40,right:5,bottom:40,left:5},_onAttach:function(b){this.images=this.images||{};
if(b.data("jBox-image-gallery")){return;}var a=b.attr(this.options.gallery)||"default";!this.images[a]&&(this.images[a]=[]);this.images[a].push({src:b.attr(this.options.src),label:(b.attr(this.options.imageLabel)||"")});
this.options.imageLabel=="title"&&b.removeAttr("title");b.data("jBox-image-gallery",a);b.data("jBox-image-id",(this.images[a].length-1));},_onInit:function(){this.currentImage={};
this.imageZIndex=1;var b=function(d,j,g,f,e,h,c){if(jQuery("#jBox-image-"+d+"-"+j).length){return;}var i=jQuery("<div/>",{id:"jBox-image-"+d+"-"+j,"class":"jBox-image-container"+(e?" jBox-image-not-found":"")+(!f&&!g?" jBox-image-"+d+"-current":""),"data-width":h,"data-height":c}).css({backgroundImage:e?"":'url("'+this.images[d][j].src+'")',backgroundSize:this.options.imageSize,opacity:(f?1:0),zIndex:(g?0:this.imageZIndex++)}).appendTo(this.content);
jQuery("<div/>",{id:"jBox-image-label-"+d+"-"+j,"class":"jBox-image-label"+(f?" active":"")}).html(this.images[d][j].label).click(function(){$(this).toggleClass("expanded");
}).appendTo(this.imageLabel);!f&&!g&&i.animate({opacity:1},this.options.imageFade);}.bind(this);var a=function(c,d){jQuery(".jBox-image-label.active").removeClass("active expanded");
jQuery("#jBox-image-label-"+c+"-"+d).addClass("active");};this.checkSize=function(c){if((this.content.width()<=c.data("width"))||(this.content.height()<=c.data("height"))){c.css("backgroundSize","contain");
}else{c.css("backgroundSize","auto");}};this.showImage=function(d){if(d!="open"){var c=this.currentImage.gallery;var f=this.currentImage.id+(1*(d=="prev")?-1:1);
f=f>(this.images[c].length-1)?0:(f<0?(this.images[c].length-1):f);}else{var c=this.source.data("jBox-image-gallery");var f=this.source.data("jBox-image-id");
jQuery(".jBox-image-pointer-prev, .jBox-image-pointer-next").css({display:(this.images[c].length>1?"block":"none")});}if(jQuery(".jBox-image-"+c+"-current").length){jQuery(".jBox-image-"+c+"-current").removeClass("jBox-image-"+c+"-current").animate({opacity:0},(d=="open")?0:this.options.imageFade);
}this.currentImage={gallery:c,id:f};if(jQuery("#jBox-image-"+c+"-"+f).length){jQuery("#jBox-image-"+c+"-"+f).addClass("jBox-image-"+c+"-current").css({zIndex:this.imageZIndex++,opacity:0}).animate({opacity:1},(d=="open")?0:this.options.imageFade);
this.checkSize(jQuery("#jBox-image-"+c+"-"+f));a(c,f);}else{this.wrapper.addClass("jBox-image-loading");jQuery('<img src="'+this.images[c][f].src+'"/>').each(function(){var g=new Image();
g.onload=function(){b(c,f,false,null,false,g.width,g.height);this.checkSize(jQuery("#jBox-image-"+c+"-"+f));a(c,f);this.wrapper.removeClass("jBox-image-loading");
}.bind(this);g.onerror=function(){b(c,f,false,null,true,g.width,g.height);a(c,f);this.wrapper.removeClass("jBox-image-loading");}.bind(this);g.src=this.images[c][f].src;
}.bind(this));}if(this.imageCounter){if(this.images[c].length>1){this.wrapper.addClass("jBox-image-has-counter");this.imageCounter.find(".jBox-image-counter-all").html(this.images[c].length);
this.imageCounter.find(".jBox-image-counter-current").html(f+1);}else{this.wrapper.removeClass("jBox-image-has-counter");}}if(this.images[c].length>1){var e=f+1;
e=e>(this.images[c].length-1)?0:(e<0?(this.images[c].length-1):e);(!jQuery("#jBox-image-"+c+"-"+e).length)&&jQuery('<img src="'+this.images[c][e].src+'"/>').each(function(){var g=new Image();
g.onload=function(){b(c,e,true,null,false,g.width,g.height);}.bind(this);g.onerror=function(){b(c,e,true,null,true,g.width,g.height);}.bind(this);g.src=this.images[c][e].src;
}.bind(this));}};},_onCreated:function(){this.imageLabel=jQuery("<div/>",{"class":"jBox-image-label-container"}).appendTo(this.wrapper);this.imageLabel.append(jQuery("<div/>",{"class":"jBox-image-pointer-prev",click:function(){this.showImage("prev");
}.bind(this)})).append(jQuery("<div/>",{"class":"jBox-image-pointer-next",click:function(){this.showImage("next");}.bind(this)}));if(this.options.imageCounter){this.imageCounter=jQuery("<div/>",{"class":"jBox-image-counter-container"}).appendTo(this.wrapper);
this.imageCounter.append(jQuery("<span/>",{"class":"jBox-image-counter-current"})).append(jQuery("<span/>").html(this.options.imageCounterSeparator)).append(jQuery("<span/>",{"class":"jBox-image-counter-all"}));
}},_onOpen:function(){jQuery(document).on("keyup.jBox-Image-"+this.id,function(a){(a.keyCode==37)&&this.showImage("prev");(a.keyCode==39)&&this.showImage("next");
}.bind(this));this.showImage("open");},_onClose:function(){jQuery(document).off("keyup.jBox-Image-"+this.id);},_onCloseComplete:function(){this.wrapper.find(".jBox-image-container").css("opacity",0);
}});});
jQuery(document).ready(function(){new jBox.plugin("Notice",{color:null,stack:!0,stackSpacing:10,autoClose:6e3,attributes:{x:"right",y:"top"},position:{x:15,y:15},responsivePositions:{500:{x:5,y:5},768:{x:10,y:10}},target:window,fixed:!0,animation:"zoomIn",closeOnClick:"box",zIndex:12e3,_onInit:function(){this.defaultNoticePosition=jQuery.extend({},this.options.position),this._adjustNoticePositon=function(){var t=jQuery(window),i={x:t.width(),y:t.height()};this.options.position=jQuery.extend({},this.defaultNoticePosition),jQuery.each(this.options.responsivePositions,function(t,o){if(i.x<=t)return this.options.position=o,!1}.bind(this)),this.options.adjustDistance={top:this.options.position.y,right:this.options.position.x,bottom:this.options.position.y,left:this.options.position.x}},this.options.content instanceof jQuery&&(this.options.content=this.options.content.clone().attr("id","")),jQuery(window).on("resize.responsivejBoxNotice-"+this.id,function(t){this.isOpen&&this._adjustNoticePositon()}.bind(this)),this.open()},_onCreated:function(){this.wrapper.addClass("jBox-Notice-color jBox-Notice-"+(this.options.color||"gray")),this.wrapper.data("jBox-Notice-position",this.options.attributes.x+"-"+this.options.attributes.y)},_onOpen:function(){this._adjustNoticePositon(),jQuery.each(jQuery(".jBox-Notice"),function(t,i){if(i=jQuery(i),i.attr("id")!=this.id&&i.data("jBox-Notice-position")==this.options.attributes.x+"-"+this.options.attributes.y){if(!this.options.stack)return void i.data("jBox").close({ignoreDelay:!0});var o=(i.data("jBoxNoticeMargin")?parseInt(i.data("jBoxNoticeMargin")):parseInt(i.css("margin-"+this.options.attributes.y)))+this.wrapper.outerHeight()+this.options.stackSpacing;i.data("jBoxNoticeMargin",o),i.css("margin-"+this.options.attributes.y,o)}}.bind(this))},_onCloseComplete:function(){this.destroy()}})});
// основано на jBox
window.msgErrorBox = {

	alert : function(title, message)
	{
		var options = {
			animation: {open: 'flip', close: 'zoomIn'},
			position: {
				x: 16,
				y: 16
			},
			color: 'red',
			zIndex: 12000,
			width: 250
		};

		if (title)
		{
			options['title'] = title;
		} else
		{
			options['title'] = 'Ошибка!';
		}
		if (message) options['content'] = message;
		new jBox('Notice', options);
	}
};

window.msgNoticeBox = {
	alert : function(title, message)
	{
		var options = {
			animation: {open: 'flip', close: 'zoomIn'},
			position: {
				x: 16,
				y: 16
			},
			color: 'green',
			zIndex: 12000,
			width: 250
		};

		if (title)
		{
			options['title'] = title;
		} else
		{
			options['title'] = 'Внимание!';
		}
		if (message) options['content'] = message;
		new jBox('Notice', options);
	}
};
/**
*  Ajax Autocomplete for jQuery, version 1.2.27
*  (c) 2015 Tomas Kirda
*
*  Ajax Autocomplete for jQuery is freely distributable under the terms of an MIT-style license.
*  For details, see the web site: https://github.com/devbridge/jQuery-Autocomplete
*/

/*jslint  browser: true, white: true, single: true, this: true, multivar: true */
/*global define, window, document, jQuery, exports, require */

// Expose plugin as an AMD module if AMD loader is present:
(function (factory) {
    "use strict";
    if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define(['jquery'], factory);
    } else if (typeof exports === 'object' && typeof require === 'function') {
        // Browserify
        factory(require('jquery'));
    } else {
        // Browser globals
        factory(jQuery);
    }
}(function ($) {
    'use strict';

    var
        utils = (function () {
            return {
                escapeRegExChars: function (value) {
                    return value.replace(/[|\\{}()[\]^$+*?.]/g, "\\$&");
                },
                createNode: function (containerClass) {
                    var div = document.createElement('div');
                    div.className = containerClass;
                    div.style.position = 'absolute';
                    div.style.display = 'none';
                    return div;
                }
            };
        }()),

        keys = {
            ESC: 27,
            TAB: 9,
            RETURN: 13,
            LEFT: 37,
            UP: 38,
            RIGHT: 39,
            DOWN: 40
        };

    function Autocomplete(el, options) {
        var noop = $.noop,
            that = this,
            defaults = {
                ajaxSettings: {},
                autoSelectFirst: false,
                appendTo: document.body,
                serviceUrl: null,
                lookup: null,
                onSelect: null,
                width: 'auto',
                minChars: 1,
                maxHeight: 300,
                deferRequestBy: 0,
                params: {},
                formatResult: Autocomplete.formatResult,
                delimiter: null,
                zIndex: 9999,
                type: 'GET',
                noCache: false,
                onSearchStart: noop,
                onSearchComplete: noop,
                onSearchError: noop,
                preserveInput: false,
                containerClass: 'autocomplete-suggestions',
                tabDisabled: false,
                dataType: 'text',
                currentRequest: null,
                triggerSelectOnValidInput: true,
                preventBadQueries: true,
                lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                    return suggestion.value.toLowerCase().indexOf(queryLowerCase) !== -1;
                },
                paramName: 'query',
                transformResult: function (response) {
                    return typeof response === 'string' ? $.parseJSON(response) : response;
                },
                showNoSuggestionNotice: false,
                noSuggestionNotice: 'No results',
                orientation: 'bottom',
                forceFixPosition: false
            };

        // Shared variables:
        that.element = el;
        that.el = $(el);
        that.suggestions = [];
        that.badQueries = [];
        that.selectedIndex = -1;
        that.currentValue = that.element.value;
        that.intervalId = 0;
        that.cachedResponse = {};
        that.onChangeInterval = null;
        that.onChange = null;
        that.isLocal = false;
        that.suggestionsContainer = null;
        that.noSuggestionsContainer = null;
        that.options = $.extend({}, defaults, options);
        that.classes = {
            selected: 'autocomplete-selected',
            suggestion: 'autocomplete-suggestion'
        };
        that.hint = null;
        that.hintValue = '';
        that.selection = null;

        // Initialize and set options:
        that.initialize();
        that.setOptions(options);
    }

    Autocomplete.utils = utils;

    $.Autocomplete = Autocomplete;

    Autocomplete.formatResult = function (suggestion, currentValue) {
        // Do not replace anything if there current value is empty
        if (!currentValue) {
            return suggestion.value;
        }
        
        var pattern = '(' + utils.escapeRegExChars(currentValue) + ')';

        return suggestion.value
            .replace(new RegExp(pattern, 'gi'), '<strong>$1<\/strong>')
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/&lt;(\/?strong)&gt;/g, '<$1>');
    };

    Autocomplete.prototype = {

        killerFn: null,

        initialize: function () {
            var that = this,
                suggestionSelector = '.' + that.classes.suggestion,
                selected = that.classes.selected,
                options = that.options,
                container;

            // Remove autocomplete attribute to prevent native suggestions:
            that.element.setAttribute('autocomplete', 'off');

            that.killerFn = function (e) {
                if (!$(e.target).closest('.' + that.options.containerClass).length) {
                    that.killSuggestions();
                    that.disableKillerFn();
                }
            };

            // html() deals with many types: htmlString or Element or Array or jQuery
            that.noSuggestionsContainer = $('<div class="autocomplete-no-suggestion"></div>')
                                          .html(this.options.noSuggestionNotice).get(0);

            that.suggestionsContainer = Autocomplete.utils.createNode(options.containerClass);

            container = $(that.suggestionsContainer);

            container.appendTo(options.appendTo);

            // Only set width if it was provided:
            if (options.width !== 'auto') {
                container.css('width', options.width);
            }

            // Listen for mouse over event on suggestions list:
            container.on('mouseover.autocomplete', suggestionSelector, function () {
                that.activate($(this).data('index'));
            });

            // Deselect active element when mouse leaves suggestions container:
            container.on('mouseout.autocomplete', function () {
                that.selectedIndex = -1;
                container.children('.' + selected).removeClass(selected);
            });

            // Listen for click event on suggestions list:
            container.on('click.autocomplete', suggestionSelector, function () {
                that.select($(this).data('index'));
                return false;
            });

            that.fixPositionCapture = function () {
                if (that.visible) {
                    that.fixPosition();
                }
            };

            $(window).on('resize.autocomplete', that.fixPositionCapture);

            that.el.on('keydown.autocomplete', function (e) { that.onKeyPress(e); });
            that.el.on('keyup.autocomplete', function (e) { that.onKeyUp(e); });
            that.el.on('blur.autocomplete', function () { that.onBlur(); });
            that.el.on('focus.autocomplete', function () { that.onFocus(); });
            that.el.on('change.autocomplete', function (e) { that.onKeyUp(e); });
            that.el.on('input.autocomplete', function (e) { that.onKeyUp(e); });
        },

        onFocus: function () {
            var that = this;

            that.fixPosition();

            if (that.el.val().length >= that.options.minChars) {
                that.onValueChange();
            }
        },

        onBlur: function () {
            this.enableKillerFn();
        },
        
        abortAjax: function () {
            var that = this;
            if (that.currentRequest) {
                that.currentRequest.abort();
                that.currentRequest = null;
            }
        },

        setOptions: function (suppliedOptions) {
            var that = this,
                options = that.options;

            $.extend(options, suppliedOptions);

            that.isLocal = $.isArray(options.lookup);

            if (that.isLocal) {
                options.lookup = that.verifySuggestionsFormat(options.lookup);
            }

            options.orientation = that.validateOrientation(options.orientation, 'bottom');

            // Adjust height, width and z-index:
            $(that.suggestionsContainer).css({
                'max-height': options.maxHeight + 'px',
                'width': options.width + 'px',
                'z-index': options.zIndex
            });
        },


        clearCache: function () {
            this.cachedResponse = {};
            this.badQueries = [];
        },

        clear: function () {
            this.clearCache();
            this.currentValue = '';
            this.suggestions = [];
        },

        disable: function () {
            var that = this;
            that.disabled = true;
            clearInterval(that.onChangeInterval);
            that.abortAjax();
        },

        enable: function () {
            this.disabled = false;
        },

        fixPosition: function () {
            // Use only when container has already its content

            var that = this,
                $container = $(that.suggestionsContainer),
                containerParent = $container.parent().get(0);
            // Fix position automatically when appended to body.
            // In other cases force parameter must be given.
            if (containerParent !== document.body && !that.options.forceFixPosition) {
                return;
            }

            // Choose orientation
            var orientation = that.options.orientation,
                containerHeight = $container.outerHeight(),
                height = that.el.outerHeight(),
                offset = that.el.offset(),
                styles = { 'top': offset.top, 'left': offset.left };

            if (orientation === 'auto') {
                var viewPortHeight = $(window).height(),
                    scrollTop = $(window).scrollTop(),
                    topOverflow = -scrollTop + offset.top - containerHeight,
                    bottomOverflow = scrollTop + viewPortHeight - (offset.top + height + containerHeight);

                orientation = (Math.max(topOverflow, bottomOverflow) === topOverflow) ? 'top' : 'bottom';
            }

            if (orientation === 'top') {
                styles.top += -containerHeight;
            } else {
                styles.top += height;
            }

            // If container is not positioned to body,
            // correct its position using offset parent offset
            if(containerParent !== document.body) {
                var opacity = $container.css('opacity'),
                    parentOffsetDiff;

                    if (!that.visible){
                        $container.css('opacity', 0).show();
                    }

                parentOffsetDiff = $container.offsetParent().offset();
                styles.top -= parentOffsetDiff.top;
                styles.left -= parentOffsetDiff.left;

                if (!that.visible){
                    $container.css('opacity', opacity).hide();
                }
            }

            if (that.options.width === 'auto') {
                styles.width = that.el.outerWidth() + 'px';
            }

            $container.css(styles);
        },

        enableKillerFn: function () {
            var that = this;
            $(document).on('click.autocomplete', that.killerFn);
        },

        disableKillerFn: function () {
            var that = this;
            $(document).off('click.autocomplete', that.killerFn);
        },

        killSuggestions: function () {
            var that = this;
            that.stopKillSuggestions();
            that.intervalId = window.setInterval(function () {
                if (that.visible) {
                    // No need to restore value when 
                    // preserveInput === true, 
                    // because we did not change it
                    if (!that.options.preserveInput) {
                        that.el.val(that.currentValue);
                    }

                    that.hide();
                }
                
                that.stopKillSuggestions();
            }, 50);
        },

        stopKillSuggestions: function () {
            window.clearInterval(this.intervalId);
        },

        isCursorAtEnd: function () {
            var that = this,
                valLength = that.el.val().length,
                selectionStart = that.element.selectionStart,
                range;

            if (typeof selectionStart === 'number') {
                return selectionStart === valLength;
            }
            if (document.selection) {
                range = document.selection.createRange();
                range.moveStart('character', -valLength);
                return valLength === range.text.length;
            }
            return true;
        },

        onKeyPress: function (e) {
            var that = this;

            // If suggestions are hidden and user presses arrow down, display suggestions:
            if (!that.disabled && !that.visible && e.which === keys.DOWN && that.currentValue) {
                that.suggest();
                return;
            }

            if (that.disabled || !that.visible) {
                return;
            }

            switch (e.which) {
                case keys.ESC:
                    that.el.val(that.currentValue);
                    that.hide();
                    break;
                case keys.RIGHT:
                    if (that.hint && that.options.onHint && that.isCursorAtEnd()) {
                        that.selectHint();
                        break;
                    }
                    return;
                case keys.TAB:
                    if (that.hint && that.options.onHint) {
                        that.selectHint();
                        return;
                    }
                    if (that.selectedIndex === -1) {
                        that.hide();
                        return;
                    }
                    that.select(that.selectedIndex);
                    if (that.options.tabDisabled === false) {
                        return;
                    }
                    break;
                case keys.RETURN:
                    if (that.selectedIndex === -1) {
                        that.hide();
                        return;
                    }
                    that.select(that.selectedIndex);
                    break;
                case keys.UP:
                    that.moveUp();
                    break;
                case keys.DOWN:
                    that.moveDown();
                    break;
                default:
                    return;
            }

            // Cancel event if function did not return:
            e.stopImmediatePropagation();
            e.preventDefault();
        },

        onKeyUp: function (e) {
            var that = this;

            if (that.disabled) {
                return;
            }

            switch (e.which) {
                case keys.UP:
                case keys.DOWN:
                    return;
            }

            clearInterval(that.onChangeInterval);

            if (that.currentValue !== that.el.val()) {
                that.findBestHint();
                if (that.options.deferRequestBy > 0) {
                    // Defer lookup in case when value changes very quickly:
                    that.onChangeInterval = setInterval(function () {
                        that.onValueChange();
                    }, that.options.deferRequestBy);
                } else {
                    that.onValueChange();
                }
            }
        },

        onValueChange: function () {
            var that = this,
                options = that.options,
                value = that.el.val(),
                query = that.getQuery(value);

            if (that.selection && that.currentValue !== query) {
                that.selection = null;
                (options.onInvalidateSelection || $.noop).call(that.element);
            }

            clearInterval(that.onChangeInterval);
            that.currentValue = value;
            that.selectedIndex = -1;

            // Check existing suggestion for the match before proceeding:
            if (options.triggerSelectOnValidInput && that.isExactMatch(query)) {
                that.select(0);
                return;
            }

            if (query.length < options.minChars) {
                that.hide();
            } else {
                that.getSuggestions(query);
            }
        },

        isExactMatch: function (query) {
            var suggestions = this.suggestions;

            return (suggestions.length === 1 && suggestions[0].value.toLowerCase() === query.toLowerCase());
        },

        getQuery: function (value) {
            var delimiter = this.options.delimiter,
                parts;

            if (!delimiter) {
                return value;
            }
            parts = value.split(delimiter);
            return $.trim(parts[parts.length - 1]);
        },

        getSuggestionsLocal: function (query) {
            var that = this,
                options = that.options,
                queryLowerCase = query.toLowerCase(),
                filter = options.lookupFilter,
                limit = parseInt(options.lookupLimit, 10),
                data;

            data = {
                suggestions: $.grep(options.lookup, function (suggestion) {
                    return filter(suggestion, query, queryLowerCase);
                })
            };

            if (limit && data.suggestions.length > limit) {
                data.suggestions = data.suggestions.slice(0, limit);
            }

            return data;
        },

        getSuggestions: function (q) {
            var response,
                that = this,
                options = that.options,
                serviceUrl = options.serviceUrl,
                params,
                cacheKey,
                ajaxSettings;

            options.params[options.paramName] = q;
            params = options.ignoreParams ? null : options.params;

            if (options.onSearchStart.call(that.element, options.params) === false) {
                return;
            }

            if ($.isFunction(options.lookup)){
                options.lookup(q, function (data) {
                    that.suggestions = data.suggestions;
                    that.suggest();
                    options.onSearchComplete.call(that.element, q, data.suggestions);
                });
                return;
            }

            if (that.isLocal) {
                response = that.getSuggestionsLocal(q);
            } else {
                if ($.isFunction(serviceUrl)) {
                    serviceUrl = serviceUrl.call(that.element, q);
                }
                cacheKey = serviceUrl + '?' + $.param(params || {});
                response = that.cachedResponse[cacheKey];
            }

            if (response && $.isArray(response.suggestions)) {
                that.suggestions = response.suggestions;
                that.suggest();
                options.onSearchComplete.call(that.element, q, response.suggestions);
            } else if (!that.isBadQuery(q)) {
                that.abortAjax();

                ajaxSettings = {
                    url: serviceUrl,
                    data: params,
                    type: options.type,
                    dataType: options.dataType
                };

                $.extend(ajaxSettings, options.ajaxSettings);

                that.currentRequest = $.ajax(ajaxSettings).done(function (data) {
                    var result;
                    that.currentRequest = null;
                    result = options.transformResult(data, q);
                    that.processResponse(result, q, cacheKey);
                    options.onSearchComplete.call(that.element, q, result.suggestions);
                }).fail(function (jqXHR, textStatus, errorThrown) {
                    options.onSearchError.call(that.element, q, jqXHR, textStatus, errorThrown);
                });
            } else {
                options.onSearchComplete.call(that.element, q, []);
            }
        },

        isBadQuery: function (q) {
            if (!this.options.preventBadQueries){
                return false;
            }

            var badQueries = this.badQueries,
                i = badQueries.length;

            while (i--) {
                if (q.indexOf(badQueries[i]) === 0) {
                    return true;
                }
            }

            return false;
        },

        hide: function () {
            var that = this,
                container = $(that.suggestionsContainer);

            if ($.isFunction(that.options.onHide) && that.visible) {
                that.options.onHide.call(that.element, container);
            }

            that.visible = false;
            that.selectedIndex = -1;
            clearInterval(that.onChangeInterval);
            $(that.suggestionsContainer).hide();
            that.signalHint(null);
        },

        suggest: function () {
            if (!this.suggestions.length) {
                if (this.options.showNoSuggestionNotice) {
                    this.noSuggestions();
                } else {
                    this.hide();
                }
                return;
            }

            var that = this,
                options = that.options,
                groupBy = options.groupBy,
                formatResult = options.formatResult,
                value = that.getQuery(that.currentValue),
                className = that.classes.suggestion,
                classSelected = that.classes.selected,
                container = $(that.suggestionsContainer),
                noSuggestionsContainer = $(that.noSuggestionsContainer),
                beforeRender = options.beforeRender,
                html = '',
                category,
                formatGroup = function (suggestion, index) {
                        var currentCategory = suggestion.data[groupBy];

                        if (category === currentCategory){
                            return '';
                        }

                        category = currentCategory;

                        return '<div class="autocomplete-group"><strong>' + category + '</strong></div>';
                    };

            if (options.triggerSelectOnValidInput && that.isExactMatch(value)) {
                that.select(0);
                return;
            }

            // Build suggestions inner HTML:
            $.each(that.suggestions, function (i, suggestion) {
                if (groupBy){
                    html += formatGroup(suggestion, value, i);
                }

                html += '<div class="' + className + '" data-index="' + i + '">' + formatResult(suggestion, value, i) + '</div>';
            });

            this.adjustContainerWidth();

            noSuggestionsContainer.detach();
            container.html(html);

            if ($.isFunction(beforeRender)) {
                beforeRender.call(that.element, container, that.suggestions);
            }

            that.fixPosition();
            container.show();

            // Select first value by default:
            if (options.autoSelectFirst) {
                that.selectedIndex = 0;
                container.scrollTop(0);
                container.children('.' + className).first().addClass(classSelected);
            }

            that.visible = true;
            that.findBestHint();
        },

        noSuggestions: function() {
             var that = this,
                 container = $(that.suggestionsContainer),
                 noSuggestionsContainer = $(that.noSuggestionsContainer);

            this.adjustContainerWidth();

            // Some explicit steps. Be careful here as it easy to get
            // noSuggestionsContainer removed from DOM if not detached properly.
            noSuggestionsContainer.detach();
            container.empty(); // clean suggestions if any
            container.append(noSuggestionsContainer);

            that.fixPosition();

            container.show();
            that.visible = true;
        },

        adjustContainerWidth: function() {
            var that = this,
                options = that.options,
                width,
                container = $(that.suggestionsContainer);

            // If width is auto, adjust width before displaying suggestions,
            // because if instance was created before input had width, it will be zero.
            // Also it adjusts if input width has changed.
            if (options.width === 'auto') {
                width = that.el.outerWidth();
                container.css('width', width > 0 ? width : 300);
            }
        },

        findBestHint: function () {
            var that = this,
                value = that.el.val().toLowerCase(),
                bestMatch = null;

            if (!value) {
                return;
            }

            $.each(that.suggestions, function (i, suggestion) {
                var foundMatch = suggestion.value.toLowerCase().indexOf(value) === 0;
                if (foundMatch) {
                    bestMatch = suggestion;
                }
                return !foundMatch;
            });

            that.signalHint(bestMatch);
        },

        signalHint: function (suggestion) {
            var hintValue = '',
                that = this;
            if (suggestion) {
                hintValue = that.currentValue + suggestion.value.substr(that.currentValue.length);
            }
            if (that.hintValue !== hintValue) {
                that.hintValue = hintValue;
                that.hint = suggestion;
                (this.options.onHint || $.noop)(hintValue);
            }
        },

        verifySuggestionsFormat: function (suggestions) {
            // If suggestions is string array, convert them to supported format:
            if (suggestions.length && typeof suggestions[0] === 'string') {
                return $.map(suggestions, function (value) {
                    return { value: value, data: null };
                });
            }

            return suggestions;
        },

        validateOrientation: function(orientation, fallback) {
            orientation = $.trim(orientation || '').toLowerCase();

            if($.inArray(orientation, ['auto', 'bottom', 'top']) === -1){
                orientation = fallback;
            }

            return orientation;
        },

        processResponse: function (result, originalQuery, cacheKey) {
            var that = this,
                options = that.options;

            result.suggestions = that.verifySuggestionsFormat(result.suggestions);

            // Cache results if cache is not disabled:
            if (!options.noCache) {
                that.cachedResponse[cacheKey] = result;
                if (options.preventBadQueries && !result.suggestions.length) {
                    that.badQueries.push(originalQuery);
                }
            }

            // Return if originalQuery is not matching current query:
            if (originalQuery !== that.getQuery(that.currentValue)) {
                return;
            }

            that.suggestions = result.suggestions;
            that.suggest();
        },

        activate: function (index) {
            var that = this,
                activeItem,
                selected = that.classes.selected,
                container = $(that.suggestionsContainer),
                children = container.find('.' + that.classes.suggestion);

            container.find('.' + selected).removeClass(selected);

            that.selectedIndex = index;

            if (that.selectedIndex !== -1 && children.length > that.selectedIndex) {
                activeItem = children.get(that.selectedIndex);
                $(activeItem).addClass(selected);
                return activeItem;
            }

            return null;
        },

        selectHint: function () {
            var that = this,
                i = $.inArray(that.hint, that.suggestions);

            that.select(i);
        },

        select: function (i) {
            var that = this;
            that.hide();
            that.onSelect(i);
            that.disableKillerFn();
        },

        moveUp: function () {
            var that = this;

            if (that.selectedIndex === -1) {
                return;
            }

            if (that.selectedIndex === 0) {
                $(that.suggestionsContainer).children().first().removeClass(that.classes.selected);
                that.selectedIndex = -1;
                that.el.val(that.currentValue);
                that.findBestHint();
                return;
            }

            that.adjustScroll(that.selectedIndex - 1);
        },

        moveDown: function () {
            var that = this;

            if (that.selectedIndex === (that.suggestions.length - 1)) {
                return;
            }

            that.adjustScroll(that.selectedIndex + 1);
        },

        adjustScroll: function (index) {
            var that = this,
                activeItem = that.activate(index);

            if (!activeItem) {
                return;
            }

            var offsetTop,
                upperBound,
                lowerBound,
                heightDelta = $(activeItem).outerHeight();

            offsetTop = activeItem.offsetTop;
            upperBound = $(that.suggestionsContainer).scrollTop();
            lowerBound = upperBound + that.options.maxHeight - heightDelta;

            if (offsetTop < upperBound) {
                $(that.suggestionsContainer).scrollTop(offsetTop);
            } else if (offsetTop > lowerBound) {
                $(that.suggestionsContainer).scrollTop(offsetTop - that.options.maxHeight + heightDelta);
            }

            if (!that.options.preserveInput) {
                that.el.val(that.getValue(that.suggestions[index].value));
            }
            that.signalHint(null);
        },

        onSelect: function (index) {
            var that = this,
                onSelectCallback = that.options.onSelect,
                suggestion = that.suggestions[index];

            that.currentValue = that.getValue(suggestion.value);

            if (that.currentValue !== that.el.val() && !that.options.preserveInput) {
                that.el.val(that.currentValue);
            }

            that.signalHint(null);
            that.suggestions = [];
            that.selection = suggestion;

            if ($.isFunction(onSelectCallback)) {
                onSelectCallback.call(that.element, suggestion);
            }
        },

        getValue: function (value) {
            var that = this,
                delimiter = that.options.delimiter,
                currentValue,
                parts;

            if (!delimiter) {
                return value;
            }

            currentValue = that.currentValue;
            parts = currentValue.split(delimiter);

            if (parts.length === 1) {
                return value;
            }

            return currentValue.substr(0, currentValue.length - parts[parts.length - 1].length) + value;
        },

        dispose: function () {
            var that = this;
            that.el.off('.autocomplete').removeData('autocomplete');
            that.disableKillerFn();
            $(window).off('resize.autocomplete', that.fixPositionCapture);
            $(that.suggestionsContainer).remove();
        }
    };

    // Create chainable jQuery plugin:
    $.fn.autocomplete = $.fn.devbridgeAutocomplete = function (options, args) {
        var dataKey = 'autocomplete';
        // If function invoked without argument return
        // instance of the first matched element:
        if (!arguments.length) {
            return this.first().data(dataKey);
        }

        return this.each(function () {
            var inputElement = $(this),
                instance = inputElement.data(dataKey);

            if (typeof options === 'string') {
                if (instance && typeof instance[options] === 'function') {
                    instance[options](args);
                }
            } else {
                // If instance already exists, destroy it:
                if (instance && instance.dispose) {
                    instance.dispose();
                }
                instance = new Autocomplete(this, options);
                inputElement.data(dataKey, instance);
            }
        });
    };
}));
;
(function(j,f){var c=j(window);function n(){return new Date(Date.UTC.apply(Date,arguments));}function g(){var q=new Date();return n(q.getFullYear(),q.getMonth(),q.getDate());
}function l(q){return function(){return this[q].apply(this,arguments);};}var e=(function(){var q={get:function(r){return this.slice(r)[0];},contains:function(u){var t=u&&u.valueOf();
for(var s=0,r=this.length;s<r;s++){if(this[s].valueOf()===t){return s;}}return -1;},remove:function(r){this.splice(r,1);},replace:function(r){if(!r){return;
}if(!j.isArray(r)){r=[r];}this.clear();this.push.apply(this,r);},clear:function(){this.splice(0);},copy:function(){var r=new e();r.replace(this);return r;
}};return function(){var r=[];r.push.apply(r,arguments);j.extend(r,q);return r;};})();var k=function(r,q){this.dates=new e();this.viewDate=g();this.focusDate=null;
this._process_options(q);this.element=j(r);this.isInline=false;this.isInput=this.element.is("input");this.component=this.element.is(".date")?this.element.find(".add-on, .input-group-addon, .btn"):false;
this.hasInput=this.component&&this.element.find("input").length;if(this.component&&this.component.length===0){this.component=false;}this.picker=j(m.template);
this._buildEvents();this._attachEvents();if(this.isInline){this.picker.addClass("datepicker-inline").appendTo(this.element);}else{this.picker.addClass("datepicker-dropdown dropdown-menu");
}if(this.o.rtl){this.picker.addClass("datepicker-rtl");}this.viewMode=this.o.startView;if(this.o.calendarWeeks){this.picker.find("tfoot th.today").attr("colspan",function(s,t){return parseInt(t)+1;
});}this._allow_update=false;this.setStartDate(this._o.startDate);this.setEndDate(this._o.endDate);this.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled);
this.fillDow();this.fillMonths();this._allow_update=true;this.update();this.showMode();if(this.isInline){this.show();}};k.prototype={constructor:k,_process_options:function(q){this._o=j.extend({},this._o,q);
var u=this.o=j.extend({},this._o);var t=u.language;if(!b[t]){t=t.split("-")[0];if(!b[t]){t=h.language;}}u.language=t;switch(u.startView){case 2:case"decade":u.startView=2;
break;case 1:case"year":u.startView=1;break;default:u.startView=0;}switch(u.minViewMode){case 1:case"months":u.minViewMode=1;break;case 2:case"years":u.minViewMode=2;
break;default:u.minViewMode=0;}u.startView=Math.max(u.startView,u.minViewMode);if(u.multidate!==true){u.multidate=Number(u.multidate)||false;if(u.multidate!==false){u.multidate=Math.max(0,u.multidate);
}else{u.multidate=1;}}u.multidateSeparator=String(u.multidateSeparator);u.weekStart%=7;u.weekEnd=((u.weekStart+6)%7);var r=m.parseFormat(u.format);if(u.startDate!==-Infinity){if(!!u.startDate){if(u.startDate instanceof Date){u.startDate=this._local_to_utc(this._zero_time(u.startDate));
}else{u.startDate=m.parseDate(u.startDate,r,u.language);}}else{u.startDate=-Infinity;}}if(u.endDate!==Infinity){if(!!u.endDate){if(u.endDate instanceof Date){u.endDate=this._local_to_utc(this._zero_time(u.endDate));
}else{u.endDate=m.parseDate(u.endDate,r,u.language);}}else{u.endDate=Infinity;}}u.daysOfWeekDisabled=u.daysOfWeekDisabled||[];if(!j.isArray(u.daysOfWeekDisabled)){u.daysOfWeekDisabled=u.daysOfWeekDisabled.split(/[,\s]*/);
}u.daysOfWeekDisabled=j.map(u.daysOfWeekDisabled,function(w){return parseInt(w,10);});var s=String(u.orientation).toLowerCase().split(/\s+/g),v=u.orientation.toLowerCase();
s=j.grep(s,function(w){return(/^auto|left|right|top|bottom$/).test(w);});u.orientation={x:"auto",y:"auto"};if(!v||v==="auto"){}else{if(s.length===1){switch(s[0]){case"top":case"bottom":u.orientation.y=s[0];
break;case"left":case"right":u.orientation.x=s[0];break;}}else{v=j.grep(s,function(w){return(/^left|right$/).test(w);});u.orientation.x=v[0]||"auto";v=j.grep(s,function(w){return(/^top|bottom$/).test(w);
});u.orientation.y=v[0]||"auto";}}},_events:[],_secondaryEvents:[],_applyEvents:function(q){for(var r=0,t,s,u;r<q.length;r++){t=q[r][0];if(q[r].length===2){s=f;
u=q[r][1];}else{if(q[r].length===3){s=q[r][1];u=q[r][2];}}t.on(u,s);}},_unapplyEvents:function(q){for(var r=0,t,u,s;r<q.length;r++){t=q[r][0];if(q[r].length===2){s=f;
u=q[r][1];}else{if(q[r].length===3){s=q[r][1];u=q[r][2];}}t.off(u,s);}},_buildEvents:function(){if(this.isInput){this._events=[[this.element,{focus:j.proxy(this.show,this),keyup:j.proxy(function(q){if(j.inArray(q.keyCode,[27,37,39,38,40,32,13,9])===-1){this.update();
}},this),keydown:j.proxy(this.keydown,this)}]];}else{if(this.component&&this.hasInput){this._events=[[this.element.find("input"),{focus:j.proxy(this.show,this),keyup:j.proxy(function(q){if(j.inArray(q.keyCode,[27,37,39,38,40,32,13,9])===-1){this.update();
}},this),keydown:j.proxy(this.keydown,this)}],[this.component,{click:j.proxy(this.show,this)}]];}else{if(this.element.is("div")){this.isInline=true;}else{this._events=[[this.element,{click:j.proxy(this.show,this)}]];
}}}this._events.push([this.element,"*",{blur:j.proxy(function(q){this._focused_from=q.target;},this)}],[this.element,{blur:j.proxy(function(q){this._focused_from=q.target;
},this)}]);this._secondaryEvents=[[this.picker,{click:j.proxy(this.click,this)}],[j(window),{resize:j.proxy(this.place,this)}],[j(document),{"mousedown touchstart":j.proxy(function(q){if(!(this.element.is(q.target)||this.element.find(q.target).length||this.picker.is(q.target)||this.picker.find(q.target).length)){this.hide();
}},this)}]];},_attachEvents:function(){this._detachEvents();this._applyEvents(this._events);},_detachEvents:function(){this._unapplyEvents(this._events);
},_attachSecondaryEvents:function(){this._detachSecondaryEvents();this._applyEvents(this._secondaryEvents);},_detachSecondaryEvents:function(){this._unapplyEvents(this._secondaryEvents);
},_trigger:function(s,t){var r=t||this.dates.get(-1),q=this._utc_to_local(r);this.element.trigger({type:s,date:q,dates:j.map(this.dates,this._utc_to_local),format:j.proxy(function(u,w){if(arguments.length===0){u=this.dates.length-1;
w=this.o.format;}else{if(typeof u==="string"){w=u;u=this.dates.length-1;}}w=w||this.o.format;var v=this.dates.get(u);return m.formatDate(v,w,this.o.language);
},this)});},show:function(){if(!this.isInline){this.picker.appendTo("body");}this.picker.show();this.place();this._attachSecondaryEvents();this._trigger("show");
},hide:function(){if(this.isInline){return;}if(!this.picker.is(":visible")){return;}this.focusDate=null;this.picker.hide().detach();this._detachSecondaryEvents();
this.viewMode=this.o.startView;this.showMode();if(this.o.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())){this.setValue();
}this._trigger("hide");},remove:function(){this.hide();this._detachEvents();this._detachSecondaryEvents();this.picker.remove();delete this.element.data().datepicker;
if(!this.isInput){delete this.element.data().date;}},_utc_to_local:function(q){return q&&new Date(q.getTime()+(q.getTimezoneOffset()*60000));},_local_to_utc:function(q){return q&&new Date(q.getTime()-(q.getTimezoneOffset()*60000));
},_zero_time:function(q){return q&&new Date(q.getFullYear(),q.getMonth(),q.getDate());},_zero_utc_time:function(q){return q&&new Date(Date.UTC(q.getUTCFullYear(),q.getUTCMonth(),q.getUTCDate()));
},getDates:function(){return j.map(this.dates,this._utc_to_local);},getUTCDates:function(){return j.map(this.dates,function(q){return new Date(q);});},getDate:function(){return this._utc_to_local(this.getUTCDate());
},getUTCDate:function(){return new Date(this.dates.get(-1));},setDates:function(){var q=j.isArray(arguments[0])?arguments[0]:arguments;this.update.apply(this,q);
this._trigger("changeDate");this.setValue();},setUTCDates:function(){var q=j.isArray(arguments[0])?arguments[0]:arguments;this.update.apply(this,j.map(q,this._utc_to_local));
this._trigger("changeDate");this.setValue();},setDate:l("setDates"),setUTCDate:l("setUTCDates"),setValue:function(){var q=this.getFormattedDate();if(!this.isInput){if(this.component){this.element.find("input").val(q).change();
}}else{this.element.val(q).change();}},getFormattedDate:function(q){if(q===f){q=this.o.format;}var r=this.o.language;return j.map(this.dates,function(s){return m.formatDate(s,q,r);
}).join(this.o.multidateSeparator);},setStartDate:function(q){this._process_options({startDate:q});this.update();this.updateNavArrows();},setEndDate:function(q){this._process_options({endDate:q});
this.update();this.updateNavArrows();},setDaysOfWeekDisabled:function(q){this._process_options({daysOfWeekDisabled:q});this.update();this.updateNavArrows();
},place:function(){if(this.isInline){return;}var E=this.picker.outerWidth(),A=this.picker.outerHeight(),u=10,w=c.width(),r=c.height(),v=c.scrollTop();var C=parseInt(this.element.parents().filter(function(){return j(this).css("z-index")!=="auto";
}).first().css("z-index"))+10;var z=this.component?this.component.parent().offset():this.element.offset();var D=this.component?this.component.outerHeight(true):this.element.outerHeight(false);
var t=this.component?this.component.outerWidth(true):this.element.outerWidth(false);var y=z.left,B=z.top;this.picker.removeClass("datepicker-orient-top datepicker-orient-bottom datepicker-orient-right datepicker-orient-left");
if(this.o.orientation.x!=="auto"){this.picker.addClass("datepicker-orient-"+this.o.orientation.x);if(this.o.orientation.x==="right"){y-=E-t;}}else{this.picker.addClass("datepicker-orient-left");
if(z.left<0){y-=z.left-u;}else{if(z.left+E>w){y=w-E-u;}}}var q=this.o.orientation.y,s,x;if(q==="auto"){s=-v+z.top-A;x=v+r-(z.top+D+A);if(Math.max(s,x)===x){q="top";
}else{q="bottom";}}this.picker.addClass("datepicker-orient-"+q);if(q==="top"){B+=D;}else{B-=A+parseInt(this.picker.css("padding-top"));}this.picker.css({top:B,left:y,zIndex:C});
},_allow_update:true,update:function(){if(!this._allow_update){return;}var r=this.dates.copy(),s=[],q=false;if(arguments.length){j.each(arguments,j.proxy(function(u,t){if(t instanceof Date){t=this._local_to_utc(t);
}s.push(t);},this));q=true;}else{s=this.isInput?this.element.val():this.element.data("date")||this.element.find("input").val();if(s&&this.o.multidate){s=s.split(this.o.multidateSeparator);
}else{s=[s];}delete this.element.data().date;}s=j.map(s,j.proxy(function(t){return m.parseDate(t,this.o.format,this.o.language);},this));s=j.grep(s,j.proxy(function(t){return(t<this.o.startDate||t>this.o.endDate||!t);
},this),true);this.dates.replace(s);if(this.dates.length){this.viewDate=new Date(this.dates.get(-1));}else{if(this.viewDate<this.o.startDate){this.viewDate=new Date(this.o.startDate);
}else{if(this.viewDate>this.o.endDate){this.viewDate=new Date(this.o.endDate);}}}if(q){this.setValue();}else{if(s.length){if(String(r)!==String(this.dates)){this._trigger("changeDate");
}}}if(!this.dates.length&&r.length){this._trigger("clearDate");}this.fill();},fillDow:function(){var r=this.o.weekStart,s="<tr>";if(this.o.calendarWeeks){var q='<th class="cw">&nbsp;</th>';
s+=q;this.picker.find(".datepicker-days thead tr:first-child").prepend(q);}while(r<this.o.weekStart+7){s+='<th class="dow">'+b[this.o.language].daysMin[(r++)%7]+"</th>";
}s+="</tr>";this.picker.find(".datepicker-days thead").append(s);},fillMonths:function(){var r="",q=0;while(q<12){r+='<span class="month">'+b[this.o.language].monthsShort[q++]+"</span>";
}this.picker.find(".datepicker-months td").html(r);},setRange:function(q){if(!q||!q.length){delete this.range;}else{this.range=j.map(q,function(r){return r.valueOf();
});}this.fill();},getClassNames:function(s){var q=[],t=this.viewDate.getUTCFullYear(),u=this.viewDate.getUTCMonth(),r=new Date();if(s.getUTCFullYear()<t||(s.getUTCFullYear()===t&&s.getUTCMonth()<u)){q.push("old");
}else{if(s.getUTCFullYear()>t||(s.getUTCFullYear()===t&&s.getUTCMonth()>u)){q.push("new");}}if(this.focusDate&&s.valueOf()===this.focusDate.valueOf()){q.push("focused");
}if(this.o.todayHighlight&&s.getUTCFullYear()===r.getFullYear()&&s.getUTCMonth()===r.getMonth()&&s.getUTCDate()===r.getDate()){q.push("today");}if(this.dates.contains(s)!==-1){q.push("active");
}if(s.valueOf()<this.o.startDate||s.valueOf()>this.o.endDate||j.inArray(s.getUTCDay(),this.o.daysOfWeekDisabled)!==-1){q.push("disabled");}if(this.range){if(s>this.range[0]&&s<this.range[this.range.length-1]){q.push("range");
}if(j.inArray(s.valueOf(),this.range)!==-1){q.push("selected");}}return q;},fill:function(){var L=new Date(this.viewDate),A=L.getUTCFullYear(),M=L.getUTCMonth(),F=this.o.startDate!==-Infinity?this.o.startDate.getUTCFullYear():-Infinity,J=this.o.startDate!==-Infinity?this.o.startDate.getUTCMonth():-Infinity,x=this.o.endDate!==Infinity?this.o.endDate.getUTCFullYear():Infinity,G=this.o.endDate!==Infinity?this.o.endDate.getUTCMonth():Infinity,y=b[this.o.language].today||b.en.today||"",s=b[this.o.language].clear||b.en.clear||"",u;
this.picker.find(".datepicker-days thead th.datepicker-switch").text(b[this.o.language].months[M]+" "+A);this.picker.find("tfoot th.today").text(y).toggle(this.o.todayBtn!==false);
this.picker.find("tfoot th.clear").text(s).toggle(this.o.clearBtn!==false);this.updateNavArrows();this.fillMonths();var O=n(A,M-1,28),I=m.getDaysInMonth(O.getUTCFullYear(),O.getUTCMonth());
O.setUTCDate(I);O.setUTCDate(I-(O.getUTCDay()-this.o.weekStart+7)%7);var q=new Date(O);q.setUTCDate(q.getUTCDate()+42);q=q.valueOf();var z=[];var D;while(O.valueOf()<q){if(O.getUTCDay()===this.o.weekStart){z.push("<tr>");
if(this.o.calendarWeeks){var r=new Date(+O+(this.o.weekStart-O.getUTCDay()-7)%7*86400000),v=new Date(Number(r)+(7+4-r.getUTCDay())%7*86400000),t=new Date(Number(t=n(v.getUTCFullYear(),0,1))+(7+4-t.getUTCDay())%7*86400000),B=(v-t)/86400000/7+1;
z.push('<td class="cw">'+B+"</td>");}}D=this.getClassNames(O);D.push("day");if(this.o.beforeShowDay!==j.noop){var C=this.o.beforeShowDay(this._utc_to_local(O));
if(C===f){C={};}else{if(typeof(C)==="boolean"){C={enabled:C};}else{if(typeof(C)==="string"){C={classes:C};}}}if(C.enabled===false){D.push("disabled");}if(C.classes){D=D.concat(C.classes.split(/\s+/));
}if(C.tooltip){u=C.tooltip;}}D=j.unique(D);z.push('<td class="'+D.join(" ")+'"'+(u?' title="'+u+'"':"")+">"+O.getUTCDate()+"</td>");if(O.getUTCDay()===this.o.weekEnd){z.push("</tr>");
}O.setUTCDate(O.getUTCDate()+1);}this.picker.find(".datepicker-days tbody").empty().append(z.join(""));var w=this.picker.find(".datepicker-months").find("th:eq(1)").text(A).end().find("span").removeClass("active");
j.each(this.dates,function(P,Q){if(Q.getUTCFullYear()===A){w.eq(Q.getUTCMonth()).addClass("active");}});if(A<F||A>x){w.addClass("disabled");}if(A===F){w.slice(0,J).addClass("disabled");
}if(A===x){w.slice(G+1).addClass("disabled");}z="";A=parseInt(A/10,10)*10;var N=this.picker.find(".datepicker-years").find("th:eq(1)").text(A+"-"+(A+9)).end().find("td");
A-=1;var E=j.map(this.dates,function(P){return P.getUTCFullYear();}),K;for(var H=-1;H<11;H++){K=["year"];if(H===-1){K.push("old");}else{if(H===10){K.push("new");
}}if(j.inArray(A,E)!==-1){K.push("active");}if(A<F||A>x){K.push("disabled");}z+='<span class="'+K.join(" ")+'">'+A+"</span>";A+=1;}N.html(z);},updateNavArrows:function(){if(!this._allow_update){return;
}var s=new Date(this.viewDate),q=s.getUTCFullYear(),r=s.getUTCMonth();switch(this.viewMode){case 0:if(this.o.startDate!==-Infinity&&q<=this.o.startDate.getUTCFullYear()&&r<=this.o.startDate.getUTCMonth()){this.picker.find(".prev").css({visibility:"hidden"});
}else{this.picker.find(".prev").css({visibility:"visible"});}if(this.o.endDate!==Infinity&&q>=this.o.endDate.getUTCFullYear()&&r>=this.o.endDate.getUTCMonth()){this.picker.find(".next").css({visibility:"hidden"});
}else{this.picker.find(".next").css({visibility:"visible"});}break;case 1:case 2:if(this.o.startDate!==-Infinity&&q<=this.o.startDate.getUTCFullYear()){this.picker.find(".prev").css({visibility:"hidden"});
}else{this.picker.find(".prev").css({visibility:"visible"});}if(this.o.endDate!==Infinity&&q>=this.o.endDate.getUTCFullYear()){this.picker.find(".next").css({visibility:"hidden"});
}else{this.picker.find(".next").css({visibility:"visible"});}break;}},click:function(u){u.preventDefault();var v=j(u.target).closest("span, td, th"),x,w,y;
if(v.length===1){switch(v[0].nodeName.toLowerCase()){case"th":switch(v[0].className){case"datepicker-switch":this.showMode(1);break;case"prev":case"next":var q=m.modes[this.viewMode].navStep*(v[0].className==="prev"?-1:1);
switch(this.viewMode){case 0:this.viewDate=this.moveMonth(this.viewDate,q);this._trigger("changeMonth",this.viewDate);break;case 1:case 2:this.viewDate=this.moveYear(this.viewDate,q);
if(this.viewMode===1){this._trigger("changeYear",this.viewDate);}break;}this.fill();break;case"today":var r=new Date();r=n(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0);
this.showMode(-2);var s=this.o.todayBtn==="linked"?null:"view";this._setDate(r,s);break;case"clear":var t;if(this.isInput){t=this.element;}else{if(this.component){t=this.element.find("input");
}}if(t){t.val("").change();}this.update();this._trigger("changeDate");if(this.o.autoclose){this.hide();}break;}break;case"span":if(!v.is(".disabled")){this.viewDate.setUTCDate(1);
if(v.is(".month")){y=1;w=v.parent().find("span").index(v);x=this.viewDate.getUTCFullYear();this.viewDate.setUTCMonth(w);this._trigger("changeMonth",this.viewDate);
if(this.o.minViewMode===1){this._setDate(n(x,w,y));}}else{y=1;w=0;x=parseInt(v.text(),10)||0;this.viewDate.setUTCFullYear(x);this._trigger("changeYear",this.viewDate);
if(this.o.minViewMode===2){this._setDate(n(x,w,y));}}this.showMode(-1);this.fill();}break;case"td":if(v.is(".day")&&!v.is(".disabled")){y=parseInt(v.text(),10)||1;
x=this.viewDate.getUTCFullYear();w=this.viewDate.getUTCMonth();if(v.is(".old")){if(w===0){w=11;x-=1;}else{w-=1;}}else{if(v.is(".new")){if(w===11){w=0;x+=1;
}else{w+=1;}}}this._setDate(n(x,w,y));}break;}}if(this.picker.is(":visible")&&this._focused_from){j(this._focused_from).focus();}delete this._focused_from;
},_toggle_multidate:function(r){var q=this.dates.contains(r);if(!r){this.dates.clear();}else{if(q!==-1){this.dates.remove(q);}else{this.dates.push(r);}}if(typeof this.o.multidate==="number"){while(this.dates.length>this.o.multidate){this.dates.remove(0);
}}},_setDate:function(q,s){if(!s||s==="date"){this._toggle_multidate(q&&new Date(q));}if(!s||s==="view"){this.viewDate=q&&new Date(q);}this.fill();this.setValue();
this._trigger("changeDate");var r;if(this.isInput){r=this.element;}else{if(this.component){r=this.element.find("input");}}if(r){r.change();}if(this.o.autoclose&&(!s||s==="date")){this.hide();
}},moveMonth:function(q,r){if(!q){return f;}if(!r){return q;}var u=new Date(q.valueOf()),y=u.getUTCDate(),v=u.getUTCMonth(),t=Math.abs(r),x,w;r=r>0?1:-1;
if(t===1){w=r===-1?function(){return u.getUTCMonth()===v;}:function(){return u.getUTCMonth()!==x;};x=v+r;u.setUTCMonth(x);if(x<0||x>11){x=(x+12)%12;}}else{for(var s=0;
s<t;s++){u=this.moveMonth(u,r);}x=u.getUTCMonth();u.setUTCDate(y);w=function(){return x!==u.getUTCMonth();};}while(w()){u.setUTCDate(--y);u.setUTCMonth(x);
}return u;},moveYear:function(r,q){return this.moveMonth(r,q*12);},dateWithinRange:function(q){return q>=this.o.startDate&&q<=this.o.endDate;},keydown:function(w){if(this.picker.is(":not(:visible)")){if(w.keyCode===27){this.show();
}return;}var s=false,r,q,u,v=this.focusDate||this.viewDate;switch(w.keyCode){case 27:if(this.focusDate){this.focusDate=null;this.viewDate=this.dates.get(-1)||this.viewDate;
this.fill();}else{this.hide();}w.preventDefault();break;case 37:case 39:if(!this.o.keyboardNavigation){break;}r=w.keyCode===37?-1:1;if(w.ctrlKey){q=this.moveYear(this.dates.get(-1)||g(),r);
u=this.moveYear(v,r);this._trigger("changeYear",this.viewDate);}else{if(w.shiftKey){q=this.moveMonth(this.dates.get(-1)||g(),r);u=this.moveMonth(v,r);this._trigger("changeMonth",this.viewDate);
}else{q=new Date(this.dates.get(-1)||g());q.setUTCDate(q.getUTCDate()+r);u=new Date(v);u.setUTCDate(v.getUTCDate()+r);}}if(this.dateWithinRange(q)){this.focusDate=this.viewDate=u;
this.setValue();this.fill();w.preventDefault();}break;case 38:case 40:if(!this.o.keyboardNavigation){break;}r=w.keyCode===38?-1:1;if(w.ctrlKey){q=this.moveYear(this.dates.get(-1)||g(),r);
u=this.moveYear(v,r);this._trigger("changeYear",this.viewDate);}else{if(w.shiftKey){q=this.moveMonth(this.dates.get(-1)||g(),r);u=this.moveMonth(v,r);this._trigger("changeMonth",this.viewDate);
}else{q=new Date(this.dates.get(-1)||g());q.setUTCDate(q.getUTCDate()+r*7);u=new Date(v);u.setUTCDate(v.getUTCDate()+r*7);}}if(this.dateWithinRange(q)){this.focusDate=this.viewDate=u;
this.setValue();this.fill();w.preventDefault();}break;case 32:break;case 13:v=this.focusDate||this.dates.get(-1)||this.viewDate;this._toggle_multidate(v);
s=true;this.focusDate=null;this.viewDate=this.dates.get(-1)||this.viewDate;this.setValue();this.fill();if(this.picker.is(":visible")){w.preventDefault();
if(this.o.autoclose){this.hide();}}break;case 9:this.focusDate=null;this.viewDate=this.dates.get(-1)||this.viewDate;this.fill();this.hide();break;}if(s){if(this.dates.length){this._trigger("changeDate");
}else{this._trigger("clearDate");}var t;if(this.isInput){t=this.element;}else{if(this.component){t=this.element.find("input");}}if(t){t.change();}}},showMode:function(q){if(q){this.viewMode=Math.max(this.o.minViewMode,Math.min(2,this.viewMode+q));
}this.picker.find(">div").hide().filter(".datepicker-"+m.modes[this.viewMode].clsName).css("display","block");this.updateNavArrows();}};var p=function(r,q){this.element=j(r);
this.inputs=j.map(q.inputs,function(s){return s.jquery?s[0]:s;});delete q.inputs;j(this.inputs).datepicker(q).bind("changeDate",j.proxy(this.dateUpdated,this));
this.pickers=j.map(this.inputs,function(s){return j(s).data("datepicker");});this.updateDates();};p.prototype={updateDates:function(){this.dates=j.map(this.pickers,function(q){return q.getUTCDate();
});this.updateRanges();},updateRanges:function(){var q=j.map(this.dates,function(r){return r.valueOf();});j.each(this.pickers,function(r,s){s.setRange(q);
});},dateUpdated:function(t){if(this.updating){return;}this.updating=true;var u=j(t.target).data("datepicker"),s=u.getUTCDate(),r=j.inArray(t.target,this.inputs),q=this.inputs.length;
if(r===-1){return;}j.each(this.pickers,function(v,w){if(!w.getUTCDate()){w.setUTCDate(s);}});if(s<this.dates[r]){while(r>=0&&s<this.dates[r]){this.pickers[r--].setUTCDate(s);
}}else{if(s>this.dates[r]){while(r<q&&s>this.dates[r]){this.pickers[r++].setUTCDate(s);}}}this.updateDates();delete this.updating;},remove:function(){j.map(this.pickers,function(q){q.remove();
});delete this.element.data().datepicker;}};function i(t,w){var v=j(t).data(),q={},u,s=new RegExp("^"+w.toLowerCase()+"([A-Z])");w=new RegExp("^"+w.toLowerCase());
function x(z,y){return y.toLowerCase();}for(var r in v){if(w.test(r)){u=r.replace(s,x);q[u]=v[r];}}return q;}function a(s){var q={};if(!b[s]){s=s.split("-")[0];
if(!b[s]){return;}}var r=b[s];j.each(o,function(u,t){if(t in r){q[t]=r[t];}});return q;}var d=j.fn.datepicker;j.fn.datepicker=function(s){var q=Array.apply(null,arguments);
q.shift();var r;this.each(function(){var A=j(this),y=A.data("datepicker"),u=typeof s==="object"&&s;if(!y){var w=i(this,"date"),t=j.extend({},h,w,u),v=a(t.language),x=j.extend({},h,v,w,u);
if(A.is(".input-daterange")||x.inputs){var z={inputs:x.inputs||A.find("input").toArray()};A.data("datepicker",(y=new p(this,j.extend(x,z))));}else{A.data("datepicker",(y=new k(this,x)));
}}if(typeof s==="string"&&typeof y[s]==="function"){r=y[s].apply(y,q);if(r!==f){return false;}}});if(r!==f){return r;}else{return this;}};var h=j.fn.datepicker.defaults={autoclose:false,beforeShowDay:j.noop,calendarWeeks:false,clearBtn:false,daysOfWeekDisabled:[],endDate:Infinity,forceParse:true,format:"mm/dd/yyyy",keyboardNavigation:true,language:"en",minViewMode:0,multidate:false,multidateSeparator:",",orientation:"auto",rtl:false,startDate:-Infinity,startView:0,todayBtn:false,todayHighlight:false,weekStart:0};
var o=j.fn.datepicker.locale_opts=["format","rtl","weekStart"];j.fn.datepicker.Constructor=k;var b=j.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear"}};
var m={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(q){return(((q%4===0)&&(q%100!==0))||(q%400===0));
},getDaysInMonth:function(q,r){return[31,(m.isLeapYear(q)?29:28),31,30,31,30,31,31,30,31,30,31][r];},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(s){var q=s.replace(this.validParts,"\0").split("\0"),r=s.match(this.validParts);
if(!q||!q.length||!r||r.length===0){throw new Error("Invalid date format.");}return{separators:q,parts:r};},parseDate:function(H,E,B){if(!H){return f;}if(H instanceof Date){return H;
}if(typeof E==="string"){E=m.parseFormat(E);}var t=/([\-+]\d+)([dmwy])/,z=H.match(/([\-+]\d+)([dmwy])/g),A,y,D;if(/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(H)){H=new Date();
for(D=0;D<z.length;D++){A=t.exec(z[D]);y=parseInt(A[1]);switch(A[2]){case"d":H.setUTCDate(H.getUTCDate()+y);break;case"m":H=k.prototype.moveMonth.call(k.prototype,H,y);
break;case"w":H.setUTCDate(H.getUTCDate()+y*7);break;case"y":H=k.prototype.moveYear.call(k.prototype,H,y);break;}}return n(H.getUTCFullYear(),H.getUTCMonth(),H.getUTCDate(),0,0,0);
}z=H&&H.match(this.nonpunctuation)||[];H=new Date();var u={},F=["yyyy","yy","M","MM","m","mm","d","dd"],x={yyyy:function(J,s){return J.setUTCFullYear(s);
},yy:function(J,s){return J.setUTCFullYear(2000+s);},m:function(J,s){if(isNaN(J)){return J;}s-=1;while(s<0){s+=12;}s%=12;J.setUTCMonth(s);while(J.getUTCMonth()!==s){J.setUTCDate(J.getUTCDate()-1);
}return J;},d:function(J,s){return J.setUTCDate(s);}},I,r;x.M=x.MM=x.mm=x.m;x.dd=x.d;H=n(H.getFullYear(),H.getMonth(),H.getDate(),0,0,0);var q=E.parts.slice();
if(z.length!==q.length){q=j(q).filter(function(s,J){return j.inArray(J,F)!==-1;}).toArray();}function G(){var s=this.slice(0,z[D].length),J=z[D].slice(0,s.length);
return s===J;}if(z.length===q.length){var C;for(D=0,C=q.length;D<C;D++){I=parseInt(z[D],10);A=q[D];if(isNaN(I)){switch(A){case"MM":r=j(b[B].months).filter(G);
I=j.inArray(r[0],b[B].months)+1;break;case"M":r=j(b[B].monthsShort).filter(G);I=j.inArray(r[0],b[B].monthsShort)+1;break;}}u[A]=I;}var v,w;for(D=0;D<F.length;
D++){w=F[D];if(w in u&&!isNaN(u[w])){v=new Date(H);x[w](v,u[w]);if(!isNaN(v)){H=v;}}}}return H;},formatDate:function(q,u,w){if(!q){return"";}if(typeof u==="string"){u=m.parseFormat(u);
}var v={d:q.getUTCDate(),D:b[w].daysShort[q.getUTCDay()],DD:b[w].days[q.getUTCDay()],m:q.getUTCMonth()+1,M:b[w].monthsShort[q.getUTCMonth()],MM:b[w].months[q.getUTCMonth()],yy:q.getUTCFullYear().toString().substring(2),yyyy:q.getUTCFullYear()};
v.dd=(v.d<10?"0":"")+v.d;v.mm=(v.m<10?"0":"")+v.m;q=[];var t=j.extend([],u.separators);for(var s=0,r=u.parts.length;s<=r;s++){if(t.length){q.push(t.shift());
}q.push(v[u.parts[s]]);}return q.join("");},headTemplate:'<thead><tr><th class="prev">&laquo;</th><th colspan="5" class="datepicker-switch"></th><th class="next">&raquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};
m.template='<div class="datepicker"><div class="datepicker-days"><table class=" table-condensed">'+m.headTemplate+"<tbody></tbody>"+m.footTemplate+'</table></div><div class="datepicker-months"><table class="table-condensed">'+m.headTemplate+m.contTemplate+m.footTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+m.headTemplate+m.contTemplate+m.footTemplate+"</table></div></div>";
j.fn.datepicker.DPGlobal=m;j.fn.datepicker.noConflict=function(){j.fn.datepicker=d;return this;};j(document).on("focus.datepicker.data-api click.datepicker.data-api",'[data-provide="datepicker"]',function(r){var q=j(this);
if(q.data("datepicker")){return;}r.preventDefault();q.datepicker("show");});j(function(){j('[data-provide="datepicker-inline"]').datepicker();});}(window.jQuery));
;
(function(a){a.fn.datepicker.dates.ru={days:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],daysShort:["Вск","Пнд","Втр","Срд","Чтв","Птн","Суб","Вск"],daysMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб","Вс"],months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthsShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],today:"Сегодня",clear:"Убрать дату",weekStart:1};
a.fn.datepicker.defaults.format="dd.mm.yyyy";a.fn.datepicker.defaults.language="ru";a.fn.datepicker.defaults.autoclose=true;}(jQuery));
/*
---
MooTools: the javascript framework

web build:
 - http://mootools.net/core/7c56cfef9dddcf170a5d68e3fb61cfd7

packager build:
 - packager build Core/Core Core/Array Core/String Core/Number Core/Function Core/Object Core/Event Core/Browser Core/Class Core/Class.Extras Core/Slick.Parser Core/Slick.Finder Core/Element Core/Element.Style Core/Element.Event Core/Element.Dimensions Core/Fx Core/Fx.CSS Core/Fx.Tween Core/Fx.Morph Core/Fx.Transitions Core/Request Core/Request.HTML Core/Request.JSON Core/Cookie Core/JSON Core/DOMReady Core/Swiff

copyrights:
  - [MooTools](http://mootools.net)

licenses:
  - [MIT License](http://mootools.net/license.txt)
...
*/
(function(){this.MooTools={version:"1.3.2",build:"c9f1ff10e9e7facb65e9481049ed1b450959d587"};var e=this.typeOf=function(i){if(i==null){return"null";}if(i.$family){return i.$family();
}if(i.nodeName){if(i.nodeType==1){return"element";}if(i.nodeType==3){return(/\S/).test(i.nodeValue)?"textnode":"whitespace";}}else{if(typeof i.length=="number"){if(i.callee){return"arguments";
}if("item" in i){return"collection";}}}return typeof i;};var u=this.instanceOf=function(w,i){if(w==null){return false;}var v=w.$constructor||w.constructor;
while(v){if(v===i){return true;}v=v.parent;}return w instanceof i;};var f=this.Function;var r=true;for(var q in {toString:1}){r=null;}if(r){r=["hasOwnProperty","valueOf","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","constructor"];
}f.prototype.overloadSetter=function(v){var i=this;return function(x,w){if(x==null){return this;}if(v||typeof x!="string"){for(var y in x){i.call(this,y,x[y]);
}if(r){for(var z=r.length;z--;){y=r[z];if(x.hasOwnProperty(y)){i.call(this,y,x[y]);}}}}else{i.call(this,x,w);}return this;};};f.prototype.overloadGetter=function(v){var i=this;
return function(x){var y,w;if(v||typeof x!="string"){y=x;}else{if(arguments.length>1){y=arguments;}}if(y){w={};for(var z=0;z<y.length;z++){w[y[z]]=i.call(this,y[z]);
}}else{w=i.call(this,x);}return w;};};f.prototype.extend=function(i,v){this[i]=v;}.overloadSetter();f.prototype.implement=function(i,v){this.prototype[i]=v;
}.overloadSetter();var o=Array.prototype.slice;f.from=function(i){return(e(i)=="function")?i:function(){return i;};};Array.from=function(i){if(i==null){return[];
}return(k.isEnumerable(i)&&typeof i!="string")?(e(i)=="array")?i:o.call(i):[i];};Number.from=function(v){var i=parseFloat(v);return isFinite(i)?i:null;
};String.from=function(i){return i+"";};f.implement({hide:function(){this.$hidden=true;return this;},protect:function(){this.$protected=true;return this;
}});var k=this.Type=function(x,w){if(x){var v=x.toLowerCase();var i=function(y){return(e(y)==v);};k["is"+x]=i;if(w!=null){w.prototype.$family=(function(){return v;
}).hide();w.type=i;}}if(w==null){return null;}w.extend(this);w.$constructor=k;w.prototype.$constructor=w;return w;};var p=Object.prototype.toString;k.isEnumerable=function(i){return(i!=null&&typeof i.length=="number"&&p.call(i)!="[object Function]");
};var b={};var d=function(i){var v=e(i.prototype);return b[v]||(b[v]=[]);};var h=function(w,A){if(A&&A.$hidden){return;}var v=d(this);for(var x=0;x<v.length;
x++){var z=v[x];if(e(z)=="type"){h.call(z,w,A);}else{z.call(this,w,A);}}var y=this.prototype[w];if(y==null||!y.$protected){this.prototype[w]=A;}if(this[w]==null&&e(A)=="function"){t.call(this,w,function(i){return A.apply(i,o.call(arguments,1));
});}};var t=function(i,w){if(w&&w.$hidden){return;}var v=this[i];if(v==null||!v.$protected){this[i]=w;}};k.implement({implement:h.overloadSetter(),extend:t.overloadSetter(),alias:function(i,v){h.call(this,i,this.prototype[v]);
}.overloadSetter(),mirror:function(i){d(this).push(i);return this;}});new k("Type",k);var c=function(v,z,x){var w=(z!=Object),D=z.prototype;if(w){z=new k(v,z);
}for(var A=0,y=x.length;A<y;A++){var E=x[A],C=z[E],B=D[E];if(C){C.protect();}if(w&&B){delete D[E];D[E]=B.protect();}}if(w){z.implement(D);}return c;};c("String",String,["charAt","charCodeAt","concat","indexOf","lastIndexOf","match","quote","replace","search","slice","split","substr","substring","toLowerCase","toUpperCase"])("Array",Array,["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice","indexOf","lastIndexOf","filter","forEach","every","map","some","reduce","reduceRight"])("Number",Number,["toExponential","toFixed","toLocaleString","toPrecision"])("Function",f,["apply","call","bind"])("RegExp",RegExp,["exec","test"])("Object",Object,["create","defineProperty","defineProperties","keys","getPrototypeOf","getOwnPropertyDescriptor","getOwnPropertyNames","preventExtensions","isExtensible","seal","isSealed","freeze","isFrozen"])("Date",Date,["now"]);
Object.extend=t.overloadSetter();Date.extend("now",function(){return +(new Date);});new k("Boolean",Boolean);Number.prototype.$family=function(){return isFinite(this)?"number":"null";
}.hide();Number.extend("random",function(v,i){return Math.floor(Math.random()*(i-v+1)+v);});var l=Object.prototype.hasOwnProperty;Object.extend("forEach",function(i,w,x){for(var v in i){if(l.call(i,v)){w.call(x,i[v],v,i);
}}});Object.each=Object.forEach;Array.implement({forEach:function(x,y){for(var w=0,v=this.length;w<v;w++){if(w in this){x.call(y,this[w],w,this);}}},each:function(i,v){Array.forEach(this,i,v);
return this;}});var s=function(i){switch(e(i)){case"array":return i.clone();case"object":return Object.clone(i);default:return i;}};Array.implement("clone",function(){var v=this.length,w=new Array(v);
while(v--){w[v]=s(this[v]);}return w;});var a=function(v,i,w){switch(e(w)){case"object":if(e(v[i])=="object"){Object.merge(v[i],w);}else{v[i]=Object.clone(w);
}break;case"array":v[i]=w.clone();break;default:v[i]=w;}return v;};Object.extend({merge:function(C,y,x){if(e(y)=="string"){return a(C,y,x);}for(var B=1,w=arguments.length;
B<w;B++){var z=arguments[B];for(var A in z){a(C,A,z[A]);}}return C;},clone:function(i){var w={};for(var v in i){w[v]=s(i[v]);}return w;},append:function(z){for(var y=1,w=arguments.length;
y<w;y++){var v=arguments[y]||{};for(var x in v){z[x]=v[x];}}return z;}});["Object","WhiteSpace","TextNode","Collection","Arguments"].each(function(i){new k(i);
});var j=Date.now();String.extend("uniqueID",function(){return(j++).toString(36);});var g=this.Hash=new k("Hash",function(i){if(e(i)=="hash"){i=Object.clone(i.getClean());
}for(var v in i){this[v]=i[v];}return this;});g.implement({forEach:function(i,v){Object.forEach(this,i,v);},getClean:function(){var v={};for(var i in this){if(this.hasOwnProperty(i)){v[i]=this[i];
}}return v;},getLength:function(){var v=0;for(var i in this){if(this.hasOwnProperty(i)){v++;}}return v;}});g.alias("each","forEach");Object.type=k.isObject;
var n=this.Native=function(i){return new k(i.name,i.initialize);};n.type=k.type;n.implement=function(x,v){for(var w=0;w<x.length;w++){x[w].implement(v);
}return n;};var m=Array.type;Array.type=function(i){return u(i,Array)||m(i);};this.$A=function(i){return Array.from(i).slice();};this.$arguments=function(v){return function(){return arguments[v];
};};this.$chk=function(i){return !!(i||i===0);};this.$clear=function(i){clearTimeout(i);clearInterval(i);return null;};this.$defined=function(i){return(i!=null);
};this.$each=function(w,v,x){var i=e(w);((i=="arguments"||i=="collection"||i=="array"||i=="elements")?Array:Object).each(w,v,x);};this.$empty=function(){};
this.$extend=function(v,i){return Object.append(v,i);};this.$H=function(i){return new g(i);};this.$merge=function(){var i=Array.slice(arguments);i.unshift({});
return Object.merge.apply(null,i);};this.$lambda=f.from;this.$mixin=Object.merge;this.$random=Number.random;this.$splat=Array.from;this.$time=Date.now;
this.$type=function(i){var v=e(i);if(v=="elements"){return"array";}return(v=="null")?false:v;};this.$unlink=function(i){switch(e(i)){case"object":return Object.clone(i);
case"array":return Array.clone(i);case"hash":return new g(i);default:return i;}};})();Array.implement({every:function(c,d){for(var b=0,a=this.length;b<a;
b++){if((b in this)&&!c.call(d,this[b],b,this)){return false;}}return true;},filter:function(d,e){var c=[];for(var b=0,a=this.length;b<a;b++){if((b in this)&&d.call(e,this[b],b,this)){c.push(this[b]);
}}return c;},indexOf:function(c,d){var a=this.length;for(var b=(d<0)?Math.max(0,a+d):d||0;b<a;b++){if(this[b]===c){return b;}}return -1;},map:function(d,e){var c=[];
for(var b=0,a=this.length;b<a;b++){if(b in this){c[b]=d.call(e,this[b],b,this);}}return c;},some:function(c,d){for(var b=0,a=this.length;b<a;b++){if((b in this)&&c.call(d,this[b],b,this)){return true;
}}return false;},clean:function(){return this.filter(function(a){return a!=null;});},invoke:function(a){var b=Array.slice(arguments,1);return this.map(function(c){return c[a].apply(c,b);
});},associate:function(c){var d={},b=Math.min(this.length,c.length);for(var a=0;a<b;a++){d[c[a]]=this[a];}return d;},link:function(c){var a={};for(var e=0,b=this.length;
e<b;e++){for(var d in c){if(c[d](this[e])){a[d]=this[e];delete c[d];break;}}}return a;},contains:function(a,b){return this.indexOf(a,b)!=-1;},append:function(a){this.push.apply(this,a);
return this;},getLast:function(){return(this.length)?this[this.length-1]:null;},getRandom:function(){return(this.length)?this[Number.random(0,this.length-1)]:null;
},include:function(a){if(!this.contains(a)){this.push(a);}return this;},combine:function(c){for(var b=0,a=c.length;b<a;b++){this.include(c[b]);}return this;
},erase:function(b){for(var a=this.length;a--;){if(this[a]===b){this.splice(a,1);}}return this;},empty:function(){this.length=0;return this;},flatten:function(){var d=[];
for(var b=0,a=this.length;b<a;b++){var c=typeOf(this[b]);if(c=="null"){continue;}d=d.concat((c=="array"||c=="collection"||c=="arguments"||instanceOf(this[b],Array))?Array.flatten(this[b]):this[b]);
}return d;},pick:function(){for(var b=0,a=this.length;b<a;b++){if(this[b]!=null){return this[b];}}return null;},hexToRgb:function(b){if(this.length!=3){return null;
}var a=this.map(function(c){if(c.length==1){c+=c;}return c.toInt(16);});return(b)?a:"rgb("+a+")";},rgbToHex:function(d){if(this.length<3){return null;}if(this.length==4&&this[3]==0&&!d){return"transparent";
}var b=[];for(var a=0;a<3;a++){var c=(this[a]-0).toString(16);b.push((c.length==1)?"0"+c:c);}return(d)?b:"#"+b.join("");}});Array.alias("extend","append");
var $pick=function(){return Array.from(arguments).pick();};String.implement({test:function(a,b){return((typeOf(a)=="regexp")?a:new RegExp(""+a,b)).test(this);
},contains:function(a,b){return(b)?(b+this+b).indexOf(b+a+b)>-1:this.indexOf(a)>-1;},trim:function(){return this.replace(/^\s+|\s+$/g,"");},clean:function(){return this.replace(/\s+/g," ").trim();
},camelCase:function(){return this.replace(/-\D/g,function(a){return a.charAt(1).toUpperCase();});},hyphenate:function(){return this.replace(/[A-Z]/g,function(a){return("-"+a.charAt(0).toLowerCase());
});},capitalize:function(){return this.replace(/\b[a-z]/g,function(a){return a.toUpperCase();});},escapeRegExp:function(){return this.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1");
},toInt:function(a){return parseInt(this,a||10);},toFloat:function(){return parseFloat(this);},hexToRgb:function(b){var a=this.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);
return(a)?a.slice(1).hexToRgb(b):null;},rgbToHex:function(b){var a=this.match(/\d{1,3}/g);return(a)?a.rgbToHex(b):null;},substitute:function(a,b){return this.replace(b||(/\\?\{([^{}]+)\}/g),function(d,c){if(d.charAt(0)=="\\"){return d.slice(1);
}return(a[c]!=null)?a[c]:"";});}});Number.implement({limit:function(b,a){return Math.min(a,Math.max(b,this));},round:function(a){a=Math.pow(10,a||0).toFixed(a<0?-a:0);
return Math.round(this*a)/a;},times:function(b,c){for(var a=0;a<this;a++){b.call(c,a,this);}},toFloat:function(){return parseFloat(this);},toInt:function(a){return parseInt(this,a||10);
}});Number.alias("each","times");(function(b){var a={};b.each(function(c){if(!Number[c]){a[c]=function(){return Math[c].apply(null,[this].concat(Array.from(arguments)));
};}});Number.implement(a);})(["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","sin","sqrt","tan"]);Function.extend({attempt:function(){for(var b=0,a=arguments.length;
b<a;b++){try{return arguments[b]();}catch(c){}}return null;}});Function.implement({attempt:function(a,c){try{return this.apply(c,Array.from(a));}catch(b){}return null;
},bind:function(c){var a=this,b=(arguments.length>1)?Array.slice(arguments,1):null;return function(){if(!b&&!arguments.length){return a.call(c);}if(b&&arguments.length){return a.apply(c,b.concat(Array.from(arguments)));
}return a.apply(c,b||arguments);};},pass:function(b,c){var a=this;if(b!=null){b=Array.from(b);}return function(){return a.apply(c,b||arguments);};},delay:function(b,c,a){return setTimeout(this.pass((a==null?[]:a),c),b);
},periodical:function(c,b,a){return setInterval(this.pass((a==null?[]:a),b),c);}});delete Function.prototype.bind;Function.implement({create:function(b){var a=this;
b=b||{};return function(d){var c=b.arguments;c=(c!=null)?Array.from(c):Array.slice(arguments,(b.event)?1:0);if(b.event){c=[d||window.event].extend(c);}var e=function(){return a.apply(b.bind||null,c);
};if(b.delay){return setTimeout(e,b.delay);}if(b.periodical){return setInterval(e,b.periodical);}if(b.attempt){return Function.attempt(e);}return e();};
},bind:function(c,b){var a=this;if(b!=null){b=Array.from(b);}return function(){return a.apply(c,b||arguments);};},bindWithEvent:function(c,b){var a=this;
if(b!=null){b=Array.from(b);}return function(d){return a.apply(c,(b==null)?arguments:[d].concat(b));};},run:function(a,b){return this.apply(b,Array.from(a));
}});var $try=Function.attempt;(function(){var a=Object.prototype.hasOwnProperty;Object.extend({subset:function(d,g){var f={};for(var e=0,b=g.length;e<b;
e++){var c=g[e];if(c in d){f[c]=d[c];}}return f;},map:function(b,e,f){var d={};for(var c in b){if(a.call(b,c)){d[c]=e.call(f,b[c],c,b);}}return d;},filter:function(b,e,g){var d={};
for(var c in b){var f=b[c];if(a.call(b,c)&&e.call(g,f,c,b)){d[c]=f;}}return d;},every:function(b,d,e){for(var c in b){if(a.call(b,c)&&!d.call(e,b[c],c)){return false;
}}return true;},some:function(b,d,e){for(var c in b){if(a.call(b,c)&&d.call(e,b[c],c)){return true;}}return false;},keys:function(b){var d=[];for(var c in b){if(a.call(b,c)){d.push(c);
}}return d;},values:function(c){var b=[];for(var d in c){if(a.call(c,d)){b.push(c[d]);}}return b;},getLength:function(b){return Object.keys(b).length;},keyOf:function(b,d){for(var c in b){if(a.call(b,c)&&b[c]===d){return c;
}}return null;},contains:function(b,c){return Object.keyOf(b,c)!=null;},toQueryString:function(b,c){var d=[];Object.each(b,function(h,g){if(c){g=c+"["+g+"]";
}var f;switch(typeOf(h)){case"object":f=Object.toQueryString(h,g);break;case"array":var e={};h.each(function(k,j){e[j]=k;});f=Object.toQueryString(e,g);
break;default:f=g+"="+encodeURIComponent(h);}if(h!=null){d.push(f);}});return d.join("&");}});})();Hash.implement({has:Object.prototype.hasOwnProperty,keyOf:function(a){return Object.keyOf(this,a);
},hasValue:function(a){return Object.contains(this,a);},extend:function(a){Hash.each(a||{},function(c,b){Hash.set(this,b,c);},this);return this;},combine:function(a){Hash.each(a||{},function(c,b){Hash.include(this,b,c);
},this);return this;},erase:function(a){if(this.hasOwnProperty(a)){delete this[a];}return this;},get:function(a){return(this.hasOwnProperty(a))?this[a]:null;
},set:function(a,b){if(!this[a]||this.hasOwnProperty(a)){this[a]=b;}return this;},empty:function(){Hash.each(this,function(b,a){delete this[a];},this);
return this;},include:function(a,b){if(this[a]==null){this[a]=b;}return this;},map:function(a,b){return new Hash(Object.map(this,a,b));},filter:function(a,b){return new Hash(Object.filter(this,a,b));
},every:function(a,b){return Object.every(this,a,b);},some:function(a,b){return Object.some(this,a,b);},getKeys:function(){return Object.keys(this);},getValues:function(){return Object.values(this);
},toQueryString:function(a){return Object.toQueryString(this,a);}});Hash.extend=Object.append;Hash.alias({indexOf:"keyOf",contains:"hasValue"});(function(){var l=this.document;
var j=l.window=this;var b=1;this.$uid=(j.ActiveXObject)?function(e){return(e.uid||(e.uid=[b++]))[0];}:function(e){return e.uid||(e.uid=b++);};$uid(j);$uid(l);
var a=navigator.userAgent.toLowerCase(),c=navigator.platform.toLowerCase(),k=a.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],g=k[1]=="ie"&&l.documentMode;
var p=this.Browser={extend:Function.prototype.extend,name:(k[1]=="version")?k[3]:k[1],version:g||parseFloat((k[1]=="opera"&&k[4])?k[4]:k[2]),Platform:{name:a.match(/ip(?:ad|od|hone)/)?"ios":(a.match(/(?:webos|android)/)||c.match(/mac|win|linux/)||["other"])[0]},Features:{xpath:!!(l.evaluate),air:!!(j.runtime),query:!!(l.querySelector),json:!!(j.JSON)},Plugins:{}};
p[p.name]=true;p[p.name+parseInt(p.version,10)]=true;p.Platform[p.Platform.name]=true;p.Request=(function(){var r=function(){return new XMLHttpRequest();
};var q=function(){return new ActiveXObject("MSXML2.XMLHTTP");};var e=function(){return new ActiveXObject("Microsoft.XMLHTTP");};return Function.attempt(function(){r();
return r;},function(){q();return q;},function(){e();return e;});})();p.Features.xhr=!!(p.Request);var i=(Function.attempt(function(){return navigator.plugins["Shockwave Flash"].description;
},function(){return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version");})||"0 r0").match(/\d+/g);p.Plugins.Flash={version:Number(i[0]||"0."+i[1])||0,build:Number(i[2])||0};
p.exec=function(q){if(!q){return q;}if(j.execScript){j.execScript(q);}else{var e=l.createElement("script");e.setAttribute("type","text/javascript");e.text=q;
l.head.appendChild(e);l.head.removeChild(e);}return q;};String.implement("stripScripts",function(q){var e="";var r=this.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(s,t){e+=t+"\n";
return"";});if(q===true){p.exec(e);}else{if(typeOf(q)=="function"){q(e,r);}}return r;});p.extend({Document:this.Document,Window:this.Window,Element:this.Element,Event:this.Event});
this.Window=this.$constructor=new Type("Window",function(){});this.$family=Function.from("window").hide();Window.mirror(function(e,q){j[e]=q;});this.Document=l.$constructor=new Type("Document",function(){});
l.$family=Function.from("document").hide();Document.mirror(function(e,q){l[e]=q;});l.html=l.documentElement;if(!l.head){l.head=l.getElementsByTagName("head")[0];
}if(l.execCommand){try{l.execCommand("BackgroundImageCache",false,true);}catch(h){}}if(this.attachEvent&&!this.addEventListener){var d=function(){this.detachEvent("onunload",d);
l.head=l.html=l.window=null;};this.attachEvent("onunload",d);}var n=Array.from;try{n(l.html.childNodes);}catch(h){Array.from=function(q){if(typeof q!="string"&&Type.isEnumerable(q)&&typeOf(q)!="array"){var e=q.length,r=new Array(e);
while(e--){r[e]=q[e];}return r;}return n(q);};var m=Array.prototype,o=m.slice;["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice"].each(function(e){var q=m[e];
Array[e]=function(r){return q.apply(Array.from(r),o.call(arguments,1));};});}if(p.Platform.ios){p.Platform.ipod=true;}p.Engine={};var f=function(q,e){p.Engine.name=q;
p.Engine[q+e]=true;p.Engine.version=e;};if(p.ie){p.Engine.trident=true;switch(p.version){case 6:f("trident",4);break;case 7:f("trident",5);break;case 8:f("trident",6);
}}if(p.firefox){p.Engine.gecko=true;if(p.version>=3){f("gecko",19);}else{f("gecko",18);}}if(p.safari||p.chrome){p.Engine.webkit=true;switch(p.version){case 2:f("webkit",419);
break;case 3:f("webkit",420);break;case 4:f("webkit",525);}}if(p.opera){p.Engine.presto=true;if(p.version>=9.6){f("presto",960);}else{if(p.version>=9.5){f("presto",950);
}else{f("presto",925);}}}if(p.name=="unknown"){switch((a.match(/(?:webkit|khtml|gecko)/)||[])[0]){case"webkit":case"khtml":p.Engine.webkit=true;break;case"gecko":p.Engine.gecko=true;
}}this.$exec=p.exec;})();var Event=new Type("Event",function(a,i){if(!i){i=window;}var o=i.document;a=a||i.event;if(a.$extended){return a;}this.$extended=true;
var n=a.type,k=a.target||a.srcElement,m={},c={},q=null,h,l,b,p;while(k&&k.nodeType==3){k=k.parentNode;}if(n.indexOf("key")!=-1){b=a.which||a.keyCode;p=Object.keyOf(Event.Keys,b);
if(n=="keydown"){var d=b-111;if(d>0&&d<13){p="f"+d;}}if(!p){p=String.fromCharCode(b).toLowerCase();}}else{if((/click|mouse|menu/i).test(n)){o=(!o.compatMode||o.compatMode=="CSS1Compat")?o.html:o.body;
m={x:(a.pageX!=null)?a.pageX:a.clientX+o.scrollLeft,y:(a.pageY!=null)?a.pageY:a.clientY+o.scrollTop};c={x:(a.pageX!=null)?a.pageX-i.pageXOffset:a.clientX,y:(a.pageY!=null)?a.pageY-i.pageYOffset:a.clientY};
if((/DOMMouseScroll|mousewheel/).test(n)){l=(a.wheelDelta)?a.wheelDelta/120:-(a.detail||0)/3;}h=(a.which==3)||(a.button==2);if((/over|out/).test(n)){q=a.relatedTarget||a[(n=="mouseover"?"from":"to")+"Element"];
var j=function(){while(q&&q.nodeType==3){q=q.parentNode;}return true;};var g=(Browser.firefox2)?j.attempt():j();q=(g)?q:null;}}else{if((/gesture|touch/i).test(n)){this.rotation=a.rotation;
this.scale=a.scale;this.targetTouches=a.targetTouches;this.changedTouches=a.changedTouches;var f=this.touches=a.touches;if(f&&f[0]){var e=f[0];m={x:e.pageX,y:e.pageY};
c={x:e.clientX,y:e.clientY};}}}}return Object.append(this,{event:a,type:n,page:m,client:c,rightClick:h,wheel:l,relatedTarget:document.id(q),target:document.id(k),code:b,key:p,shift:a.shiftKey,control:a.ctrlKey,alt:a.altKey,meta:a.metaKey});
});Event.Keys={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46};Event.Keys=new Hash(Event.Keys);Event.implement({stop:function(){return this.stopPropagation().preventDefault();
},stopPropagation:function(){if(this.event.stopPropagation){this.event.stopPropagation();}else{this.event.cancelBubble=true;}return this;},preventDefault:function(){if(this.event.preventDefault){this.event.preventDefault();
}else{this.event.returnValue=false;}return this;}});(function(){var a=this.Class=new Type("Class",function(h){if(instanceOf(h,Function)){h={initialize:h};
}var g=function(){e(this);if(g.$prototyping){return this;}this.$caller=null;var i=(this.initialize)?this.initialize.apply(this,arguments):this;this.$caller=this.caller=null;
return i;}.extend(this).implement(h);g.$constructor=a;g.prototype.$constructor=g;g.prototype.parent=c;return g;});var c=function(){if(!this.$caller){throw new Error('The method "parent" cannot be called.');
}var g=this.$caller.$name,h=this.$caller.$owner.parent,i=(h)?h.prototype[g]:null;if(!i){throw new Error('The method "'+g+'" has no parent.');}return i.apply(this,arguments);
};var e=function(g){for(var h in g){var j=g[h];switch(typeOf(j)){case"object":var i=function(){};i.prototype=j;g[h]=e(new i);break;case"array":g[h]=j.clone();
break;}}return g;};var b=function(g,h,j){if(j.$origin){j=j.$origin;}var i=function(){if(j.$protected&&this.$caller==null){throw new Error('The method "'+h+'" cannot be called.');
}var l=this.caller,m=this.$caller;this.caller=m;this.$caller=i;var k=j.apply(this,arguments);this.$caller=m;this.caller=l;return k;}.extend({$owner:g,$origin:j,$name:h});
return i;};var f=function(h,i,g){if(a.Mutators.hasOwnProperty(h)){i=a.Mutators[h].call(this,i);if(i==null){return this;}}if(typeOf(i)=="function"){if(i.$hidden){return this;
}this.prototype[h]=(g)?i:b(this,h,i);}else{Object.merge(this.prototype,h,i);}return this;};var d=function(g){g.$prototyping=true;var h=new g;delete g.$prototyping;
return h;};a.implement("implement",f.overloadSetter());a.Mutators={Extends:function(g){this.parent=g;this.prototype=d(g);},Implements:function(g){Array.from(g).each(function(j){var h=new j;
for(var i in h){f.call(this,i,h[i],true);}},this);}};})();(function(){this.Chain=new Class({$chain:[],chain:function(){this.$chain.append(Array.flatten(arguments));
return this;},callChain:function(){return(this.$chain.length)?this.$chain.shift().apply(this,arguments):false;},clearChain:function(){this.$chain.empty();
return this;}});var a=function(b){return b.replace(/^on([A-Z])/,function(c,d){return d.toLowerCase();});};this.Events=new Class({$events:{},addEvent:function(d,c,b){d=a(d);
if(c==$empty){return this;}this.$events[d]=(this.$events[d]||[]).include(c);if(b){c.internal=true;}return this;},addEvents:function(b){for(var c in b){this.addEvent(c,b[c]);
}return this;},fireEvent:function(e,c,b){e=a(e);var d=this.$events[e];if(!d){return this;}c=Array.from(c);d.each(function(f){if(b){f.delay(b,this,c);}else{f.apply(this,c);
}},this);return this;},removeEvent:function(e,d){e=a(e);var c=this.$events[e];if(c&&!d.internal){var b=c.indexOf(d);if(b!=-1){delete c[b];}}return this;
},removeEvents:function(d){var e;if(typeOf(d)=="object"){for(e in d){this.removeEvent(e,d[e]);}return this;}if(d){d=a(d);}for(e in this.$events){if(d&&d!=e){continue;
}var c=this.$events[e];for(var b=c.length;b--;){if(b in c){this.removeEvent(e,c[b]);}}}return this;}});this.Options=new Class({setOptions:function(){var b=this.options=Object.merge.apply(null,[{},this.options].append(arguments));
if(this.addEvent){for(var c in b){if(typeOf(b[c])!="function"||!(/^on[A-Z]/).test(c)){continue;}this.addEvent(c,b[c]);delete b[c];}}return this;}});})();
(function(){var k,n,l,g,a={},c={},m=/\\/g;var e=function(q,p){if(q==null){return null;}if(q.Slick===true){return q;}q=(""+q).replace(/^\s+|\s+$/g,"");g=!!p;
var o=(g)?c:a;if(o[q]){return o[q];}k={Slick:true,expressions:[],raw:q,reverse:function(){return e(this.raw,true);}};n=-1;while(q!=(q=q.replace(j,b))){}k.length=k.expressions.length;
return o[k.raw]=(g)?h(k):k;};var i=function(o){if(o==="!"){return" ";}else{if(o===" "){return"!";}else{if((/^!/).test(o)){return o.replace(/^!/,"");}else{return"!"+o;
}}}};var h=function(u){var r=u.expressions;for(var p=0;p<r.length;p++){var t=r[p];var q={parts:[],tag:"*",combinator:i(t[0].combinator)};for(var o=0;o<t.length;
o++){var s=t[o];if(!s.reverseCombinator){s.reverseCombinator=" ";}s.combinator=s.reverseCombinator;delete s.reverseCombinator;}t.reverse().push(q);}return u;
};var f=function(o){return o.replace(/[-[\]{}()*+?.\\^$|,#\s]/g,function(p){return"\\"+p;});};var j=new RegExp("^(?:\\s*(,)\\s*|\\s*(<combinator>+)\\s*|(\\s+)|(<unicode>+|\\*)|\\#(<unicode>+)|\\.(<unicode>+)|\\[\\s*(<unicode1>+)(?:\\s*([*^$!~|]?=)(?:\\s*(?:([\"']?)(.*?)\\9)))?\\s*\\](?!\\])|(:+)(<unicode>+)(?:\\((?:(?:([\"'])([^\\13]*)\\13)|((?:\\([^)]+\\)|[^()]*)+))\\))?)".replace(/<combinator>/,"["+f(">+~`!@$%^&={}\\;</")+"]").replace(/<unicode>/g,"(?:[\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])").replace(/<unicode1>/g,"(?:[:\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])"));
function b(x,s,D,z,r,C,q,B,A,y,u,F,G,v,p,w){if(s||n===-1){k.expressions[++n]=[];l=-1;if(s){return"";}}if(D||z||l===-1){D=D||" ";var t=k.expressions[n];
if(g&&t[l]){t[l].reverseCombinator=i(D);}t[++l]={combinator:D,tag:"*"};}var o=k.expressions[n][l];if(r){o.tag=r.replace(m,"");}else{if(C){o.id=C.replace(m,"");
}else{if(q){q=q.replace(m,"");if(!o.classList){o.classList=[];}if(!o.classes){o.classes=[];}o.classList.push(q);o.classes.push({value:q,regexp:new RegExp("(^|\\s)"+f(q)+"(\\s|$)")});
}else{if(G){w=w||p;w=w?w.replace(m,""):null;if(!o.pseudos){o.pseudos=[];}o.pseudos.push({key:G.replace(m,""),value:w,type:F.length==1?"class":"element"});
}else{if(B){B=B.replace(m,"");u=(u||"").replace(m,"");var E,H;switch(A){case"^=":H=new RegExp("^"+f(u));break;case"$=":H=new RegExp(f(u)+"$");break;case"~=":H=new RegExp("(^|\\s)"+f(u)+"(\\s|$)");
break;case"|=":H=new RegExp("^"+f(u)+"(-|$)");break;case"=":E=function(I){return u==I;};break;case"*=":E=function(I){return I&&I.indexOf(u)>-1;};break;
case"!=":E=function(I){return u!=I;};break;default:E=function(I){return !!I;};}if(u==""&&(/^[*$^]=$/).test(A)){E=function(){return false;};}if(!E){E=function(I){return I&&H.test(I);
};}if(!o.attributes){o.attributes=[];}o.attributes.push({key:B,operator:A,value:u,test:E});}}}}}return"";}var d=(this.Slick||{});d.parse=function(o){return e(o);
};d.escapeRegExp=f;if(!this.Slick){this.Slick=d;}}).apply((typeof exports!="undefined")?exports:this);(function(){var j={},l={},b=Object.prototype.toString;
j.isNativeCode=function(c){return(/\{\s*\[native code\]\s*\}/).test(""+c);};j.isXML=function(c){return(!!c.xmlVersion)||(!!c.xml)||(b.call(c)=="[object XMLDocument]")||(c.nodeType==9&&c.documentElement.nodeName!="HTML");
};j.setDocument=function(w){var t=w.nodeType;if(t==9){}else{if(t){w=w.ownerDocument;}else{if(w.navigator){w=w.document;}else{return;}}}if(this.document===w){return;
}this.document=w;var y=w.documentElement,u=this.getUIDXML(y),o=l[u],A;if(o){for(A in o){this[A]=o[A];}return;}o=l[u]={};o.root=y;o.isXMLDocument=this.isXML(w);
o.brokenStarGEBTN=o.starSelectsClosedQSA=o.idGetsName=o.brokenMixedCaseQSA=o.brokenGEBCN=o.brokenCheckedQSA=o.brokenEmptyAttributeQSA=o.isHTMLDocument=o.nativeMatchesSelector=false;
var m,n,x,q,r;var s,c="slick_uniqueid";var z=w.createElement("div");var p=w.body||w.getElementsByTagName("body")[0]||y;p.appendChild(z);try{z.innerHTML='<a id="'+c+'"></a>';
o.isHTMLDocument=!!w.getElementById(c);}catch(v){}if(o.isHTMLDocument){z.style.display="none";z.appendChild(w.createComment(""));n=(z.getElementsByTagName("*").length>1);
try{z.innerHTML="foo</foo>";s=z.getElementsByTagName("*");m=(s&&!!s.length&&s[0].nodeName.charAt(0)=="/");}catch(v){}o.brokenStarGEBTN=n||m;try{z.innerHTML='<a name="'+c+'"></a><b id="'+c+'"></b>';
o.idGetsName=w.getElementById(c)===z.firstChild;}catch(v){}if(z.getElementsByClassName){try{z.innerHTML='<a class="f"></a><a class="b"></a>';z.getElementsByClassName("b").length;
z.firstChild.className="b";q=(z.getElementsByClassName("b").length!=2);}catch(v){}try{z.innerHTML='<a class="a"></a><a class="f b a"></a>';x=(z.getElementsByClassName("a").length!=2);
}catch(v){}o.brokenGEBCN=q||x;}if(z.querySelectorAll){try{z.innerHTML="foo</foo>";s=z.querySelectorAll("*");o.starSelectsClosedQSA=(s&&!!s.length&&s[0].nodeName.charAt(0)=="/");
}catch(v){}try{z.innerHTML='<a class="MiX"></a>';o.brokenMixedCaseQSA=!z.querySelectorAll(".MiX").length;}catch(v){}try{z.innerHTML='<select><option selected="selected">a</option></select>';
o.brokenCheckedQSA=(z.querySelectorAll(":checked").length==0);}catch(v){}try{z.innerHTML='<a class=""></a>';o.brokenEmptyAttributeQSA=(z.querySelectorAll('[class*=""]').length!=0);
}catch(v){}}try{z.innerHTML='<form action="s"><input id="action"/></form>';r=(z.firstChild.getAttribute("action")!="s");}catch(v){}o.nativeMatchesSelector=y.matchesSelector||y.mozMatchesSelector||y.webkitMatchesSelector;
if(o.nativeMatchesSelector){try{o.nativeMatchesSelector.call(y,":slick");o.nativeMatchesSelector=null;}catch(v){}}}try{y.slick_expando=1;delete y.slick_expando;
o.getUID=this.getUIDHTML;}catch(v){o.getUID=this.getUIDXML;}p.removeChild(z);z=s=p=null;o.getAttribute=(o.isHTMLDocument&&r)?function(D,B){var E=this.attributeGetters[B];
if(E){return E.call(D);}var C=D.getAttributeNode(B);return(C)?C.nodeValue:null;}:function(C,B){var D=this.attributeGetters[B];return(D)?D.call(C):C.getAttribute(B);
};o.hasAttribute=(y&&this.isNativeCode(y.hasAttribute))?function(C,B){return C.hasAttribute(B);}:function(C,B){C=C.getAttributeNode(B);return !!(C&&(C.specified||C.nodeValue));
};o.contains=(y&&this.isNativeCode(y.contains))?function(B,C){return B.contains(C);}:(y&&y.compareDocumentPosition)?function(B,C){return B===C||!!(B.compareDocumentPosition(C)&16);
}:function(B,C){if(C){do{if(C===B){return true;}}while((C=C.parentNode));}return false;};o.documentSorter=(y.compareDocumentPosition)?function(C,B){if(!C.compareDocumentPosition||!B.compareDocumentPosition){return 0;
}return C.compareDocumentPosition(B)&4?-1:C===B?0:1;}:("sourceIndex" in y)?function(C,B){if(!C.sourceIndex||!B.sourceIndex){return 0;}return C.sourceIndex-B.sourceIndex;
}:(w.createRange)?function(E,C){if(!E.ownerDocument||!C.ownerDocument){return 0;}var D=E.ownerDocument.createRange(),B=C.ownerDocument.createRange();D.setStart(E,0);
D.setEnd(E,0);B.setStart(C,0);B.setEnd(C,0);return D.compareBoundaryPoints(Range.START_TO_END,B);}:null;y=null;for(A in o){this[A]=o[A];}};var e=/^([#.]?)((?:[\w-]+|\*))$/,g=/\[.+[*$^]=(?:""|'')?\]/,f={};
j.search=function(U,z,H,s){var p=this.found=(s)?null:(H||[]);if(!U){return p;}else{if(U.navigator){U=U.document;}else{if(!U.nodeType){return p;}}}var F,O,V=this.uniques={},I=!!(H&&H.length),y=(U.nodeType==9);
if(this.document!==(y?U:U.ownerDocument)){this.setDocument(U);}if(I){for(O=p.length;O--;){V[this.getUID(p[O])]=true;}}if(typeof z=="string"){var r=z.match(e);
simpleSelectors:if(r){var u=r[1],v=r[2],A,E;if(!u){if(v=="*"&&this.brokenStarGEBTN){break simpleSelectors;}E=U.getElementsByTagName(v);if(s){return E[0]||null;
}for(O=0;A=E[O++];){if(!(I&&V[this.getUID(A)])){p.push(A);}}}else{if(u=="#"){if(!this.isHTMLDocument||!y){break simpleSelectors;}A=U.getElementById(v);
if(!A){return p;}if(this.idGetsName&&A.getAttributeNode("id").nodeValue!=v){break simpleSelectors;}if(s){return A||null;}if(!(I&&V[this.getUID(A)])){p.push(A);
}}else{if(u=="."){if(!this.isHTMLDocument||((!U.getElementsByClassName||this.brokenGEBCN)&&U.querySelectorAll)){break simpleSelectors;}if(U.getElementsByClassName&&!this.brokenGEBCN){E=U.getElementsByClassName(v);
if(s){return E[0]||null;}for(O=0;A=E[O++];){if(!(I&&V[this.getUID(A)])){p.push(A);}}}else{var T=new RegExp("(^|\\s)"+d.escapeRegExp(v)+"(\\s|$)");E=U.getElementsByTagName("*");
for(O=0;A=E[O++];){className=A.className;if(!(className&&T.test(className))){continue;}if(s){return A;}if(!(I&&V[this.getUID(A)])){p.push(A);}}}}}}if(I){this.sort(p);
}return(s)?null:p;}querySelector:if(U.querySelectorAll){if(!this.isHTMLDocument||f[z]||this.brokenMixedCaseQSA||(this.brokenCheckedQSA&&z.indexOf(":checked")>-1)||(this.brokenEmptyAttributeQSA&&g.test(z))||(!y&&z.indexOf(",")>-1)||d.disableQSA){break querySelector;
}var S=z,x=U;if(!y){var C=x.getAttribute("id"),t="slickid__";x.setAttribute("id",t);S="#"+t+" "+S;U=x.parentNode;}try{if(s){return U.querySelector(S)||null;
}else{E=U.querySelectorAll(S);}}catch(Q){f[z]=1;break querySelector;}finally{if(!y){if(C){x.setAttribute("id",C);}else{x.removeAttribute("id");}U=x;}}if(this.starSelectsClosedQSA){for(O=0;
A=E[O++];){if(A.nodeName>"@"&&!(I&&V[this.getUID(A)])){p.push(A);}}}else{for(O=0;A=E[O++];){if(!(I&&V[this.getUID(A)])){p.push(A);}}}if(I){this.sort(p);
}return p;}F=this.Slick.parse(z);if(!F.length){return p;}}else{if(z==null){return p;}else{if(z.Slick){F=z;}else{if(this.contains(U.documentElement||U,z)){(p)?p.push(z):p=z;
return p;}else{return p;}}}}this.posNTH={};this.posNTHLast={};this.posNTHType={};this.posNTHTypeLast={};this.push=(!I&&(s||(F.length==1&&F.expressions[0].length==1)))?this.pushArray:this.pushUID;
if(p==null){p=[];}var M,L,K;var B,J,D,c,q,G,W;var N,P,o,w,R=F.expressions;search:for(O=0;(P=R[O]);O++){for(M=0;(o=P[M]);M++){B="combinator:"+o.combinator;
if(!this[B]){continue search;}J=(this.isXMLDocument)?o.tag:o.tag.toUpperCase();D=o.id;c=o.classList;q=o.classes;G=o.attributes;W=o.pseudos;w=(M===(P.length-1));
this.bitUniques={};if(w){this.uniques=V;this.found=p;}else{this.uniques={};this.found=[];}if(M===0){this[B](U,J,D,q,G,W,c);if(s&&w&&p.length){break search;
}}else{if(s&&w){for(L=0,K=N.length;L<K;L++){this[B](N[L],J,D,q,G,W,c);if(p.length){break search;}}}else{for(L=0,K=N.length;L<K;L++){this[B](N[L],J,D,q,G,W,c);
}}}N=this.found;}}if(I||(F.expressions.length>1)){this.sort(p);}return(s)?(p[0]||null):p;};j.uidx=1;j.uidk="slick-uniqueid";j.getUIDXML=function(m){var c=m.getAttribute(this.uidk);
if(!c){c=this.uidx++;m.setAttribute(this.uidk,c);}return c;};j.getUIDHTML=function(c){return c.uniqueNumber||(c.uniqueNumber=this.uidx++);};j.sort=function(c){if(!this.documentSorter){return c;
}c.sort(this.documentSorter);return c;};j.cacheNTH={};j.matchNTH=/^([+-]?\d*)?([a-z]+)?([+-]\d+)?$/;j.parseNTHArgument=function(p){var n=p.match(this.matchNTH);
if(!n){return false;}var o=n[2]||false;var m=n[1]||1;if(m=="-"){m=-1;}var c=+n[3]||0;n=(o=="n")?{a:m,b:c}:(o=="odd")?{a:2,b:1}:(o=="even")?{a:2,b:0}:{a:0,b:m};
return(this.cacheNTH[p]=n);};j.createNTHPseudo=function(o,m,c,n){return function(r,p){var t=this.getUID(r);if(!this[c][t]){var z=r.parentNode;if(!z){return false;
}var q=z[o],s=1;if(n){var y=r.nodeName;do{if(q.nodeName!=y){continue;}this[c][this.getUID(q)]=s++;}while((q=q[m]));}else{do{if(q.nodeType!=1){continue;
}this[c][this.getUID(q)]=s++;}while((q=q[m]));}}p=p||"n";var u=this.cacheNTH[p]||this.parseNTHArgument(p);if(!u){return false;}var x=u.a,w=u.b,v=this[c][t];
if(x==0){return w==v;}if(x>0){if(v<w){return false;}}else{if(w<v){return false;}}return((v-w)%x)==0;};};j.pushArray=function(o,c,q,n,m,p){if(this.matchSelector(o,c,q,n,m,p)){this.found.push(o);
}};j.pushUID=function(p,c,r,o,m,q){var n=this.getUID(p);if(!this.uniques[n]&&this.matchSelector(p,c,r,o,m,q)){this.uniques[n]=true;this.found.push(p);}};
j.matchNode=function(m,n){if(this.isHTMLDocument&&this.nativeMatchesSelector){try{return this.nativeMatchesSelector.call(m,n.replace(/\[([^=]+)=\s*([^'"\]]+?)\s*\]/g,'[$1="$2"]'));
}catch(u){}}var t=this.Slick.parse(n);if(!t){return true;}var r=t.expressions,p,s=0,q;for(q=0;(currentExpression=r[q]);q++){if(currentExpression.length==1){var o=currentExpression[0];
if(this.matchSelector(m,(this.isXMLDocument)?o.tag:o.tag.toUpperCase(),o.id,o.classes,o.attributes,o.pseudos)){return true;}s++;}}if(s==t.length){return false;
}var c=this.search(this.document,t),v;for(q=0;v=c[q++];){if(v===m){return true;}}return false;};j.matchPseudo=function(p,c,o){var m="pseudo:"+c;if(this[m]){return this[m](p,o);
}var n=this.getAttribute(p,c);return(o)?o==n:!!n;};j.matchSelector=function(n,u,c,o,p,r){if(u){var s=(this.isXMLDocument)?n.nodeName:n.nodeName.toUpperCase();
if(u=="*"){if(s<"@"){return false;}}else{if(s!=u){return false;}}}if(c&&n.getAttribute("id")!=c){return false;}var q,m,t;if(o){for(q=o.length;q--;){t=n.getAttribute("class")||n.className;
if(!(t&&o[q].regexp.test(t))){return false;}}}if(p){for(q=p.length;q--;){m=p[q];if(m.operator?!m.test(this.getAttribute(n,m.key)):!this.hasAttribute(n,m.key)){return false;
}}}if(r){for(q=r.length;q--;){m=r[q];if(!this.matchPseudo(n,m.key,m.value)){return false;}}}return true;};var i={" ":function(p,v,m,q,r,t,o){var s,u,n;
if(this.isHTMLDocument){getById:if(m){u=this.document.getElementById(m);if((!u&&p.all)||(this.idGetsName&&u&&u.getAttributeNode("id").nodeValue!=m)){n=p.all[m];
if(!n){return;}if(!n[0]){n=[n];}for(s=0;u=n[s++];){var c=u.getAttributeNode("id");if(c&&c.nodeValue==m){this.push(u,v,null,q,r,t);break;}}return;}if(!u){if(this.contains(this.root,p)){return;
}else{break getById;}}else{if(this.document!==p&&!this.contains(p,u)){return;}}this.push(u,v,null,q,r,t);return;}getByClass:if(q&&p.getElementsByClassName&&!this.brokenGEBCN){n=p.getElementsByClassName(o.join(" "));
if(!(n&&n.length)){break getByClass;}for(s=0;u=n[s++];){this.push(u,v,m,null,r,t);}return;}}getByTag:{n=p.getElementsByTagName(v);if(!(n&&n.length)){break getByTag;
}if(!this.brokenStarGEBTN){v=null;}for(s=0;u=n[s++];){this.push(u,v,m,q,r,t);}}},">":function(o,c,q,n,m,p){if((o=o.firstChild)){do{if(o.nodeType==1){this.push(o,c,q,n,m,p);
}}while((o=o.nextSibling));}},"+":function(o,c,q,n,m,p){while((o=o.nextSibling)){if(o.nodeType==1){this.push(o,c,q,n,m,p);break;}}},"^":function(o,c,q,n,m,p){o=o.firstChild;
if(o){if(o.nodeType==1){this.push(o,c,q,n,m,p);}else{this["combinator:+"](o,c,q,n,m,p);}}},"~":function(p,c,r,o,m,q){while((p=p.nextSibling)){if(p.nodeType!=1){continue;
}var n=this.getUID(p);if(this.bitUniques[n]){break;}this.bitUniques[n]=true;this.push(p,c,r,o,m,q);}},"++":function(o,c,q,n,m,p){this["combinator:+"](o,c,q,n,m,p);
this["combinator:!+"](o,c,q,n,m,p);},"~~":function(o,c,q,n,m,p){this["combinator:~"](o,c,q,n,m,p);this["combinator:!~"](o,c,q,n,m,p);},"!":function(o,c,q,n,m,p){while((o=o.parentNode)){if(o!==this.document){this.push(o,c,q,n,m,p);
}}},"!>":function(o,c,q,n,m,p){o=o.parentNode;if(o!==this.document){this.push(o,c,q,n,m,p);}},"!+":function(o,c,q,n,m,p){while((o=o.previousSibling)){if(o.nodeType==1){this.push(o,c,q,n,m,p);
break;}}},"!^":function(o,c,q,n,m,p){o=o.lastChild;if(o){if(o.nodeType==1){this.push(o,c,q,n,m,p);}else{this["combinator:!+"](o,c,q,n,m,p);}}},"!~":function(p,c,r,o,m,q){while((p=p.previousSibling)){if(p.nodeType!=1){continue;
}var n=this.getUID(p);if(this.bitUniques[n]){break;}this.bitUniques[n]=true;this.push(p,c,r,o,m,q);}}};for(var h in i){j["combinator:"+h]=i[h];}var k={empty:function(c){var m=c.firstChild;
return !(m&&m.nodeType==1)&&!(c.innerText||c.textContent||"").length;},not:function(c,m){return !this.matchNode(c,m);},contains:function(c,m){return(c.innerText||c.textContent||"").indexOf(m)>-1;
},"first-child":function(c){while((c=c.previousSibling)){if(c.nodeType==1){return false;}}return true;},"last-child":function(c){while((c=c.nextSibling)){if(c.nodeType==1){return false;
}}return true;},"only-child":function(n){var m=n;while((m=m.previousSibling)){if(m.nodeType==1){return false;}}var c=n;while((c=c.nextSibling)){if(c.nodeType==1){return false;
}}return true;},"nth-child":j.createNTHPseudo("firstChild","nextSibling","posNTH"),"nth-last-child":j.createNTHPseudo("lastChild","previousSibling","posNTHLast"),"nth-of-type":j.createNTHPseudo("firstChild","nextSibling","posNTHType",true),"nth-last-of-type":j.createNTHPseudo("lastChild","previousSibling","posNTHTypeLast",true),index:function(m,c){return this["pseudo:nth-child"](m,""+c+1);
},even:function(c){return this["pseudo:nth-child"](c,"2n");},odd:function(c){return this["pseudo:nth-child"](c,"2n+1");},"first-of-type":function(c){var m=c.nodeName;
while((c=c.previousSibling)){if(c.nodeName==m){return false;}}return true;},"last-of-type":function(c){var m=c.nodeName;while((c=c.nextSibling)){if(c.nodeName==m){return false;
}}return true;},"only-of-type":function(n){var m=n,o=n.nodeName;while((m=m.previousSibling)){if(m.nodeName==o){return false;}}var c=n;while((c=c.nextSibling)){if(c.nodeName==o){return false;
}}return true;},enabled:function(c){return !c.disabled;},disabled:function(c){return c.disabled;},checked:function(c){return c.checked||c.selected;},focus:function(c){return this.isHTMLDocument&&this.document.activeElement===c&&(c.href||c.type||this.hasAttribute(c,"tabindex"));
},root:function(c){return(c===this.root);},selected:function(c){return c.selected;}};for(var a in k){j["pseudo:"+a]=k[a];}j.attributeGetters={"class":function(){return this.getAttribute("class")||this.className;
},"for":function(){return("htmlFor" in this)?this.htmlFor:this.getAttribute("for");},href:function(){return("href" in this)?this.getAttribute("href",2):this.getAttribute("href");
},style:function(){return(this.style)?this.style.cssText:this.getAttribute("style");},tabindex:function(){var c=this.getAttributeNode("tabindex");return(c&&c.specified)?c.nodeValue:null;
},type:function(){return this.getAttribute("type");}};var d=j.Slick=(this.Slick||{});d.version="1.1.5";d.search=function(m,n,c){return j.search(m,n,c);
};d.find=function(c,m){return j.search(c,m,null,true);};d.contains=function(c,m){j.setDocument(c);return j.contains(c,m);};d.getAttribute=function(m,c){return j.getAttribute(m,c);
};d.match=function(m,c){if(!(m&&c)){return false;}if(!c||c===m){return true;}j.setDocument(m);return j.matchNode(m,c);};d.defineAttributeGetter=function(c,m){j.attributeGetters[c]=m;
return this;};d.lookupAttributeGetter=function(c){return j.attributeGetters[c];};d.definePseudo=function(c,m){j["pseudo:"+c]=function(o,n){return m.call(o,n);
};return this;};d.lookupPseudo=function(c){var m=j["pseudo:"+c];if(m){return function(n){return m.call(this,n);};}return null;};d.override=function(m,c){j.override(m,c);
return this;};d.isXML=j.isXML;d.uidOf=function(c){return j.getUIDHTML(c);};if(!this.Slick){this.Slick=d;}}).apply((typeof exports!="undefined")?exports:this);
var Element=function(b,g){var h=Element.Constructors[b];if(h){return h(g);}if(typeof b!="string"){return document.id(b).set(g);}if(!g){g={};}if(!(/^[\w-]+$/).test(b)){var e=Slick.parse(b).expressions[0][0];
b=(e.tag=="*")?"div":e.tag;if(e.id&&g.id==null){g.id=e.id;}var d=e.attributes;if(d){for(var f=0,c=d.length;f<c;f++){var a=d[f];if(g[a.key]!=null){continue;
}if(a.value!=null&&a.operator=="="){g[a.key]=a.value;}else{if(!a.value&&!a.operator){g[a.key]=true;}}}}if(e.classList&&g["class"]==null){g["class"]=e.classList.join(" ");
}}return document.newElement(b,g);};if(Browser.Element){Element.prototype=Browser.Element.prototype;}new Type("Element",Element).mirror(function(a){if(Array.prototype[a]){return;
}var b={};b[a]=function(){var h=[],e=arguments,j=true;for(var g=0,d=this.length;g<d;g++){var f=this[g],c=h[g]=f[a].apply(f,e);j=(j&&typeOf(c)=="element");
}return(j)?new Elements(h):h;};Elements.implement(b);});if(!Browser.Element){Element.parent=Object;Element.Prototype={"$family":Function.from("element").hide()};
Element.mirror(function(a,b){Element.Prototype[a]=b;});}Element.Constructors={};Element.Constructors=new Hash;var IFrame=new Type("IFrame",function(){var e=Array.link(arguments,{properties:Type.isObject,iframe:function(f){return(f!=null);
}});var c=e.properties||{},b;if(e.iframe){b=document.id(e.iframe);}var d=c.onload||function(){};delete c.onload;c.id=c.name=[c.id,c.name,b?(b.id||b.name):"IFrame_"+String.uniqueID()].pick();
b=new Element(b||"iframe",c);var a=function(){d.call(b.contentWindow);};if(window.frames[c.id]){a();}else{b.addListener("load",a);}return b;});var Elements=this.Elements=function(a){if(a&&a.length){var e={},d;
for(var c=0;d=a[c++];){var b=Slick.uidOf(d);if(!e[b]){e[b]=true;this.push(d);}}}};Elements.prototype={length:0};Elements.parent=Array;new Type("Elements",Elements).implement({filter:function(a,b){if(!a){return this;
}return new Elements(Array.filter(this,(typeOf(a)=="string")?function(c){return c.match(a);}:a,b));}.protect(),push:function(){var d=this.length;for(var b=0,a=arguments.length;
b<a;b++){var c=document.id(arguments[b]);if(c){this[d++]=c;}}return(this.length=d);}.protect(),unshift:function(){var b=[];for(var c=0,a=arguments.length;
c<a;c++){var d=document.id(arguments[c]);if(d){b.push(d);}}return Array.prototype.unshift.apply(this,b);}.protect(),concat:function(){var b=new Elements(this);
for(var c=0,a=arguments.length;c<a;c++){var d=arguments[c];if(Type.isEnumerable(d)){b.append(d);}else{b.push(d);}}return b;}.protect(),append:function(c){for(var b=0,a=c.length;
b<a;b++){this.push(c[b]);}return this;}.protect(),empty:function(){while(this.length){delete this[--this.length];}return this;}.protect()});Elements.alias("extend","append");
(function(){var g=Array.prototype.splice,b={"0":0,"1":1,length:2};g.call(b,1,1);if(b[1]==1){Elements.implement("splice",function(){var e=this.length;g.apply(this,arguments);
while(e>=this.length){delete this[e--];}return this;}.protect());}Elements.implement(Array.prototype);Array.mirror(Elements);var f;try{var a=document.createElement("<input name=x>");
f=(a.name=="x");}catch(c){}var d=function(e){return(""+e).replace(/&/g,"&amp;").replace(/"/g,"&quot;");};Document.implement({newElement:function(e,h){if(h&&h.checked!=null){h.defaultChecked=h.checked;
}if(f&&h){e="<"+e;if(h.name){e+=' name="'+d(h.name)+'"';}if(h.type){e+=' type="'+d(h.type)+'"';}e+=">";delete h.name;delete h.type;}return this.id(this.createElement(e)).set(h);
}});})();Document.implement({newTextNode:function(a){return this.createTextNode(a);},getDocument:function(){return this;},getWindow:function(){return this.window;
},id:(function(){var a={string:function(d,c,b){d=Slick.find(b,"#"+d.replace(/(\W)/g,"\\$1"));return(d)?a.element(d,c):null;},element:function(b,c){$uid(b);
if(!c&&!b.$family&&!(/^(?:object|embed)$/i).test(b.tagName)){Object.append(b,Element.Prototype);}return b;},object:function(c,d,b){if(c.toElement){return a.element(c.toElement(b),d);
}return null;}};a.textnode=a.whitespace=a.window=a.document=function(b){return b;};return function(c,e,d){if(c&&c.$family&&c.uid){return c;}var b=typeOf(c);
return(a[b])?a[b](c,e,d||document):null;};})()});if(window.$==null){Window.implement("$",function(a,b){return document.id(a,b,this.document);});}Window.implement({getDocument:function(){return this.document;
},getWindow:function(){return this;}});[Document,Element].invoke("implement",{getElements:function(a){return Slick.search(this,a,new Elements);},getElement:function(a){return document.id(Slick.find(this,a));
}});(function(b,d,a){this.Selectors={};var e=this.Selectors.Pseudo=new Hash();var c=function(){for(var f in e){if(e.hasOwnProperty(f)){Slick.definePseudo(f,e[f]);
delete e[f];}}};Slick.search=function(g,h,f){c();return b.call(this,g,h,f);};Slick.find=function(f,g){c();return d.call(this,f,g);};Slick.match=function(g,f){c();
return a.call(this,g,f);};})(Slick.search,Slick.find,Slick.match);if(window.$$==null){Window.implement("$$",function(a){var f=new Elements;if(arguments.length==1&&typeof a=="string"){return Slick.search(this.document,a,f);
}var c=Array.flatten(arguments);for(var d=0,b=c.length;d<b;d++){var e=c[d];switch(typeOf(e)){case"element":f.push(e);break;case"string":Slick.search(this.document,e,f);
}}return f;});}if(window.$$==null){Window.implement("$$",function(a){if(arguments.length==1){if(typeof a=="string"){return Slick.search(this.document,a,new Elements);
}else{if(Type.isEnumerable(a)){return new Elements(a);}}}return new Elements(arguments);});}(function(){var k={},i={};var n={input:"checked",option:"selected",textarea:"value"};
var e=function(p){return(i[p]||(i[p]={}));};var j=function(q){var p=q.uid;if(q.removeEvents){q.removeEvents();}if(q.clearAttributes){q.clearAttributes();
}if(p!=null){delete k[p];delete i[p];}return q;};var o=["defaultValue","accessKey","cellPadding","cellSpacing","colSpan","frameBorder","maxLength","readOnly","rowSpan","tabIndex","useMap"];
var d=["compact","nowrap","ismap","declare","noshade","checked","disabled","readOnly","multiple","selected","noresize","defer","defaultChecked"];var g={html:"innerHTML","class":"className","for":"htmlFor",text:(function(){var p=document.createElement("div");
return(p.textContent==null)?"innerText":"textContent";})()};var m=["type"];var h=["value","defaultValue"];var l=/^(?:href|src|usemap)$/i;d=d.associate(d);
o=o.associate(o.map(String.toLowerCase));m=m.associate(m);Object.append(g,h.associate(h));var c={before:function(q,p){var r=p.parentNode;if(r){r.insertBefore(q,p);
}},after:function(q,p){var r=p.parentNode;if(r){r.insertBefore(q,p.nextSibling);}},bottom:function(q,p){p.appendChild(q);},top:function(q,p){p.insertBefore(q,p.firstChild);
}};c.inside=c.bottom;Object.each(c,function(q,r){r=r.capitalize();var p={};p["inject"+r]=function(s){q(this,document.id(s,true));return this;};p["grab"+r]=function(s){q(document.id(s,true),this);
return this;};Element.implement(p);});var b=function(s,r){if(!s){return r;}s=Object.clone(Slick.parse(s));var q=s.expressions;for(var p=q.length;p--;){q[p][0].combinator=r;
}return s;};Element.implement({set:function(r,q){var p=Element.Properties[r];(p&&p.set)?p.set.call(this,q):this.setProperty(r,q);}.overloadSetter(),get:function(q){var p=Element.Properties[q];
return(p&&p.get)?p.get.apply(this):this.getProperty(q);}.overloadGetter(),erase:function(q){var p=Element.Properties[q];(p&&p.erase)?p.erase.apply(this):this.removeProperty(q);
return this;},setProperty:function(q,r){q=o[q]||q;if(r==null){return this.removeProperty(q);}var p=g[q];(p)?this[p]=r:(d[q])?this[q]=!!r:this.setAttribute(q,""+r);
return this;},setProperties:function(p){for(var q in p){this.setProperty(q,p[q]);}return this;},getProperty:function(q){q=o[q]||q;var p=g[q]||m[q];return(p)?this[p]:(d[q])?!!this[q]:(l.test(q)?this.getAttribute(q,2):(p=this.getAttributeNode(q))?p.nodeValue:null)||null;
},getProperties:function(){var p=Array.from(arguments);return p.map(this.getProperty,this).associate(p);},removeProperty:function(q){q=o[q]||q;var p=g[q];
(p)?this[p]="":(d[q])?this[q]=false:this.removeAttribute(q);return this;},removeProperties:function(){Array.each(arguments,this.removeProperty,this);return this;
},hasClass:function(p){return this.className.clean().contains(p," ");},addClass:function(p){if(!this.hasClass(p)){this.className=(this.className+" "+p).clean();
}return this;},removeClass:function(p){this.className=this.className.replace(new RegExp("(^|\\s)"+p+"(?:\\s|$)"),"$1");return this;},toggleClass:function(p,q){if(q==null){q=!this.hasClass(p);
}return(q)?this.addClass(p):this.removeClass(p);},adopt:function(){var s=this,p,u=Array.flatten(arguments),t=u.length;if(t>1){s=p=document.createDocumentFragment();
}for(var r=0;r<t;r++){var q=document.id(u[r],true);if(q){s.appendChild(q);}}if(p){this.appendChild(p);}return this;},appendText:function(q,p){return this.grab(this.getDocument().newTextNode(q),p);
},grab:function(q,p){c[p||"bottom"](document.id(q,true),this);return this;},inject:function(q,p){c[p||"bottom"](this,document.id(q,true));return this;},replaces:function(p){p=document.id(p,true);
p.parentNode.replaceChild(this,p);return this;},wraps:function(q,p){q=document.id(q,true);return this.replaces(q).grab(q,p);},getPrevious:function(p){return document.id(Slick.find(this,b(p,"!~")));
},getAllPrevious:function(p){return Slick.search(this,b(p,"!~"),new Elements);},getNext:function(p){return document.id(Slick.find(this,b(p,"~")));},getAllNext:function(p){return Slick.search(this,b(p,"~"),new Elements);
},getFirst:function(p){return document.id(Slick.search(this,b(p,">"))[0]);},getLast:function(p){return document.id(Slick.search(this,b(p,">")).getLast());
},getParent:function(p){return document.id(Slick.find(this,b(p,"!")));},getParents:function(p){return Slick.search(this,b(p,"!"),new Elements);},getSiblings:function(p){return Slick.search(this,b(p,"~~"),new Elements);
},getChildren:function(p){return Slick.search(this,b(p,">"),new Elements);},getWindow:function(){return this.ownerDocument.window;},getDocument:function(){return this.ownerDocument;
},getElementById:function(p){return document.id(Slick.find(this,"#"+(""+p).replace(/(\W)/g,"\\$1")));},getSelected:function(){this.selectedIndex;return new Elements(Array.from(this.options).filter(function(p){return p.selected;
}));},toQueryString:function(){var p=[];this.getElements("input, select, textarea").each(function(r){var q=r.type;if(!r.name||r.disabled||q=="submit"||q=="reset"||q=="file"||q=="image"){return;
}var s=(r.get("tag")=="select")?r.getSelected().map(function(t){return document.id(t).get("value");}):((q=="radio"||q=="checkbox")&&!r.checked)?null:r.get("value");
Array.from(s).each(function(t){if(typeof t!="undefined"){p.push(encodeURIComponent(r.name)+"="+encodeURIComponent(t));}});});return p.join("&");},destroy:function(){var p=j(this).getElementsByTagName("*");
Array.each(p,j);Element.dispose(this);return null;},empty:function(){Array.from(this.childNodes).each(Element.dispose);return this;},dispose:function(){return(this.parentNode)?this.parentNode.removeChild(this):this;
},match:function(p){return !p||Slick.match(this,p);}});var a=function(t,s,q){if(!q){t.setAttributeNode(document.createAttribute("id"));}if(t.clearAttributes){t.clearAttributes();
t.mergeAttributes(s);t.removeAttribute("uid");if(t.options){var u=t.options,p=s.options;for(var r=u.length;r--;){u[r].selected=p[r].selected;}}}var v=n[s.tagName.toLowerCase()];
if(v&&s[v]){t[v]=s[v];}};Element.implement("clone",function(r,p){r=r!==false;var w=this.cloneNode(r),q;if(r){var s=w.getElementsByTagName("*"),u=this.getElementsByTagName("*");
for(q=s.length;q--;){a(s[q],u[q],p);}}a(w,this,p);if(Browser.ie){var t=w.getElementsByTagName("object"),v=this.getElementsByTagName("object");for(q=t.length;
q--;){t[q].outerHTML=v[q].outerHTML;}}return document.id(w);});var f={contains:function(p){return Slick.contains(this,p);}};if(!document.contains){Document.implement(f);
}if(!document.createElement("div").contains){Element.implement(f);}Element.implement("hasChild",function(p){return this!==p&&this.contains(p);});[Element,Window,Document].invoke("implement",{addListener:function(s,r){if(s=="unload"){var p=r,q=this;
r=function(){q.removeListener("unload",r);p();};}else{k[$uid(this)]=this;}if(this.addEventListener){this.addEventListener(s,r,!!arguments[2]);}else{this.attachEvent("on"+s,r);
}return this;},removeListener:function(q,p){if(this.removeEventListener){this.removeEventListener(q,p,!!arguments[2]);}else{this.detachEvent("on"+q,p);
}return this;},retrieve:function(q,p){var s=e($uid(this)),r=s[q];if(p!=null&&r==null){r=s[q]=p;}return r!=null?r:null;},store:function(q,p){var r=e($uid(this));
r[q]=p;return this;},eliminate:function(p){var q=e($uid(this));delete q[p];return this;}});if(window.attachEvent&&!window.addEventListener){window.addListener("unload",function(){Object.each(k,j);
if(window.CollectGarbage){CollectGarbage();}});}})();Element.Properties={};Element.Properties=new Hash;Element.Properties.style={set:function(a){this.style.cssText=a;
},get:function(){return this.style.cssText;},erase:function(){this.style.cssText="";}};Element.Properties.tag={get:function(){return this.tagName.toLowerCase();
}};(function(a){if(a!=null){Element.Properties.maxlength=Element.Properties.maxLength={get:function(){var b=this.getAttribute("maxLength");return b==a?null:b;
}};}})(document.createElement("input").getAttribute("maxLength"));Element.Properties.html=(function(){var c=Function.attempt(function(){var e=document.createElement("table");
e.innerHTML="<tr><td></td></tr>";});var d=document.createElement("div");var a={table:[1,"<table>","</table>"],select:[1,"<select>","</select>"],tbody:[2,"<table><tbody>","</tbody></table>"],tr:[3,"<table><tbody><tr>","</tr></tbody></table>"]};
a.thead=a.tfoot=a.tbody;var b={set:function(){var f=Array.flatten(arguments).join("");var g=(!c&&a[this.get("tag")]);if(g){var h=d;h.innerHTML=g[1]+f+g[2];
for(var e=g[0];e--;){h=h.firstChild;}this.empty().adopt(h.childNodes);}else{this.innerHTML=f;}}};b.erase=b.set;return b;})();(function(){var c=document.html;
Element.Properties.styles={set:function(f){this.setStyles(f);}};var e=(c.style.opacity!=null);var d=/alpha\(opacity=([\d.]+)\)/i;var b=function(g,f){if(!g.currentStyle||!g.currentStyle.hasLayout){g.style.zoom=1;
}if(e){g.style.opacity=f;}else{f=(f*100).limit(0,100).round();f=(f==100)?"":"alpha(opacity="+f+")";var h=g.style.filter||g.getComputedStyle("filter")||"";
g.style.filter=d.test(h)?h.replace(d,f):h+f;}};Element.Properties.opacity={set:function(g){var f=this.style.visibility;if(g==0&&f!="hidden"){this.style.visibility="hidden";
}else{if(g!=0&&f!="visible"){this.style.visibility="visible";}}b(this,g);},get:(e)?function(){var f=this.style.opacity||this.getComputedStyle("opacity");
return(f=="")?1:f;}:function(){var f,g=(this.style.filter||this.getComputedStyle("filter"));if(g){f=g.match(d);}return(f==null||g==null)?1:(f[1]/100);}};
var a=(c.style.cssFloat==null)?"styleFloat":"cssFloat";Element.implement({getComputedStyle:function(h){if(this.currentStyle){return this.currentStyle[h.camelCase()];
}var g=Element.getDocument(this).defaultView,f=g?g.getComputedStyle(this,null):null;return(f)?f.getPropertyValue((h==a)?"float":h.hyphenate()):null;},setOpacity:function(f){b(this,f);
return this;},getOpacity:function(){return this.get("opacity");},setStyle:function(g,f){switch(g){case"opacity":return this.set("opacity",parseFloat(f));
case"float":g=a;}g=g.camelCase();if(typeOf(f)!="string"){var h=(Element.Styles[g]||"@").split(" ");f=Array.from(f).map(function(k,j){if(!h[j]){return"";
}return(typeOf(k)=="number")?h[j].replace("@",Math.round(k)):k;}).join(" ");}else{if(f==String(Number(f))){f=Math.round(f);}}this.style[g]=f;return this;
},getStyle:function(l){switch(l){case"opacity":return this.get("opacity");case"float":l=a;}l=l.camelCase();var f=this.style[l];if(!f||l=="zIndex"){f=[];
for(var k in Element.ShortStyles){if(l!=k){continue;}for(var j in Element.ShortStyles[k]){f.push(this.getStyle(j));}return f.join(" ");}f=this.getComputedStyle(l);
}if(f){f=String(f);var h=f.match(/rgba?\([\d\s,]+\)/);if(h){f=f.replace(h[0],h[0].rgbToHex());}}if(Browser.opera||(Browser.ie&&isNaN(parseFloat(f)))){if((/^(height|width)$/).test(l)){var g=(l=="width")?["left","right"]:["top","bottom"],i=0;
g.each(function(m){i+=this.getStyle("border-"+m+"-width").toInt()+this.getStyle("padding-"+m).toInt();},this);return this["offset"+l.capitalize()]-i+"px";
}if(Browser.opera&&String(f).indexOf("px")!=-1){return f;}if((/^border(.+)Width|margin|padding/).test(l)){return"0px";}}return f;},setStyles:function(g){for(var f in g){this.setStyle(f,g[f]);
}return this;},getStyles:function(){var f={};Array.flatten(arguments).each(function(g){f[g]=this.getStyle(g);},this);return f;}});Element.Styles={left:"@px",top:"@px",bottom:"@px",right:"@px",width:"@px",height:"@px",maxWidth:"@px",maxHeight:"@px",minWidth:"@px",minHeight:"@px",backgroundColor:"rgb(@, @, @)",backgroundPosition:"@px @px",color:"rgb(@, @, @)",fontSize:"@px",letterSpacing:"@px",lineHeight:"@px",clip:"rect(@px @px @px @px)",margin:"@px @px @px @px",padding:"@px @px @px @px",border:"@px @ rgb(@, @, @) @px @ rgb(@, @, @) @px @ rgb(@, @, @)",borderWidth:"@px @px @px @px",borderStyle:"@ @ @ @",borderColor:"rgb(@, @, @) rgb(@, @, @) rgb(@, @, @) rgb(@, @, @)",zIndex:"@",zoom:"@",fontWeight:"@",textIndent:"@px",opacity:"@"};
Element.Styles=new Hash(Element.Styles);Element.ShortStyles={margin:{},padding:{},border:{},borderWidth:{},borderStyle:{},borderColor:{}};["Top","Right","Bottom","Left"].each(function(l){var k=Element.ShortStyles;
var g=Element.Styles;["margin","padding"].each(function(m){var n=m+l;k[m][n]=g[n]="@px";});var j="border"+l;k.border[j]=g[j]="@px @ rgb(@, @, @)";var i=j+"Width",f=j+"Style",h=j+"Color";
k[j]={};k.borderWidth[i]=k[j][i]=g[i]="@px";k.borderStyle[f]=k[j][f]=g[f]="@";k.borderColor[h]=k[j][h]=g[h]="rgb(@, @, @)";});})();(function(){Element.Properties.events={set:function(b){this.addEvents(b);
}};[Element,Window,Document].invoke("implement",{addEvent:function(f,h){var i=this.retrieve("events",{});if(!i[f]){i[f]={keys:[],values:[]};}if(i[f].keys.contains(h)){return this;
}i[f].keys.push(h);var g=f,b=Element.Events[f],d=h,j=this;if(b){if(b.onAdd){b.onAdd.call(this,h);}if(b.condition){d=function(k){if(b.condition.call(this,k)){return h.call(this,k);
}return true;};}g=b.base||g;}var e=function(){return h.call(j);};var c=Element.NativeEvents[g];if(c){if(c==2){e=function(k){k=new Event(k,j.getWindow());
if(d.call(j,k)===false){k.stop();}};}this.addListener(g,e,arguments[2]);}i[f].values.push(e);return this;},removeEvent:function(e,d){var c=this.retrieve("events");
if(!c||!c[e]){return this;}var h=c[e];var b=h.keys.indexOf(d);if(b==-1){return this;}var g=h.values[b];delete h.keys[b];delete h.values[b];var f=Element.Events[e];
if(f){if(f.onRemove){f.onRemove.call(this,d);}e=f.base||e;}return(Element.NativeEvents[e])?this.removeListener(e,g,arguments[2]):this;},addEvents:function(b){for(var c in b){this.addEvent(c,b[c]);
}return this;},removeEvents:function(b){var d;if(typeOf(b)=="object"){for(d in b){this.removeEvent(d,b[d]);}return this;}var c=this.retrieve("events");
if(!c){return this;}if(!b){for(d in c){this.removeEvents(d);}this.eliminate("events");}else{if(c[b]){c[b].keys.each(function(e){this.removeEvent(b,e);},this);
delete c[b];}}return this;},fireEvent:function(e,c,b){var d=this.retrieve("events");if(!d||!d[e]){return this;}c=Array.from(c);d[e].keys.each(function(f){if(b){f.delay(b,this,c);
}else{f.apply(this,c);}},this);return this;},cloneEvents:function(e,d){e=document.id(e);var c=e.retrieve("events");if(!c){return this;}if(!d){for(var b in c){this.cloneEvents(e,b);
}}else{if(c[d]){c[d].keys.each(function(f){this.addEvent(d,f);},this);}}return this;}});Element.NativeEvents={click:2,dblclick:2,mouseup:2,mousedown:2,contextmenu:2,mousewheel:2,DOMMouseScroll:2,mouseover:2,mouseout:2,mousemove:2,selectstart:2,selectend:2,keydown:2,keypress:2,keyup:2,orientationchange:2,touchstart:2,touchmove:2,touchend:2,touchcancel:2,gesturestart:2,gesturechange:2,gestureend:2,focus:2,blur:2,change:2,reset:2,select:2,submit:2,load:2,unload:1,beforeunload:2,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,error:1,abort:1,scroll:1};
var a=function(b){var c=b.relatedTarget;if(c==null){return true;}if(!c){return false;}return(c!=this&&c.prefix!="xul"&&typeOf(this)!="document"&&!this.contains(c));
};Element.Events={mouseenter:{base:"mouseover",condition:a},mouseleave:{base:"mouseout",condition:a},mousewheel:{base:(Browser.firefox)?"DOMMouseScroll":"mousewheel"}};
Element.Events=new Hash(Element.Events);})();(function(){var h=document.createElement("div"),e=document.createElement("div");h.style.height="0";h.appendChild(e);
var d=(e.offsetParent===h);h=e=null;var l=function(m){return k(m,"position")!="static"||a(m);};var i=function(m){return l(m)||(/^(?:table|td|th)$/i).test(m.tagName);
};Element.implement({scrollTo:function(m,n){if(a(this)){this.getWindow().scrollTo(m,n);}else{this.scrollLeft=m;this.scrollTop=n;}return this;},getSize:function(){if(a(this)){return this.getWindow().getSize();
}return{x:this.offsetWidth,y:this.offsetHeight};},getScrollSize:function(){if(a(this)){return this.getWindow().getScrollSize();}return{x:this.scrollWidth,y:this.scrollHeight};
},getScroll:function(){if(a(this)){return this.getWindow().getScroll();}return{x:this.scrollLeft,y:this.scrollTop};},getScrolls:function(){var n=this.parentNode,m={x:0,y:0};
while(n&&!a(n)){m.x+=n.scrollLeft;m.y+=n.scrollTop;n=n.parentNode;}return m;},getOffsetParent:d?function(){var m=this;if(a(m)||k(m,"position")=="fixed"){return null;
}var n=(k(m,"position")=="static")?i:l;while((m=m.parentNode)){if(n(m)){return m;}}return null;}:function(){var m=this;if(a(m)||k(m,"position")=="fixed"){return null;
}try{return m.offsetParent;}catch(n){}return null;},getOffsets:function(){if(this.getBoundingClientRect&&!Browser.Platform.ios){var r=this.getBoundingClientRect(),o=document.id(this.getDocument().documentElement),q=o.getScroll(),t=this.getScrolls(),s=(k(this,"position")=="fixed");
return{x:r.left.toInt()+t.x+((s)?0:q.x)-o.clientLeft,y:r.top.toInt()+t.y+((s)?0:q.y)-o.clientTop};}var n=this,m={x:0,y:0};if(a(this)){return m;}while(n&&!a(n)){m.x+=n.offsetLeft;
m.y+=n.offsetTop;if(Browser.firefox){if(!c(n)){m.x+=b(n);m.y+=g(n);}var p=n.parentNode;if(p&&k(p,"overflow")!="visible"){m.x+=b(p);m.y+=g(p);}}else{if(n!=this&&Browser.safari){m.x+=b(n);
m.y+=g(n);}}n=n.offsetParent;}if(Browser.firefox&&!c(this)){m.x-=b(this);m.y-=g(this);}return m;},getPosition:function(p){if(a(this)){return{x:0,y:0};}var q=this.getOffsets(),n=this.getScrolls();
var m={x:q.x-n.x,y:q.y-n.y};if(p&&(p=document.id(p))){var o=p.getPosition();return{x:m.x-o.x-b(p),y:m.y-o.y-g(p)};}return m;},getCoordinates:function(o){if(a(this)){return this.getWindow().getCoordinates();
}var m=this.getPosition(o),n=this.getSize();var p={left:m.x,top:m.y,width:n.x,height:n.y};p.right=p.left+p.width;p.bottom=p.top+p.height;return p;},computePosition:function(m){return{left:m.x-j(this,"margin-left"),top:m.y-j(this,"margin-top")};
},setPosition:function(m){return this.setStyles(this.computePosition(m));}});[Document,Window].invoke("implement",{getSize:function(){var m=f(this);return{x:m.clientWidth,y:m.clientHeight};
},getScroll:function(){var n=this.getWindow(),m=f(this);return{x:n.pageXOffset||m.scrollLeft,y:n.pageYOffset||m.scrollTop};},getScrollSize:function(){var o=f(this),n=this.getSize(),m=this.getDocument().body;
return{x:Math.max(o.scrollWidth,m.scrollWidth,n.x),y:Math.max(o.scrollHeight,m.scrollHeight,n.y)};},getPosition:function(){return{x:0,y:0};},getCoordinates:function(){var m=this.getSize();
return{top:0,left:0,bottom:m.y,right:m.x,height:m.y,width:m.x};}});var k=Element.getComputedStyle;function j(m,n){return k(m,n).toInt()||0;}function c(m){return k(m,"-moz-box-sizing")=="border-box";
}function g(m){return j(m,"border-top-width");}function b(m){return j(m,"border-left-width");}function a(m){return(/^(?:body|html)$/i).test(m.tagName);
}function f(m){var n=m.getDocument();return(!n.compatMode||n.compatMode=="CSS1Compat")?n.html:n.body;}})();Element.alias({position:"setPosition"});[Window,Document,Element].invoke("implement",{getHeight:function(){return this.getSize().y;
},getWidth:function(){return this.getSize().x;},getScrollTop:function(){return this.getScroll().y;},getScrollLeft:function(){return this.getScroll().x;
},getScrollHeight:function(){return this.getScrollSize().y;},getScrollWidth:function(){return this.getScrollSize().x;},getTop:function(){return this.getPosition().y;
},getLeft:function(){return this.getPosition().x;}});(function(){var f=this.Fx=new Class({Implements:[Chain,Events,Options],options:{fps:60,unit:false,duration:500,frames:null,frameSkip:true,link:"ignore"},initialize:function(g){this.subject=this.subject||this;
this.setOptions(g);},getTransition:function(){return function(g){return -(Math.cos(Math.PI*g)-1)/2;};},step:function(g){if(this.options.frameSkip){var h=(this.time!=null)?(g-this.time):0,i=h/this.frameInterval;
this.time=g;this.frame+=i;}else{this.frame++;}if(this.frame<this.frames){var j=this.transition(this.frame/this.frames);this.set(this.compute(this.from,this.to,j));
}else{this.frame=this.frames;this.set(this.compute(this.from,this.to,1));this.stop();}},set:function(g){return g;},compute:function(i,h,g){return f.compute(i,h,g);
},check:function(){if(!this.isRunning()){return true;}switch(this.options.link){case"cancel":this.cancel();return true;case"chain":this.chain(this.caller.pass(arguments,this));
return false;}return false;},start:function(k,j){if(!this.check(k,j)){return this;}this.from=k;this.to=j;this.frame=(this.options.frameSkip)?0:-1;this.time=null;
this.transition=this.getTransition();var i=this.options.frames,h=this.options.fps,g=this.options.duration;this.duration=f.Durations[g]||g.toInt();this.frameInterval=1000/h;
this.frames=i||Math.round(this.duration/this.frameInterval);this.fireEvent("start",this.subject);b.call(this,h);return this;},stop:function(){if(this.isRunning()){this.time=null;
d.call(this,this.options.fps);if(this.frames==this.frame){this.fireEvent("complete",this.subject);if(!this.callChain()){this.fireEvent("chainComplete",this.subject);
}}else{this.fireEvent("stop",this.subject);}}return this;},cancel:function(){if(this.isRunning()){this.time=null;d.call(this,this.options.fps);this.frame=this.frames;
this.fireEvent("cancel",this.subject).clearChain();}return this;},pause:function(){if(this.isRunning()){this.time=null;d.call(this,this.options.fps);}return this;
},resume:function(){if((this.frame<this.frames)&&!this.isRunning()){b.call(this,this.options.fps);}return this;},isRunning:function(){var g=e[this.options.fps];
return g&&g.contains(this);}});f.compute=function(i,h,g){return(h-i)*g+i;};f.Durations={"short":250,normal:500,"long":1000};var e={},c={};var a=function(){var h=Date.now();
for(var j=this.length;j--;){var g=this[j];if(g){g.step(h);}}};var b=function(h){var g=e[h]||(e[h]=[]);g.push(this);if(!c[h]){c[h]=a.periodical(Math.round(1000/h),g);
}};var d=function(h){var g=e[h];if(g){g.erase(this);if(!g.length&&c[h]){delete e[h];c[h]=clearInterval(c[h]);}}};})();Fx.CSS=new Class({Extends:Fx,prepare:function(c,d,b){b=Array.from(b);
if(b[1]==null){b[1]=b[0];b[0]=c.getStyle(d);}var a=b.map(this.parse);return{from:a[0],to:a[1]};},parse:function(a){a=Function.from(a)();a=(typeof a=="string")?a.split(" "):Array.from(a);
return a.map(function(c){c=String(c);var b=false;Object.each(Fx.CSS.Parsers,function(f,e){if(b){return;}var d=f.parse(c);if(d||d===0){b={value:d,parser:f};
}});b=b||{value:c,parser:Fx.CSS.Parsers.String};return b;});},compute:function(d,c,b){var a=[];(Math.min(d.length,c.length)).times(function(e){a.push({value:d[e].parser.compute(d[e].value,c[e].value,b),parser:d[e].parser});
});a.$family=Function.from("fx:css:value");return a;},serve:function(c,b){if(typeOf(c)!="fx:css:value"){c=this.parse(c);}var a=[];c.each(function(d){a=a.concat(d.parser.serve(d.value,b));
});return a;},render:function(a,d,c,b){a.setStyle(d,this.serve(c,b));},search:function(a){if(Fx.CSS.Cache[a]){return Fx.CSS.Cache[a];}var c={},b=new RegExp("^"+a.escapeRegExp()+"$");
Array.each(document.styleSheets,function(f,e){var d=f.href;if(d&&d.contains("://")&&!d.contains(document.domain)){return;}var g=f.rules||f.cssRules;Array.each(g,function(k,h){if(!k.style){return;
}var j=(k.selectorText)?k.selectorText.replace(/^\w+/,function(i){return i.toLowerCase();}):null;if(!j||!b.test(j)){return;}Object.each(Element.Styles,function(l,i){if(!k.style[i]||Element.ShortStyles[i]){return;
}l=String(k.style[i]);c[i]=((/^rgb/).test(l))?l.rgbToHex():l;});});});return Fx.CSS.Cache[a]=c;}});Fx.CSS.Cache={};Fx.CSS.Parsers={Color:{parse:function(a){if(a.match(/^#[0-9a-f]{3,6}$/i)){return a.hexToRgb(true);
}return((a=a.match(/(\d+),\s*(\d+),\s*(\d+)/)))?[a[1],a[2],a[3]]:false;},compute:function(c,b,a){return c.map(function(e,d){return Math.round(Fx.compute(c[d],b[d],a));
});},serve:function(a){return a.map(Number);}},Number:{parse:parseFloat,compute:Fx.compute,serve:function(b,a){return(a)?b+a:b;}},String:{parse:Function.from(false),compute:function(b,a){return a;
},serve:function(a){return a;}}};Fx.CSS.Parsers=new Hash(Fx.CSS.Parsers);Fx.Tween=new Class({Extends:Fx.CSS,initialize:function(b,a){this.element=this.subject=document.id(b);
this.parent(a);},set:function(b,a){if(arguments.length==1){a=b;b=this.property||this.options.property;}this.render(this.element,b,a,this.options.unit);
return this;},start:function(c,e,d){if(!this.check(c,e,d)){return this;}var b=Array.flatten(arguments);this.property=this.options.property||b.shift();var a=this.prepare(this.element,this.property,b);
return this.parent(a.from,a.to);}});Element.Properties.tween={set:function(a){this.get("tween").cancel().setOptions(a);return this;},get:function(){var a=this.retrieve("tween");
if(!a){a=new Fx.Tween(this,{link:"cancel"});this.store("tween",a);}return a;}};Element.implement({tween:function(a,c,b){this.get("tween").start(arguments);
return this;},fade:function(c){var e=this.get("tween"),d="opacity",a;c=[c,"toggle"].pick();switch(c){case"in":e.start(d,1);break;case"out":e.start(d,0);
break;case"show":e.set(d,1);break;case"hide":e.set(d,0);break;case"toggle":var b=this.retrieve("fade:flag",this.get("opacity")==1);e.start(d,(b)?0:1);this.store("fade:flag",!b);
a=true;break;default:e.start(d,arguments);}if(!a){this.eliminate("fade:flag");}return this;},highlight:function(c,a){if(!a){a=this.retrieve("highlight:original",this.getStyle("background-color"));
a=(a=="transparent")?"#fff":a;}var b=this.get("tween");b.start("background-color",c||"#ffff88",a).chain(function(){this.setStyle("background-color",this.retrieve("highlight:original"));
b.callChain();}.bind(this));return this;}});Fx.Morph=new Class({Extends:Fx.CSS,initialize:function(b,a){this.element=this.subject=document.id(b);this.parent(a);
},set:function(a){if(typeof a=="string"){a=this.search(a);}for(var b in a){this.render(this.element,b,a[b],this.options.unit);}return this;},compute:function(e,d,c){var a={};
for(var b in e){a[b]=this.parent(e[b],d[b],c);}return a;},start:function(b){if(!this.check(b)){return this;}if(typeof b=="string"){b=this.search(b);}var e={},d={};
for(var c in b){var a=this.prepare(this.element,c,b[c]);e[c]=a.from;d[c]=a.to;}return this.parent(e,d);}});Element.Properties.morph={set:function(a){this.get("morph").cancel().setOptions(a);
return this;},get:function(){var a=this.retrieve("morph");if(!a){a=new Fx.Morph(this,{link:"cancel"});this.store("morph",a);}return a;}};Element.implement({morph:function(a){this.get("morph").start(a);
return this;}});Fx.implement({getTransition:function(){var a=this.options.transition||Fx.Transitions.Sine.easeInOut;if(typeof a=="string"){var b=a.split(":");
a=Fx.Transitions;a=a[b[0]]||a[b[0].capitalize()];if(b[1]){a=a["ease"+b[1].capitalize()+(b[2]?b[2].capitalize():"")];}}return a;}});Fx.Transition=function(c,b){b=Array.from(b);
var a=function(d){return c(d,b);};return Object.append(a,{easeIn:a,easeOut:function(d){return 1-c(1-d,b);},easeInOut:function(d){return(d<=0.5?c(2*d,b):(2-c(2*(1-d),b)))/2;
}});};Fx.Transitions={linear:function(a){return a;}};Fx.Transitions=new Hash(Fx.Transitions);Fx.Transitions.extend=function(a){for(var b in a){Fx.Transitions[b]=new Fx.Transition(a[b]);
}};Fx.Transitions.extend({Pow:function(b,a){return Math.pow(b,a&&a[0]||6);},Expo:function(a){return Math.pow(2,8*(a-1));},Circ:function(a){return 1-Math.sin(Math.acos(a));
},Sine:function(a){return 1-Math.cos(a*Math.PI/2);},Back:function(b,a){a=a&&a[0]||1.618;return Math.pow(b,2)*((a+1)*b-a);},Bounce:function(f){var e;for(var d=0,c=1;
1;d+=c,c/=2){if(f>=(7-4*d)/11){e=c*c-Math.pow((11-6*d-11*f)/4,2);break;}}return e;},Elastic:function(b,a){return Math.pow(2,10*--b)*Math.cos(20*b*Math.PI*(a&&a[0]||1)/3);
}});["Quad","Cubic","Quart","Quint"].each(function(b,a){Fx.Transitions[b]=new Fx.Transition(function(c){return Math.pow(c,a+2);});});(function(){var d=function(){},a=("onprogress" in new Browser.Request);
var c=this.Request=new Class({Implements:[Chain,Events,Options],options:{url:"",data:"",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*"},async:true,format:false,method:"post",link:"ignore",isSuccess:null,emulation:true,urlEncoded:true,encoding:"utf-8",evalScripts:false,evalResponse:false,timeout:0,noCache:false},initialize:function(e){this.xhr=new Browser.Request();
this.setOptions(e);this.headers=this.options.headers;},onStateChange:function(){var e=this.xhr;if(e.readyState!=4||!this.running){return;}this.running=false;
this.status=0;Function.attempt(function(){var f=e.status;this.status=(f==1223)?204:f;}.bind(this));e.onreadystatechange=d;if(a){e.onprogress=e.onloadstart=d;
}clearTimeout(this.timer);this.response={text:this.xhr.responseText||"",xml:this.xhr.responseXML};if(this.options.isSuccess.call(this,this.status)){this.success(this.response.text,this.response.xml);
}else{this.failure();}},isSuccess:function(){var e=this.status;return(e>=200&&e<300);},isRunning:function(){return !!this.running;},processScripts:function(e){if(this.options.evalResponse||(/(ecma|java)script/).test(this.getHeader("Content-type"))){return Browser.exec(e);
}return e.stripScripts(this.options.evalScripts);},success:function(f,e){this.onSuccess(this.processScripts(f),e);},onSuccess:function(){this.fireEvent("complete",arguments).fireEvent("success",arguments).callChain();
},failure:function(){this.onFailure();},onFailure:function(){this.fireEvent("complete").fireEvent("failure",this.xhr);},loadstart:function(e){this.fireEvent("loadstart",[e,this.xhr]);
},progress:function(e){this.fireEvent("progress",[e,this.xhr]);},timeout:function(){this.fireEvent("timeout",this.xhr);},setHeader:function(e,f){this.headers[e]=f;
return this;},getHeader:function(e){return Function.attempt(function(){return this.xhr.getResponseHeader(e);}.bind(this));},check:function(){if(!this.running){return true;
}switch(this.options.link){case"cancel":this.cancel();return true;case"chain":this.chain(this.caller.pass(arguments,this));return false;}return false;},send:function(o){if(!this.check(o)){return this;
}this.options.isSuccess=this.options.isSuccess||this.isSuccess;this.running=true;var l=typeOf(o);if(l=="string"||l=="element"){o={data:o};}var h=this.options;
o=Object.append({data:h.data,url:h.url,method:h.method},o);var j=o.data,f=String(o.url),e=o.method.toLowerCase();switch(typeOf(j)){case"element":j=document.id(j).toQueryString();
break;case"object":case"hash":j=Object.toQueryString(j);}if(this.options.format){var m="format="+this.options.format;j=(j)?m+"&"+j:m;}if(this.options.emulation&&!["get","post"].contains(e)){var k="_method="+e;
j=(j)?k+"&"+j:k;e="post";}if(this.options.urlEncoded&&["post","put"].contains(e)){var g=(this.options.encoding)?"; charset="+this.options.encoding:"";this.headers["Content-type"]="application/x-www-form-urlencoded"+g;
}if(!f){f=document.location.pathname;}var i=f.lastIndexOf("/");if(i>-1&&(i=f.indexOf("#"))>-1){f=f.substr(0,i);}if(this.options.noCache){f+=(f.contains("?")?"&":"?")+String.uniqueID();
}if(j&&e=="get"){f+=(f.contains("?")?"&":"?")+j;j=null;}var n=this.xhr;if(a){n.onloadstart=this.loadstart.bind(this);n.onprogress=this.progress.bind(this);
}n.open(e.toUpperCase(),f,this.options.async,this.options.user,this.options.password);if(this.options.user&&"withCredentials" in n){n.withCredentials=true;
}n.onreadystatechange=this.onStateChange.bind(this);Object.each(this.headers,function(q,p){try{n.setRequestHeader(p,q);}catch(r){this.fireEvent("exception",[p,q]);
}},this);this.fireEvent("request");n.send(j);if(!this.options.async){this.onStateChange();}if(this.options.timeout){this.timer=this.timeout.delay(this.options.timeout,this);
}return this;},cancel:function(){if(!this.running){return this;}this.running=false;var e=this.xhr;e.abort();clearTimeout(this.timer);e.onreadystatechange=d;
if(a){e.onprogress=e.onloadstart=d;}this.xhr=new Browser.Request();this.fireEvent("cancel");return this;}});var b={};["get","post","put","delete","GET","POST","PUT","DELETE"].each(function(e){b[e]=function(g){var f={method:e};
if(g!=null){f.data=g;}return this.send(f);};});c.implement(b);Element.Properties.send={set:function(e){var f=this.get("send").cancel();f.setOptions(e);
return this;},get:function(){var e=this.retrieve("send");if(!e){e=new c({data:this,link:"cancel",method:this.get("method")||"post",url:this.get("action")});
this.store("send",e);}return e;}};Element.implement({send:function(e){var f=this.get("send");f.send({data:this,url:e||f.options.url});return this;}});})();
Request.HTML=new Class({Extends:Request,options:{update:false,append:false,evalScripts:true,filter:false,headers:{Accept:"text/html, application/xml, text/xml, */*"}},success:function(e){var d=this.options,b=this.response;
b.html=e.stripScripts(function(f){b.javascript=f;});var c=b.html.match(/<body[^>]*>([\s\S]*?)<\/body>/i);if(c){b.html=c[1];}var a=new Element("div").set("html",b.html);
b.tree=a.childNodes;b.elements=a.getElements("*");if(d.filter){b.tree=b.elements.filter(d.filter);}if(d.update){document.id(d.update).empty().set("html",b.html);
}else{if(d.append){document.id(d.append).adopt(a.getChildren());}}if(d.evalScripts){Browser.exec(b.javascript);}this.onSuccess(b.tree,b.elements,b.html,b.javascript);
}});Element.Properties.load={set:function(a){var b=this.get("load").cancel();b.setOptions(a);return this;},get:function(){var a=this.retrieve("load");if(!a){a=new Request.HTML({data:this,link:"cancel",update:this,method:"get"});
this.store("load",a);}return a;}};Element.implement({load:function(){this.get("load").send(Array.link(arguments,{data:Type.isObject,url:Type.isString}));
return this;}});if(typeof JSON=="undefined"){this.JSON={};}JSON=new Hash({stringify:JSON.stringify,parse:JSON.parse});(function(){var special={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};
var escape=function(chr){return special[chr]||"\\u"+("0000"+chr.charCodeAt(0).toString(16)).slice(-4);};JSON.validate=function(string){string=string.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"");
return(/^[\],:{}\s]*$/).test(string);};JSON.encode=JSON.stringify?function(obj){return JSON.stringify(obj);}:function(obj){if(obj&&obj.toJSON){obj=obj.toJSON();
}switch(typeOf(obj)){case"string":return'"'+obj.replace(/[\x00-\x1f\\"]/g,escape)+'"';case"array":return"["+obj.map(JSON.encode).clean()+"]";case"object":case"hash":var string=[];
Object.each(obj,function(value,key){var json=JSON.encode(value);if(json){string.push(JSON.encode(key)+":"+json);}});return"{"+string+"}";case"number":case"boolean":return""+obj;
case"null":return"null";}return null;};JSON.decode=function(string,secure){if(!string||typeOf(string)!="string"){return null;}if(secure||JSON.secure){if(JSON.parse){return JSON.parse(string);
}if(!JSON.validate(string)){throw new Error("JSON could not decode the input; security is enabled and the value is not secure.");}}return eval("("+string+")");
};})();Request.JSON=new Class({Extends:Request,options:{secure:true},initialize:function(a){this.parent(a);Object.append(this.headers,{Accept:"application/json","X-Request":"JSON"});
},success:function(c){var b;try{b=this.response.json=JSON.decode(c,this.options.secure);}catch(a){this.fireEvent("error",[c,a]);return;}if(b==null){this.onFailure();
}else{this.onSuccess(b,c);}}});var Cookie=new Class({Implements:Options,options:{path:"/",domain:false,duration:false,secure:false,document:document,encode:true},initialize:function(b,a){this.key=b;
this.setOptions(a);},write:function(b){if(this.options.encode){b=encodeURIComponent(b);}if(this.options.domain){b+="; domain="+this.options.domain;}if(this.options.path){b+="; path="+this.options.path;
}if(this.options.duration){var a=new Date();a.setTime(a.getTime()+this.options.duration*24*60*60*1000);b+="; expires="+a.toGMTString();}if(this.options.secure){b+="; secure";
}this.options.document.cookie=this.key+"="+b;return this;},read:function(){var a=this.options.document.cookie.match("(?:^|;)\\s*"+this.key.escapeRegExp()+"=([^;]*)");
return(a)?decodeURIComponent(a[1]):null;},dispose:function(){new Cookie(this.key,Object.merge({},this.options,{duration:-1})).write("");return this;}});
Cookie.write=function(b,c,a){return new Cookie(b,a).write(c);};Cookie.read=function(a){return new Cookie(a).read();};Cookie.dispose=function(b,a){return new Cookie(b,a).dispose();
};(function(i,k){var l,f,e=[],c,b,d=k.createElement("div");var g=function(){clearTimeout(b);if(l){return;}Browser.loaded=l=true;k.removeListener("DOMContentLoaded",g).removeListener("readystatechange",a);
k.fireEvent("domready");i.fireEvent("domready");};var a=function(){for(var m=e.length;m--;){if(e[m]()){g();return true;}}return false;};var j=function(){clearTimeout(b);
if(!a()){b=setTimeout(j,10);}};k.addListener("DOMContentLoaded",g);var h=function(){try{d.doScroll();return true;}catch(m){}return false;};if(d.doScroll&&!h()){e.push(h);
c=true;}if(k.readyState){e.push(function(){var m=k.readyState;return(m=="loaded"||m=="complete");});}if("onreadystatechange" in k){k.addListener("readystatechange",a);
}else{c=true;}if(c){j();}Element.Events.domready={onAdd:function(m){if(l){m.call(this);}}};Element.Events.load={base:"load",onAdd:function(m){if(f&&this==i){m.call(this);
}},condition:function(){if(this==i){g();delete Element.Events.load;}return true;}};i.addEvent("load",function(){f=true;});})(window,document);(function(){var Swiff=this.Swiff=new Class({Implements:Options,options:{id:null,height:1,width:1,container:null,properties:{},params:{quality:"high",allowScriptAccess:"always",wMode:"window",swLiveConnect:true},callBacks:{},vars:{}},toElement:function(){return this.object;
},initialize:function(path,options){this.instance="Swiff_"+String.uniqueID();this.setOptions(options);options=this.options;var id=this.id=options.id||this.instance;
var container=document.id(options.container);Swiff.CallBacks[this.instance]={};var params=options.params,vars=options.vars,callBacks=options.callBacks;
var properties=Object.append({height:options.height,width:options.width},options.properties);var self=this;for(var callBack in callBacks){Swiff.CallBacks[this.instance][callBack]=(function(option){return function(){return option.apply(self.object,arguments);
};})(callBacks[callBack]);vars[callBack]="Swiff.CallBacks."+this.instance+"."+callBack;}params.flashVars=Object.toQueryString(vars);if(Browser.ie){properties.classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000";
params.movie=path;}else{properties.type="application/x-shockwave-flash";}properties.data=path;var build='<object id="'+id+'"';for(var property in properties){build+=" "+property+'="'+properties[property]+'"';
}build+=">";for(var param in params){if(params[param]){build+='<param name="'+param+'" value="'+params[param]+'" />';}}build+="</object>";this.object=((container)?container.empty():new Element("div")).set("html",build).firstChild;
},replaces:function(element){element=document.id(element,true);element.parentNode.replaceChild(this.toElement(),element);return this;},inject:function(element){document.id(element,true).appendChild(this.toElement());
return this;},remote:function(){return Swiff.remote.apply(Swiff,[this.toElement()].append(arguments));}});Swiff.CallBacks={};Swiff.remote=function(obj,fn){var rs=obj.CallFunction('<invoke name="'+fn+'" returntype="javascript">'+__flash__argumentsToXML(arguments,2)+"</invoke>");
return eval(rs);};})();
delete Function.prototype.bind;

Function.implement({

	bind : function(that)
	{
		var self = this,
			args = arguments.length > 1 ? Array.slice(arguments, 1) : null,
			F = function(){};

		var bound = function(){
			var context = that, length = arguments.length;
			if (this instanceof bound){
				F.prototype = self.prototype;
				context = new F;
			}
			var result = (!args && !length)
				? self.call(context)
				: self.apply(context, args && length ? args.concat(Array.slice(arguments)) : args || arguments);
			return context == that ? result : context;
		};
		return bound;
	}
});
;
// MooTools: the javascript framework.
// Load this file's selection again by visiting: http://mootools.net/more/93a47a81b8788493eaa4a711ffc5c9b6 
// Or build this file again with packager using: packager build More/More More/Date More/Object.Extras More/Hash More/Hash.Extras More/Element.Measure More/Element.Position More/Element.Shortcuts More/Fx.Elements More/Fx.Move More/Fx.Reveal More/Fx.Scroll More/Fx.Slide More/Locale More/Locale.en-US.Date More/Locale.ru-RU-unicode.Date More/Locale.ru-RU-unicode.Form.Validator
/*
---
copyrights:
  - [MooTools](http://mootools.net)

licenses:
  - [MIT License](http://mootools.net/license.txt)
...
*/
MooTools.More={version:"1.3.2.1",build:"e586bcd2496e9b22acfde32e12f84d49ce09e59d"};(function(){var b=function(c){return c!=null;};var a=Object.prototype.hasOwnProperty;
Object.extend({getFromPath:function(e,f){if(typeof f=="string"){f=f.split(".");}for(var d=0,c=f.length;d<c;d++){if(a.call(e,f[d])){e=e[f[d]];}else{return null;
}}return e;},cleanValues:function(c,e){e=e||b;for(var d in c){if(!e(c[d])){delete c[d];}}return c;},erase:function(c,d){if(a.call(c,d)){delete c[d];}return c;
},run:function(d){var c=Array.slice(arguments,1);for(var e in d){if(d[e].apply){d[e].apply(d,c);}}return d;}});})();(function(){var b=null,a={},e={};var d=function(g){if(instanceOf(g,f.Set)){return g;
}else{return a[g];}};var f=this.Locale={define:function(g,k,i,j){var h;if(instanceOf(g,f.Set)){h=g.name;if(h){a[h]=g;}}else{h=g;if(!a[h]){a[h]=new f.Set(h);
}g=a[h];}if(k){g.define(k,i,j);}if(k=="cascade"){return f.inherit(h,i);}if(!b){b=g;}return g;},use:function(g){g=d(g);if(g){b=g;this.fireEvent("change",g);
this.fireEvent("langChange",g.name);}return this;},getCurrent:function(){return b;},get:function(h,g){return(b)?b.get(h,g):"";},inherit:function(g,h,i){g=d(g);
if(g){g.inherit(h,i);}return this;},list:function(){return Object.keys(a);}};Object.append(f,new Events);f.Set=new Class({sets:{},inherits:{locales:[],sets:{}},initialize:function(g){this.name=g||"";
},define:function(j,h,i){var g=this.sets[j];if(!g){g={};}if(h){if(typeOf(h)=="object"){g=Object.merge(g,h);}else{g[h]=i;}}this.sets[j]=g;return this;},get:function(s,k,r){var q=Object.getFromPath(this.sets,s);
if(q!=null){var n=typeOf(q);if(n=="function"){q=q.apply(null,Array.from(k));}else{if(n=="object"){q=Object.clone(q);}}return q;}var j=s.indexOf("."),p=j<0?s:s.substr(0,j),m=(this.inherits.sets[p]||[]).combine(this.inherits.locales).include("en-US");
if(!r){r=[];}for(var h=0,g=m.length;h<g;h++){if(r.contains(m[h])){continue;}r.include(m[h]);var o=a[m[h]];if(!o){continue;}q=o.get(s,k,r);if(q!=null){return q;
}}return"";},inherit:function(h,i){h=Array.from(h);if(i&&!this.inherits.sets[i]){this.inherits.sets[i]=[];}var g=h.length;while(g--){(i?this.inherits.sets[i]:this.inherits.locales).unshift(h[g]);
}return this;}});var c=MooTools.lang={};Object.append(c,f,{setLanguage:f.use,getCurrentLanguage:function(){var g=f.getCurrent();return(g)?g.name:null;},set:function(){f.define.apply(this,arguments);
return this;},get:function(i,h,g){if(h){i+="."+h;}return f.get(i,g);}});})();Locale.define("en-US","Date",{months:["January","February","March","April","May","June","July","August","September","October","November","December"],months_abbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],days_abbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dateOrder:["month","date","year"],shortDate:"%m/%d/%Y",shortTime:"%I:%M%p",AM:"AM",PM:"PM",firstDayOfWeek:0,ordinal:function(a){return(a>3&&a<21)?"th":["th","st","nd","rd","th"][Math.min(a%10,4)];
},lessThanMinuteAgo:"less than a minute ago",minuteAgo:"about a minute ago",minutesAgo:"{delta} minutes ago",hourAgo:"about an hour ago",hoursAgo:"about {delta} hours ago",dayAgo:"1 day ago",daysAgo:"{delta} days ago",weekAgo:"1 week ago",weeksAgo:"{delta} weeks ago",monthAgo:"1 month ago",monthsAgo:"{delta} months ago",yearAgo:"1 year ago",yearsAgo:"{delta} years ago",lessThanMinuteUntil:"less than a minute from now",minuteUntil:"about a minute from now",minutesUntil:"{delta} minutes from now",hourUntil:"about an hour from now",hoursUntil:"about {delta} hours from now",dayUntil:"1 day from now",daysUntil:"{delta} days from now",weekUntil:"1 week from now",weeksUntil:"{delta} weeks from now",monthUntil:"1 month from now",monthsUntil:"{delta} months from now",yearUntil:"1 year from now",yearsUntil:"{delta} years from now"});
(function(){var a=this.Date;var f=a.Methods={ms:"Milliseconds",year:"FullYear",min:"Minutes",mo:"Month",sec:"Seconds",hr:"Hours"};["Date","Day","FullYear","Hours","Milliseconds","Minutes","Month","Seconds","Time","TimezoneOffset","Week","Timezone","GMTOffset","DayOfYear","LastMonth","LastDayOfMonth","UTCDate","UTCDay","UTCFullYear","AMPM","Ordinal","UTCHours","UTCMilliseconds","UTCMinutes","UTCMonth","UTCSeconds","UTCMilliseconds"].each(function(t){a.Methods[t.toLowerCase()]=t;
});var p=function(v,u,t){if(u==1){return v;}return v<Math.pow(10,u-1)?(t||"0")+p(v,u-1,t):v;};a.implement({set:function(v,t){v=v.toLowerCase();var u=f[v]&&"set"+f[v];
if(u&&this[u]){this[u](t);}return this;}.overloadSetter(),get:function(u){u=u.toLowerCase();var t=f[u]&&"get"+f[u];if(t&&this[t]){return this[t]();}return null;
}.overloadGetter(),clone:function(){return new a(this.get("time"));},increment:function(t,v){t=t||"day";v=v!=null?v:1;switch(t){case"year":return this.increment("month",v*12);
case"month":var u=this.get("date");this.set("date",1).set("mo",this.get("mo")+v);return this.set("date",u.min(this.get("lastdayofmonth")));case"week":return this.increment("day",v*7);
case"day":return this.set("date",this.get("date")+v);}if(!a.units[t]){throw new Error(t+" is not a supported interval");}return this.set("time",this.get("time")+v*a.units[t]());
},decrement:function(t,u){return this.increment(t,-1*(u!=null?u:1));},isLeapYear:function(){return a.isLeapYear(this.get("year"));},clearTime:function(){return this.set({hr:0,min:0,sec:0,ms:0});
},diff:function(u,t){if(typeOf(u)=="string"){u=a.parse(u);}return((u-this)/a.units[t||"day"](3,3)).round();},getLastDayOfMonth:function(){return a.daysInMonth(this.get("mo"),this.get("year"));
},getDayOfYear:function(){return(a.UTC(this.get("year"),this.get("mo"),this.get("date")+1)-a.UTC(this.get("year"),0,1))/a.units.day();},setDay:function(u,t){if(t==null){t=a.getMsg("firstDayOfWeek");
if(t===""){t=1;}}u=(7+a.parseDay(u,true)-t)%7;var v=(7+this.get("day")-t)%7;return this.increment("day",u-v);},getWeek:function(w){if(w==null){w=a.getMsg("firstDayOfWeek");
if(w===""){w=1;}}var y=this,v=(7+y.get("day")-w)%7,u=0,x;if(w==1){var z=y.get("month"),t=y.get("date")-v;if(z==11&&t>28){return 1;}if(z==0&&t<-2){y=new a(y).decrement("day",v);
v=0;}x=new a(y.get("year"),0,1).get("day")||7;if(x>4){u=-7;}}else{x=new a(y.get("year"),0,1).get("day");}u+=y.get("dayofyear");u+=6-v;u+=(7+x-w)%7;return(u/7);
},getOrdinal:function(t){return a.getMsg("ordinal",t||this.get("date"));},getTimezone:function(){return this.toString().replace(/^.*? ([A-Z]{3}).[0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3");
},getGMTOffset:function(){var t=this.get("timezoneOffset");return((t>0)?"-":"+")+p((t.abs()/60).floor(),2)+p(t%60,2);},setAMPM:function(t){t=t.toUpperCase();
var u=this.get("hr");if(u>11&&t=="AM"){return this.decrement("hour",12);}else{if(u<12&&t=="PM"){return this.increment("hour",12);}}return this;},getAMPM:function(){return(this.get("hr")<12)?"AM":"PM";
},parse:function(t){this.set("time",a.parse(t));return this;},isValid:function(t){return !isNaN((t||this).valueOf());},format:function(u){if(!this.isValid()){return"invalid date";
}if(!u){u="%x %X";}var t=u.toLowerCase();if(s[t]){return s[t](this);}u=g[t]||u;var v=this;return u.replace(/%([a-z%])/gi,function(x,w){switch(w){case"a":return a.getMsg("days_abbr")[v.get("day")];
case"A":return a.getMsg("days")[v.get("day")];case"b":return a.getMsg("months_abbr")[v.get("month")];case"B":return a.getMsg("months")[v.get("month")];
case"c":return v.format("%a %b %d %H:%M:%S %Y");case"d":return p(v.get("date"),2);case"e":return p(v.get("date"),2," ");case"H":return p(v.get("hr"),2);
case"I":return p((v.get("hr")%12)||12,2);case"j":return p(v.get("dayofyear"),3);case"k":return p(v.get("hr"),2," ");case"l":return p((v.get("hr")%12)||12,2," ");
case"L":return p(v.get("ms"),3);case"m":return p((v.get("mo")+1),2);case"M":return p(v.get("min"),2);case"o":return v.get("ordinal");case"p":return a.getMsg(v.get("ampm"));
case"s":return Math.round(v/1000);case"S":return p(v.get("seconds"),2);case"T":return v.format("%H:%M:%S");case"U":return p(v.get("week"),2);case"w":return v.get("day");
case"x":return v.format(a.getMsg("shortDate"));case"X":return v.format(a.getMsg("shortTime"));case"y":return v.get("year").toString().substr(2);case"Y":return v.get("year");
case"z":return v.get("GMTOffset");case"Z":return v.get("Timezone");}return w;});},toISOString:function(){return this.format("iso8601");}}).alias({toJSON:"toISOString",compare:"diff",strftime:"format"});
var g={db:"%Y-%m-%d %H:%M:%S",compact:"%Y%m%dT%H%M%S","short":"%d %b %H:%M","long":"%B %d, %Y %H:%M"};var k=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],h=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
var s={rfc822:function(t){return k[t.get("day")]+t.format(", %d ")+h[t.get("month")]+t.format(" %Y %H:%M:%S %Z");},rfc2822:function(t){return k[t.get("day")]+t.format(", %d ")+h[t.get("month")]+t.format(" %Y %H:%M:%S %z");
},iso8601:function(t){return(t.getUTCFullYear()+"-"+p(t.getUTCMonth()+1,2)+"-"+p(t.getUTCDate(),2)+"T"+p(t.getUTCHours(),2)+":"+p(t.getUTCMinutes(),2)+":"+p(t.getUTCSeconds(),2)+"."+p(t.getUTCMilliseconds(),3)+"Z");
}};var c=[],n=a.parse;var r=function(w,y,v){var u=-1,x=a.getMsg(w+"s");switch(typeOf(y)){case"object":u=x[y.get(w)];break;case"number":u=x[y];if(!u){throw new Error("Invalid "+w+" index: "+y);
}break;case"string":var t=x.filter(function(z){return this.test(z);},new RegExp("^"+y,"i"));if(!t.length){throw new Error("Invalid "+w+" string");}if(t.length>1){throw new Error("Ambiguous "+w);
}u=t[0];}return(v)?x.indexOf(u):u;};var i=1900,o=70;a.extend({getMsg:function(u,t){return Locale.get("Date."+u,t);},units:{ms:Function.from(1),second:Function.from(1000),minute:Function.from(60000),hour:Function.from(3600000),day:Function.from(86400000),week:Function.from(608400000),month:function(u,t){var v=new a;
return a.daysInMonth(u!=null?u:v.get("mo"),t!=null?t:v.get("year"))*86400000;},year:function(t){t=t||new a().get("year");return a.isLeapYear(t)?31622400000:31536000000;
}},daysInMonth:function(u,t){return[31,a.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][u];},isLeapYear:function(t){return((t%4===0)&&(t%100!==0))||(t%400===0);
},parse:function(w){var v=typeOf(w);if(v=="number"){return new a(w);}if(v!="string"){return w;}w=w.clean();if(!w.length){return null;}var u;c.some(function(x){var t=x.re.exec(w);
return(t)?(u=x.handler(t)):false;});if(!(u&&u.isValid())){u=new a(n(w));if(!(u&&u.isValid())){u=new a(w.toInt());}}return u;},parseDay:function(t,u){return r("day",t,u);
},parseMonth:function(u,t){return r("month",u,t);},parseUTC:function(u){var t=new a(u);var v=a.UTC(t.get("year"),t.get("mo"),t.get("date"),t.get("hr"),t.get("min"),t.get("sec"),t.get("ms"));
return new a(v);},orderIndex:function(t){return a.getMsg("dateOrder").indexOf(t)+1;},defineFormat:function(t,u){g[t]=u;return this;},defineFormats:function(t){for(var u in t){a.defineFormat(u,t[u]);
}return this;},parsePatterns:c,defineParser:function(t){c.push((t.re&&t.handler)?t:l(t));return this;},defineParsers:function(){Array.flatten(arguments).each(a.defineParser);
return this;},define2DigitYearStart:function(t){o=t%100;i=t-o;return this;}});var d=function(t){return new RegExp("(?:"+a.getMsg(t).map(function(u){return u.substr(0,3);
}).join("|")+")[a-z]*");};var m=function(t){switch(t){case"T":return"%H:%M:%S";case"x":return((a.orderIndex("month")==1)?"%m[-./]%d":"%d[-./]%m")+"([-./]%y)?";
case"X":return"%H([.:]%M)?([.:]%S([.:]%s)?)? ?%p? ?%z?";}return null;};var j={d:/[0-2]?[0-9]|3[01]/,H:/[01]?[0-9]|2[0-3]/,I:/0?[1-9]|1[0-2]/,M:/[0-5]?\d/,s:/\d+/,o:/[a-z]*/,p:/[ap]\.?m\.?/,y:/\d{2}|\d{4}/,Y:/\d{4}/,z:/Z|[+-]\d{2}(?::?\d{2})?/};
j.m=j.I;j.S=j.M;var e;var b=function(t){e=t;j.a=j.A=d("days");j.b=j.B=d("months");c.each(function(v,u){if(v.format){c[u]=l(v.format);}});};var l=function(v){if(!e){return{format:v};
}var t=[];var u=(v.source||v).replace(/%([a-z])/gi,function(x,w){return m(w)||x;}).replace(/\((?!\?)/g,"(?:").replace(/ (?!\?|\*)/g,",? ").replace(/%([a-z%])/gi,function(x,w){var y=j[w];
if(!y){return w;}t.push(w);return"("+y.source+")";}).replace(/\[a-z\]/gi,"[a-z\\u00c0-\\uffff;&]");return{format:v,re:new RegExp("^"+u+"$","i"),handler:function(z){z=z.slice(1).associate(t);
var w=new a().clearTime(),y=z.y||z.Y;if(y!=null){q.call(w,"y",y);}if("d" in z){q.call(w,"d",1);}if("m" in z||z.b||z.B){q.call(w,"m",1);}for(var x in z){q.call(w,x,z[x]);
}return w;}};};var q=function(t,u){if(!u){return this;}switch(t){case"a":case"A":return this.set("day",a.parseDay(u,true));case"b":case"B":return this.set("mo",a.parseMonth(u,true));
case"d":return this.set("date",u);case"H":case"I":return this.set("hr",u);case"m":return this.set("mo",u-1);case"M":return this.set("min",u);case"p":return this.set("ampm",u.replace(/\./g,""));
case"S":return this.set("sec",u);case"s":return this.set("ms",("0."+u)*1000);case"w":return this.set("day",u);case"Y":return this.set("year",u);case"y":u=+u;
if(u<100){u+=i+(u<o?100:0);}return this.set("year",u);case"z":if(u=="Z"){u="+00";}var v=u.match(/([+-])(\d{2}):?(\d{2})?/);v=(v[1]+"1")*(v[2]*60+(+v[3]||0))+this.getTimezoneOffset();
return this.set("time",this-v*60000);}return this;};a.defineParsers("%Y([-./]%m([-./]%d((T| )%X)?)?)?","%Y%m%d(T%H(%M%S?)?)?","%x( %X)?","%d%o( %b( %Y)?)?( %X)?","%b( %d%o)?( %Y)?( %X)?","%Y %b( %d%o( %X)?)?","%o %b %d %X %z %Y","%T","%H:%M( ?%p)?");
Locale.addEvent("change",function(t){if(Locale.get("Date")){b(t);}}).fireEvent("change",Locale.getCurrent());})();(function(){if(this.Hash){return;}var a=this.Hash=new Type("Hash",function(b){if(typeOf(b)=="hash"){b=Object.clone(b.getClean());
}for(var c in b){this[c]=b[c];}return this;});this.$H=function(b){return new a(b);};a.implement({forEach:function(b,c){Object.forEach(this,b,c);},getClean:function(){var c={};
for(var b in this){if(this.hasOwnProperty(b)){c[b]=this[b];}}return c;},getLength:function(){var c=0;for(var b in this){if(this.hasOwnProperty(b)){c++;
}}return c;}});a.alias("each","forEach");a.implement({has:Object.prototype.hasOwnProperty,keyOf:function(b){return Object.keyOf(this,b);},hasValue:function(b){return Object.contains(this,b);
},extend:function(b){a.each(b||{},function(d,c){a.set(this,c,d);},this);return this;},combine:function(b){a.each(b||{},function(d,c){a.include(this,c,d);
},this);return this;},erase:function(b){if(this.hasOwnProperty(b)){delete this[b];}return this;},get:function(b){return(this.hasOwnProperty(b))?this[b]:null;
},set:function(b,c){if(!this[b]||this.hasOwnProperty(b)){this[b]=c;}return this;},empty:function(){a.each(this,function(c,b){delete this[b];},this);return this;
},include:function(b,c){if(this[b]==undefined){this[b]=c;}return this;},map:function(b,c){return new a(Object.map(this,b,c));},filter:function(b,c){return new a(Object.filter(this,b,c));
},every:function(b,c){return Object.every(this,b,c);},some:function(b,c){return Object.some(this,b,c);},getKeys:function(){return Object.keys(this);},getValues:function(){return Object.values(this);
},toQueryString:function(b){return Object.toQueryString(this,b);}});a.alias({indexOf:"keyOf",contains:"hasValue"});})();Hash.implement({getFromPath:function(a){return Object.getFromPath(this,a);
},cleanValues:function(a){return new Hash(Object.cleanValues(this,a));},run:function(){Object.run(arguments);}});(function(){var b=function(e,d){var f=[];
Object.each(d,function(g){Object.each(g,function(h){e.each(function(i){f.push(i+"-"+h+(i=="border"?"-width":""));});});});return f;};var c=function(f,e){var d=0;
Object.each(e,function(h,g){if(g.test(f)){d=d+h.toInt();}});return d;};var a=function(d){return !!(!d||d.offsetHeight||d.offsetWidth);};Element.implement({measure:function(h){if(a(this)){return h.call(this);
}var g=this.getParent(),e=[];while(!a(g)&&g!=document.body){e.push(g.expose());g=g.getParent();}var f=this.expose(),d=h.call(this);f();e.each(function(i){i();
});return d;},expose:function(){if(this.getStyle("display")!="none"){return function(){};}var d=this.style.cssText;this.setStyles({display:"block",position:"absolute",visibility:"hidden"});
return function(){this.style.cssText=d;}.bind(this);},getDimensions:function(d){d=Object.merge({computeSize:false},d);var i={x:0,y:0};var h=function(j,e){return(e.computeSize)?j.getComputedSize(e):j.getSize();
};var f=this.getParent("body");if(f&&this.getStyle("display")=="none"){i=this.measure(function(){return h(this,d);});}else{if(f){try{i=h(this,d);}catch(g){}}}return Object.append(i,(i.x||i.x===0)?{width:i.x,height:i.y}:{x:i.width,y:i.height});
},getComputedSize:function(d){if(d&&d.plains){d.planes=d.plains;}d=Object.merge({styles:["padding","border"],planes:{height:["top","bottom"],width:["left","right"]},mode:"both"},d);
var g={},e={width:0,height:0},f;if(d.mode=="vertical"){delete e.width;delete d.planes.width;}else{if(d.mode=="horizontal"){delete e.height;delete d.planes.height;
}}b(d.styles,d.planes).each(function(h){g[h]=this.getStyle(h).toInt();},this);Object.each(d.planes,function(i,h){var k=h.capitalize(),j=this.getStyle(h);
if(j=="auto"&&!f){f=this.getDimensions();}j=g[h]=(j=="auto")?f[h]:j.toInt();e["total"+k]=j;i.each(function(m){var l=c(m,g);e["computed"+m.capitalize()]=l;
e["total"+k]+=l;});},this);return Object.append(e,g);}});})();(function(b){var a=Element.Position={options:{relativeTo:document.body,position:{x:"center",y:"center"},offset:{x:0,y:0}},getOptions:function(d,c){c=Object.merge({},a.options,c);
a.setPositionOption(c);a.setEdgeOption(c);a.setOffsetOption(d,c);a.setDimensionsOption(d,c);return c;},setPositionOption:function(c){c.position=a.getCoordinateFromValue(c.position);
},setEdgeOption:function(d){var c=a.getCoordinateFromValue(d.edge);d.edge=c?c:(d.position.x=="center"&&d.position.y=="center")?{x:"center",y:"center"}:{x:"left",y:"top"};
},setOffsetOption:function(f,d){var c={x:0,y:0},g=f.measure(function(){return document.id(this.getOffsetParent());}),e=g.getScroll();if(!g||g==f.getDocument().body){return;
}c=g.measure(function(){var i=this.getPosition();if(this.getStyle("position")=="fixed"){var h=window.getScroll();i.x+=h.x;i.y+=h.y;}return i;});d.offset={parentPositioned:g!=document.id(d.relativeTo),x:d.offset.x-c.x+e.x,y:d.offset.y-c.y+e.y};
},setDimensionsOption:function(d,c){c.dimensions=d.getDimensions({computeSize:true,styles:["padding","border","margin"]});},getPosition:function(e,d){var c={};
d=a.getOptions(e,d);var f=document.id(d.relativeTo)||document.body;a.setPositionCoordinates(d,c,f);if(d.edge){a.toEdge(c,d);}var g=d.offset;c.left=((c.x>=0||g.parentPositioned||d.allowNegative)?c.x:0).toInt();
c.top=((c.y>=0||g.parentPositioned||d.allowNegative)?c.y:0).toInt();a.toMinMax(c,d);if(d.relFixedPosition||f.getStyle("position")=="fixed"){a.toRelFixedPosition(f,c);
}if(d.ignoreScroll){a.toIgnoreScroll(f,c);}if(d.ignoreMargins){a.toIgnoreMargins(c,d);}c.left=Math.ceil(c.left);c.top=Math.ceil(c.top);delete c.x;delete c.y;
return c;},setPositionCoordinates:function(k,g,d){var f=k.offset.y,h=k.offset.x,e=(d==document.body)?window.getScroll():d.getPosition(),j=e.y,c=e.x,i=window.getSize();
switch(k.position.x){case"left":g.x=c+h;break;case"right":g.x=c+h+d.offsetWidth;break;default:g.x=c+((d==document.body?i.x:d.offsetWidth)/2)+h;break;}switch(k.position.y){case"top":g.y=j+f;
break;case"bottom":g.y=j+f+d.offsetHeight;break;default:g.y=j+((d==document.body?i.y:d.offsetHeight)/2)+f;break;}},toMinMax:function(c,d){var f={left:"x",top:"y"},e;
["minimum","maximum"].each(function(g){["left","top"].each(function(h){e=d[g]?d[g][f[h]]:null;if(e!=null&&((g=="minimum")?c[h]<e:c[h]>e)){c[h]=e;}});});
},toRelFixedPosition:function(e,c){var d=window.getScroll();c.top+=d.y;c.left+=d.x;},toIgnoreScroll:function(e,d){var c=e.getScroll();d.top-=c.y;d.left-=c.x;
},toIgnoreMargins:function(c,d){c.left+=d.edge.x=="right"?d.dimensions["margin-right"]:(d.edge.x!="center"?-d.dimensions["margin-left"]:-d.dimensions["margin-left"]+((d.dimensions["margin-right"]+d.dimensions["margin-left"])/2));
c.top+=d.edge.y=="bottom"?d.dimensions["margin-bottom"]:(d.edge.y!="center"?-d.dimensions["margin-top"]:-d.dimensions["margin-top"]+((d.dimensions["margin-bottom"]+d.dimensions["margin-top"])/2));
},toEdge:function(c,d){var e={},g=d.dimensions,f=d.edge;switch(f.x){case"left":e.x=0;break;case"right":e.x=-g.x-g.computedRight-g.computedLeft;break;default:e.x=-(Math.round(g.totalWidth/2));
break;}switch(f.y){case"top":e.y=0;break;case"bottom":e.y=-g.y-g.computedTop-g.computedBottom;break;default:e.y=-(Math.round(g.totalHeight/2));break;}c.x+=e.x;
c.y+=e.y;},getCoordinateFromValue:function(c){if(typeOf(c)!="string"){return c;}c=c.toLowerCase();return{x:c.test("left")?"left":(c.test("right")?"right":"center"),y:c.test(/upper|top/)?"top":(c.test("bottom")?"bottom":"center")};
}};Element.implement({position:function(d){if(d&&(d.x!=null||d.y!=null)){return(b?b.apply(this,arguments):this);}var c=this.setStyle("position","absolute").calculatePosition(d);
return(d&&d.returnPos)?c:this.setStyles(c);},calculatePosition:function(c){return a.getPosition(this,c);}});})(Element.prototype.position);Element.implement({isDisplayed:function(){return this.getStyle("display")!="none";
},isVisible:function(){var a=this.offsetWidth,b=this.offsetHeight;return(a==0&&b==0)?false:(a>0&&b>0)?true:this.style.display!="none";},toggle:function(){return this[this.isDisplayed()?"hide":"show"]();
},hide:function(){var b;try{b=this.getStyle("display");}catch(a){}if(b=="none"){return this;}return this.store("element:_originalDisplay",b||"").setStyle("display","none");
},show:function(a){if(!a&&this.isDisplayed()){return this;}a=a||this.retrieve("element:_originalDisplay")||"block";return this.setStyle("display",(a=="none")?"block":a);
},swapClass:function(a,b){return this.removeClass(a).addClass(b);}});Document.implement({clearSelection:function(){if(window.getSelection){var a=window.getSelection();
if(a&&a.removeAllRanges){a.removeAllRanges();}}else{if(document.selection&&document.selection.empty){try{document.selection.empty();}catch(b){}}}}});Fx.Elements=new Class({Extends:Fx.CSS,initialize:function(b,a){this.elements=this.subject=$$(b);
this.parent(a);},compute:function(g,h,j){var c={};for(var d in g){var a=g[d],e=h[d],f=c[d]={};for(var b in a){f[b]=this.parent(a[b],e[b],j);}}return c;
},set:function(b){for(var c in b){if(!this.elements[c]){continue;}var a=b[c];for(var d in a){this.render(this.elements[c],d,a[d],this.options.unit);}}return this;
},start:function(c){if(!this.check(c)){return this;}var h={},j={};for(var d in c){if(!this.elements[d]){continue;}var f=c[d],a=h[d]={},g=j[d]={};for(var b in f){var e=this.prepare(this.elements[d],b,f[b]);
a[b]=e.from;g[b]=e.to;}}return this.parent(h,j);}});Fx.Move=new Class({Extends:Fx.Morph,options:{relativeTo:document.body,position:"center",edge:false,offset:{x:0,y:0}},start:function(a){var b=this.element,c=b.getStyles("top","left");
if(c.top=="auto"||c.left=="auto"){b.setPosition(b.getPosition(b.getOffsetParent()));}return this.parent(b.position(Object.merge({},this.options,a,{returnPos:true})));
}});Element.Properties.move={set:function(a){this.get("move").cancel().setOptions(a);return this;},get:function(){var a=this.retrieve("move");if(!a){a=new Fx.Move(this,{link:"cancel"});
this.store("move",a);}return a;}};Element.implement({move:function(a){this.get("move").start(a);return this;}});(function(){var a=function(d){var b=d.options.hideInputs;
if(window.OverText){var c=[null];OverText.each(function(e){c.include("."+e.options.labelClass);});if(c){b+=c.join(", ");}}return(b)?d.element.getElements(b):null;
};Fx.Reveal=new Class({Extends:Fx.Morph,options:{link:"cancel",styles:["padding","border","margin"],transitionOpacity:!Browser.ie6,mode:"vertical",display:function(){return this.element.get("tag")!="tr"?"block":"table-row";
},opacity:1,hideInputs:Browser.ie?"select, input, textarea, object, embed":null},dissolve:function(){if(!this.hiding&&!this.showing){if(this.element.getStyle("display")!="none"){this.hiding=true;
this.showing=false;this.hidden=true;this.cssText=this.element.style.cssText;var d=this.element.getComputedSize({styles:this.options.styles,mode:this.options.mode});
if(this.options.transitionOpacity){d.opacity=this.options.opacity;}var c={};Object.each(d,function(f,e){c[e]=[f,0];});this.element.setStyles({display:Function.from(this.options.display).call(this),overflow:"hidden"});
var b=a(this);if(b){b.setStyle("visibility","hidden");}this.$chain.unshift(function(){if(this.hidden){this.hiding=false;this.element.style.cssText=this.cssText;
this.element.setStyle("display","none");if(b){b.setStyle("visibility","visible");}}this.fireEvent("hide",this.element);this.callChain();}.bind(this));this.start(c);
}else{this.callChain.delay(10,this);this.fireEvent("complete",this.element);this.fireEvent("hide",this.element);}}else{if(this.options.link=="chain"){this.chain(this.dissolve.bind(this));
}else{if(this.options.link=="cancel"&&!this.hiding){this.cancel();this.dissolve();}}}return this;},reveal:function(){if(!this.showing&&!this.hiding){if(this.element.getStyle("display")=="none"){this.hiding=false;
this.showing=true;this.hidden=false;this.cssText=this.element.style.cssText;var d;this.element.measure(function(){d=this.element.getComputedSize({styles:this.options.styles,mode:this.options.mode});
}.bind(this));if(this.options.heightOverride!=null){d.height=this.options.heightOverride.toInt();}if(this.options.widthOverride!=null){d.width=this.options.widthOverride.toInt();
}if(this.options.transitionOpacity){this.element.setStyle("opacity",0);d.opacity=this.options.opacity;}var c={height:0,display:Function.from(this.options.display).call(this)};
Object.each(d,function(f,e){c[e]=0;});c.overflow="hidden";this.element.setStyles(c);var b=a(this);if(b){b.setStyle("visibility","hidden");}this.$chain.unshift(function(){this.element.style.cssText=this.cssText;
this.element.setStyle("display",Function.from(this.options.display).call(this));if(!this.hidden){this.showing=false;}if(b){b.setStyle("visibility","visible");
}this.callChain();this.fireEvent("show",this.element);}.bind(this));this.start(d);}else{this.callChain();this.fireEvent("complete",this.element);this.fireEvent("show",this.element);
}}else{if(this.options.link=="chain"){this.chain(this.reveal.bind(this));}else{if(this.options.link=="cancel"&&!this.showing){this.cancel();this.reveal();
}}}return this;},toggle:function(){if(this.element.getStyle("display")=="none"){this.reveal();}else{this.dissolve();}return this;},cancel:function(){this.parent.apply(this,arguments);
if(this.cssText!=null){this.element.style.cssText=this.cssText;}this.hiding=false;this.showing=false;return this;}});Element.Properties.reveal={set:function(b){this.get("reveal").cancel().setOptions(b);
return this;},get:function(){var b=this.retrieve("reveal");if(!b){b=new Fx.Reveal(this);this.store("reveal",b);}return b;}};Element.Properties.dissolve=Element.Properties.reveal;
Element.implement({reveal:function(b){this.get("reveal").setOptions(b).reveal();return this;},dissolve:function(b){this.get("reveal").setOptions(b).dissolve();
return this;},nix:function(b){var c=Array.link(arguments,{destroy:Type.isBoolean,options:Type.isObject});this.get("reveal").setOptions(b).dissolve().chain(function(){this[c.destroy?"destroy":"dispose"]();
}.bind(this));return this;},wink:function(){var c=Array.link(arguments,{duration:Type.isNumber,options:Type.isObject});var b=this.get("reveal").setOptions(c.options);
b.reveal().chain(function(){(function(){b.dissolve();}).delay(c.duration||2000);});}});})();(function(){Fx.Scroll=new Class({Extends:Fx,options:{offset:{x:0,y:0},wheelStops:true},initialize:function(c,b){this.element=this.subject=document.id(c);
this.parent(b);if(typeOf(this.element)!="element"){this.element=document.id(this.element.getDocument().body);}if(this.options.wheelStops){var d=this.element,e=this.cancel.pass(false,this);
this.addEvent("start",function(){d.addEvent("mousewheel",e);},true);this.addEvent("complete",function(){d.removeEvent("mousewheel",e);},true);}},set:function(){var b=Array.flatten(arguments);
if(Browser.firefox){b=[Math.round(b[0]),Math.round(b[1])];}this.element.scrollTo(b[0],b[1]);return this;},compute:function(d,c,b){return[0,1].map(function(e){return Fx.compute(d[e],c[e],b);
});},start:function(c,d){if(!this.check(c,d)){return this;}var b=this.element.getScroll();return this.parent([b.x,b.y],[c,d]);},calculateScroll:function(g,f){var d=this.element,b=d.getScrollSize(),h=d.getScroll(),j=d.getSize(),c=this.options.offset,i={x:g,y:f};
for(var e in i){if(!i[e]&&i[e]!==0){i[e]=h[e];}if(typeOf(i[e])!="number"){i[e]=b[e]-j[e];}i[e]+=c[e];}return[i.x,i.y];},toTop:function(){return this.start.apply(this,this.calculateScroll(false,0));
},toLeft:function(){return this.start.apply(this,this.calculateScroll(0,false));},toRight:function(){return this.start.apply(this,this.calculateScroll("right",false));
},toBottom:function(){return this.start.apply(this,this.calculateScroll(false,"bottom"));},toElement:function(d,e){e=e?Array.from(e):["x","y"];var c=a(this.element)?{x:0,y:0}:this.element.getScroll();
var b=Object.map(document.id(d).getPosition(this.element),function(g,f){return e.contains(f)?g+c[f]:false;});return this.start.apply(this,this.calculateScroll(b.x,b.y));
},toElementEdge:function(d,g,e){g=g?Array.from(g):["x","y"];d=document.id(d);var i={},f=d.getPosition(this.element),j=d.getSize(),h=this.element.getScroll(),b=this.element.getSize(),c={x:f.x+j.x,y:f.y+j.y};
["x","y"].each(function(k){if(g.contains(k)){if(c[k]>h[k]+b[k]){i[k]=c[k]-b[k];}if(f[k]<h[k]){i[k]=f[k];}}if(i[k]==null){i[k]=h[k];}if(e&&e[k]){i[k]=i[k]+e[k];
}},this);if(i.x!=h.x||i.y!=h.y){this.start(i.x,i.y);}return this;},toElementCenter:function(e,f,h){f=f?Array.from(f):["x","y"];e=document.id(e);var i={},c=e.getPosition(this.element),d=e.getSize(),b=this.element.getScroll(),g=this.element.getSize();
["x","y"].each(function(j){if(f.contains(j)){i[j]=c[j]-(g[j]-d[j])/2;}if(i[j]==null){i[j]=b[j];}if(h&&h[j]){i[j]=i[j]+h[j];}},this);if(i.x!=b.x||i.y!=b.y){this.start(i.x,i.y);
}return this;}});Fx.Scroll.implement({scrollToCenter:function(){return this.toElementCenter.apply(this,arguments);},scrollIntoView:function(){return this.toElementEdge.apply(this,arguments);
}});function a(b){return(/^(?:body|html)$/i).test(b.tagName);}})();Fx.Slide=new Class({Extends:Fx,options:{mode:"vertical",wrapper:false,hideOverflow:true,resetHeight:false},initialize:function(b,a){b=this.element=this.subject=document.id(b);
this.parent(a);a=this.options;var d=b.retrieve("wrapper"),c=b.getStyles("margin","position","overflow");if(a.hideOverflow){c=Object.append(c,{overflow:"hidden"});
}if(a.wrapper){d=document.id(a.wrapper).setStyles(c);}if(!d){d=new Element("div",{styles:c}).wraps(b);}b.store("wrapper",d).setStyle("margin",0);if(b.getStyle("overflow")=="visible"){b.setStyle("overflow","hidden");
}this.now=[];this.open=true;this.wrapper=d;this.addEvent("complete",function(){this.open=(d["offset"+this.layout.capitalize()]!=0);if(this.open&&this.options.resetHeight){d.setStyle("height","");
}},true);},vertical:function(){this.margin="margin-top";this.layout="height";this.offset=this.element.offsetHeight;},horizontal:function(){this.margin="margin-left";
this.layout="width";this.offset=this.element.offsetWidth;},set:function(a){this.element.setStyle(this.margin,a[0]);this.wrapper.setStyle(this.layout,a[1]);
return this;},compute:function(c,b,a){return[0,1].map(function(d){return Fx.compute(c[d],b[d],a);});},start:function(b,e){if(!this.check(b,e)){return this;
}this[e||this.options.mode]();var d=this.element.getStyle(this.margin).toInt(),c=this.wrapper.getStyle(this.layout).toInt(),a=[[d,c],[0,this.offset]],g=[[d,c],[-this.offset,0]],f;
switch(b){case"in":f=a;break;case"out":f=g;break;case"toggle":f=(c==0)?a:g;}return this.parent(f[0],f[1]);},slideIn:function(a){return this.start("in",a);
},slideOut:function(a){return this.start("out",a);},hide:function(a){this[a||this.options.mode]();this.open=false;return this.set([-this.offset,0]);},show:function(a){this[a||this.options.mode]();
this.open=true;return this.set([0,this.offset]);},toggle:function(a){return this.start("toggle",a);}});Element.Properties.slide={set:function(a){this.get("slide").cancel().setOptions(a);
return this;},get:function(){var a=this.retrieve("slide");if(!a){a=new Fx.Slide(this,{link:"cancel"});this.store("slide",a);}return a;}};Element.implement({slide:function(d,e){d=d||"toggle";
var b=this.get("slide"),a;switch(d){case"hide":b.hide(e);break;case"show":b.show(e);break;case"toggle":var c=this.retrieve("slide:flag",b.open);b[c?"slideOut":"slideIn"](e);
this.store("slide:flag",!c);a=true;break;default:b.start(d,e);}if(!a){this.eliminate("slide:flag");}return this;}});(function(){var a=function(h,e,d,g,b){var c=h%10,f=h%100;
if(c==1&&f!=11){return e;}else{if((c==2||c==3||c==4)&&!(f==12||f==13||f==14)){return d;}else{if(c==0||(c==5||c==6||c==7||c==8||c==9)||(f==11||f==12||f==13||f==14)){return g;
}else{return b;}}}};Locale.define("ru-RU","Date",{months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],months_abbr:["янв","февр","март","апр","май","июнь","июль","авг","сент","окт","нояб","дек"],days:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],days_abbr:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],dateOrder:["date","month","year"],shortDate:"%d.%m.%Y",shortTime:"%H:%M",AM:"AM",PM:"PM",firstDayOfWeek:1,ordinal:"",lessThanMinuteAgo:"меньше минуты назад",minuteAgo:"минуту назад",minutesAgo:function(b){return"{delta} "+a(b,"минуту","минуты","минут")+" назад";
},hourAgo:"час назад",hoursAgo:function(b){return"{delta} "+a(b,"час","часа","часов")+" назад";},dayAgo:"вчера",daysAgo:function(b){return"{delta} "+a(b,"день","дня","дней")+" назад";
},weekAgo:"неделю назад",weeksAgo:function(b){return"{delta} "+a(b,"неделя","недели","недель")+" назад";},monthAgo:"месяц назад",monthsAgo:function(b){return"{delta} "+a(b,"месяц","месяца","месецев")+" назад";
},yearAgo:"год назад",yearsAgo:function(b){return"{delta} "+a(b,"год","года","лет")+" назад";},lessThanMinuteUntil:"меньше чем через минуту",minuteUntil:"через минуту",minutesUntil:function(b){return"через {delta} "+a(b,"час","часа","часов")+"";
},hourUntil:"через час",hoursUntil:function(b){return"через {delta} "+a(b,"час","часа","часов")+"";},dayUntil:"завтра",daysUntil:function(b){return"через {delta} "+a(b,"день","дня","дней")+"";
},weekUntil:"через неделю",weeksUntil:function(b){return"через {delta} "+a(b,"неделю","недели","недель")+"";},monthUntil:"через месяц",monthsUntil:function(b){return"через {delta} "+a(b,"месяц","месяца","месецев")+"";
},yearUntil:"через",yearsUntil:function(b){return"через {delta} "+a(b,"год","года","лет")+"";}});Locale.define("ru-RU-unicode").inherit("ru-RU","Date");
})();Locale.define("ru-RU","FormValidator",{required:"Это поле обязательно к заполнению.",minLength:"Пожалуйста, введите хотя бы {minLength} символов (Вы ввели {length}).",maxLength:"Пожалуйста, введите не больше {maxLength} символов (Вы ввели {length}).",integer:"Пожалуйста, введите в это поле число. Дробные числа (например 1.25) тут не разрешены.",numeric:'Пожалуйста, введите в это поле число (например "1" или "1.1", или "-1", или "-1.1").',digits:"В этом поле Вы можете использовать только цифры и знаки пунктуации (например, телефонный номер со знаками дефиса или с точками).",alpha:"В этом поле можно использовать только латинские буквы (a-z). Пробелы и другие символы запрещены.",alphanum:"В этом поле можно использовать только латинские буквы (a-z) и цифры (0-9). Пробелы и другие символы запрещены.",dateSuchAs:"Пожалуйста, введите корректную дату {date}",dateInFormatMDY:'Пожалуйста, введите дату в формате ММ/ДД/ГГГГ (например "12/31/1999")',email:'Пожалуйста, введите корректный емейл-адрес. Для примера "fred@domain.com".',url:"Пожалуйста, введите правильную ссылку вида http://www.example.com.",currencyDollar:"Пожалуйста, введите сумму в долларах. Например: $100.00 .",oneRequired:"Пожалуйста, выберите хоть что-нибудь в одном из этих полей.",errorPrefix:"Ошибка: ",warningPrefix:"Внимание: "});
Locale.define("ru-RU-unicode").inherit("ru-RU","FormValidator");
/*! highlight.js v9.3.0 | BSD3 License | git.io/hljslicense */
!function(e){var n="object"==typeof window&&window||"object"==typeof self&&self;"undefined"!=typeof exports?e(exports):n&&(n.hljs=e({}),"function"==typeof define&&define.amd&&define([],function(){return n.hljs}))}(function(e){function n(e){return e.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;")}function t(e){return e.nodeName.toLowerCase()}function r(e,n){var t=e&&e.exec(n);return t&&0==t.index}function a(e){return/^(no-?highlight|plain|text)$/i.test(e)}function i(e){var n,t,r,i=e.className+" ";if(i+=e.parentNode?e.parentNode.className:"",t=/\blang(?:uage)?-([\w-]+)\b/i.exec(i))return w(t[1])?t[1]:"no-highlight";for(i=i.split(/\s+/),n=0,r=i.length;r>n;n++)if(w(i[n])||a(i[n]))return i[n]}function o(e,n){var t,r={};for(t in e)r[t]=e[t];if(n)for(t in n)r[t]=n[t];return r}function u(e){var n=[];return function r(e,a){for(var i=e.firstChild;i;i=i.nextSibling)3==i.nodeType?a+=i.nodeValue.length:1==i.nodeType&&(n.push({event:"start",offset:a,node:i}),a=r(i,a),t(i).match(/br|hr|img|input/)||n.push({event:"stop",offset:a,node:i}));return a}(e,0),n}function c(e,r,a){function i(){return e.length&&r.length?e[0].offset!=r[0].offset?e[0].offset<r[0].offset?e:r:"start"==r[0].event?e:r:e.length?e:r}function o(e){function r(e){return" "+e.nodeName+'="'+n(e.value)+'"'}f+="<"+t(e)+Array.prototype.map.call(e.attributes,r).join("")+">"}function u(e){f+="</"+t(e)+">"}function c(e){("start"==e.event?o:u)(e.node)}for(var s=0,f="",l=[];e.length||r.length;){var g=i();if(f+=n(a.substr(s,g[0].offset-s)),s=g[0].offset,g==e){l.reverse().forEach(u);do c(g.splice(0,1)[0]),g=i();while(g==e&&g.length&&g[0].offset==s);l.reverse().forEach(o)}else"start"==g[0].event?l.push(g[0].node):l.pop(),c(g.splice(0,1)[0])}return f+n(a.substr(s))}function s(e){function n(e){return e&&e.source||e}function t(t,r){return new RegExp(n(t),"m"+(e.cI?"i":"")+(r?"g":""))}function r(a,i){if(!a.compiled){if(a.compiled=!0,a.k=a.k||a.bK,a.k){var u={},c=function(n,t){e.cI&&(t=t.toLowerCase()),t.split(" ").forEach(function(e){var t=e.split("|");u[t[0]]=[n,t[1]?Number(t[1]):1]})};"string"==typeof a.k?c("keyword",a.k):Object.keys(a.k).forEach(function(e){c(e,a.k[e])}),a.k=u}a.lR=t(a.l||/\w+/,!0),i&&(a.bK&&(a.b="\\b("+a.bK.split(" ").join("|")+")\\b"),a.b||(a.b=/\B|\b/),a.bR=t(a.b),a.e||a.eW||(a.e=/\B|\b/),a.e&&(a.eR=t(a.e)),a.tE=n(a.e)||"",a.eW&&i.tE&&(a.tE+=(a.e?"|":"")+i.tE)),a.i&&(a.iR=t(a.i)),void 0===a.r&&(a.r=1),a.c||(a.c=[]);var s=[];a.c.forEach(function(e){e.v?e.v.forEach(function(n){s.push(o(e,n))}):s.push("self"==e?a:e)}),a.c=s,a.c.forEach(function(e){r(e,a)}),a.starts&&r(a.starts,i);var f=a.c.map(function(e){return e.bK?"\\.?("+e.b+")\\.?":e.b}).concat([a.tE,a.i]).map(n).filter(Boolean);a.t=f.length?t(f.join("|"),!0):{exec:function(){return null}}}}r(e)}function f(e,t,a,i){function o(e,n){for(var t=0;t<n.c.length;t++)if(r(n.c[t].bR,e))return n.c[t]}function u(e,n){if(r(e.eR,n)){for(;e.endsParent&&e.parent;)e=e.parent;return e}return e.eW?u(e.parent,n):void 0}function c(e,n){return!a&&r(n.iR,e)}function g(e,n){var t=N.cI?n[0].toLowerCase():n[0];return e.k.hasOwnProperty(t)&&e.k[t]}function p(e,n,t,r){var a=r?"":E.classPrefix,i='<span class="'+a,o=t?"":"</span>";return i+=e+'">',i+n+o}function h(){if(!k.k)return n(M);var e="",t=0;k.lR.lastIndex=0;for(var r=k.lR.exec(M);r;){e+=n(M.substr(t,r.index-t));var a=g(k,r);a?(B+=a[1],e+=p(a[0],n(r[0]))):e+=n(r[0]),t=k.lR.lastIndex,r=k.lR.exec(M)}return e+n(M.substr(t))}function d(){var e="string"==typeof k.sL;if(e&&!R[k.sL])return n(M);var t=e?f(k.sL,M,!0,y[k.sL]):l(M,k.sL.length?k.sL:void 0);return k.r>0&&(B+=t.r),e&&(y[k.sL]=t.top),p(t.language,t.value,!1,!0)}function b(){L+=void 0!==k.sL?d():h(),M=""}function v(e,n){L+=e.cN?p(e.cN,"",!0):"",k=Object.create(e,{parent:{value:k}})}function m(e,n){if(M+=e,void 0===n)return b(),0;var t=o(n,k);if(t)return t.skip?M+=n:(t.eB&&(M+=n),b(),t.rB||t.eB||(M=n)),v(t,n),t.rB?0:n.length;var r=u(k,n);if(r){var a=k;a.skip?M+=n:(a.rE||a.eE||(M+=n),b(),a.eE&&(M=n));do k.cN&&(L+="</span>"),k.skip||(B+=k.r),k=k.parent;while(k!=r.parent);return r.starts&&v(r.starts,""),a.rE?0:n.length}if(c(n,k))throw new Error('Illegal lexeme "'+n+'" for mode "'+(k.cN||"<unnamed>")+'"');return M+=n,n.length||1}var N=w(e);if(!N)throw new Error('Unknown language: "'+e+'"');s(N);var x,k=i||N,y={},L="";for(x=k;x!=N;x=x.parent)x.cN&&(L=p(x.cN,"",!0)+L);var M="",B=0;try{for(var C,j,I=0;;){if(k.t.lastIndex=I,C=k.t.exec(t),!C)break;j=m(t.substr(I,C.index-I),C[0]),I=C.index+j}for(m(t.substr(I)),x=k;x.parent;x=x.parent)x.cN&&(L+="</span>");return{r:B,value:L,language:e,top:k}}catch(O){if(-1!=O.message.indexOf("Illegal"))return{r:0,value:n(t)};throw O}}function l(e,t){t=t||E.languages||Object.keys(R);var r={r:0,value:n(e)},a=r;return t.filter(w).forEach(function(n){var t=f(n,e,!1);t.language=n,t.r>a.r&&(a=t),t.r>r.r&&(a=r,r=t)}),a.language&&(r.second_best=a),r}function g(e){return E.tabReplace&&(e=e.replace(/^((<[^>]+>|\t)+)/gm,function(e,n){return n.replace(/\t/g,E.tabReplace)})),E.useBR&&(e=e.replace(/\n/g,"<br>")),e}function p(e,n,t){var r=n?x[n]:t,a=[e.trim()];return e.match(/\bhljs\b/)||a.push("hljs"),-1===e.indexOf(r)&&a.push(r),a.join(" ").trim()}function h(e){var n=i(e);if(!a(n)){var t;E.useBR?(t=document.createElementNS("http://www.w3.org/1999/xhtml","div"),t.innerHTML=e.innerHTML.replace(/\n/g,"").replace(/<br[ \/]*>/g,"\n")):t=e;var r=t.textContent,o=n?f(n,r,!0):l(r),s=u(t);if(s.length){var h=document.createElementNS("http://www.w3.org/1999/xhtml","div");h.innerHTML=o.value,o.value=c(s,u(h),r)}o.value=g(o.value),e.innerHTML=o.value,e.className=p(e.className,n,o.language),e.result={language:o.language,re:o.r},o.second_best&&(e.second_best={language:o.second_best.language,re:o.second_best.r})}}function d(e){E=o(E,e)}function b(){if(!b.called){b.called=!0;var e=document.querySelectorAll("pre code");Array.prototype.forEach.call(e,h)}}function v(){addEventListener("DOMContentLoaded",b,!1),addEventListener("load",b,!1)}function m(n,t){var r=R[n]=t(e);r.aliases&&r.aliases.forEach(function(e){x[e]=n})}function N(){return Object.keys(R)}function w(e){return e=(e||"").toLowerCase(),R[e]||R[x[e]]}var E={classPrefix:"hljs-",tabReplace:null,useBR:!1,languages:void 0},R={},x={};return e.highlight=f,e.highlightAuto=l,e.fixMarkup=g,e.highlightBlock=h,e.configure=d,e.initHighlighting=b,e.initHighlightingOnLoad=v,e.registerLanguage=m,e.listLanguages=N,e.getLanguage=w,e.inherit=o,e.IR="[a-zA-Z]\\w*",e.UIR="[a-zA-Z_]\\w*",e.NR="\\b\\d+(\\.\\d+)?",e.CNR="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",e.BNR="\\b(0b[01]+)",e.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",e.BE={b:"\\\\[\\s\\S]",r:0},e.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[e.BE]},e.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[e.BE]},e.PWM={b:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|like)\b/},e.C=function(n,t,r){var a=e.inherit({cN:"comment",b:n,e:t,c:[]},r||{});return a.c.push(e.PWM),a.c.push({cN:"doctag",b:"(?:TODO|FIXME|NOTE|BUG|XXX):",r:0}),a},e.CLCM=e.C("//","$"),e.CBCM=e.C("/\\*","\\*/"),e.HCM=e.C("#","$"),e.NM={cN:"number",b:e.NR,r:0},e.CNM={cN:"number",b:e.CNR,r:0},e.BNM={cN:"number",b:e.BNR,r:0},e.CSSNM={cN:"number",b:e.NR+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",r:0},e.RM={cN:"regexp",b:/\//,e:/\/[gimuy]*/,i:/\n/,c:[e.BE,{b:/\[/,e:/\]/,r:0,c:[e.BE]}]},e.TM={cN:"title",b:e.IR,r:0},e.UTM={cN:"title",b:e.UIR,r:0},e.METHOD_GUARD={b:"\\.\\s*"+e.UIR,r:0},e});hljs.registerLanguage("delphi",function(e){var r="exports register file shl array record property for mod while set ally label uses raise not stored class safecall var interface or private static exit index inherited to else stdcall override shr asm far resourcestring finalization packed virtual out and protected library do xorwrite goto near function end div overload object unit begin string on inline repeat until destructor write message program with read initialization except default nil if case cdecl in downto threadvar of try pascal const external constructor type public then implementation finally published procedure",t=[e.CLCM,e.C(/\{/,/\}/,{r:0}),e.C(/\(\*/,/\*\)/,{r:10})],a={cN:"string",b:/'/,e:/'/,c:[{b:/''/}]},i={cN:"string",b:/(#\d+)+/},c={b:e.IR+"\\s*=\\s*class\\s*\\(",rB:!0,c:[e.TM]},o={cN:"function",bK:"function constructor destructor procedure",e:/[:;]/,k:"function constructor|10 destructor|10 procedure|10",c:[e.TM,{cN:"params",b:/\(/,e:/\)/,k:r,c:[a,i]}].concat(t)};return{aliases:["dpr","dfm","pas","pascal","freepascal","lazarus","lpr","lfm"],cI:!0,k:r,i:/"|\$[G-Zg-z]|\/\*|<\/|\|/,c:[a,i,e.NM,c,o].concat(t)}});hljs.registerLanguage("objectivec",function(e){var t={cN:"built_in",b:"(AV|CA|CF|CG|CI|MK|MP|NS|UI|XC)\\w+"},i={keyword:"int float while char export sizeof typedef const struct for union unsigned long volatile static bool mutable if do return goto void enum else break extern asm case short default double register explicit signed typename this switch continue wchar_t inline readonly assign readwrite self @synchronized id typeof nonatomic super unichar IBOutlet IBAction strong weak copy in out inout bycopy byref oneway __strong __weak __block __autoreleasing @private @protected @public @try @property @end @throw @catch @finally @autoreleasepool @synthesize @dynamic @selector @optional @required",literal:"false true FALSE TRUE nil YES NO NULL",built_in:"BOOL dispatch_once_t dispatch_queue_t dispatch_sync dispatch_async dispatch_once"},n=/[a-zA-Z@][a-zA-Z0-9_]*/,o="@interface @class @protocol @implementation";return{aliases:["mm","objc","obj-c"],k:i,l:n,i:"</",c:[t,e.CLCM,e.CBCM,e.CNM,e.QSM,{cN:"string",v:[{b:'@"',e:'"',i:"\\n",c:[e.BE]},{b:"'",e:"[^\\\\]'",i:"[^\\\\][^']"}]},{cN:"meta",b:"#",e:"$",c:[{cN:"meta-string",v:[{b:'"',e:'"'},{b:"<",e:">"}]}]},{cN:"class",b:"("+o.split(" ").join("|")+")\\b",e:"({|$)",eE:!0,k:o,l:n,c:[e.UTM]},{b:"\\."+e.UIR,r:0}]}});hljs.registerLanguage("go",function(e){var t={keyword:"break default func interface select case map struct chan else goto package switch const fallthrough if range type continue for import return var go defer bool byte complex64 complex128 float32 float64 int8 int16 int32 int64 string uint8 uint16 uint32 uint64 int uint uintptr rune",literal:"true false iota nil",built_in:"append cap close complex copy imag len make new panic print println real recover delete"};return{aliases:["golang"],k:t,i:"</",c:[e.CLCM,e.CBCM,e.QSM,{cN:"string",b:"'",e:"[^\\\\]'"},{cN:"string",b:"`",e:"`"},{cN:"number",b:e.CNR+"[dflsi]?",r:0},e.CNM]}});hljs.registerLanguage("basic",function(E){return{cI:!0,i:"^.",l:"[a-zA-Z][a-zA-Z0-9_$%!#]*",k:{keyword:"ABS ASC AND ATN AUTO|0 BEEP BLOAD|10 BSAVE|10 CALL CALLS CDBL CHAIN CHDIR CHR$|10 CINT CIRCLE CLEAR CLOSE CLS COLOR COM COMMON CONT COS CSNG CSRLIN CVD CVI CVS DATA DATE$ DEFDBL DEFINT DEFSNG DEFSTR DEF|0 SEG USR DELETE DIM DRAW EDIT END ENVIRON ENVIRON$ EOF EQV ERASE ERDEV ERDEV$ ERL ERR ERROR EXP FIELD FILES FIX FOR|0 FRE GET GOSUB|10 GOTO HEX$ IF|0 THEN ELSE|0 INKEY$ INP INPUT INPUT# INPUT$ INSTR IMP INT IOCTL IOCTL$ KEY ON OFF LIST KILL LEFT$ LEN LET LINE LLIST LOAD LOC LOCATE LOF LOG LPRINT USING LSET MERGE MID$ MKDIR MKD$ MKI$ MKS$ MOD NAME NEW NEXT NOISE NOT OCT$ ON OR PEN PLAY STRIG OPEN OPTION BASE OUT PAINT PALETTE PCOPY PEEK PMAP POINT POKE POS PRINT PRINT] PSET PRESET PUT RANDOMIZE READ REM RENUM RESET|0 RESTORE RESUME RETURN|0 RIGHT$ RMDIR RND RSET RUN SAVE SCREEN SGN SHELL SIN SOUND SPACE$ SPC SQR STEP STICK STOP STR$ STRING$ SWAP SYSTEM TAB TAN TIME$ TIMER TROFF TRON TO USR VAL VARPTR VARPTR$ VIEW WAIT WHILE WEND WIDTH WINDOW WRITE XOR"},c:[E.QSM,E.C("REM","$",{r:10}),E.C("'","$",{r:0}),{cN:"symbol",b:"^[0-9]+ ",r:10},{cN:"number",b:"\\b([0-9]+[0-9edED.]*[#!]?)",r:0},{cN:"number",b:"(&[hH][0-9a-fA-F]{1,4})"},{cN:"number",b:"(&[oO][0-7]{1,6})"}]}});hljs.registerLanguage("java",function(e){var t=e.UIR+"(<"+e.UIR+"(\\s*,\\s*"+e.UIR+")*>)?",a="false synchronized int abstract float private char boolean static null if const for true while long strictfp finally protected import native final void enum else break transient catch instanceof byte super volatile case assert short package default double public try this switch continue throws protected public private module requires exports",r="\\b(0[bB]([01]+[01_]+[01]+|[01]+)|0[xX]([a-fA-F0-9]+[a-fA-F0-9_]+[a-fA-F0-9]+|[a-fA-F0-9]+)|(([\\d]+[\\d_]+[\\d]+|[\\d]+)(\\.([\\d]+[\\d_]+[\\d]+|[\\d]+))?|\\.([\\d]+[\\d_]+[\\d]+|[\\d]+))([eE][-+]?\\d+)?)[lLfF]?",s={cN:"number",b:r,r:0};return{aliases:["jsp"],k:a,i:/<\/|#/,c:[e.C("/\\*\\*","\\*/",{r:0,c:[{b:/\w+@/,r:0},{cN:"doctag",b:"@[A-Za-z]+"}]}),e.CLCM,e.CBCM,e.ASM,e.QSM,{cN:"class",bK:"class interface",e:/[{;=]/,eE:!0,k:"class interface",i:/[:"\[\]]/,c:[{bK:"extends implements"},e.UTM]},{bK:"new throw return else",r:0},{cN:"function",b:"("+t+"\\s+)+"+e.UIR+"\\s*\\(",rB:!0,e:/[{;=]/,eE:!0,k:a,c:[{b:e.UIR+"\\s*\\(",rB:!0,r:0,c:[e.UTM]},{cN:"params",b:/\(/,e:/\)/,k:a,r:0,c:[e.ASM,e.QSM,e.CNM,e.CBCM]},e.CLCM,e.CBCM]},s,{cN:"meta",b:"@[A-Za-z]+"}]}});hljs.registerLanguage("perl",function(e){var t="getpwent getservent quotemeta msgrcv scalar kill dbmclose undef lc ma syswrite tr send umask sysopen shmwrite vec qx utime local oct semctl localtime readpipe do return format read sprintf dbmopen pop getpgrp not getpwnam rewinddir qqfileno qw endprotoent wait sethostent bless s|0 opendir continue each sleep endgrent shutdown dump chomp connect getsockname die socketpair close flock exists index shmgetsub for endpwent redo lstat msgctl setpgrp abs exit select print ref gethostbyaddr unshift fcntl syscall goto getnetbyaddr join gmtime symlink semget splice x|0 getpeername recv log setsockopt cos last reverse gethostbyname getgrnam study formline endhostent times chop length gethostent getnetent pack getprotoent getservbyname rand mkdir pos chmod y|0 substr endnetent printf next open msgsnd readdir use unlink getsockopt getpriority rindex wantarray hex system getservbyport endservent int chr untie rmdir prototype tell listen fork shmread ucfirst setprotoent else sysseek link getgrgid shmctl waitpid unpack getnetbyname reset chdir grep split require caller lcfirst until warn while values shift telldir getpwuid my getprotobynumber delete and sort uc defined srand accept package seekdir getprotobyname semop our rename seek if q|0 chroot sysread setpwent no crypt getc chown sqrt write setnetent setpriority foreach tie sin msgget map stat getlogin unless elsif truncate exec keys glob tied closedirioctl socket readlink eval xor readline binmode setservent eof ord bind alarm pipe atan2 getgrent exp time push setgrent gt lt or ne m|0 break given say state when",r={cN:"subst",b:"[$@]\\{",e:"\\}",k:t},s={b:"->{",e:"}"},n={v:[{b:/\$\d/},{b:/[\$%@](\^\w\b|#\w+(::\w+)*|{\w+}|\w+(::\w*)*)/},{b:/[\$%@][^\s\w{]/,r:0}]},i=[e.BE,r,n],o=[n,e.HCM,e.C("^\\=\\w","\\=cut",{eW:!0}),s,{cN:"string",c:i,v:[{b:"q[qwxr]?\\s*\\(",e:"\\)",r:5},{b:"q[qwxr]?\\s*\\[",e:"\\]",r:5},{b:"q[qwxr]?\\s*\\{",e:"\\}",r:5},{b:"q[qwxr]?\\s*\\|",e:"\\|",r:5},{b:"q[qwxr]?\\s*\\<",e:"\\>",r:5},{b:"qw\\s+q",e:"q",r:5},{b:"'",e:"'",c:[e.BE]},{b:'"',e:'"'},{b:"`",e:"`",c:[e.BE]},{b:"{\\w+}",c:[],r:0},{b:"-?\\w+\\s*\\=\\>",c:[],r:0}]},{cN:"number",b:"(\\b0[0-7_]+)|(\\b0x[0-9a-fA-F_]+)|(\\b[1-9][0-9_]*(\\.[0-9_]+)?)|[0_]\\b",r:0},{b:"(\\/\\/|"+e.RSR+"|\\b(split|return|print|reverse|grep)\\b)\\s*",k:"split return print reverse grep",r:0,c:[e.HCM,{cN:"regexp",b:"(s|tr|y)/(\\\\.|[^/])*/(\\\\.|[^/])*/[a-z]*",r:10},{cN:"regexp",b:"(m|qr)?/",e:"/[a-z]*",c:[e.BE],r:0}]},{cN:"function",bK:"sub",e:"(\\s*\\(.*?\\))?[;{]",eE:!0,r:5,c:[e.TM]},{b:"-\\w\\b",r:0},{b:"^__DATA__$",e:"^__END__$",sL:"mojolicious",c:[{b:"^@@.*",e:"$",cN:"comment"}]}];return r.c=o,s.c=o,{aliases:["pl","pm"],l:/[\w\.]+/,k:t,c:o}});hljs.registerLanguage("vbnet",function(e){return{aliases:["vb"],cI:!0,k:{keyword:"addhandler addressof alias and andalso aggregate ansi as assembly auto binary by byref byval call case catch class compare const continue custom declare default delegate dim distinct do each equals else elseif end enum erase error event exit explicit finally for friend from function get global goto group handles if implements imports in inherits interface into is isfalse isnot istrue join key let lib like loop me mid mod module mustinherit mustoverride mybase myclass namespace narrowing new next not notinheritable notoverridable of off on operator option optional or order orelse overloads overridable overrides paramarray partial preserve private property protected public raiseevent readonly redim rem removehandler resume return select set shadows shared skip static step stop structure strict sub synclock take text then throw to try unicode until using when where while widening with withevents writeonly xor",built_in:"boolean byte cbool cbyte cchar cdate cdec cdbl char cint clng cobj csbyte cshort csng cstr ctype date decimal directcast double gettype getxmlnamespace iif integer long object sbyte short single string trycast typeof uinteger ulong ushort",literal:"true false nothing"},i:"//|{|}|endif|gosub|variant|wend",c:[e.inherit(e.QSM,{c:[{b:'""'}]}),e.C("'","$",{rB:!0,c:[{cN:"doctag",b:"'''|<!--|-->",c:[e.PWM]},{cN:"doctag",b:"</?",e:">",c:[e.PWM]}]}),e.CNM,{cN:"meta",b:"#",e:"$",k:{"meta-keyword":"if else elseif end region externalsource"}}]}});hljs.registerLanguage("bash",function(e){var t={cN:"variable",v:[{b:/\$[\w\d#@][\w\d_]*/},{b:/\$\{(.*?)}/}]},s={cN:"string",b:/"/,e:/"/,c:[e.BE,t,{cN:"variable",b:/\$\(/,e:/\)/,c:[e.BE]}]},a={cN:"string",b:/'/,e:/'/};return{aliases:["sh","zsh"],l:/-?[a-z\.]+/,k:{keyword:"if then else elif fi for while in do done case esac function",literal:"true false",built_in:"break cd continue eval exec exit export getopts hash pwd readonly return shift test times trap umask unset alias bind builtin caller command declare echo enable help let local logout mapfile printf read readarray source type typeset ulimit unalias set shopt autoload bg bindkey bye cap chdir clone comparguments compcall compctl compdescribe compfiles compgroups compquote comptags comptry compvalues dirs disable disown echotc echoti emulate fc fg float functions getcap getln history integer jobs kill limit log noglob popd print pushd pushln rehash sched setcap setopt stat suspend ttyctl unfunction unhash unlimit unsetopt vared wait whence where which zcompile zformat zftp zle zmodload zparseopts zprof zpty zregexparse zsocket zstyle ztcp",_:"-ne -eq -lt -gt -f -d -e -s -l -a"},c:[{cN:"meta",b:/^#![^\n]+sh\s*$/,r:10},{cN:"function",b:/\w[\w\d_]*\s*\(\s*\)\s*\{/,rB:!0,c:[e.inherit(e.TM,{b:/\w[\w\d_]*/})],r:0},e.HCM,s,a,t]}});hljs.registerLanguage("r",function(e){var r="([a-zA-Z]|\\.[a-zA-Z.])[a-zA-Z0-9._]*";return{c:[e.HCM,{b:r,l:r,k:{keyword:"function if in break next repeat else for return switch while try tryCatch stop warning require library attach detach source setMethod setGeneric setGroupGeneric setClass ...",literal:"NULL NA TRUE FALSE T F Inf NaN NA_integer_|10 NA_real_|10 NA_character_|10 NA_complex_|10"},r:0},{cN:"number",b:"0[xX][0-9a-fA-F]+[Li]?\\b",r:0},{cN:"number",b:"\\d+(?:[eE][+\\-]?\\d*)?L\\b",r:0},{cN:"number",b:"\\d+\\.(?!\\d)(?:i\\b)?",r:0},{cN:"number",b:"\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",r:0},{b:"`",e:"`",r:0},{cN:"string",c:[e.BE],v:[{b:'"',e:'"'},{b:"'",e:"'"}]}]}});hljs.registerLanguage("ini",function(e){var b={cN:"string",c:[e.BE],v:[{b:"'''",e:"'''",r:10},{b:'"""',e:'"""',r:10},{b:'"',e:'"'},{b:"'",e:"'"}]};return{aliases:["toml"],cI:!0,i:/\S/,c:[e.C(";","$"),e.HCM,{cN:"section",b:/^\s*\[+/,e:/\]+/},{b:/^[a-z0-9\[\]_-]+\s*=\s*/,e:"$",rB:!0,c:[{cN:"attr",b:/[a-z0-9\[\]_-]+/},{b:/=/,eW:!0,r:0,c:[{cN:"literal",b:/\bon|off|true|false|yes|no\b/},{cN:"variable",v:[{b:/\$[\w\d"][\w\d_]*/},{b:/\$\{(.*?)}/}]},b,{cN:"number",b:/([\+\-]+)?[\d]+_[\d_]+/},e.NM]}]}]}});hljs.registerLanguage("cs",function(e){var r={keyword:"abstract as base bool break byte case catch char checked const continue decimal dynamic default delegate do double else enum event explicit extern finally fixed float for foreach goto if implicit in int interface internal is lock long when object operator out override params private protected public readonly ref sbyte sealed short sizeof stackalloc static string struct switch this try typeof uint ulong unchecked unsafe ushort using virtual volatile void while async protected public private internal ascending descending from get group into join let orderby partial select set value var where yield",literal:"null false true"},t=e.IR+"(<"+e.IR+">)?(\\[\\])?";return{aliases:["csharp"],k:r,i:/::/,c:[e.C("///","$",{rB:!0,c:[{cN:"doctag",v:[{b:"///",r:0},{b:"<!--|-->"},{b:"</?",e:">"}]}]}),e.CLCM,e.CBCM,{cN:"meta",b:"#",e:"$",k:{"meta-keyword":"if else elif endif define undef warning error line region endregion pragma checksum"}},{cN:"string",b:'@"',e:'"',c:[{b:'""'}]},e.ASM,e.QSM,e.CNM,{bK:"class interface",e:/[{;=]/,i:/[^\s:]/,c:[e.TM,e.CLCM,e.CBCM]},{bK:"namespace",e:/[{;=]/,i:/[^\s:]/,c:[e.inherit(e.TM,{b:"[a-zA-Z](\\.?\\w)*"}),e.CLCM,e.CBCM]},{bK:"new return throw await",r:0},{cN:"function",b:"("+t+"\\s+)+"+e.IR+"\\s*\\(",rB:!0,e:/[{;=]/,eE:!0,k:r,c:[{b:e.IR+"\\s*\\(",rB:!0,c:[e.TM],r:0},{cN:"params",b:/\(/,e:/\)/,eB:!0,eE:!0,k:r,r:0,c:[e.ASM,e.QSM,e.CNM,e.CBCM]},e.CLCM,e.CBCM]}]}});hljs.registerLanguage("sql",function(e){var t=e.C("--","$");return{cI:!0,i:/[<>{}*#]/,c:[{bK:"begin end start commit rollback savepoint lock alter create drop rename call delete do handler insert load replace select truncate update set show pragma grant merge describe use explain help declare prepare execute deallocate release unlock purge reset change stop analyze cache flush optimize repair kill install uninstall checksum restore check backup revoke",e:/;/,eW:!0,l:/[\w\.]+/,k:{keyword:"abort abs absolute acc acce accep accept access accessed accessible account acos action activate add addtime admin administer advanced advise aes_decrypt aes_encrypt after agent aggregate ali alia alias allocate allow alter always analyze ancillary and any anydata anydataset anyschema anytype apply archive archived archivelog are as asc ascii asin assembly assertion associate asynchronous at atan atn2 attr attri attrib attribu attribut attribute attributes audit authenticated authentication authid authors auto autoallocate autodblink autoextend automatic availability avg backup badfile basicfile before begin beginning benchmark between bfile bfile_base big bigfile bin binary_double binary_float binlog bit_and bit_count bit_length bit_or bit_xor bitmap blob_base block blocksize body both bound buffer_cache buffer_pool build bulk by byte byteordermark bytes cache caching call calling cancel capacity cascade cascaded case cast catalog category ceil ceiling chain change changed char_base char_length character_length characters characterset charindex charset charsetform charsetid check checksum checksum_agg child choose chr chunk class cleanup clear client clob clob_base clone close cluster_id cluster_probability cluster_set clustering coalesce coercibility col collate collation collect colu colum column column_value columns columns_updated comment commit compact compatibility compiled complete composite_limit compound compress compute concat concat_ws concurrent confirm conn connec connect connect_by_iscycle connect_by_isleaf connect_by_root connect_time connection consider consistent constant constraint constraints constructor container content contents context contributors controlfile conv convert convert_tz corr corr_k corr_s corresponding corruption cos cost count count_big counted covar_pop covar_samp cpu_per_call cpu_per_session crc32 create creation critical cross cube cume_dist curdate current current_date current_time current_timestamp current_user cursor curtime customdatum cycle data database databases datafile datafiles datalength date_add date_cache date_format date_sub dateadd datediff datefromparts datename datepart datetime2fromparts day day_to_second dayname dayofmonth dayofweek dayofyear days db_role_change dbtimezone ddl deallocate declare decode decompose decrement decrypt deduplicate def defa defau defaul default defaults deferred defi defin define degrees delayed delegate delete delete_all delimited demand dense_rank depth dequeue des_decrypt des_encrypt des_key_file desc descr descri describ describe descriptor deterministic diagnostics difference dimension direct_load directory disable disable_all disallow disassociate discardfile disconnect diskgroup distinct distinctrow distribute distributed div do document domain dotnet double downgrade drop dumpfile duplicate duration each edition editionable editions element ellipsis else elsif elt empty enable enable_all enclosed encode encoding encrypt end end-exec endian enforced engine engines enqueue enterprise entityescaping eomonth error errors escaped evalname evaluate event eventdata events except exception exceptions exchange exclude excluding execu execut execute exempt exists exit exp expire explain export export_set extended extent external external_1 external_2 externally extract failed failed_login_attempts failover failure far fast feature_set feature_value fetch field fields file file_name_convert filesystem_like_logging final finish first first_value fixed flash_cache flashback floor flush following follows for forall force form forma format found found_rows freelist freelists freepools fresh from from_base64 from_days ftp full function general generated get get_format get_lock getdate getutcdate global global_name globally go goto grant grants greatest group group_concat group_id grouping grouping_id groups gtid_subtract guarantee guard handler hash hashkeys having hea head headi headin heading heap help hex hierarchy high high_priority hosts hour http id ident_current ident_incr ident_seed identified identity idle_time if ifnull ignore iif ilike ilm immediate import in include including increment index indexes indexing indextype indicator indices inet6_aton inet6_ntoa inet_aton inet_ntoa infile initial initialized initially initrans inmemory inner innodb input insert install instance instantiable instr interface interleaved intersect into invalidate invisible is is_free_lock is_ipv4 is_ipv4_compat is_not is_not_null is_used_lock isdate isnull isolation iterate java join json json_exists keep keep_duplicates key keys kill language large last last_day last_insert_id last_value lax lcase lead leading least leaves left len lenght length less level levels library like like2 like4 likec limit lines link list listagg little ln load load_file lob lobs local localtime localtimestamp locate locator lock locked log log10 log2 logfile logfiles logging logical logical_reads_per_call logoff logon logs long loop low low_priority lower lpad lrtrim ltrim main make_set makedate maketime managed management manual map mapping mask master master_pos_wait match matched materialized max maxextents maximize maxinstances maxlen maxlogfiles maxloghistory maxlogmembers maxsize maxtrans md5 measures median medium member memcompress memory merge microsecond mid migration min minextents minimum mining minus minute minvalue missing mod mode model modification modify module monitoring month months mount move movement multiset mutex name name_const names nan national native natural nav nchar nclob nested never new newline next nextval no no_write_to_binlog noarchivelog noaudit nobadfile nocheck nocompress nocopy nocycle nodelay nodiscardfile noentityescaping noguarantee nokeep nologfile nomapping nomaxvalue nominimize nominvalue nomonitoring none noneditionable nonschema noorder nopr nopro noprom nopromp noprompt norely noresetlogs noreverse normal norowdependencies noschemacheck noswitch not nothing notice notrim novalidate now nowait nth_value nullif nulls num numb numbe nvarchar nvarchar2 object ocicoll ocidate ocidatetime ociduration ociinterval ociloblocator ocinumber ociref ocirefcursor ocirowid ocistring ocitype oct octet_length of off offline offset oid oidindex old on online only opaque open operations operator optimal optimize option optionally or oracle oracle_date oradata ord ordaudio orddicom orddoc order ordimage ordinality ordvideo organization orlany orlvary out outer outfile outline output over overflow overriding package pad parallel parallel_enable parameters parent parse partial partition partitions pascal passing password password_grace_time password_lock_time password_reuse_max password_reuse_time password_verify_function patch path patindex pctincrease pctthreshold pctused pctversion percent percent_rank percentile_cont percentile_disc performance period period_add period_diff permanent physical pi pipe pipelined pivot pluggable plugin policy position post_transaction pow power pragma prebuilt precedes preceding precision prediction prediction_cost prediction_details prediction_probability prediction_set prepare present preserve prior priority private private_sga privileges procedural procedure procedure_analyze processlist profiles project prompt protection public publishingservername purge quarter query quick quiesce quota quotename radians raise rand range rank raw read reads readsize rebuild record records recover recovery recursive recycle redo reduced ref reference referenced references referencing refresh regexp_like register regr_avgx regr_avgy regr_count regr_intercept regr_r2 regr_slope regr_sxx regr_sxy reject rekey relational relative relaylog release release_lock relies_on relocate rely rem remainder rename repair repeat replace replicate replication required reset resetlogs resize resource respect restore restricted result result_cache resumable resume retention return returning returns reuse reverse revoke right rlike role roles rollback rolling rollup round row row_count rowdependencies rowid rownum rows rtrim rules safe salt sample save savepoint sb1 sb2 sb4 scan schema schemacheck scn scope scroll sdo_georaster sdo_topo_geometry search sec_to_time second section securefile security seed segment select self sequence sequential serializable server servererror session session_user sessions_per_user set sets settings sha sha1 sha2 share shared shared_pool short show shrink shutdown si_averagecolor si_colorhistogram si_featurelist si_positionalcolor si_stillimage si_texture siblings sid sign sin size size_t sizes skip slave sleep smalldatetimefromparts smallfile snapshot some soname sort soundex source space sparse spfile split sql sql_big_result sql_buffer_result sql_cache sql_calc_found_rows sql_small_result sql_variant_property sqlcode sqldata sqlerror sqlname sqlstate sqrt square standalone standby start starting startup statement static statistics stats_binomial_test stats_crosstab stats_ks_test stats_mode stats_mw_test stats_one_way_anova stats_t_test_ stats_t_test_indep stats_t_test_one stats_t_test_paired stats_wsr_test status std stddev stddev_pop stddev_samp stdev stop storage store stored str str_to_date straight_join strcmp strict string struct stuff style subdate subpartition subpartitions substitutable substr substring subtime subtring_index subtype success sum suspend switch switchoffset switchover sync synchronous synonym sys sys_xmlagg sysasm sysaux sysdate sysdatetimeoffset sysdba sysoper system system_user sysutcdatetime table tables tablespace tan tdo template temporary terminated tertiary_weights test than then thread through tier ties time time_format time_zone timediff timefromparts timeout timestamp timestampadd timestampdiff timezone_abbr timezone_minute timezone_region to to_base64 to_date to_days to_seconds todatetimeoffset trace tracking transaction transactional translate translation treat trigger trigger_nestlevel triggers trim truncate try_cast try_convert try_parse type ub1 ub2 ub4 ucase unarchived unbounded uncompress under undo unhex unicode uniform uninstall union unique unix_timestamp unknown unlimited unlock unpivot unrecoverable unsafe unsigned until untrusted unusable unused update updated upgrade upped upper upsert url urowid usable usage use use_stored_outlines user user_data user_resources users using utc_date utc_timestamp uuid uuid_short validate validate_password_strength validation valist value values var var_samp varcharc vari varia variab variabl variable variables variance varp varraw varrawc varray verify version versions view virtual visible void wait wallet warning warnings week weekday weekofyear wellformed when whene whenev wheneve whenever where while whitespace with within without work wrapped xdb xml xmlagg xmlattributes xmlcast xmlcolattval xmlelement xmlexists xmlforest xmlindex xmlnamespaces xmlpi xmlquery xmlroot xmlschema xmlserialize xmltable xmltype xor year year_to_month years yearweek",literal:"true false null",built_in:"array bigint binary bit blob boolean char character date dec decimal float int int8 integer interval number numeric real record serial serial8 smallint text varchar varying void"},c:[{cN:"string",b:"'",e:"'",c:[e.BE,{b:"''"}]},{cN:"string",b:'"',e:'"',c:[e.BE,{b:'""'}]},{cN:"string",b:"`",e:"`",c:[e.BE]},e.CNM,e.CBCM,t]},e.CBCM,t]}});hljs.registerLanguage("python",function(e){var r={cN:"meta",b:/^(>>>|\.\.\.) /},b={cN:"string",c:[e.BE],v:[{b:/(u|b)?r?'''/,e:/'''/,c:[r],r:10},{b:/(u|b)?r?"""/,e:/"""/,c:[r],r:10},{b:/(u|r|ur)'/,e:/'/,r:10},{b:/(u|r|ur)"/,e:/"/,r:10},{b:/(b|br)'/,e:/'/},{b:/(b|br)"/,e:/"/},e.ASM,e.QSM]},a={cN:"number",r:0,v:[{b:e.BNR+"[lLjJ]?"},{b:"\\b(0o[0-7]+)[lLjJ]?"},{b:e.CNR+"[lLjJ]?"}]},l={cN:"params",b:/\(/,e:/\)/,c:["self",r,a,b]};return{aliases:["py","gyp"],k:{keyword:"and elif is global as in if from raise for except finally print import pass return exec else break not with class assert yield try while continue del or def lambda async await nonlocal|10 None True False",built_in:"Ellipsis NotImplemented"},i:/(<\/|->|\?)/,c:[r,a,b,e.HCM,{v:[{cN:"function",bK:"def",r:10},{cN:"class",bK:"class"}],e:/:/,i:/[${=;\n,]/,c:[e.UTM,l,{b:/->/,eW:!0,k:"None"}]},{cN:"meta",b:/^[\t ]*@/,e:/$/},{b:/\b(print|exec)\(/}]}});hljs.registerLanguage("php",function(e){var c={b:"\\$+[a-zA-Z_-ÿ][a-zA-Z0-9_-ÿ]*"},a={cN:"meta",b:/<\?(php)?|\?>/},i={cN:"string",c:[e.BE,a],v:[{b:'b"',e:'"'},{b:"b'",e:"'"},e.inherit(e.ASM,{i:null}),e.inherit(e.QSM,{i:null})]},t={v:[e.BNM,e.CNM]};return{aliases:["php3","php4","php5","php6"],cI:!0,k:"and include_once list abstract global private echo interface as static endswitch array null if endwhile or const for endforeach self var while isset public protected exit foreach throw elseif include __FILE__ empty require_once do xor return parent clone use __CLASS__ __LINE__ else break print eval new catch __METHOD__ case exception default die require __FUNCTION__ enddeclare final try switch continue endfor endif declare unset true false trait goto instanceof insteadof __DIR__ __NAMESPACE__ yield finally",c:[e.HCM,e.C("//","$",{c:[a]}),e.C("/\\*","\\*/",{c:[{cN:"doctag",b:"@[A-Za-z]+"}]}),e.C("__halt_compiler.+?;",!1,{eW:!0,k:"__halt_compiler",l:e.UIR}),{cN:"string",b:/<<<['"]?\w+['"]?$/,e:/^\w+;?$/,c:[e.BE,{cN:"subst",v:[{b:/\$\w+/},{b:/\{\$/,e:/\}/}]}]},a,c,{b:/(::|->)+[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*/},{cN:"function",bK:"function",e:/[;{]/,eE:!0,i:"\\$|\\[|%",c:[e.UTM,{cN:"params",b:"\\(",e:"\\)",c:["self",c,e.CBCM,i,t]}]},{cN:"class",bK:"class interface",e:"{",eE:!0,i:/[:\(\$"]/,c:[{bK:"extends implements"},e.UTM]},{bK:"namespace",e:";",i:/[\.']/,c:[e.UTM]},{bK:"use",e:";",c:[e.UTM]},{b:"=>"},i,t]}});hljs.registerLanguage("vbscript",function(e){return{aliases:["vbs"],cI:!0,k:{keyword:"call class const dim do loop erase execute executeglobal exit for each next function if then else on error option explicit new private property let get public randomize redim rem select case set stop sub while wend with end to elseif is or xor and not class_initialize class_terminate default preserve in me byval byref step resume goto",built_in:"lcase month vartype instrrev ubound setlocale getobject rgb getref string weekdayname rnd dateadd monthname now day minute isarray cbool round formatcurrency conversions csng timevalue second year space abs clng timeserial fixs len asc isempty maths dateserial atn timer isobject filter weekday datevalue ccur isdate instr datediff formatdatetime replace isnull right sgn array snumeric log cdbl hex chr lbound msgbox ucase getlocale cos cdate cbyte rtrim join hour oct typename trim strcomp int createobject loadpicture tan formatnumber mid scriptenginebuildversion scriptengine split scriptengineminorversion cint sin datepart ltrim sqr scriptenginemajorversion time derived eval date formatpercent exp inputbox left ascw chrw regexp server response request cstr err",literal:"true false null nothing empty"},i:"//",c:[e.inherit(e.QSM,{c:[{b:'""'}]}),e.C(/'/,/$/,{r:0}),e.CNM]}});hljs.registerLanguage("lua",function(e){var t="\\[=*\\[",a="\\]=*\\]",r={b:t,e:a,c:["self"]},n=[e.C("--(?!"+t+")","$"),e.C("--"+t,a,{c:[r],r:10})];return{l:e.UIR,k:{keyword:"and break do else elseif end false for if in local nil not or repeat return then true until while",built_in:"_G _VERSION assert collectgarbage dofile error getfenv getmetatable ipairs load loadfile loadstring module next pairs pcall print rawequal rawget rawset require select setfenv setmetatable tonumber tostring type unpack xpcall coroutine debug io math os package string table"},c:n.concat([{cN:"function",bK:"function",e:"\\)",c:[e.inherit(e.TM,{b:"([_a-zA-Z]\\w*\\.)*([_a-zA-Z]\\w*:)?[_a-zA-Z]\\w*"}),{cN:"params",b:"\\(",eW:!0,c:n}].concat(n)},e.CNM,e.ASM,e.QSM,{cN:"string",b:t,e:a,c:[r],r:5}])}});hljs.registerLanguage("javascript",function(e){return{aliases:["js","jsx"],k:{keyword:"in of if for while finally var new function do return void else break catch instanceof with throw case default try this switch continue typeof delete let yield const export super debugger as async await static import from as",literal:"true false null undefined NaN Infinity",built_in:"eval isFinite isNaN parseFloat parseInt decodeURI decodeURIComponent encodeURI encodeURIComponent escape unescape Object Function Boolean Error EvalError InternalError RangeError ReferenceError StopIteration SyntaxError TypeError URIError Number Math Date String RegExp Array Float32Array Float64Array Int16Array Int32Array Int8Array Uint16Array Uint32Array Uint8Array Uint8ClampedArray ArrayBuffer DataView JSON Intl arguments require module console window document Symbol Set Map WeakSet WeakMap Proxy Reflect Promise"},c:[{cN:"meta",r:10,b:/^\s*['"]use (strict|asm)['"]/},{cN:"meta",b:/^#!/,e:/$/},e.ASM,e.QSM,{cN:"string",b:"`",e:"`",c:[e.BE,{cN:"subst",b:"\\$\\{",e:"\\}"}]},e.CLCM,e.CBCM,{cN:"number",v:[{b:"\\b(0[bB][01]+)"},{b:"\\b(0[oO][0-7]+)"},{b:e.CNR}],r:0},{b:"("+e.RSR+"|\\b(case|return|throw)\\b)\\s*",k:"return throw case",c:[e.CLCM,e.CBCM,e.RM,{b:/</,e:/(\/\w+|\w+\/)>/,sL:"xml",c:[{b:/<\w+\s*\/>/,skip:!0},{b:/<\w+/,e:/(\/\w+|\w+\/)>/,skip:!0,c:["self"]}]}],r:0},{cN:"function",bK:"function",e:/\{/,eE:!0,c:[e.inherit(e.TM,{b:/[A-Za-z$_][0-9A-Za-z$_]*/}),{cN:"params",b:/\(/,e:/\)/,eB:!0,eE:!0,c:[e.CLCM,e.CBCM]}],i:/\[|%/},{b:/\$[(.]/},e.METHOD_GUARD,{cN:"class",bK:"class",e:/[{;=]/,eE:!0,i:/[:"\[\]]/,c:[{bK:"extends"},e.UTM]},{bK:"constructor",e:/\{/,eE:!0}],i:/#(?!!)/}});hljs.registerLanguage("cpp",function(t){var e={cN:"keyword",b:"\\b[a-z\\d_]*_t\\b"},r={cN:"string",v:[t.inherit(t.QSM,{b:'((u8?|U)|L)?"'}),{b:'(u8?|U)?R"',e:'"',c:[t.BE]},{b:"'\\\\?.",e:"'",i:"."}]},i={cN:"number",v:[{b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},{b:t.CNR}],r:0},s={cN:"meta",b:"#",e:"$",k:{"meta-keyword":"if else elif endif define undef warning error line pragma ifdef ifndef"},c:[{b:/\\\n/,r:0},{bK:"include",e:"$",k:{"meta-keyword":"include"},c:[t.inherit(r,{cN:"meta-string"}),{cN:"meta-string",b:"<",e:">",i:"\\n"}]},r,t.CLCM,t.CBCM]},a=t.IR+"\\s*\\(",c={keyword:"int float while private char catch export virtual operator sizeof dynamic_cast|10 typedef const_cast|10 const struct for static_cast|10 union namespace unsigned long volatile static protected bool template mutable if public friend do goto auto void enum else break extern using class asm case typeid short reinterpret_cast|10 default double register explicit signed typename try this switch continue inline delete alignof constexpr decltype noexcept static_assert thread_local restrict _Bool complex _Complex _Imaginary atomic_bool atomic_char atomic_schar atomic_uchar atomic_short atomic_ushort atomic_int atomic_uint atomic_long atomic_ulong atomic_llong atomic_ullong",built_in:"std string cin cout cerr clog stdin stdout stderr stringstream istringstream ostringstream auto_ptr deque list queue stack vector map set bitset multiset multimap unordered_set unordered_map unordered_multiset unordered_multimap array shared_ptr abort abs acos asin atan2 atan calloc ceil cosh cos exit exp fabs floor fmod fprintf fputs free frexp fscanf isalnum isalpha iscntrl isdigit isgraph islower isprint ispunct isspace isupper isxdigit tolower toupper labs ldexp log10 log malloc realloc memchr memcmp memcpy memset modf pow printf putchar puts scanf sinh sin snprintf sprintf sqrt sscanf strcat strchr strcmp strcpy strcspn strlen strncat strncmp strncpy strpbrk strrchr strspn strstr tanh tan vfprintf vprintf vsprintf endl initializer_list unique_ptr",literal:"true false nullptr NULL"},n=[e,t.CLCM,t.CBCM,i,r];return{aliases:["c","cc","h","c++","h++","hpp"],k:c,i:"</",c:n.concat([s,{b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:c,c:["self",e]},{b:t.IR+"::",k:c},{v:[{b:/=/,e:/;/},{b:/\(/,e:/\)/},{bK:"new throw return else",e:/;/}],k:c,c:n.concat([{b:/\(/,e:/\)/,c:n.concat(["self"]),r:0}]),r:0},{cN:"function",b:"("+t.IR+"[\\*&\\s]+)+"+a,rB:!0,e:/[{;=]/,eE:!0,k:c,i:/[^\w\s\*&]/,c:[{b:a,rB:!0,c:[t.TM],r:0},{cN:"params",b:/\(/,e:/\)/,k:c,r:0,c:[t.CLCM,t.CBCM,r,i]},t.CLCM,t.CBCM,s]}])}});
var lsVote;

var lsVoteClass = new Class({
										   
		Implements: Options,

		options: {
				classes_action: {
						voted:          'voted',                       
						plus:           'plus',
						minus:          'minus',
						positive:       'positive',
						negative:       'negative',
						quest:          'quest'
				},
				classes_element: {
						voting:         'voting',
						count:          'count',                       
						total:          'total a',                       
						plus:           'plus',
						minus:          'minus'
				}              
		},
	   
		typeVote: {
				comment: {
						url: DIR_WEB_ROOT+'/include/ajax/voteComment.php',
						targetName: 'idComment'
				},
				topic: {
						url: DIR_WEB_ROOT+'/include/ajax/voteTopic.php',
						targetName: 'idTopic'
				},
				blog: {
						url: DIR_WEB_ROOT+'/include/ajax/voteBlog.php',
						targetName: 'idBlog'
				},
				user: {
						url: DIR_WEB_ROOT+'/include/ajax/voteUser.php',
						targetName: 'idUser'
				},
				article: {
						url: DIR_WEB_ROOT+'/finansoviy-slovar/vote/',
						targetName: 'idArticle'
				},
				broker: {
						url: DIR_WEB_ROOT+'/brokers-rating/vote/',
						targetName: 'idBroker'
				},
				broker_comment: {
						url: DIR_WEB_ROOT+'/brokers-rating/ajaxvotecomment/',
						targetName: 'idComment'
				}				
		},

		initialize: function(options){         
				this.setOptions(options);                      
		},
	   
		vote: function(idTarget,objVote,value,type) {          
				if (!this.typeVote[type]) {
						return false;
				}
			   
				this.idTarget=idTarget;
				this.objVote=$(objVote);
				this.value=value;
				this.type=type;        
				thisObj=this;
						
				var params = new Hash();
				params['value']=value;
				params[this.typeVote[type].targetName]=idTarget;
				params['security_ls_key']=LIVESTREET_SECURITY_KEY;
				
				JsHttpRequest.query(
						'POST '+this.typeVote[type].url,                       
						params,
						function(result, errors) {

							if (type == 'topic')
							{
								thisObj.onVoteCount(result, errors, thisObj);
							} else
							{
								thisObj.onVote(result, errors, thisObj);
							}
						},
						true
				);             
		},
	   
		onVote: function(result, errors, thisObj) {            
			if (!result) {
				msgErrorBox.alert('Error','Please try again later');           
			}      
			if (result.bStateError) {
				msgErrorBox.alert(result.sMsgTitle,result.sMsg);
			} else {
				msgNoticeBox.alert(result.sMsgTitle,result.sMsg);
			   
				var divVoting=thisObj.objVote.getParent('.'+thisObj.options.classes_element.voting);                
				divVoting.addClass(thisObj.options.classes_action.voted);
				divVoting.removeClass(thisObj.options.classes_action.plus);
				divVoting.removeClass(thisObj.options.classes_action.minus);
			   
				if (this.value>0) {
						divVoting.addClass(thisObj.options.classes_action.plus);
				}
				if(this.value<0) {
						divVoting.addClass(thisObj.options.classes_action.minus);
				}              
				var divCount=divVoting.getChildren('.'+thisObj.options.classes_element.count);
				if (divCount && divCount[0]) {
					divCount.set('text',result.iCountVote);
				}
			   
				var divTotal=divVoting.getChildren('.'+thisObj.options.classes_element.total);              
				result.iRating=parseFloat(result.iRating);  
				divVoting.removeClass(thisObj.options.classes_action.negative);    
				divVoting.removeClass(thisObj.options.classes_action.positive);         
				if (result.iRating>0) {                        
						divVoting.addClass(thisObj.options.classes_action.positive);
						divTotal.set('text','+'+result.iRating);
				}
				if (result.iRating<0) {                        
						divVoting.addClass(thisObj.options.classes_action.negative);
						divTotal.set('text',result.iRating);
				}
				if (result.iRating==0) {
						divTotal.set('text','0');
				}
				
				if (thisObj.type=='user' && $('user_skill_'+thisObj.idTarget)) {
					$('user_skill_'+thisObj.idTarget).set('text',result.iSkill);
				}
			}      
		},

		onVoteCount: function(result, errors, thisObj) {            
			if (!result) {
				msgErrorBox.alert('Error','Please try again later');           
			}      
			if (result.bStateError) {
				msgErrorBox.alert(result.sMsgTitle,result.sMsg);
			} else {
				msgNoticeBox.alert(result.sMsgTitle,result.sMsg);
			   
				var divVoting=thisObj.objVote.getParent('.'+thisObj.options.classes_element.voting);                
				divVoting.addClass(thisObj.options.classes_action.voted);
				divVoting.removeClass(thisObj.options.classes_action.plus);
				divVoting.removeClass(thisObj.options.classes_action.minus);
			   
				if (this.value>0) {
						divVoting.addClass(thisObj.options.classes_action.plus);
				}
				if(this.value<0) {
						divVoting.addClass(thisObj.options.classes_action.minus);
				}              
				var divCount=divVoting.getChildren('.'+thisObj.options.classes_element.count);
				if (divCount && divCount[0]) {
					divCount.set('text',result.iCountVote);
				}
			   
				var divTotal=divVoting.getChildren('.'+thisObj.options.classes_element.total);              
				result.iCountVote=parseFloat(result.iCountVote);  
				divVoting.removeClass(thisObj.options.classes_action.negative);    
				divVoting.removeClass(thisObj.options.classes_action.positive);         
				if (result.iCountVote>0) {                        
						divVoting.addClass(thisObj.options.classes_action.positive);
						divTotal.set('text',result.iCountVote);
				}
				if (result.iCountVote<0) {                        
						divVoting.addClass(thisObj.options.classes_action.negative);
						divTotal.set('text',result.iCountVote);
				}
				if (result.iCountVote==0) {
						divTotal.set('text','0');
				}
				
				if (thisObj.type=='user' && $('user_skill_'+thisObj.idTarget)) {
					$('user_skill_'+thisObj.idTarget).set('text',result.iSkill);
				}
			}      
		}		
	   
});

window.addEvent('domready', function() {       
	  lsVote=new lsVoteClass();
});
var lsFavourite;

var lsFavouriteClass = new Class({
                                           
        Implements: Options,

        options: {
                classes_action: {                        
                        active:    'active',
                        quest:     'quest'
                },
                classes_element: {
                        favorite:  'favorite'
                }              
        },
       
        typeFavourite: {                
                topic: {
                        url: DIR_WEB_ROOT+'/include/ajax/topicFavourite.php',
                        targetName: 'idTopic'
                },
                comment: {
                        url: DIR_WEB_ROOT+'/include/ajax/commentFavourite.php',
                        targetName: 'idComment'                	
                },
                talk : {
                        url: DIR_WEB_ROOT+'/include/ajax/talkFavourite.php',
                        targetName: 'idTalk'                	                	
                }
        },

        initialize: function(options){         
                this.setOptions(options);                      
        },
       
        toggle: function(idTarget,objFavourite,type) {          
                if (!this.typeFavourite[type]) {
                        return false;
                }

                this.idTarget=idTarget;
                this.objFavourite=$(objFavourite);
                this.value=value;
                this.type=type;        
                thisObj=this;
                  
                var value=1;      
                if (this.objFavourite.getParent('.'+this.options.classes_element.favorite).hasClass(this.options.classes_action.active)) {
                	value=0;
                }
                
                var params = new Hash();
                params['type']=value;
                params[this.typeFavourite[type].targetName]=idTarget;
                params['security_ls_key']=LIVESTREET_SECURITY_KEY;
                
                JsHttpRequest.query(
                        'POST '+this.typeFavourite[type].url,                       
                        params,
                        function(result, errors) {     
                                thisObj.onToggle(result, errors, thisObj);                               
                        },
                        true
                );             
        },
       
        onToggle: function(result, errors, thisObj) {            
        	if (!result) {
                msgErrorBox.alert('Error','Please try again later');           
        	}      
        	if (result.bStateError) {
                msgErrorBox.alert(result.sMsgTitle,result.sMsg);
        	} else {
                msgNoticeBox.alert(result.sMsgTitle,result.sMsg);
               
                var divFavourite=thisObj.objFavourite.getParent('.'+thisObj.options.classes_element.favorite);
                divFavourite.removeClass(thisObj.options.classes_action.active);
                if (result.bState) {
                	divFavourite.addClass(thisObj.options.classes_action.active);
                }
        	}      
        }
       
});

window.addEvent('domready', function() {       
      lsFavourite=new lsFavouriteClass();
});
function ajaxQuestionVote(idTopic,idAnswer) {	
	JsHttpRequest.query(
		'POST '+DIR_WEB_ROOT+'/include/ajax/questionVote.php',                       
		{ idTopic: idTopic, idAnswer: idAnswer, security_ls_key: LIVESTREET_SECURITY_KEY },
		function(result, errors) {  
			if (!result) {
				msgErrorBox.alert('Error','Please try again later');
			}
			if (result.bStateError) {
				msgErrorBox.alert(result.sMsgTitle,result.sMsg);
			} else {            	
				msgNoticeBox.alert(result.sMsgTitle,result.sMsg);
				if ($('topic_question_area_'+idTopic)) {
					$('topic_question_area_'+idTopic).set('html',result.sText);
				}  
			}                               
		},
		true
	);	
}


jQuery(document).ready(function($)
{
	$('.vote').on('click', '.vote_item', function()
	{
		if (typeof(CURRENT_USER_ID) == 'undefined')
		{
			document.location.href = '/login/';
			return;
		}

		var nVote = $(this).parents('.vote');
		if (nVote.find('.vote_options').hasClass('disable_vote')) return;
		
		var sVoteTargetType = nVote.attr('target-type');
		var iVoteTargetId = nVote.attr('target-id');
		var iVoteValue = $(this).attr('vote-value');

		JsHttpRequest.query('POST '+DIR_WEB_ROOT+'/include/ajax/questionVoteNew.php', { targetId: iVoteTargetId, targetType: sVoteTargetType, idAnswer: iVoteValue, security_ls_key: LIVESTREET_SECURITY_KEY }, function(result, errors)
		{
			if (!result)
			{
				msgErrorBox.alert('Error','Please try again later');
				return;
			}

			if (!result.bStateError)
			{
				nVote.find('.vote_options').addClass('disable_vote');

				$.each(result.aResult.answers, function(i,v)
				{
					var item = nVote.find('.vote_item[vote-value="' + i + '"]');
					if ('top' in v) item.addClass('selected');
					item.find('.vote_value').attr('title', v['count']).text(v['percent'] + '%');
					item.find('.vote_indicator').css('width', v['percent'] + '%');
				});

				$('#total_users').text(result.aResult.total);
				msgNoticeBox.alert(result.sMsgTitle, result.sMsg);
			} else
			{
				msgErrorBox.alert(result.sMsgTitle, result.sMsg);
			}

		}, true);
	});
});
// function toogleFriendForm(obj) {
// 	var friendForm=$('add_friend_form');
// 	var slideForm = new Fx.Slide('add_friend_form');						
	
// 	friendForm.getElements('textarea').set('value','');	
// 	if(friendForm.getStyle('display')=='none') {
// 		friendForm.setStyle('display','block');	
// 		slideForm.hide();	
// 	}
// 	slideForm.toggle();
// 	slideForm.addEvent('complete', function() {friendForm.getElement('textarea').focus();});
// }

function ajaxAddUserFriend(obj,idUser,sAction) {
	obj   = $(obj).getParent('li');
	
	// if(sAction!='link' && sAction!='accept') {
	// 	sText = obj.getElement('form textarea').get('value');
	// 	obj.getElement('form').getChildren().each(function(item){item.setProperty('disabled','disabled')});
	// } else {
	// 	sText='';
	// }
	
    sText='';
    
	if(sAction=='accept') {
		sPath=aRouter.profile+'ajaxfriendaccept/';
	} else {
		sPath=aRouter.profile+'ajaxfriendadd/';
	}
	
	JsHttpRequest.query(
    	'POST '+sPath,                       
        { idUser: idUser,userText: sText, security_ls_key: LIVESTREET_SECURITY_KEY },
        function(result, errors) {  
        	if (!result) {
                msgErrorBox.alert('Error','Please try again later');         
				obj.getElement('form').getChildren().each(function(item){item.removeProperty('disabled')});
        	}
            if (result.bStateError) {
            	msgErrorBox.alert(result.sMsgTitle,result.sMsg);
				obj.getElement('form').getChildren().each(function(item){item.removeProperty('disabled')});
            } else {            	
            	msgNoticeBox.alert(result.sMsgTitle,result.sMsg);
            	if (obj)  {           		
            		item = new Element('li',{'html':result.sToggleText});
					item.getElement('li').inject(obj.getParent('ul'),'top');            		
 	          		obj.dispose();
            	}
            }                               
        },
        true
    );
}

function ajaxDeleteUserFriend(obj,idUser,sAction) {   
	obj=$(obj).getParent('li');
	JsHttpRequest.query(
    	'POST '+aRouter.profile+'ajaxfrienddelete/',                         
        { idUser: idUser,sAction: sAction, security_ls_key: LIVESTREET_SECURITY_KEY },
        function(result, errors) {  
        	if (!result) {
                msgErrorBox.alert('Error','Please try again later');           
        	}
            if (result.bStateError) {
            	msgErrorBox.alert(result.sMsgTitle,result.sMsg);
            } else {            	
            	msgNoticeBox.alert(result.sMsgTitle,result.sMsg);
            	if (obj)  {            		
            		item = new Element('li',{'html':result.sToggleText});
					item.getElement('li').inject(obj.getParent('ul'),'top');            		
					obj.dispose();
            	}
            }                               
        },
        true
    );
}


                        jQuery(document).ready(function($)
                        {
                            $('.flistlink').on('click', function(e)
                            {
                                var t = $(e.target);
                                var url =  DIR_WEB_ROOT + '/profile/ajax' + t.attr('type') + 'list/';
                                var login = t.attr('user');

                                var c = t.parents('tr').next('tr').find('.friends_w');
                                $.get(url, {'JsHttpRequest' : (new Date()).getTime(), 'login': login}, function(result, errors)
                                {
                                    var res = result.match(/^JsHttpRequest\.dataReady\((.+)\)/);
                                    if (res != null) res = JSON.parse(res[1]);

                                    if (!res.js)
                                    {
                                        msgErrorBox.alert('Error','Please try again later');
                                    }
                                    if (res.js.bStateError)
                                    {
                                        msgErrorBox.alert(res.js.sMsgTitle,res.js.sMsg);
                                    } else
                                    {
                                        c.empty();
                                        $.each(res.js.aUsersList, function(i,a)
                                        {
                                            $('<a></a>').attr('href', DIR_WEB_ROOT + '/profile/' + a.user_login + '/').text(a.user_profile_name).appendTo(c);
                                        });

                                        c.show();
                                    }
                                });
                                t.remove();

                            });

                        }); ;
function ajaxJoinLeaveBlog(obj,idBlog) {   
	obj=$(obj);
	JsHttpRequest.query(
    	'POST '+DIR_WEB_ROOT+'/include/ajax/joinLeaveBlog.php',
        { idBlog: idBlog, security_ls_key: LIVESTREET_SECURITY_KEY },
        function(result, errors) {
        	if (!result) {
                msgErrorBox.alert('Error','Please try again later');
        	}
            if (result.bStateError) {
            	msgErrorBox.alert(result.sMsgTitle,result.sMsg);
            } else {
            	msgNoticeBox.alert(result.sMsgTitle,result.sMsg);
            	if (obj)  {
            		obj.getParent().removeClass('active');
            		if (result.bState) {
            			obj.getParent().addClass('active');
            		}
            		divCount=$('blog_user_count_'+idBlog);
            		if (divCount) {
            			divCount.set('text',result.iCountUser);
            		}
            	}
            }
        },
        true
    );
}


function ajaxBlogInfo(idBlog) { 	
	JsHttpRequest.query(
    	'POST '+DIR_WEB_ROOT+'/include/ajax/blogInfo.php',                       
        { idBlog: idBlog, security_ls_key: LIVESTREET_SECURITY_KEY  },
        function(result, errors) {  
        	if (!result) {
                msgErrorBox.alert('Error','Please try again later');           
        	}
            if (result.bStateError) {
            	
            } else {            	
            	if ($('block_blog_info')) {
            		$('block_blog_info').set('html',result.sText);            		
            	}
            }                               
        },
        true
    );
}
;
function ajaxTopicRenewPaid(topicId)
{

	JsHttpRequest.query('POST ' + aRouter.topic + 'renew_paid/' + topicId + '/?ajax=1&security_ls_key=' + LIVESTREET_SECURITY_KEY, {}, function(result, errors)
	{
		if (!result) {
			msgErrorBox.alert('Error', 'Please try again later');
		}
		if (result.bStateError) {
			msgErrorBox.alert(result.sMsgTitle, result.sMsg);
		} else {
			msgNoticeBox.alert(result.sMsgTitle, result.sMsg);

		}
	}, true);
}



function ajaxTextPreview(textId, save, divPreview) {
	var text;
	if (BLOG_USE_TINYMCE && tinyMCE && (ed = tinyMCE.get(textId))) {
		text = ed.getContent();
	} else {
		text = $(textId).value;
	}
	jQuery.ajax({
		type: 'POST',
		url: DIR_WEB_ROOT + '/include/ajax/textPreview.php?JsHttpRequest='+ (new Date()).getTime()+'-form',
		data: { text: text, save: save ? 1 : 0, security_ls_key: LIVESTREET_SECURITY_KEY },
		success: function(result, errors)
		{
			try
			{
				result = result.match(/top\.JsHttpRequestGlobal\.dataReady\((.+)\)/); // ебаное гавно с JsHttpRequest, если не указать -form - оно поебет кодеровки на сервере )) ой заебись))
				if (result != null) result = JSON.parse(result[1]);
				result = result.js;

			} catch (e) { result = null; }

			if (!result) {
				msgErrorBox.alert('Error', 'Please try again later');
			}
			if (result.bStateError) {
				msgErrorBox.alert('Error', 'Please try again later');
			} else {
				if (!divPreview) {
					divPreview = 'text_preview';
				}

				var div = $(divPreview);     	
				if (div)
				{
					div.set('html',result.sText).setStyle('display','block');

					var docScroller = new Fx.Scroll(document.getDocument());
					docScroller.setOptions({
						duration:500,
						offset: {
							'x': 0,
							'y': 0
						}
					});
					docScroller.start(0, div.getPosition().y);
				}
			}
		}
	});
}


// для опроса
function addField(btn) {
	tr = btn;
	while (tr.tagName != 'TR') tr = tr.parentNode;
	var newTr = tr.parentNode.insertBefore(tr.cloneNode(true), tr.nextSibling);
	checkFieldForLast();
}
function checkFieldForLast() {
	btns = document.getElementsByName('drop_answer');
	for (i = 0; i < btns.length; i++) {
		btns[i].disabled = false;
	}
	if (btns.length <= 2) {
		btns[0].disabled = true;
		btns[1].disabled = true;
	}
}
function dropField(btn) {
	tr = btn;
	while (tr.tagName != 'TR') tr = tr.parentNode;
	tr.parentNode.removeChild(tr);
	checkFieldForLast();
}


function checkAllTalk(checkbox) {
	$$('.form_talks_checkbox').each(function(chk) {
		if (checkbox.checked) {
			chk.checked = true;
		} else {
			chk.checked = false;
		}
	});
}

function checkAllReport(checkbox) {
	$$('.form_reports_checkbox').each(function(chk) {
		if (checkbox.checked) {
			chk.checked = true;
		} else {
			chk.checked = false;
		}
	});
}

function checkAllPlugins(checkbox) {
	$$('.form_plugins_checkbox').each(function(chk) {
		if (checkbox.checked) {
			chk.checked = true;
		} else {
			chk.checked = false;
		}
	});
}

function showImgUploadForm() {
	if (Browser.Engine.trident) {
		//return true;
	}
	if (!winFormImgUpload) {
		winFormImgUpload = new StickyWin.Modal({content: $('window_load_img'), closeClassName: 'close-block', useIframeShim: false, modalOptions: {modalStyle:{'z-index':900}}});
	}
	winFormImgUpload.show();
	winFormImgUpload.pin(true);
	$$('input[name=img_file]').set('value', '');
	$$('input[name=img_url]').set('value', 'http://');
	return false;
}

function hideImgUploadForm() {
	winFormImgUpload.hide();
}

var winFormImgUpload;


function ajaxUploadImg(value, sToLoad) {
	var req = new JsHttpRequest();
	req.onreadystatechange = function() {
		if (req.readyState == 4) {
			if (req.responseJS.bStateError) {
				msgErrorBox.alert(req.responseJS.sMsgTitle, req.responseJS.sMsg);
			} else {
				lsPanel.putText(sToLoad, req.responseJS.sText);
				hideImgUploadForm();
			}
		}
	}
	req.open(null, DIR_WEB_ROOT + '/include/ajax/uploadImg.php', true);
	req.send({ value: value, security_ls_key: LIVESTREET_SECURITY_KEY });
}

function addEventById(id, event, fn) {
	var el = $(id)
	if (el) {
		el.addEvent(event, fn)
	}
	return el
}

function changeSelect(data) {
	var myElement = document.getElementById('checkbox');
	if (data == 0 && myElement.isDisplayed()) {
		myElement.hide();
	} else if (data != 0 && !myElement.isDisplayed()) {
		myElement.show();
	}
}

function ajaxTopicMore(topicId, sHash, content, callback_after)
{
	JsHttpRequest.query('POST /blog/ajax_topic_more', { topicId: topicId, hash: sHash }, function(result, errors)
	{
		if (!result)
		{
			msgErrorBox.alert('Error', 'Please try again later');
		}
		
		if (result.bStateError)
		{
			msgErrorBox.alert(result.sMsgTitle, result.sMsg);
		} else
		{
			var poll = content.find('.topic_question');
			content.empty();
			content.html(result.sTopicMore);
			if (poll.length) content.prepent(poll)

			if (typeof(callback_after) == 'function') setTimeout(callback_after, 1);
		}

	}, true);
}

function submitCommentForm(topicId)
{
	if (window.tinyMCE) tinyMCE.triggerSave();
	var commentText = jQuery('#form_comment').find('#form_comment_text').val();

	var mce = tinyMCE.get('form_comment_text');
	if (mce) mce.setProgressState(true);


	jQuery.ajax({
		type: 'POST',
		url: aRouter.blog + 'ajaxaddcomment/' + '?JsHttpRequest=' + (new Date()).getTime() + '-form', // ебаное гавно с JsHttpRequest
		data: {cmt_target_id: topicId, comment_text: commentText, reply: '', security_ls_key: LIVESTREET_SECURITY_KEY}
	}).then(function(result)
	{
		var mce = tinyMCE.get('form_comment_text');
		if (mce) mce.setProgressState(false);

		try
		{
			result = result.match(/top\.JsHttpRequestGlobal\.dataReady\((.+)\)/); // ебаное гавно с JsHttpRequest
			if (result != null) result = JSON.parse(result[1]);

		} catch (e) { result = null; }

		if (!result)
		{
			msgErrorBox.alert('Error', 'Please try again later');
		}
		
		if (result.js.bStateError)
		{
			msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
		} else
		{
			msgNoticeBox.alert('Внимание!', 'Комментарий успешно добавлен.');

			if (window.tinyMCE)
			{
				var mce = tinyMCE.get('form_comment_text');
				if (mce) mce.remove();
			}
			jQuery('#form_comment').remove();			
		}
	}, function()
	{
		var mce = tinyMCE.get('form_comment_text');
		if (mce) mce.setProgressState(false);

		msgErrorBox.alert('Error', 'Please try again later');
	});
}

function addCommentForm(NodeAfter, topicId)
{
	if (window.tinyMCE)
	{
		var mce = tinyMCE.get('form_comment_text');
		if (mce) mce.remove();
	}

	jQuery('#form_comment').remove();

	var form = '<div id="form_comment" style="margin-bottom: 2em">\
		<textarea name="comment_text" id="form_comment_text"></textarea>\
		<input type="submit" name="submit_comment" value="комментировать" onclick="submitCommentForm(' + topicId + '); return false;">\
	</div>';

	var formNode = jQuery(form);
	NodeAfter.after(formNode);

	var InitMCE = function()
	{
		var options = {
			content_css : DIR_STATIC_SKIN + '/css/tinyMCE.css',
			mode : "exact",
			elements : "form_comment_text",
			theme : "advanced",
			theme_advanced_toolbar_location : "top",
			theme_advanced_toolbar_align : "left",
			theme_advanced_buttons1 : "emotions,bold,italic,underline,strikethrough,|,forecolor,blockquote,|,lslink,unlink,lsvideo,lsimage,lsdictionary,code",
			theme_advanced_buttons2 : "",
			theme_advanced_buttons3 : "",
			theme_advanced_statusbar_location : "bottom",
			theme_advanced_resizing : true,
			theme_advanced_resize_horizontal : 0,
			theme_advanced_resizing_use_cookie : 0,
			theme_advanced_path : false,
			plugins : "lseditor,safari,inlinepopups,media,pagebreak,paste,mention",
			paste_auto_cleanup_on_paste : true,
			paste_remove_spans : true,
			object_resizing : true,
			force_br_newlines : true,
			forced_root_block : '', 
			force_p_newlines : false,
			convert_urls : false,
			extended_valid_elements : "embed[src|type|allowscriptaccess|allowfullscreen|width|height],img[src|alt|title|align|width|height|hspace|vspace|class|smile]",
			media_strict : false,
			language : TINYMCE_LANG,
			browser_spellcheck:true,
			gecko_spellcheck:true,
			setup : function(ed)
			{
				ed.onKeyDown.add(function(ed, evt)
				{
					if (evt.ctrlKey && !evt.shiftKey && !evt.altKey && !evt.metaKey && evt.keyCode == 13)
					{
						evt.preventDefault();
						$('form_comment').getElement('input[name=submit_comment]').click();
					}
				});
			},
			mentions: {
				queryBy: 't',
				source: function(query, process)
				{
					jQuery.getJSON(aRouter['summoner'] + 'nick_autocomplete/' + encodeURIComponent(query) + '?security_ls_key=' + LIVESTREET_SECURITY_KEY, function(data)
					{
						//call process to show the result
						if (('bStateError' in data) && (data.bStateError == false))	process(data['results']);
					});
				},
				delimiter: '@',
				items: 5,
				insert: function(item)
				{
					return '<a href="' + item.p + '" title="' + item.l + '" class="summoner">@' + item.t + '</a>';
				},
				render: function(item)
				{
					return '<li><span><img src="' + item.i + '"></span><div><div>' + item.t + '</div><span>' + item.c + '</span></div></li>';
				},
				renderDropdown: function()
				{
					return '<ul class="rte-autocomplete mention-menu"></ul>';
				},
				sorter: function (items)
				{
					return items;
				}
			},

			paste_preprocess: function(plugin, args)
			{
				if (!('content' in args)) return;

				var sYouTybeTemplate = '<iframe width="560" height="315" src="https://www.youtube.com/embed/%%videoId%%" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';
				var sContent = args.content.replace(/<a[^\>]*?>.*?<\/\s?a>|https?:\/\/(?:www\.)?youtu\.be\/([a-z0-9\-\_]+(?:\?t=\d+)?)/ig, function(sMatch, sVideoCode, offset, sString)
				{
					return (typeof(sVideoCode) == 'undefined') ? sMatch : sYouTybeTemplate.replace('%%videoId%%', sVideoCode);
				
				}).replace(/<a[^\>]*?>.*?<\/\s?a>|https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([a-z0-9\-\_]+(?:\?t=\d+)?)/ig, function(sMatch, sVideoCode, offset, sString)
				{
					return (typeof(sVideoCode) == 'undefined') ? sMatch : sYouTybeTemplate.replace('%%videoId%%', sVideoCode);
				});		

				args.content = sContent;
			}

		};
		if (window.tinyMCE) tinyMCE.init(options);
	}

	if (!window.tinyMCE)
	{
		var mce = new Element('script', {type:'text/javascript', src:'/engine/lib/external/tiny_mce_3.5.11/tiny_mce.js'});
		mce.addEvent('load', function()
		{
			// если загрузились быстрее чем DOM - просто ничего не делаем
			InitMCE();
		});
		$$('head')[0].adopt(mce);		
	} else
	{
		InitMCE();
	}
}


function tryCommentForm(topicId, afterFunc)
{
	var params = {cmt_target_id: topicId, reply: '', security_ls_key: LIVESTREET_SECURITY_KEY};
	JsHttpRequest.query('POST ' + aRouter.blog + 'ajaxcancomment/', params, function(result, errors)
	{
		if (!result)
		{
			msgErrorBox.alert('Error', 'Please try again later');
		}
		
		if (result.bStateError)
		{
			msgErrorBox.alert(result.sMsgTitle, result.sMsg);
			if (typeof(afterFunc) == 'function') afterFunc(false);
		} else
		{
			if (typeof(afterFunc) == 'function') afterFunc(true);
		}
	}, true);	
}

document.addEvent('domready', function()
{
	(function($)
	{
		if (typeof(MutationObserver) != 'undefined')
		{
			var sContainer = '#wrapper';
			var aLoadContainers = ['IFRAME', 'IMG'];
			var aResizeContainers = ['DIV'];
			
			var recalcBanners = function()
			{
				var nConiatnerHeight = $(sContainer).height();
				$('.sticky_block > div').each(function(i,e)
				{
					if ($(this).height() > 0) // sized
					{
						$(this).hide();
						if ($(sContainer).height() == nConiatnerHeight)
						{
							$(this).show();
							$(this).stick_in_parent({parent: sContainer, spacer: '.sticky_block'});
						} else
						{
							$(this).show();
							$(this).trigger('sticky_kit:detach');
						}
					}
				});
				$(document.body).trigger('sticky_kit:recalc');
			};

			var bannerObserver = new MutationObserver(function(mutations)
			{
				var bRecalcBanners = false;
				for (var i = 0, j = mutations.length; i<j; i++)
				{
					if (mutations[i].type == 'childList')
					{
						if (mutations[i].addedNodes.length)
						{
							for (var k = 0, l = mutations[i].addedNodes.length; k<l; k++)
							{
								if (aLoadContainers.indexOf(mutations[i].addedNodes[k].nodeName) != -1)
								{
									mutations[i].addedNodes[k].addEventListener('load', recalcBanners, false);
								}

								if (aResizeContainers.indexOf(mutations[i].addedNodes[k].nodeName) != -1)
								{
									if (mutations[i].addedNodes[k].style.height && (mutations[i].addedNodes[k].style.height != 'auto')) bRecalcBanners = true;
									if (mutations[i].addedNodes[k].style.width && (mutations[i].addedNodes[k].style.width != 'auto')) bRecalcBanners = true;
								}
							}
						}

						if (mutations[i].removedNodes.length)
						{
							for (var k = 0, l = mutations[i].addedNodes.length; k<l; k++)
							{
								if (aLoadContainers.indexOf(mutations[i].addedNodes[k].nodeName) != -1)
								{
									mutations[i].addedNodes[k].removeEventListener('load', recalcBanners, false);
								}

								if (aResizeContainers.indexOf(mutations[i].addedNodes[k].nodeName) != -1)
								{
									bRecalcBanners = true;
								}
							}	
						}
					}
				}

				if (bRecalcBanners) recalcBanners();
			});

			$('.sticky_block').not('#listalka').wrapInner('<div/>');
			$('.sticky_block > div').each(function(i,e)
			{
				bannerObserver.observe(this, {childList: true, subtree: true});

			});

			$(window).on('resize', recalcBanners);

		} else
		{
			$('.sticky_block').not('#listalka').wrapInner('<div/>');
			$('.sticky_block > div').stick_in_parent({parent: '#wrapper', spacer: '.sticky_block', recalc_every: 1});
		}
	})(jQuery);

	jQuery(document).on('scroll', function(event)
	{
		if (event.target.scrollingElement && event.target.scrollingElement.scrollLeft > 5)
		{
			jQuery('#listalka').hide();
		} else {
			jQuery('#listalka').show();
		}
	});

	if (typeof(hljs) == 'object')
	{
		jQuery('pre, code').each(function(i)
		{
			hljs.highlightBlock(this);
		});
	}

	jQuery('span.scrollUp').on('click', function(e)
	{
		jQuery.scrollTo('body');
	});

	jQuery('span.scrollDown').click(function(){

		if (jQuery('#googlebanner').length)
		{
			var o = jQuery('#googlebanner').offset();
			jQuery.scrollTo(o.top - document.documentElement.clientHeight + jQuery('#googlebanner').height() + 10);

		} else if (jQuery('#comment-children-0').length)
		{
			var o = jQuery('#comment-children-0').offset();
			jQuery.scrollTo(o.top - document.documentElement.clientHeight + jQuery('#comment-children-0').height() + 10);

		} else
		{
			jQuery.scrollTo('#footer');
		}
	});	

	// кастыль для виджетов твиттера
	if (jQuery('.twitter-tweet').length)
	{
		var rx = new RegExp('^' +  DIR_WEB_ROOT.replace(/\//g, '\\/').replace(/\./g, '\\.') + '\\/r\\.php\\?u=([^\\&]+)', 'i');
		var rx2 = new RegExp('^\\/r\\.php\\?u=([^\\&]+)', 'i');
		jQuery('a', '.twitter-tweet').each(function(i, el)
		{
			if (el.hasAttribute('href'))
			{
				if (m = (jQuery(el).attr('href').match(rx) || jQuery(el).attr('href').match(rx2))) jQuery(el).attr('href', decodeURIComponent(m[1]));
			}
		});
		if (!jQuery('#twitter-wjs').length) jQuery.getScript('//platform.twitter.com/widgets.js');
	}

	setInterval(function()
	{
		var blinked_items = $$('.blinked');
		blinked_items.each(function(item, i)
		{
			item.style.visibility = (item.style.visibility == '') ? 'hidden' : '';
		});
	
	}, 500);


	jQuery('.image_true, img.validated').jBox('Tooltip', {
		maxWidth: '300px',
		position: {
		  x: 'right',
		  y: 'center'
		},
		outside: 'x'
	});	

	if (document.cookie.indexOf('nomobile=') != -1)
	{
		jQuery('body').prepend(jQuery('<div class="user_mobile"><i></i><a href="?mobile=1">Мобильная версия</a></div>'));
	}

	(function($)
	{
		if ($('#admin_new_bug').length)
		{
			$('#admin_new_bug').on('click', function()
			{
				JsHttpRequest.query('POST ' + aRouter.abuse + 'bug_clean_ajax/', {iBugId: $(this).attr('bug-id'), security_ls_key: LIVESTREET_SECURITY_KEY}, function(result, errors)
				{
					if (!result)
					{
						msgErrorBox.alert('Error', 'Please try again later');
					}
					
					if (result.bStateError)
					{
						msgErrorBox.alert(result.sMsgTitle, result.sMsg);
						if ('iNewBug' in result)
						{
							$('#admin_new_bug').attr('bug-id', result.iNewBug);
							$('.user_warned a').first().attr('href', aRouter['trading'] + 'smartlab-bugs/goto_comment_' + result.iNewComment + '/#comment' + result.iNewComment);
						}
					
					} else
					{
						document.location.reload();
					}
				}, true);	

			});
		}

		if ($('#admin_new_spam').length)
		{
			$('#admin_new_spam').on('click', function()
			{
				JsHttpRequest.query('POST ' + aRouter.abuse + 'spam_clean_ajax/', {iAbuseId: $(this).attr('abuse-id'), security_ls_key: LIVESTREET_SECURITY_KEY}, function(result, errors)
				{
					if (!result)
					{
						msgErrorBox.alert('Error', 'Please try again later');
					}
					
					if (result.bStateError)
					{
						msgErrorBox.alert(result.sMsgTitle, result.sMsg);
						if ('iNewAbuse' in result)
						{
							$('#admin_new_spam').attr('abuse-id', result.iNewAbuse);

							setTimeout(function()
							{
								document.location.reload();

							}, 1000);
						}
					
					} else
					{
						document.location.reload();
					}
				}, true);	

			});
		}

	})(jQuery);

	// jQuery(document).on('copy', function(e)
	// {
	// 	var selection;
	// 	window.getSelection ? selection = window.getSelection() : document.getSelection ? selection = document.getSelection() : document.selection && (selection = document.selection.createRange());

	// 	var hiddenDiv = jQuery('<div></div>').css({position:'absolute', 'left': '-99999px'}).html(selection.toString().replace(/(?:\r\n|\r|\n)/g, '<br />') + '<br /><br />источник: <a href="' + document.location.href + '">' + document.location.href + '</a>');
	// 	jQuery('body').append(hiddenDiv);

	// 	selection.selectAllChildren(hiddenDiv[0]);
		
	// 	setTimeout(function()
	// 	{
	// 	 	hiddenDiv.remove(hiddenDiv);

	// 	}, 0);
	// });

	if (jQuery('#content').on('click', function(e)
	{
		if ((e.target.nodeName === 'A') && (jQuery.trim(jQuery(e.target).text()) == 'Читать дальше'))
		{
			if (e.shiftKey || e.ctrlKey) return;
			var sHash = jQuery(e.target).attr('hash');
			if (sHash)
			{
				e.preventDefault();
				var link = jQuery(e.target);
				var topicId = link.parents('.topic').attr('tid');
				var content = link.parents('.content');

				link.before('<span class="topic_more_loading">Загрузка...</span>');
				link.remove();

				ajaxTopicMore(topicId, sHash, content, function()
				{
					content.each(function(i, el)
					{
						jQuery(el).find('a.imgpreview').attr('data-jbox-image', 'gallery_topic_' + topicId);
					});
					window.jbi = new jBox('Image');
					jQuery(window).trigger('resize');
				});
			}

		} else if ((e.target.nodeName === 'SPAN') && ((jQuery.trim(jQuery(e.target).text()) == 'комментировать') || (jQuery.trim(jQuery(e.target).text()) == 'ответить')))
		{
			if (e.shiftKey || e.ctrlKey) return;
			if (!window.DIR_STATIC_SKIN) return; // гости
			e.preventDefault();			

			var aTopic = jQuery(e.target).parents('.topic');

			// more предварительно загружаем
			var aMore = aTopic.find('.content').find('a[hash]');
			if (aMore.length)
			{
				var sHash = aMore.attr('hash');
				if (sHash)
				{
					var topicId = aTopic.attr('tid');
					var content = aTopic.find('.content');

					aMore.before('<span class="topic_more_loading">Загрузка...</span>');
					aMore.remove();

					ajaxTopicMore(topicId, sHash, content, function()
					{
						tryCommentForm(topicId, function(success)
						{
							if (success)
							{
								addCommentForm(content, topicId);
								jQuery('body').scrollTo(jQuery('#form_comment'));
							}
						});
						
					});
				}
			} else
			{
				// у вопросов нет .content, херачим за шарокнопками
				var after = aTopic.find('.content');
				if (after.length == 0) after = aTopic.find('.action'); // after = aTopic.find('.topshare');

				tryCommentForm(aTopic.attr('tid'), function(success)
				{
					if (success)
					{
						addCommentForm(after, aTopic.attr('tid'));
					}
				});
			}
		} else if (((e.target.nodeName === 'A') || (e.target.nodeName === 'B')) && (jQuery.inArray(jQuery.trim(jQuery(e.target).text()), ['N', 'K', 'Y', 'Z']) >= 0))
		{
			e.preventDefault();
			var link = (e.target.nodeName === 'B') ? e.target.parentNode : e.target;
			var url = link.href.toString();

			JsHttpRequest.query('POST ' + url + '&ajax=1', {}, function(result, errors)
			{
				if (!result)
				{
					msgErrorBox.alert('Error', 'Please try again later');
				} else
				{
					if (result.bStateError)
					{
						msgErrorBox.alert(result.sMsgTitle, result.sMsg);
					} else
					{
						// переключалка ссылок (ебучий глюк)
						switch (jQuery.trim(jQuery(e.target).text()))
						{
							case 'Z':
							{
								if (e.target.nodeName === 'B')
								{
									// был включен
									url = url.replace('/index_default/', '/index_show/');
									jQuery(e.target.parentNode).empty().attr('href', url).text('Z');
								} else
								{
									url = url.replace('/index_show/', '/index_default/');
									jQuery(e.target).empty().attr('href', url).append('<b>Z</b>');
									jQuery(e.target).parents('.action').find('A > B').each(function(i, el)
									{
										if (jQuery.trim(jQuery(el).text()) == 'Y')
										{
											var link = el.parentNode;
											jQuery(link).empty().append('Y').attr('href', link.href.toString().replace('/index_default/', '/index_hide/'));
										}
									});
								}
								break;
							}

							case 'Y':
							{
								if (e.target.nodeName === 'B')
								{
									// был включен
									url = url.replace('/index_default/', '/index_hide/');
									jQuery(e.target.parentNode).empty().attr('href', url).text('Y');
								} else
								{
									url = url.replace('/index_hide/', '/index_default/');
									jQuery(e.target).empty().attr('href', url).append('<b>Y</b>');

									jQuery(e.target).parents('.action').find('A > B').each(function(i, el)
									{
										if (jQuery.trim(jQuery(el).text()) == 'Z')
										{
											var link = el.parentNode;
											jQuery(link).empty().append('Z').attr('href', link.href.toString().replace('/index_default/', '/index_show/'));
										}
									});									
								}								
								break;
							}
						}


						msgNoticeBox.alert(result.sMsgTitle, result.sMsg);
					}
				}
			}, true);			
		}
	}));

	// убираем конфирмы
	jQuery('.topic').find('.action').find('a').each(function(i, el)
	{
		if (jQuery.inArray(jQuery.trim(jQuery(el).text()), ['N', 'K', 'Y', 'Z']) >= 0)
		{
			jQuery(el).removeAttr('onclick');
		}
	});


	if (jQuery('#content .topic[tid]').length)
	{
		var aTids = jQuery('#content .topic[tid]').map(function(i,el)
		{
			return parseInt(jQuery(el).attr('tid'));
		});


		var vf = 'func' + Math.floor(Math.random() * 10000);
		window[vf] = function(tid, count)
		{
			var vt = jQuery('.topic[tid="' + tid + '"] li.views-total');
			if (!vt.length) vt = jQuery('.topic[tid="' + tid + '"] .views-total-topic');

			if (vt.length)
			{
				if (typeof(count) == 'string') count = parseInt(count);
				if (typeof(count) != 'number') return;

				var cv = count;
				if (cv > 1000)
				{
					cv /= 100;
					cv = (Math.floor(cv) / 10) + 'К';
				};

				var bNotEmpty = vt.find('*').length;
				var vs = jQuery('<span class="views-span" title="Просмотрели ' + count + '">' + cv + '</span>');
				vt.prepend(vs);
				if (bNotEmpty) vs.after(' | ');
			}
		};

		jQuery.getScript('/cgi-bin/gcn.fcgi?list=' + (jQuery.makeArray(aTids)).join(',') + '&func=' + vf).done(function()
		{
			delete window[vf];
		});


		var aTopicsVals = {};
		var aTopicsSends = [];

		function topicFill()
		{
			aTopicsVals = {};
			jQuery('div.topic').each(function(index, node)
			{
				var topic = jQuery(node);

				if (aTopicsSends.indexOf(topic.attr('tid')) == -1)
				{
					var acd = topic.offset();
					acd.bottom = acd.top + topic.height();
					acd.right = acd.left + topic.width();
					aTopicsVals[topic.attr('tid')] = acd;
				}
			});
		};


		function topicCheck(event)
		{
			var aVisible = [];
			var body = jQuery('html').get(0);
			var scrollYTop = body.scrollTop;
			var scrollYBottom = scrollYTop + body.clientHeight;

			for (var i in aTopicsVals)
			{
				if (((aTopicsVals[i].top >= scrollYTop) && (aTopicsVals[i].top <= scrollYBottom)) || ((aTopicsVals[i].top <= scrollYTop) && (aTopicsVals[i].bottom >= scrollYTop))) aVisible.push(i);
			}

			var aTopics2Send = [];
			jQuery.each(aVisible, function(index, tid)
			{
				if (aTopicsSends.indexOf(tid) == -1) aTopics2Send.push(tid);
			});

			if (aTopics2Send.length)
			{
				new Image().src = '/cgi-bin/scn.fcgi?list=' + aTopics2Send.join(',') + '&r='+Math.random();
				aTopicsSends = aTopicsSends.concat(aTopics2Send);
				jQuery.each(aTopics2Send, function(i,tid)
				{
					delete aTopicsVals[tid];
				});
			}
		};


		var allVideos = jQuery('#content .topic .content iframe, #content .topic .content object');
		var fluidEl = jQuery('#content');
		 
		allVideos.each(function()
		{
			jQuery(this).data('aspectRatio', this.height / this.width).removeAttr('height').removeAttr('width');
		});

		function videosCheck()
		{
			var newWidth = fluidEl.width();
			allVideos.each(function()
			{
				var el = jQuery(this);
				el.width(newWidth).height(newWidth * el.data('aspectRatio'));  
			});
		}

		jQuery(window).on('resize', function(e)
		{
			videosCheck();
			topicFill();
			topicCheck();

		}).on('scroll', function(e)
		{
			topicCheck();

		}).trigger('resize');
	}

	if (jQuery('#search').length) jQuery('#search').autocomplete({

		serviceUrl: DIR_WEB_ROOT+'/include/ajax/tagAutocompleter.php?security_ls_key='+LIVESTREET_SECURITY_KEY,
		type: 'POST',
		dataType: 'json',
		paramName: 'value',
		params: {'json': 1},
		preventBadQueries: false,
		zIndex: 99999,

		transformResult: function(response)
		{
			return { suggestions: response['results'] };
		}
	});	

	if (jQuery('#topic_tags').length) jQuery('#topic_tags').autocomplete({

		serviceUrl: DIR_WEB_ROOT+'/include/ajax/tagAutocompleter.php?security_ls_key='+LIVESTREET_SECURITY_KEY,
		type: 'POST',
		dataType: 'json',
		paramName: 'value',
		params: {'json': 1},
		preventBadQueries: false,
		zIndex: 99999,
		delimiter: ',',

		transformResult: function(response)
		{
			return { suggestions: response['results'] };
		},

		onSelect: function (suggestion)
		{
			if (jQuery(this).val()) jQuery(this).val(jQuery(this).val() + ',');
		}		
	});

	if (jQuery('#topic_tags_forum').length) jQuery('#topic_tags_forum').autocomplete({
		serviceUrl: '/forum/ajaxsearch/',
		type: 'POST',
		dataType: 'json',
		paramName: 'value',
		params: {'json': 1, 'all': 0},
		preventBadQueries: false,
		zIndex: 99999,
		delimiter: ',',
		transformResult: function(response)
		{
			return { suggestions: response['results'] };
		},

		onSelect: function (suggestion)
		{
			if (jQuery(this).val()) jQuery(this).val(jQuery(this).val() + ',');
		}
	});


	if (jQuery('#profile_city').length) jQuery('#profile_city').autocomplete({
		serviceUrl: DIR_WEB_ROOT + '/include/ajax/cityAutocompleter.php',
		type: 'POST',
		dataType: 'json',
		paramName: 'value',
		params: {'json': 1},
		preventBadQueries: false,
		zIndex: 99999,
		transformResult: function(response)
		{
			return { suggestions: response['results'] };
		}
	});

	if (jQuery('#profile_country').length) jQuery('#profile_country').autocomplete({
		serviceUrl: DIR_WEB_ROOT+'/include/ajax/countryAutocompleter.php',
		type: 'POST',
		dataType: 'json',
		paramName: 'value',
		params: {'json': 1},
		preventBadQueries: false,
		zIndex: 99999,
		transformResult: function(response)
		{
			return { suggestions: response['results'] };
		}
	});

	$$('.goto-comment-child a').each(function(el) {
		el.addEvent('click', function() {
			return lsCmtTree.goToChildComment(this);
		})
	})

	addEventById('new-comments', 'click', function() {
		lsCmtTree.goNextComment()
	})
	addEventById('slf', 'click', function() {
		return showLoginForm()
	})
	addEventById('search', 'blur', function() {
		if (!this.getProperty('value')) this.setProperty('value', 'Поиск')
	})
	addEventById('search', 'click', function() {
		if (this.getProperty('value') == 'Поиск') this.setProperty('value', '')
	})

	// вся лютая хуйня ниже борется с тем, что DOM модифицируется и элементы уезжают вниз
	// пока мы вкрутим эту залупу, если не попрет - перепишем на mutation observer
	var iTimer = 0;
	var adtDesignFunction = null;
	Object.defineProperty(window, 'adt_design',
	{
		set: function(value)
		{
			adtDesignFunction = value;
		},

		get: function()
		{
			if (iTimer) clearTimeout(iTimer);
			iTimer = setTimeout(function()
			{
				iTimer = 0;

				var node = jQuery('#listalka');
				var bHas = node.hasClass('sticky');
				if (bHas) node.removeClass('sticky');
				node.data('offset', node.offset());
				//if (bHas) node.addClass('sticky');

			}, 10);
			return adtDesignFunction;
		}
	});
});

;
(function($)
{
	$(document).ready(function($)
	{
		$('body').on('click', '.blog_calendar', function()
		{
			if ($('.blog_dates').length)
			{
				$('.blog_dates').toggleClass('show');
			}
		});

		$('.input-daterange').datepicker({

			'toDisplay': 'dd.mm.yy',
			'toValue' : 'yyyy-mm-dd'

		}).on('hide', function(e) {e.preventDefault();});

		$('#my_blog_interval_form').on('submit', function(e)
		{
			e.preventDefault();

			var path = $('#my_blog_interval_form').attr('action');
				path += ($('#date_from').val()) ? $('#date_from').datepicker('getFormattedDate', 'yyyy-mm-dd') : '-';
				path += '/';

			if ($('#date_to').val())
			{
				path+= $('#date_to').datepicker('getFormattedDate', 'yyyy-mm-dd');
				path += '/';
			}

			location.replace(path);
			return false;
		});


		$('.place-btn').jBox('Tooltip', {
			maxWidth: '300px'
		});

	});

})(jQuery);
jQuery(document).ready(function($)
{

	// уменьшение картинок в пределы окна
	$('[data-type="article"]').each(function(i, el)
	{
		var aId = $(el).data('id');
		$(el).find('a.imgpreview').attr('data-jbox-image', 'gallery_article_' + aId);
	});

	$('[data-type="comment"]').each(function(i, el)
	{
		var cId = $(el).data('id');
		$(el).find('a.imgpreview').attr('data-jbox-image', 'gallery_comment_' + cId);
	});	


	$('.topic').each(function(i, el)
	{
		var tId = $(el).attr('tid');
		$(el).find('a.imgpreview').attr('data-jbox-image', 'gallery_topic_' + tId);
	});

	$('.comment').each(function(i, el)
	{
		var cId = $(el).attr('id');
		if (typeof(cId) !== 'undefined')
		{
			var m = cId.match(/^comment_id_(\d+)$/);
			if (m !== null)
			{
				cId = m[1];
				$(el).find('a.imgpreview').attr('data-jbox-image', 'gallery_comment_' + cId);
			}
		}
	});	


	if (!('jbi' in window))
	{
		var widthOffset = 18+40;
		var heightOffset = 55+40;

		window.jbi = new jBox('Image');
		$(window).on('resize', function(e)
		{
			var jbiWidth = window.innerWidth - widthOffset;
			var jbiHeight = (window.innerWidth - widthOffset) / 1.5;
			if (jbiHeight > window.innerHeight)
			{
				jbiHeight = window.innerHeight - heightOffset;
				jbiWidth = jbiHeight * 1.5;
			}
			window.jbi.setWidth(jbiWidth);
			window.jbi.setHeight(jbiHeight);
		});
		$(window).trigger('resize');
	}

});
(function($)
{
	$(document).ready(function($)
	{
		$('body').on('click', '.chat_more__btn', function(e)
		{
			e.preventDefault();

			var nBtn = $(this);
			if (nBtn.next('.chat_more__overlay').length)
			{
				nBtn.find('~ .chat_more__overlay').show();
				nBtn.find('~ .chat_more__list').fadeIn('fast');
				nBtn.addClass('menu_active');

				return;
			}
			
			var sTargetType = null;
			var iTargetId = null;

			if (nBtn.parents('.topic[tid]').length)
			{
				sTargetType = 'topic';
				iTargetId = nBtn.parents('.topic[tid]').attr('tid');
			
			} else if (nBtn.parents('.comment[cid]').length)
			{
				sTargetType = 'comment';
				iTargetId = nBtn.parents('.comment[cid]').attr('cid');
			}

			if (iTargetId !== null)
			{
				var data = {target_id: iTargetId, security_ls_key: LIVESTREET_SECURITY_KEY}; 
				if ((sTargetType == 'comment') && ((typeof(lsCmtTree) !== 'undefined') && ('IsChat' in lsCmtTree))) data['chat'] = 1;

				$.ajax({

					url: aRouter['topic'] + 'ajax_' + sTargetType + '_menu/',
					type: 'POST',
					data: data
				}).then(function(result)
				{
					if (!result.bStateError)
					{
						nBtn.data('loaded', true);
						nBtn.after($(result.sHtml));
						nBtn.find('~ .chat_more__overlay').show();
						nBtn.find('~ .chat_more__list').fadeIn('fast');
						nBtn.addClass('menu_active');
					} else
					{
						msgErrorBox.alert(result.sMsgTitle, result.sMsg);
					}
				});
			}
		}).on('click', '.chat_more__item a.blacklist', function(e)
		{
			var data = {idUser: $(this).attr('user'), action: 'ban', security_ls_key: LIVESTREET_SECURITY_KEY};
			var url = '/blacklist/ajax/';
			
			$.ajax({

				url: url + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
				type: 'POST',
				data: data
			}).then(function(result)
			{
				try
				{
					result = JSON.parse(result);
				} catch (e)
				{
					msgErrorBox.alert('Внимание!', 'Неизвестная ошибка');
					return;
				}

				if (result.js.bStateError)
				{
					return msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
				} else
				{
					if (result.js.sMsg) msgNoticeBox.alert(result.js.sMsgTitle, result.js.sMsg);
				}
			});
			
		}).on('click', '.chat_more__item a, .chat_more__overlay', function(e)
		{
			var nBtn = $(this).parents('.chat_more__wrapper').find('.chat_more__btn');
			nBtn.find('~ .chat_more__list').fadeOut('fast', function()
			{
				if (nBtn.data('loaded'))
				{
					$(this).remove();
					nBtn.find('~ .chat_more__overlay').remove();
					nBtn.removeClass('menu_active');
					nBtn.removeData('loaded');					
				} else
				{
					nBtn.removeClass('menu_active');
					nBtn.find('~ .chat_more__list').fadeOut('fast');
					nBtn.find('~ .chat_more__overlay').hide();
				}
			});
		});
	});

})(jQuery);								  ;
(function(a){a(document).ready(function(e){var b={};var g=0;var d=null;var c=e('<div class="Whodidit"></div>');e("body").append(c);function f(h,i){c.empty();
if(!i.data.length){c.append("Нет данных");}else{if(i.vote){c.append("<div>Лайкнули: "+i.vote.count+" чел.</div>");c.append("<div>Рейтинг: +"+i.vote.rating+"</div>");
c.append('<hr style="margin: 4px 0 2px 0" />');}e.each(i.data,function(l,k){c.append('<div class="'+((k.direction>0)?"plus":"minus")+'">'+k.name+"</div>");
});}var j=e(h).offset();c.css("left",j.left+e(h).outerWidth());c.css("top",j.top+e(h).outerHeight());c.show();}e("div.comments, div.topic, div.forum-top-buttons, .forum_cmts").on("mouseover",".total a, #vote_article_counter, a.cm_mrk",function(h){d=h.target;
if(d.parentNode.getAttribute("title")){d.parentNode.removeAttribute("title");}g=setTimeout(function(){g=0;var j=d.href.split("/");var k=j[j.length-2];if(k in b){f(d,b[k]);
}else{var l=e(d).offset();c.empty();c.append("<div>Загрузка...</div>");c.css("left",l.left+e(d).outerWidth());c.css("top",l.top+e(d).outerHeight());c.show();
var i=d;JsHttpRequest.query("POST "+i.href.replace("comment","comment_ajax").replace("topic","topic_ajax").replace("article","article_ajax")+"/?security_ls_key="+LIVESTREET_SECURITY_KEY,{},function(m,n){if(i!==d){return;
}if(m&&!m.bStateError){b[k]={data:m.data,vote:("vote" in m)?m.vote:null};f(d,b[k]);}else{c.find("div").text("Ошибка!");}});}},500);}).on("mouseout",".total a, #vote_article_counter, a.cm_mrk",function(h){d=null;
if(g){clearTimeout(g);g=0;}c.hide();});});})(jQuery);
jQuery(document).ready(function($)
{
	var vapidPublicKey = 'BNIp6VPnSvoSm96bH-tlXdCObG8EVcUzJV3yigtQ8FGb5OPX3LK6lg6S67JGugfNRxX77_qMLGiWNQYGEVCqdHk';
	var aErrors = {

		'error' : 'Ошибка',
		'notify_denied' : 'Уведомления запрещены в настройках браузера. Разрешите уведомления для сайта, чтобы получить возможность получать push-уведомления.',
		'notify_not_supported' : 'Ваш браузер не поддерживает Push-уведомления. Попробуйте установить Google Chrome.',
		'notify_subscribe_problems' : 'Не удалось подписаться на push-уведомления.',
		'notify_unsubscribe_problems' : 'Возникла ошибка в процессе отписки от push-уведомлений.',
		'token_update_error' : 'Не удалось обновить токен подписки.',
		'subscribe_status_error' : 'Не удалось обновить статус подписки.'
	};

	var aSussess = {

		'success' : 'Внимание!',
		'notify_subscribe_recovered' : 'Подписки успешно восстановлены'
	};

	function updateSubscriptionInfo(subscription, bSubscribe, bMute)
	{
		bSubscribe = (bSubscribe == undefined) ? true : bSubscribe;
		bMute = (bMute == undefined) ? false : bMute;

		return new Promise(function(resolve, reject)
		{
			var sOldEndpoint = localStorage.getItem('sEndpoint');

			var sKey = subscription.getKey ? subscription.getKey('p256dh') : '';
			sKey = sKey ? btoa(String.fromCharCode.apply(null, new Uint8Array(sKey))) : '';

			var sAuth = subscription.getKey ? subscription.getKey('auth') : '';
			sAuth = sAuth ? btoa(String.fromCharCode.apply(null, new Uint8Array(sAuth))) : '';

			var sEndpoint = subscription.endpoint;


			if ((sEndpoint !== sOldEndpoint) || !bSubscribe || !bMute)
			{
				$.ajax({
					url: '/pushes/ajax_webpush_subscribe/?JsHttpRequest=' + (new Date()).getTime() + '-xml', // ебаное гавно с JsHttpRequest
					type: 'POST',
					data: {sEndpoint: sEndpoint, sOldEndpoint: sOldEndpoint, sKey: sKey, sAuth: sAuth, bSubscribe: bSubscribe ? 1 : 0, security_ls_key: LIVESTREET_SECURITY_KEY}
				}).then(function(result)
				{
					try
					{
						result = JSON.parse(result);

					} catch (e) {result = null; }

					if (result == null)
					{
						if (!bMute) msgErrorBox.alert(aErrors['error'], aErrors['token_update_error']);
						return reject({bError: true});
					}

					if (result.js.bStateError)
					{
						msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
						return reject({bError: result.js.bStateError});
					} else
					{
						if (bSubscribe)
						{
							localStorage.setItem('sEndpoint', sEndpoint);
						} else
						{
							localStorage.removeItem('sEndpoint');
						}
						return resolve({bError: result.js.bStateError});
					}
				}).catch(function(err)
				{
					return reject({bError: true});
				});
			} else
			{
				resolve({bError: false});
			}
		});
	};

	function updateSubscriptionToTarget(targetId, targetType, targetHow, bSubscribe)
	{
		return new Promise(function(resolve, reject)
		{
			$.ajax({
				url: '/pushes/ajax_update_subscribe2target/?JsHttpRequest=' + (new Date()).getTime() + '-xml', // ебаное гавно с JsHttpRequest
				type: 'POST',
				data: {targetId: targetId, targetType: targetType, targetHow: targetHow, bSubscribe: bSubscribe ? 1 : 0, security_ls_key: LIVESTREET_SECURITY_KEY}
			}).then(function(result)
			{
				try
				{
					result = JSON.parse(result);

				} catch (e) {result = null; }

				if (result == null)
				{
					msgErrorBox.alert(aErrors['error'], aErrors['subscribe_status_error']);
					return reject({bError: true, targetId: targetId, targetType: targetType});
				}

				if (result.js.bStateError)
				{
					msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
					return reject({bError: result.js.bStateError, targetId: targetId, targetType: targetType});
				} else
				{
					msgNoticeBox.alert(result.js.sMsgTitle, result.js.sMsg);
					return resolve({bError: result.js.bStateError, targetId: targetId, targetType: targetType, bSubscribed: result.js.bSubscribed, bLastSubscription: result.js.bLastSubscription});
				}

			}).catch(function(err)
			{
				return reject({bError: true, targetId: targetId, targetType: targetType});
			});
		});
	};

	function urlBase64ToUint8Array(base64String)
	{
		var padding = '='.repeat((4 - base64String.length % 4) % 4);
		var base64 = (base64String + padding).replace(/\-/g, '+').replace(/_/g, '/');
		var rawData = window.atob(base64);
		var outputArray = new Uint8Array(rawData.length);

		for (var i = 0; i < rawData.length; ++i) {
			outputArray[i] = rawData.charCodeAt(i);
		}
		return outputArray;
	}	

	var btn = $('.push-notifies-subscribe');
	if ('serviceWorker' in navigator) navigator.serviceWorker.register('/sw.js?v1').then(function()
	{
		if (!('showNotification' in ServiceWorkerRegistration.prototype)) return;
		if (Notification.permission === 'denied') return;
		if (!('PushManager' in window)) return;

		navigator.serviceWorker.ready.then(function(serviceWorkerRegistration)
		{
			serviceWorkerRegistration.pushManager.getSubscription().then(function(subscription)
			{
				$('.push-notifies-repair').removeClass('unsupported');
				if (btn.hasClass('unsupported')) btn.removeClass('unsupported');
				if (subscription) return updateSubscriptionInfo(subscription, true, true);

				var pt = $('head').find('meta[name="push-subscribes"]');
				if (pt.length && (pt.attr('content') == 'yes'))
				{
					serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly:true, applicationServerKey: urlBase64ToUint8Array(vapidPublicKey)}).then(function(subscription)
					{
						updateSubscriptionInfo(subscription, true, true);
					});
				}

			}).catch(function(err) {}); // subscribtion catch
		});
	}).catch(function(err) {}); // registration catch

	$('body').on('click', '.push-notifies-subscribe', function(e)
	{
		var btn = $(e.target);
		
		var targetId = btn.data('target-id');
		var targetType = btn.data('target-type');
		var targetHow =  btn.data('target-how');

		if (btn.hasClass('unsupported'))
		{
			e.stopPropagation();
			msgErrorBox.alert(aErrors['error'], (Notification.permission === 'denied') ? aErrors['notify_denied'] : aErrors['notify_not_supported']);
			return false;
		}

		var bCheckbox = ((btn.get(0).nodeName == 'INPUT') && (btn.attr('type') == 'checkbox'));
		if (bCheckbox) e.preventDefault();

		var bSubscribed = (btn.hasClass('subscribed') || (bCheckbox && !btn.get(0).checked));
		if (bSubscribed)
		{
			updateSubscriptionToTarget(targetId, targetType, targetHow, false).then(function(params)
			{
				if (bCheckbox) btn.get(0).checked = false;
				btn.removeClass('subscribed');
				btn.trigger('subscribe', [params['bSubscribed']]);
			});

		} else
		{
			navigator.serviceWorker.ready.then(function(serviceWorkerRegistration)
			{
				serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly:true, applicationServerKey: urlBase64ToUint8Array(vapidPublicKey)}).then(function(subscription)
				{
					updateSubscriptionInfo(subscription).then(function(params)
					{
						updateSubscriptionToTarget(targetId, targetType, targetHow, true).then(function(params)
						{
							if (bCheckbox) btn.get(0).checked = true;
							btn.addClass('subscribed');
							btn.trigger('subscribe', [params['bSubscribed']]);
						});
					});

				}).catch(function(e)
				{
					msgErrorBox.alert(aErrors['error'], (Notification.permission === 'denied') ? aErrors['notify_denied'] : aErrors['notify_subscribe_problems']);
				});
			});
		}
	}).on('click', '.push-notifies-repair', function(e)
	{
		if (btn.hasClass('unsupported'))
		{
			e.stopPropagation();
			msgErrorBox.alert(aErrors['error'], (Notification.permission === 'denied') ? aErrors['notify_denied'] : aErrors['notify_not_supported']);
			return false;
		}
		
		navigator.serviceWorker.ready.then(function(serviceWorkerRegistration)
		{
			serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly:true, applicationServerKey: urlBase64ToUint8Array(vapidPublicKey)}).then(function(subscription)
			{
				updateSubscriptionInfo(subscription, true, false).then(function(params)
				{
					msgNoticeBox.alert(aSussess['success'], aSussess['notify_subscribe_recovered']);
				});
			});
		});

	});


});
(function($)
{
	$(document).ready(function($)
	{
		if (typeof(CURRENT_USER_ID) === 'undefined') return;
		function userNetlenkaDialog(topicId, sDestination, title)
		{
			var untDialog = new jBox('Confirm', 
			{
				id: 'user_netlenka_dialog',
				title: (sDestination == 'netlenka') ? 'Добавить в дерево блога пост:' : 'Добавить в Дерево Избранное пост',
				confirmButton: 'ОК',
				closeOnConfirm: false,
				cancelButton: 'Отмена',
				ajax:
				{
					url: '/my/' + CURRENT_USER_LOGIN + ((sDestination == 'netlenka') ? '/tree/ajax/' : '/tree/fav/ajax/'),
					data:
					{
						JsHttpRequest: (new Date()).getTime() + '-xml',
						action: 'dialog',
						topic: topicId,
						security_ls_key: LIVESTREET_SECURITY_KEY
					},
					reload: 'strict',
					setContent: false,
					success: function (response)
					{
						try
						{
							response = JSON.parse(response);
							if (response.js.bStateError) throw 'Error loading content';
							if (!('sDialogHtml' in response.js)) throw 'Error content';
							var nContent = $(response.js.sDialogHtml);
							nContent.find('#netlenka_dialog_tpl').removeAttr('id').show();
							nContent.find('#topic_title').text('"' + title + '"');
							nContent.find('#netlenka_categoryId').val(0);

							this.setContent(nContent);

					  	} catch (e)
					  	{
					  		this.setContent('<b style="color: #d33">' + e + '</b>');
					  	}
					},
					error: function ()
					{
					  this.setContent('<b style="color: #d33">Error loading content.</b>');
					}
				},

				confirm: function()
				{
					var dialog = $('#user_netlenka_dialog');
					var data = {
						action: 'new',
						type: 'record',
						source: topicId,
						destination: dialog.find('#netlenka_categoryId').val(),
						text: '',
						security_ls_key: LIVESTREET_SECURITY_KEY
					};

					JsHttpRequest.query('POST /my/' + CURRENT_USER_LOGIN + ((sDestination == 'netlenka') ? '/tree/ajax/' : '/tree/fav/ajax/') + '?security_ls_key=' + LIVESTREET_SECURITY_KEY, data, function(result, errors)
					{
						if (!result)
						{
							msgErrorBox.alert('Error', 'Please try again later');
						}

						if (result.bStateError)
						{
							msgErrorBox.alert(result.sMsgTitle, result.sMsg);
						} else
						{
							msgNoticeBox.alert(result.sMsgTitle, result.sMsg);
							untDialog.close();
						}
					}, true);
				},

				onCloseComplete: function()
				{
					this.destroy();
				},

			});
			untDialog.open();
		}

		window['user_netlenka'] = userNetlenkaDialog;

		var sFriendsTooltipHtml = '';
		new jBox('Tooltip', {
			
			attach: '#subscribe-sidebar-links',
			target: '#friends_menu_link',
			trigger: 'subscribed',
			maxWidth: '300px',
			closeButton: 'box',
			closeOnClick: 'overlay',
			position: {
				x: 'center',
				y: 'bottom'
			},
			outside: 'y',
			onOpen: function()
			{
				this.setContent(sFriendsTooltipHtml);
			}
		});		


		$('body').on('click', '#subscribe-sidebar-links', function(e)
		{
			var nBtn = $(this);
			var sLogin = $(this).attr('login');
			var bSubscribed = parseInt($(this).attr('subscribed')) ? true : false;

			if (!bSubscribed) window.fz('track', 'subscribe blog-sidebar-button');

			JsHttpRequest.query('POST /friends/ajax_user_subscribe/', {login:sLogin, subscribe: !bSubscribed, security_ls_key: LIVESTREET_SECURITY_KEY}, function(result, errors)
			{
				if (!result) return;
				if (!result.bStateError)
				{
					// обновим кеш
					nBtn.attr('subscribed', result.bSubscribeState ? 1 : 0);
					if (result.bSubscribeState)
					{
						nBtn.text('Вы подписаны');

						sFriendsTooltipHtml = result.sMsg + '<br />Посмотреть список вашей подписки вы можете в <a href="/profile/' + CURRENT_USER_LOGIN + '/">своем профиле</a>';
						nBtn.trigger('subscribed');

					} else
					{
						nBtn.text('Подписаться на блог');
					}

					msgNoticeBox.alert(result.sMsgTitle, result.sMsg);
				} else
				{
					msgErrorBox.alert(result.sMsgTitle, result.sMsg);
				}
			}, true);
		});

	});

})(jQuery);
(function($)
{
	$(document).ready(function($)
	{
		$('body').on('click', '.thisdayHide', function()
		{
			var block = $(this).parents('.topic.thisday');
			JsHttpRequest.query('POST /thisday/ajax/', {action: 'hide', security_ls_key: LIVESTREET_SECURITY_KEY}, function(result, errors)
			{
				if (!result) return;
				if (!result.bStateError)
				{
					msgNoticeBox.alert(result.sMsgTitle, result.sMsg);
					block.remove();
				} else
				{
					msgErrorBox.alert(result.sMsgTitle, result.sMsg);
				}
			}, true);
		});
	});

})(jQuery);	

;
(function(a){a(document).ready(function(c){var b=c("#topic_ban_dialog");function e(g,h){var i={"delete":"Удалить топик",offtopic:"Принять меры"};i=(h in i)?i[h]:"Что-то творим с топиком";
var f=new jBox("Confirm",{id:"topicBanDialog",title:i,confirmButton:"ОК",cancelButton:"Отмена",content:b,confirm:function(){var j=this;var q={topic_id:g,security_ls_key:LIVESTREET_SECURITY_KEY};
var r=b.find('select[name="topic_action"]');q.action=r.val();var k="nothing";var p=b.find('input[name="additional_action"]');p.each(function(t,s){if(s.checked){k=c(s).val();
}});if(k!="nothing"){var o=b.find('input[name="reason"]');o.each(function(t,s){if(s.checked){q.reason=s.value;}});var l=b.find('input[name="reason_value"]');
if(l.length){q.reason_value=l.val();}if(k=="ban"){var n=b.find('input[name="time"]');n.each(function(t,s){if(n.length>1){if(s.checked){q.time=s.value;}}else{q.time=s.value;
}});var l=b.find('input[name="time_value"]');l.each(function(t,s){if(l.length>1){if(s.checked){q.time_value=s.value;}}else{q.time_value=s.value;}});}}q.additional_action=k;
JsHttpRequest.query("POST /topic/admin/"+q.topic_id+"/?security_ls_key="+LIVESTREET_SECURITY_KEY,q,function(s,u){if(!s){msgErrorBox.alert("Error","Please try again later");
}if(s.bStateError){msgErrorBox.alert(s.sMsgTitle,s.sMsg);}else{var t=c("#content").find(".topic");if(q.action=="delete"){if(t.length>1){t.each(function(v,w){if(c(w).attr("tid")==q.topic_id){w.parentNode.removeChild(w);
}});msgNoticeBox.alert(s.sMsgTitle,s.sMsg);}else{if(document.location.href.toString()!=s.sURL){document.location.replace(s.sURL);}else{document.location.reload();
}}}else{if(["offtopic","signals","copypaste","news"].indexOf(q.action)!==-1){if(t.length>1){msgNoticeBox.alert(s.sMsgTitle,s.sMsg);}else{if(document.location.href.toString()!=s.sURL){document.location.replace(s.sURL);
}else{document.location.reload();}}}else{if(s.sMsg){msgNoticeBox.alert(s.sMsgTitle,s.sMsg);}}}}},true);},onOpen:function(){var n=b.find('select[name="topic_action"]');
if(n.find('option[value="'+h+'"]').length){n.val(h);}var l=b.find('input[name="additional_action"]');l.each(function(p,o){o.checked=false;});l[0].checked=true;
var k=b.find('input[name="reason"]');k.each(function(p,o){o.checked=false;});k[10].checked=true;var j=b.find('input[type="radio"][name="time_value"]');
if(j.length){j.each(function(p,o){o.checked=false;});j[0].checked=true;}else{var j=b.find('input[type="radio"][name="time"]');if(j.length){j.each(function(p,o){o.checked=false;
});j[0].checked=true;}}b.on("click",function(t){var o="nothing";var r=b.find('input[name="additional_action"]');r.each(function(v,u){if(u.checked){o=c(u).val();
}});var s=["radio","text"];b.find("fieldset.ban_reason input").each(function(u,v){if(s.indexOf(c(v).attr("type"))!=-1){v.disabled=(o=="nothing");}});b.find("fieldset.ban_time input").each(function(u,v){if(s.indexOf(c(v).attr("type"))!=-1){v.disabled=(o!="ban");
}});if(o!="nothing"){var q=b.find('input[name="reason"]');q.each(function(v,u){if(u.checked){var w=b.find('input[name="reason_value"]');if(w.length){w[0].disabled=(u.value!="0");
}}});if(o=="ban"){var p=b.find('input[name="time"]');p.each(function(v,u){if(u.checked){var w=b.find('input[name="time_value"]');if(w.length){w[0].disabled=(u.value!="limited");
}}});}}if((c(t.target).attr("name")=="additional_action")&&(c(t.target).val()=="warn")){b.find('fieldset.ban_reason input[value="0"]').each(function(u,v){v.checked=true;
});}});b.click();},onCloseComplete:function(){this.destroy();}});f.open();}var d=new RegExp("^/topic/(delete|offtopic)/(\\d+)/","i");c("#content").on("click","a[href]",function(f){if(m=c(this).attr("href").match(d)){f.preventDefault();
c.ajax({url:aRouter.topic+"ajax_topic_ban_dialog/",type:"POST",data:{topic_id:parseInt(m[2]),security_ls_key:LIVESTREET_SECURITY_KEY}}).then(function(g){if(!g.bStateError){if(c("#topic_ban_dialog_tpl").length){c("#topic_ban_dialog_tpl").remove();
}c("body").append(c(g.sHtml));b=c("#topic_ban_dialog");e(parseInt(m[2]),m[1]);}else{msgErrorBox.alert(g.sMsgTitle,g.sMsg);}});}});c("#content").find("a[href]").each(function(f,g){$el=c(g);
if($el.attr("href").match(d)){$el.removeAttr("onclick").attr("title","Принять меры.");}});});})(jQuery);
(function($){function fillTopicZen(iTopicId){var d=$.Deferred();var zen={};var images={};var zenDialog=new jBox("Confirm",{id:"topicZenDialog",title:"Добавление топика в ленту Yandex.ZEN",confirmButton:"ОК",cancelButton:"Отмена",content:'\t\t\t<label for="zen_title">Название в ленте:</label>\t\t\t<input type="text" name="title" id="zen_title" value="" />\t\t\t<label for="zen_description">Аннотация:</label>\t\t\t<textarea name="description" id="zen_description"></textarea>\t\t\t<div class="image">\t\t\t\t<div>\t\t\t\t\t<img src="" />\t\t\t\t</div>\t\t\t\t<label for="zen_image_upload">Загрузить:</label>\t\t\t\t<input type="file" />\t\t\t</div>\t\t\t<label class="clear"><input type="checkbox" name="ok" />отправить в ленту</label>\t\t\t',confirm:function(){var self=this;var dialog=$("#"+this.id);var data={topicId:iTopicId,security_ls_key:LIVESTREET_SECURITY_KEY};data["zen_title"]=dialog.find("#zen_title").val();data["zen_annotation"]=dialog.find("#zen_description").val();data["zen_image"]=dialog.find("img").attr("src");if(typeof data["zen_image"]=="undefined")data["zen_image"]=null;data["zen_ok"]=dialog.find("input:checkbox").is(":checked")?1:0;zen["zen_ok"]=data["zen_ok"];JsHttpRequest.query("POST /topic/ajax_fill_zen/",data,function(result,errors){if(!result){msgErrorBox.alert("Error","Please try again later")}if(result.bStateError){msgErrorBox.alert(result.sMsgTitle,result.sMsg)}else{msgNoticeBox.alert(result.sMsgTitle,result.sMsg)}},true)},onOpen:function(a){var dialog=$("#"+this.id);dialog.find("#zen_title").val("zen_title"in zen?zen.zen_title:"");dialog.find("#zen_description").val("zen_annotation"in zen?zen.zen_annotation:"");dialog.find("input:checkbox").prop("checked","zen_ok"in zen?parseInt(zen.zen_ok):false);dialog.find("img").attr("src","zen_image"in zen?zen.zen_image:images.length?images[0]:null);if("zen_image"in zen&&images.indexOf(zen.zen_image)==-1)images.push(zen.zen_image);dialog.find("img").on("click",function(e){var i=images.indexOf($(this).attr("src"));i++;if(i==images.length)i=0;$(this).attr("src",images[i])});dialog.find("input:file").on("change",function(e){if(this.files.length){var aFile=this.files[0];var formData=new FormData;formData.append("type_add","preview");formData.append("img_file",aFile);formData.append("preview_size","large");formData.append("security_ls_key",LIVESTREET_SECURITY_KEY);return $.ajax({url:"/include/ajax/uploadImg.php?JsHttpRequest="+(new Date).getTime()+"-form",type:"POST",contentType:false,processData:false,data:formData}).then(function(result){try{result=result.match(/top\.JsHttpRequestGlobal\.dataReady\((.+)\)/);if(result!=null)result=JSON.parse(result[1])}catch(e){result=null}if(result==null){msgErrorBox.alert("Ошибка","Серверу сплохело на загрузке фотографии.");return}if(result.js.bStateError){msgErrorBox.alert(result.js.sMsgTitle,result.js.sMsg)}else{var m=result.js.sText.match(/<a\s+[^\>]*?href="([^\"]+)"/i);if(m){var url=m[1];if(url[0]=="/")url=document.location.origin+url;dialog.find("img").attr("src",url);if(images.indexOf(url)==-1)images.push(url)}}})}})},onClose:function(){var dialog=$("#"+this.id);dialog.find("img").off("click")},onCloseComplete:function(){d.resolve(zen.zen_ok);this.destroy()}});JsHttpRequest.query("GET /topic/ajax_fill_zen/",{topicId:iTopicId,security_ls_key:LIVESTREET_SECURITY_KEY},function(result,errors){if(!result){msgErrorBox.alert("Error","Please try again later")}if(result.bStateError){msgErrorBox.alert(result.sMsgTitle,result.sMsg)}else{zen=result.aZen;images=result.aImages;zenDialog.open()}},true);return d}window["zen_dialog"]=fillTopicZen;$(document).ready(function($){new jBox("Tooltip",{id:"extraTagsPopover",trigger:"click",adjustDistance:{top:55,right:5,bottom:5,left:5},closeOnClick:"body",closeOnEsc:true,animation:"move",attach:$(".extraTagEditLink"),zIndex:8e3,position:{x:"center",y:"bottom"},outside:"y",onOpen:function(){var self=this;var tid=$(this.target).attr("tid");JsHttpRequest.query("GET /topic/ajax_edit_extratags/",{topicId:tid,security_ls_key:LIVESTREET_SECURITY_KEY},function(result,errors){if(!result)return;if(!result.bStateError){if("aAvailableExtraTags"in result||"aAvailableForumTags"in result){var html="";var bNeedHr=false;if("aAvailableExtraTags"in result){html+="<label>Экстра-теги для топика:</label>";for(var i in result.aAvailableExtraTags){html+='<label><input type="checkbox" name="extra_tags['+i+']" value="'+i+'" '+($.inArray(i,result.aTopicExtraTags)>=0?"checked":"")+"/>"+result.aAvailableExtraTags[i]["description"]+"</label>"}bNeedHr=true}if("bAvailableSmm"in result){if(bNeedHr)html+="<hr />";bNeedHr=true;html+='<label><input type="checkbox" name="smm" value="1" '+(parseInt(result.bAvailableSmm)?"checked":"")+"/><strong>SMM pipeline</strong></label>"}if("bAvailableNews"in result){if(bNeedHr)html+="<hr />";bNeedHr=false;html+='<label style="display: inline"><input id="publish_to_smartlabnews" type="checkbox" name="news" value="1" '+(parseInt(result.bAvailableNews)?"checked":"")+"/><strong>NEWS</strong></label>"}if("bAvailableNewsRedString"in result){if(bNeedHr)html+="<hr />";bNeedHr=!("sAvailableNewsHeader"in result);html+='<label style="display: inline; margin-left:15px;"><input type="checkbox" name="news_red_string" value="1" '+(parseInt(result.bAvailableNewsRedString)?"checked":"")+"/><strong>⚡</strong></label>"}if("sAvailableNewsHeader"in result){if(bNeedHr)html+="<hr />";let display=(parseInt(result.bAvailableNews)?"checked":"")?"block":"none";html+='<label style="display: inline; margin: 5px 0;"><input title="Опубликовать с заголовком. Чтобы вернуть заголовок поста - оставьте пустым" style="display: '+display+';" id="change_header_to_smartlabnews" autocomplete="off" type="text" name="news_title_string" value="'+result.sAvailableNewsHeader+'" /></label>'}if("aCountries"in result){if(bNeedHr)html+="<hr />";let countries_html_options="";for(country of result.aCountries){if(!country.in_moderator_list){continue}let country_name=country.moderator_alias||country.name;let selected=country.id==parseInt(result.iCountryId)?"selected":"";countries_html_options+='<option value="'+country.id+'" '+selected+">"+country_name+"</option>"}let display=(parseInt(result.bAvailableNews)?"checked":"")?"block":"none";html+='<label style="display: inline; margin: 5px 0; for="news_countries_array">'+'<select style="margin:5px 0; display: '+display+';" id="news_countries_array" name="country_id">'+countries_html_options+"</select>"+"</label>"}if("aTypes"in result){if(bNeedHr)html+="<hr />";bNeedHr=true;let types_html_options="";for(type of result.aTypes){let selected=type.id==parseInt(result.iTypeId)?"selected":"";types_html_options+='<option value="'+type.id+'" '+selected+">"+type.name+"</option>"}let display=(parseInt(result.bAvailableNews)?"checked":"")?"block":"none";html+='<label style="display: inline; margin: 5px 0; for="news_types_array">'+'<select style="margin:5px 0; display: '+display+';" id="news_types_array" name="type_id">'+types_html_options+"</select>"+"</label>"}if("bAvailableForumTags"in result&&result.bAvailableForumTags){if(bNeedHr)html+="<hr />";html+="<label>Компании для топика:</label>";if("aAvailableForumTags"in result){for(var i in result.aAvailableForumTags){html+='<label><input type="checkbox" name="forum_tags['+i+']" value="'+i+'" checked />'+result.aAvailableForumTags[i]["title"]+"</label>"}}html+='<input type="text" id="forumTagAutocomplete" />'}html+='<div style="text-align: right; margin-top:1em">';html+='<input id="extraTagEditSubmit" type="button" value="Применить"/>';html+="</div>";self.setContent(html);$("#publish_to_smartlabnews").click(function(){if($("#"+self.id).find('input:checkbox[name="news"]').is(":checked")){$("#change_header_to_smartlabnews").css("display","block");$("#news_countries_array").css("display","block");$("#news_types_array").css("display","block")}else{$("#change_header_to_smartlabnews").css("display","none");$("#news_countries_array").css("display","none");$("#news_types_array").css("display","none");$("#"+self.id).find('input:checkbox[name="news_red_string"]').prop("checked",false)}});$("#forumTagAutocomplete").autocomplete({serviceUrl:"/forum/ajax_forum_tags/",type:"POST",dataType:"json",paramName:"value",params:{json:1},preventBadQueries:false,containerClass:"autocomplete-suggestions width-auto",transformResult:function(response){return{suggestions:response}},onSelect:function(suggestion){$("#forumTagAutocomplete").before($('<label><input type="checkbox" name="forum_tags['+suggestion.data+']" value="'+suggestion.data+'" checked />'+suggestion.value+"</label>"));$("#forumTagAutocomplete").val("")}});$("#extraTagEditSubmit").on("click",function(e){var aTopicExtraTags={};$("#"+self.id).find('input:checkbox[name^="extra_tags"]').each(function(i,el){if(el.checked)aTopicExtraTags[$(el).val()]=true});var aTopicForumTags={};$("#"+self.id).find('input:checkbox[name^="forum_tags"]').each(function(i,el){if(el.checked)aTopicForumTags[$(el).val()]=true});var bSmm=$("#"+self.id).find('input:checkbox[name^="smm"]').is(":checked");var bNews=$("#"+self.id).find('input:checkbox[name="news"]').is(":checked");var bNewsRedString=$("#"+self.id).find('input:checkbox[name="news_red_string"]').is(":checked");var sAvailableNewsHeader=$("#"+self.id).find('input:text[name="news_title_string"]').val();var sNewsTypeId=$("#"+self.id).find('select[name="type_id"]').val();var sNewsCountryId=$("#"+self.id).find('select[name="country_id"]').val();var topicNode=$("#content").find('.extraTagEditLink[tid="'+tid+'"]').parents(".topic");JsHttpRequest.query("POST /topic/ajax_edit_extratags/",{topicId:tid,aTopicExtraTags:aTopicExtraTags,aTopicForumTags:aTopicForumTags,bNews:bNews,bNewsRedString:bNewsRedString,iTypeId:sNewsTypeId,iCountryId:sNewsCountryId,sAvailableNewsHeader:encodeURIComponent(sAvailableNewsHeader),bSmm:bSmm,security_ls_key:LIVESTREET_SECURITY_KEY},function(result,errors){if(!result)return;if(!result.bStateError){if("aResultTags"in result){if($.isArray(result.aResultTags)){if(topicNode.find(".admin_tags").length){topicNode.find(".admin_tags .tag, .admin_tags .no_tag").remove();topicNode.find(".admin_tags").append($('<div class="no_tag">Нет тегов</div>'))}if(topicNode.find(".tags").length)topicNode.find(".tags").empty()}else{var block=topicNode.find(".admin_tags");if(block.length){block.find(".tag").remove();block.find(".no_tag").remove();for(var i in result.aResultTags){var newTag=$('<div class="tag"><a href="/tag/'+encodeURIComponent(i)+'/"></a> | <span class="edit" title="Заменить тег в посте">ред.</span> | <span class="delete" title="Удалить тег у поста">X</span></div>');newTag.find("a").text(result.aResultTags[i]);block.append(newTag)}}else{if(topicNode.find(".tags").length){var block=topicNode.find(".tags");block.append($("<li>Ключевые слова: </li>"));var c=0;for(var i in result.aResultTags){c++}var ct=0;for(var i in result.aResultTags){ct++;var html='<li><a href="/tag/'+encodeURIComponent(i)+'/"></a>'+(c!=ct?", ":"")+"</li>";html.find("a").text(result.aResultTags[i]);block.append(html)}}}}}if("aResultExtraTags"in result){if($.isArray(result.aResultExtraTags)){topicNode.find(".ext_tags").remove()}else{var etd=topicNode.find(".ext_tags");if(etd.length){etd.empty()}else{etd=$('<ul class="ext_tags"></ul>');etd.insertBefore(topicNode.find("> hr, > .tags, > .admin_tags").first())}etd.append("<li>спецраздел: </li>");var c=0;for(var i in result.aResultExtraTags){c++}var ct=0;for(var i in result.aResultExtraTags){ct++;var html='<li><a href="'+DIR_WEB_ROOT+"/"+result.aResultExtraTags[i].url+'/">'+result.aResultExtraTags[i].description+"</a>"+(c!=ct?", ":"")+"</li>";etd.append(html)}}}if("aResultForumTags"in result){if($.isArray(result.aResultForumTags)){topicNode.find(".forum_tags").remove()}else{var etd=topicNode.find(".forum_tags");if(etd.length){etd.empty()}else{etd=$('<ul class="forum_tags"></ul>');etd.insertBefore(topicNode.find("> hr, > .tags, > .admin_tags").first())}etd.append("<li>обсудить на форуме: </li>");var c=0;for(var i in result.aResultForumTags){c++}var ct=0;for(var i in result.aResultForumTags){ct++;var html='<li><a href="'+result.aResultForumTags[i].url+'">'+result.aResultForumTags[i].title+"</a>"+(c!=ct?", ":"")+"</li>";etd.append(html)}}}msgNoticeBox.alert(result.sMsgTitle,result.sMsg)}else{msgErrorBox.alert(result.sMsgTitle,result.sMsg)}},true);self.close({ignoreDelay:true})})}}else{msgErrorBox.alert(result.sMsgTitle,result.sMsg)}},true)},onClose:function(){$("#extraTagEditSubmit").off("click")}})})})(jQuery);
(function($)
{
	function adminTagAction(topicId, action, sourceTag, destinationTag)
	{
		var d = $.Deferred();
		var data = {security_ls_key: LIVESTREET_SECURITY_KEY, topic_id: topicId, action: action, source: sourceTag};
		if (action == 'edit') data['destination'] = destinationTag;

		$.ajax({
			type: 'POST',
			url: '/topic/admin_tags/' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
			data: data
		}).then(function(result)
		{
			if (result.bStateError)
			{
				msgErrorBox.alert(result.sMsgTitle, result.sMsg);
				return d.reject(result.sMsg);
			} else
			{
				if (result.sMsg) msgNoticeBox.alert(result.sMsgTitle, result.sMsg);
			}

			d.resolve(result);
		});

		return d;
	}


	$(document).ready(function($)
	{
		$('body').on('click', '.admin_tags .add, .admin_tags .delete, .admin_tags .edit, .admin_tags .empty', function(e)
		{
			var btn = $(this);
			var topicId = btn.parents('.topic').attr('tid');
			var action = null;
			if (btn.hasClass('add'))
			{
				action = 'add';
			} else if (btn.hasClass('delete'))
			{
				action = 'delete';
			} else if (btn.hasClass('edit'))
			{
				action = 'edit';
			} else if (btn.hasClass('empty'))
			{
				action = 'empty';
			}

			var sourceTag = null;
			if ((action != 'add') && (action != 'empty')) sourceTag = btn.parents('.tag').find('a').text();


			switch (action)
			{
				case 'edit':
				{
					(new jBox('Confirm',
					{
						content: '<label>Новый тег:</label><br /><input type="text" name="tag" value="" />',
						addClass: 'adminTagEdit',
						confirmButton: 'Изменить',
						cancelButton: 'Отмена',
						confirm: function()
						{
							destinationTag = $('.adminTagEdit').find('input[name="tag"]').val();

							adminTagAction(topicId, action, sourceTag, destinationTag).then(function(result)
							{
								if ('bUpdated' in result)
								{
									btn.parents('.tag').find('a').attr('href', '/tag/' + encodeURIComponent(destinationTag) + '/').text(destinationTag);
								}
							});
						},
						cancel: function(){},
						onOpen: function()
						{
							destinationTag = $('.adminTagEdit').find('input[name="tag"]').val(sourceTag);

							$('.adminTagEdit').find('input[name="tag"]').autocomplete({
								serviceUrl: DIR_WEB_ROOT+'/include/ajax/tagAutocompleter.php?security_ls_key='+LIVESTREET_SECURITY_KEY,
								type: 'POST',
								dataType: 'json',
								paramName: 'value',
								params: {'json': 1},
								preventBadQueries: false,
								zIndex: 99999,
								

								transformResult: function(response)
								{
									return { suggestions: response['results'] };
								}
							});
						},
						onCloseComplete: function()
						{
							this.destroy();
						}
					 })).open();
					break;
				}

				case 'add':
				{
					(new jBox('Confirm',
					{
						content: '<label>Новые теги:</label><br /><input type="text" name="tag" value="" />',
						addClass: 'adminTagAdd',
						confirmButton: 'Добавить',
						cancelButton: 'Отмена',
						confirm: function()
						{
							sourceTag = $('.adminTagAdd').find('input[name="tag"]').val();

							adminTagAction(topicId, action, sourceTag).then(function(result)
							{
								if ('bAdded' in result)
								{
									var block = btn.parents('.admin_tags');
									block.find('.no_tag').remove();
									var aTags = sourceTag.split(',');

									for (var i = 0, j = aTags.length; i<j; i++)
									{
										var sTag = $.trim(aTags[i]);
										if (sTag)
										{
											var bNeeded = true;
											block.find('.tag a').each(function(i,v)
											{
												if ($(v).text().toLowerCase() == sTag.toLowerCase())
												{
													bNeeded = false;
													return false;
												}
											});

											if (bNeeded)
											{
												var newTag = $('<div class="tag"><a href="/tag/' + encodeURIComponent(sTag) + '/"></a> | <span class="edit" title="Заменить тег в посте">ред.</span> | <span class="delete" title="Удалить тег у поста">X</span></div>');
												newTag.find('a').text(sTag);
												block.append(newTag);
											}
										}
									}
								}
							});
						},
						cancel: function(){},
						onOpen: function()
						{
							$('.adminTagAdd').find('input[name="tag"]').autocomplete({
								serviceUrl: DIR_WEB_ROOT+'/include/ajax/tagAutocompleter.php?security_ls_key='+LIVESTREET_SECURITY_KEY,
								type: 'POST',
								dataType: 'json',
								paramName: 'value',
								params: {'json': 1},
								preventBadQueries: false,
								zIndex: 99999,
								delimiter: ',',

								transformResult: function(response)
								{
									return { suggestions: response['results'] };
								},

								onSelect: function (suggestion)
								{
									if ($(this).val()) $(this).val($(this).val() + ',');
								}		
							});
						},

						onCloseComplete: function()
						{
							this.destroy();
						}
					 })).open();
					break;
				}

				case 'delete':
				{
					adminTagAction(topicId, action, sourceTag).then(function()
					{
						var block = btn.parents('.admin_tags');
						btn.parents('.tag').remove();

						if (!block.find('.tag').length) block.append($('<div class="no_tag">Нет тегов</div>'));
					});
					break;
				}

				case 'empty':
				{
					(new jBox('Confirm',
					{
						content: 'Удалить все теги у поста?',
						addClass: 'adminTagDelete',
						confirmButton: 'Удалить',
						cancelButton: 'Отмена',
						confirm: function()
						{
							adminTagAction(topicId, action, sourceTag).then(function()
							{
								var block = btn.parents('.admin_tags');
								block.find('.tag, .no_tag').remove();
								block.append($('<div class="no_tag">Нет тегов</div>'));
							});
						},
						cancel: function(){},
						onCloseComplete: function()
						{
							this.destroy();
						}
					 })).open();
					break;
				}
			}
		});
	});

})(jQuery);
(function($)
{
	$(document).ready(function($)
	{
		$('#content .text > blockquote').each(function()
		{
			$(this).has('blockquote').addClass('bq_many');
			$(this).has('blockquote').children('blockquote').hide();
		});

		$('#content .text blockquote.bq_many').click(function()
		{
			$(this).children('blockquote').toggle();
			$(this).children('blockquote').toggleClass('bq_many_collapsed');
		});

	});

})(jQuery);
jQuery(document).ready(function($)
{
	$('#all_date').datepicker().on('hide', function(e)
	{
		e.preventDefault();

	}).on('changeDate', function(e)
	{
		if (('date' in e) && (e.format(0, 'yyyy-mm-dd')))
		{
			location.replace($(this).attr('route') + 'date/' + e.format(0, 'yyyy-mm-dd') + '/');
		} else
		{
			location.replace($(this).attr('route'));
		}
	});

	$('.refres_btn').on('click', function(e)
	{
		var button = $(this);
		button.toggleClass('enabled');

		var data = {};

		if (typeof(CURRENT_USER_ID) != 'undefined')
		{
			data['security_ls_key'] = LIVESTREET_SECURITY_KEY;
			data[button.attr('field')] = button.hasClass('enabled') ? 1 : 0;
		} else
		{
			// Гость
			if (localStorage) localStorage.setItem(button.attr('field'), button.hasClass('enabled') ? 1 : 0);
			return button.trigger('update');
		}

		$.ajax({

			url: '/settings/some_settings_ajax/' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
			type: 'POST',
			data: data

		}).then(function(result)
		{
			try
			{
				result = JSON.parse(result);
				if (result.js.bStateError)
				{
					msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
					return;
				} else
				{
					if ((button.attr('field') in result.js) && parseInt(result.js[button.attr('field')]))
					{
						button.addClass('enabled');
					} else
					{
						button.removeClass('enabled');
					}
					button.trigger('update');
				}
			} catch (e) {}
		});

	}).on('update', function(e)
	{
		var button = $(this);

		if ((typeof(CURRENT_USER_ID) == 'undefined') && localStorage)
		{
			if (parseInt(localStorage.getItem(button.attr('field'))))
			{
				button.addClass('enabled');
			} else
			{
				button.removeClass('enabled');
			}
		}

		if (button.data('timer'))
		{
			clearTimeout(button.data('timer'));
			button.removeData('timer');
		}

		if (button.hasClass('enabled'))
		{
			button.data('timer', setTimeout(function()
			{
				document.location.reload(true);

			}, 60000));
		}

	}).trigger('update');


	$('#disclosure-filters').on('click', 'span', function()
	{
		$(this).toggleClass('selected');
		
		var e = '';
		$(this).parents('.disclosureFilters').find('>.selected[act_code]').each(function(i,n)
		{
			if (e !='') e+='&';
			e+= encodeURIComponent('act_code[]') + '=' + encodeURIComponent($(n).attr('act_code'));
		});

		var h = document.location.href.toString().replace(/\/page\d+/, '').replace(/\?.*/, '');
		if (e) h += '?' + e;

		location.replace(h);
	});

	$('#allblog-filters').on('click', 'span', function()
	{
		$(this).toggleClass('selected');
		
		var e = '';
		$(this).parents('.disclosureFilters').find('>.selected[extra_id]').each(function(i,n)
		{
			if (e !='') e+='&';
			e+= encodeURIComponent('extra[]') + '=' + encodeURIComponent($(n).attr('extra_id'));
		});

		var h = document.location.href.toString().replace(/\/page\d+/, '').replace(/\?.*/, '');
		if (e) h += '?' + e;

		location.replace(h);
	});

});
var ls = ls || {};
ls.plugin = ls.plugin || {};

ls.plugin.autoopenid =( function ($) {

	var that=this;

	this.goServiceLogin = function(service)
	{
		var sBackUrl = window.location.href;

		$.each(document.cookie.split(';'), function(i, el)
		{
			var aCookie = $.trim(el).split('=');
			if (aCookie[0] == 'openidreferal')
			{
				sBackUrl = decodeURIComponent(aCookie[1]);
				return false;
			}
		});

		var data = { service: service, referal: sBackUrl};
		if (window.LIVESTREET_SECURITY_KEY) data['security_ls_key'] = LIVESTREET_SECURITY_KEY;

		$.ajax({

			url: DIR_WEB_ROOT + '/login/autoopenid/login-oauth' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
			type: 'POST',
			data: data

		}).then(function(result)
		{
			try
			{
				result = JSON.parse(result);
				if (!result.js.bStateError)
				{
					window.location.href=result.js.sUrl;

				} else
				{
					msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
				}

			} catch (e) {

				msgErrorBox.alert(null, 'Вход через '+service+' временно не работает.');
			}
		});
	};

	this.removeService = function(type,id)
	{
		var data = { type: type, id: id };
		if (window.LIVESTREET_SECURITY_KEY) data['security_ls_key'] = LIVESTREET_SECURITY_KEY;

 		
		$.ajax({

			url: DIR_WEB_ROOT + '/login/autoopenid/service-remove' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
			type: 'POST',
			data: data

		}).then(function(result)
		{
			try
			{
				result = JSON.parse(result);
				if (!result.js.bStateError)
				{
					$('#autoopenid-service-connect-item-'+res.id).remove();

				} else
				{
					msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
				}

			} catch (e) {

				msgErrorBox.alert(null, 'Вход через '+service+' временно не работает.');
			}
		});
	};

	this.showFormData = function() {
		$('#aoid-form-mail').hide();
		$('#aoid-form-data').show();
		$('#aoid-toggle-data').addClass('active');
		$('#aoid-toggle-mail').removeClass('active');
	};

	this.showFormMail = function() {
		$('#aoid-form-mail').show();
		$('#aoid-form-data').hide();
		$('#aoid-toggle-data').removeClass('active');
		$('#aoid-toggle-mail').addClass('active');
	};

	this.toggleFieldMail = function() {
		$('#aoid-field-mail').toggle();
	};

	$(function()
	{
		$(document).on('click', '.js-autoopenid-auth', function (e)
		{
			that.goServiceLogin($(this).data('service'));
			return false;
		});
		$(document).on('click', '.js-autoopenid-remove', function (e)
		{
			that.removeService($(this).data('serviceType'),$(this).attr('data-service-id'));
			return false;
		});
	}.bind(this));

	return this;

}).call(ls.plugin.autoopenid || {},jQuery);
jQuery(document).ready(function($)
{
	function hideProfileDropdown()
	{
		$('body').off('click', hideProfileDropdown);
		$('.profile .drop-menu-main').removeClass('dropped');
		$('.profile .drop-menu-main-sub').removeClass('showing');
	}

	$('.profile .drop-menu-main').on('click', function(e)
	{
		var bShowing = $('.profile .drop-menu-main-sub').hasClass('showing');

		$('.profile .drop-menu-main').toggleClass('dropped');
		$('.profile .drop-menu-main-sub').toggleClass('showing');

		if (!bShowing)
		{
			setTimeout(function()
			{
				// чтобы клик прошел в другие хендлеры, но не попал сразу
				$('body').on('click', hideProfileDropdown);

			}, 1);
		} else
		{
			$('body').off('click', hideProfileDropdown);
		}
	});


	function setGlobalCounter(iCounter)
	{
		$('#notifies_link').find('.notify_round').text(iCounter);
		if (iCounter)
		{
			$('#notifies_link').removeClass('empty');
		} else
		{
			$('#notifies_link').addClass('empty');
		}
	};


	function clearTabCounter(sTab)
	{
		var d = $.Deferred();

		$.ajax({
			url: '/profile/ajaxnotifiesclear/',
			type: 'POST',
			data: {security_ls_key: LIVESTREET_SECURITY_KEY, tabs: [sTab]}
		}).then(function(response)
		{
			if (!response.bStateError)
			{
				d.resolve(response.iCounter);
			} else
			{
				d.reject(response.sMsgTitle, response.sMsg);
			}
		});

		return d;
	};	

	var nPopup = new jBox('Tooltip', 
	{
		id: 'notifiesPopover',
		trigger: 'click',
		adjustDistance: {top: 55, right: 5, bottom: 5, left: 5},
//		preventDefault: true,
//		closeOnClick: 'body',
		attach: $('#notifies_link'),
		zIndex: 12000,
		position: {
			x: 'center',
			y: 'bottom'
		},
		outside: 'y',
		pointer: 'right:20',
		clearTab: [$('#notifies_link').attr('tab') ? $('#notifies_link').attr('tab') : 'blog'],
		ajax: {
			url: '/profile/ajaxnotifies/',
			data: {
				security_ls_key: LIVESTREET_SECURITY_KEY,
				tab: $('#notifies_link').attr('tab') ? $('#notifies_link').attr('tab') : 'blog'
			},
			reload: 'strict',
			setContent: false,
			success: function(response)
			{
				if (response.bStateError)
				{
					this.close();
					return msgErrorBox.alert(response.sMsgTitle, response.sMsg);
				}
				this.setContent(response.sHtml);
				
				var nTab = this.content.find('.notify_tab.notify_tab__active');
				if (nTab.length && nTab.find('.notify_count > span').text() != '0')
				{
					var sTab = nTab.attr('tab');

					clearTabCounter(sTab).then(function(iCounter)
					{
						nPopup.options.globalCounter = iCounter;
					});
				} else
				{
					nPopup.options.globalCounter = parseInt($('#notifies_link > .notify_round').text());
				}
			},
			error: function()
			{
				msgErrorBox.alert('Ошибка', 'Неизвестная ошибка!');
				this.close();
			}
		},

		onOpen: function()
		{
			var nContent = this.content;
			
			nContent.on('click', '.notify_tab', function()
			{
				var nTab = $(this);
				var sTab = nTab.attr('tab');

				var nTabs = nContent.find('.notify_tabs');
				if (nTabs.length)
				{
					var nActiveTab = nTabs.find('.notify_tab.notify_tab__active');
					if (nActiveTab.attr('tab') === nTab.attr('tab')) return;

					nActiveTab.removeClass('notify_tab__active').addClass('empty');
					setGlobalCounter(nPopup.options.globalCounter);

					nTab.addClass('notify_tab__active');
					nContent.find('.notify_content').hide();
					nContent.find('.notify_content[id="' + sTab + '"]').show();

					clearTabCounter(sTab).then(function(iCounter)
					{
						nPopup.options.globalCounter = iCounter;
					});
				}
			}).on('click', '.reply_section', function()
			{
				var sLink = $(this).attr('link');
				if (sLink)
				{
					nPopup.close();
					document.location.href = sLink;
				}
			}).on('click', 'a', function()
			{
				nPopup.close();
			});
		},

		onClose: function()
		{
			var nTab = this.content.find('.notify_tab.notify_tab__active');
			if (nTab.length)
			{
				clearTabCounter('all').then(function(iCounter)
				{
					nPopup.options.globalCounter = iCounter;
					setGlobalCounter(iCounter);
				});
			}
			this.content.off('click');
		}
	});

	// кастыль глюкала
	$('body').on('click', function(e)
	{
		if ($(e.target).parents('#notifies_link').length) return;
		if ($(e.target).parents('#notifiesPopover').length) return;
		if (nPopup.isOpen) nPopup.close();
	});
});
(function ($) {

	function switchTheme(sTheme)
	{
		$('head').find('link[rel="stylesheet"]').filter(function($i)
		{
			return ($(this).attr('href').match(/^\/templates\/skin\/smart-lab-x3\/themes\//i) !== null);
		
		}).remove();

		if (sTheme != 'black') $('<link/>').attr({'rel':'stylesheet', 'type' : 'text/css', 'href' : '/templates/skin/smart-lab-x3/themes/' + sTheme + '.css'}).appendTo($('head'));
	}


	if (typeof(CURRENT_USER_ID) == 'undefined')
	{
		var sTheme = 'black';
		if ((typeof(localStorage) !== 'undefined') && (localStorage.getItem('sCurrentTheme') !== null)) sTheme = (['black', 'fullblack', 'white'].indexOf(localStorage.getItem('sCurrentTheme')) != -1) ? localStorage.getItem('sCurrentTheme') : 'black';
		switchTheme(sTheme);
	}

	jQuery(document).ready(function($)
	{
		$(document).on('click', '.toggle_fz', function(event)
		{
			event.preventDefault();
			var bActive = !$('body').hasClass('large_font') ? 1 : 0;

			if (typeof(CURRENT_USER_ID) != 'undefined')
			{
				var data = {security_ls_key: LIVESTREET_SECURITY_KEY, bPostsLargeFont: bActive};
				$.ajax({

					url: '/settings/some_settings_ajax/' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
					type: 'POST',
					data: data

				}).then(function(result)
				{
					try
					{
						result = JSON.parse(result);
						if (result.js.bStateError)
						{
							msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
							return;
						} else
						{
							if (('bPostsLargeFont' in result.js) && parseInt(result.js['bPostsLargeFont']))
							{
								$('body').addClass('large_font');
							} else
							{
								$('body').removeClass('large_font');
							}
						}
					} catch (e) {}
				});

			} else
			{
				// Гость
				if (typeof(localStorage) != 'undefined') localStorage.setItem('bPostsLargeFont', bActive);
				if (bActive)
				{
					$('body').addClass('large_font');
				} else
				{
					$('body').removeClass('large_font');
				}
			}
			return false;
		});

		if (typeof(CURRENT_USER_ID) == 'undefined')
		{
			var bActive = true;
			if ((typeof(localStorage) !== 'undefined') && (localStorage.getItem('bPostsLargeFont') !== null)) bActive = parseInt(localStorage.getItem('bPostsLargeFont')) ? true : false;

			if (bActive)
			{
				$('body').addClass('large_font');
			} else
			{
				$('body').removeClass('large_font');
			}
		}

		$(document).on('click', '.theme_switch_btn a', function(e)
		{
			e.preventDefault();

			var sTheme = $(this).attr('theme');
			if (typeof(CURRENT_USER_ID) != 'undefined')
			{
				document.location.href = '/settings/theme/' + sTheme + '/';

			} else
			{
				// Гость
				if (typeof(localStorage) != 'undefined') localStorage.setItem('sCurrentTheme', sTheme);
				switchTheme(sTheme);
			}
			return false;
		});		
	});


})(jQuery);
;

						jQuery(document).ready(function($)
						{
							// $('.flistlink').on('click', function(e)
							// {
							// 	var t = $(e.target);
							// 	var url =  '/profile/ajax' + t.attr('type') + 'list/';
							// 	var login = t.attr('user');

							// 	var c =	t.parents('tr').next('tr').find('.friends_w');
							// 	$.get(url, {'JsHttpRequest' : (new Date()).getTime(), 'login': login}, function(result, errors)
							// 	{
							// 		var res = result.match(/^JsHttpRequest\.dataReady\((.+)\)/);
							// 		if (res != null) res = JSON.parse(res[1]);

							// 		if (!res.js)
							// 		{
							// 			msgErrorBox.alert('Error','Please try again later');
							// 		}
							// 		if (res.js.bStateError)
							// 		{
							// 			msgErrorBox.alert(res.js.sMsgTitle,res.js.sMsg);
							// 		} else
							// 		{
							// 			c.empty();
							// 			$.each(res.js.aUsersList, function(i,a)
							// 			{
							// 				$('<a></a>').attr('href', '/profile/' + a.user_login + '/').text(a.user_profile_name).appendTo(c);
							// 			});

							// 			c.show();
							// 		}
							// 	});
							// 	t.remove();

							// });

							$('#plus100link').on('click', function(e)
							{
								var sLogin = $(e.target).attr('login');
								$.post('/profile/ajaxplus100/?JsHttpRequest=' + (new Date()).getTime() + '-xml', {'sLogin': sLogin, security_ls_key: LIVESTREET_SECURITY_KEY}, function(result)
								{
									try
									{
										result = JSON.parse(result);
									} catch (e)
									{
										return msgErrorBox.alert('Error', 'Please try again later');
									}
									if (!result) msgErrorBox.alert('Error', 'Please try again later');
									if (!result.js.bStateError)
									{
										$('#rating_span').text(result.js.sNewRating);
										msgNoticeBox.alert(result.js.sMsgTitle, result.js.sMsg);
									} else
									{
										msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
									}
								});
							});

							$('#allowPostNowlink').on('click', function(e)
							{
								var sLogin = $(e.target).attr('login');
								$.post('/profile/ajaxallownewbie/?JsHttpRequest=' + (new Date()).getTime() + '-xml', {'sLogin': sLogin, security_ls_key: LIVESTREET_SECURITY_KEY}, function(result)
								{
									try
									{
										result = JSON.parse(result);
									} catch (e)
									{
										return msgErrorBox.alert('Error', 'Please try again later');
									}
									if (!result) msgErrorBox.alert('Error', 'Please try again later');
									if (!result.js.bStateError)
									{
										msgNoticeBox.alert(result.js.sMsgTitle, result.js.sMsg);
									} else
									{
										msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
									}
								});
							});							

							$('#books_help_link').jBox('Tooltip', {
								position: {
									x: 'right',
									y: 'bottom'
								},
								width: '300px'
							});

							$('.detail_status .item, .user_status a, .reputation_item').jBox('Tooltip', {
								width: '300px'
							});
						});	
;
(function(b){var c='<div class="profile_popup bg"><img src="#"><div>	<div class="profile_avatar">		<a href="#" title="Посмотреть профиль пользователя">			<img src="{$DIR_STATIC_SKIN}/images/avatar_100x100.jpg" />		</a>	</div>	<div class="profile_info">		<div><a id="user_link" href="#" title="Посмотреть профиль пользователя">Фамилия Имя</a></div>		<div><span id="user_work">Работаю работником на работе большой большой текст не помещается на 2 строки</span></div>		<div><a id="user_city" href="#">Город</a></div>		<div class="profile_rating">			<div><a href="#" id="blog_link">Читать блог</a><span class="bsp">&nbsp</span><a href="#" id="forum_link">Читать форум</a></div>			<div>Подписчиков: <span id="user_subscribers">8888</span>, друзей: <span id="user_friends">55555</span></div>			<div>Рейтинг: <span id="user_rating">+881188</span>, сила: <span id="user_skill">55555323</span></div>			<div>Зарегистрирован: <span id="user_registred">22.22.2222</span></div>		</div>		<div class="profile_more">			<a><img src="/plugins/smartusers/templates/skin/default/img/more_vert-24px.svg" alt=""></a>			<div class="profile_more_menu">				<ul>					<li class="blacklist"><a>В черный список</a></li>				</ul>			</div>		</div>	</div>	<div class="profile_panel">		<div class="profile_panel__wrapper">			<div>				<input id="user_friend_btn" type="button" value="Дружить">				<svg class="user_add" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="20"><path d="M0 0h24v24H0z" fill="none"></path><path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path></svg>				<input id="user_subscribe_btn" type="button" value="Подписаться">			</div>			<div>				<button id="user_pm_btn" title="Отправить ЛС">					<svg xmlns="http://www.w3.org/2000/svg" height="18" viewBox="0 0 24 24" width="24"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg>				</button>			</div>		</div>	</div></div></div>';
function a(f){var d=b(c);if(f.background){d.find("> img").attr("src",f.background);d.addClass("bg");}else{d.find("> img").remove();d.removeClass("bg");
}d.find(".profile_avatar img").attr("src",f.avatar?f.avatar:DIR_STATIC_SKIN+"/images/avatar_100x100.jpg");d.find(".profile_avatar a").attr("href",f.profile);
d.find("#user_link").attr("href",f.profile).text(f.name);if(f.work){d.find("#user_work").text(f.work);}else{d.find("#user_work").parent("div").remove();
}if(f.city){d.find("#user_city").text(f.city).attr("href",aRouter.people+"city/"+f.city+"/");}else{d.find("#user_city").parent("div").remove();}d.find("#user_subscribers").text(f.readers);
d.find("#user_friends").text(f.friends);d.find("#user_rating").text(Math.round(f.rating));d.find("#user_skill").text(Math.round(f.skill));d.find("#user_registred").text(f.registred);
d.find("#blog_link").attr("href",f.blog_url);d.find("#forum_link").attr("href",f.forum_url);if(f.is_subscribed){d.find("#user_subscribe_btn").addClass("active").val("Отписаться");
}var e=d.find("#user_friend_btn");if((f.friendship==1)&&(f.is_friend)){f.friendship=2;}switch(f.friendship){case 1:e.addClass("active").val("Заявка подана").attr("disabled",true);
break;case 2:e.addClass("active").val("Удалить из друзей");break;default:case 4:case 8:case 16:e.removeClass("active").val("Дружить");break;}return d;}b(document).ready(function(){if(typeof(CURRENT_USER_ID)=="undefined"){return false;
}var g={};c=c.replace("{$DIR_STATIC_SKIN}",DIR_STATIC_SKIN);var f=new RegExp("^/profile/([^\\/]+)/$","i");var d=new jBox("Tooltip",{id:"profilePopover",trigger:"mouseenter",adjustDistance:{top:55,right:5,bottom:5,left:5},delayOpen:500,closeOnMouseleave:true,animation:"move",attach:b('a[href^="/profile/"]').filter(function(h){if(this.hasAttribute("href")){return((b(this).attr("href").match(f)!==null)&&(!b(this).parents(".drop-menu-main-sub").length));
}return false;}),zIndex:25000,position:{x:"center",y:"bottom"},outside:"y",onOpen:function(){var i=this;var h=null;if(m=b(this.target).attr("href").match(f)){h=m[1];
}if(b(this.target).find("img").length){this.target=b(this.target).find("img");}var j=function(k){this.setContent(a(k));b("#user_pm_btn").on("click",function(){if(window.mailto_func&&(typeof(window.mailto_func)=="function")){window.mailto_func(h);
}else{window.open("/talk/add/?talk_users="+encodeURIComponent(h),"_blank");}i.close({ignoreDelay:true});});b("#user_subscribe_btn").on("click",function(){if(!g[h]["is_subscribed"]){window.fz("track","subscribe mini-window-read");
}JsHttpRequest.query("POST /friends/ajax_user_subscribe/",{login:h,subscribe:!(g[h]["is_subscribed"]),security_ls_key:LIVESTREET_SECURITY_KEY},function(n,p){if(!n){return;
}if(!n.bStateError){if(h in g){g[h]["is_subscribed"]=n.bSubscribeState;}var o=b("#user_subscribe_btn");if(n.bSubscribeState){o.addClass("active").val("Отписаться");
}else{o.removeClass("active").val("Подписаться");}msgNoticeBox.alert(n.sMsgTitle,n.sMsg);}else{msgErrorBox.alert(n.sMsgTitle,n.sMsg);}},true);});b("#user_friend_btn").on("click",function(){switch(g[h].friendship){case 1:case 2:JsHttpRequest.query("POST /profile/ajaxfrienddelete/",{idUser:g[h]["id"],sAction:"del",security_ls_key:LIVESTREET_SECURITY_KEY},function(n,p){if(!n){msgErrorBox.alert("Error","Please try again later");
}if(n.bStateError){msgErrorBox.alert(n.sMsgTitle,n.sMsg);}else{msgNoticeBox.alert(n.sMsgTitle,n.sMsg);var o=b("#user_friend_btn");o.removeClass("active").val("Добавить в друзья");
g[h].friendship=4;g[h].is_friend=false;}},true);break;default:case 4:case 8:case 16:window.fz("track","subscribe mini-window-addfriend");JsHttpRequest.query("POST /profile/ajaxfriendadd/",{idUser:g[h]["id"],userText:"",security_ls_key:LIVESTREET_SECURITY_KEY},function(n,p){if(!n){msgErrorBox.alert("Error","Please try again later");
}if(n.bStateError){msgErrorBox.alert(n.sMsgTitle,n.sMsg);}else{msgNoticeBox.alert(n.sMsgTitle,n.sMsg);var o=b("#user_friend_btn");if(g[h].friendship==0){o.addClass("active").val("Заявка подана").attr("disabled",true);
g[h].friendship=1;g[h].is_friend=false;}else{o.addClass("active").val("Удалить из друзей");g[h].friendship=2;g[h].is_friend=true;}}},true);break;}});if("ban" in window){var l=b('<li class="ban"><a>Наказать</a></li>');
if("is_banned" in k){l.attr("title",k.is_banned).addClass("banned");}if("is_warned" in k){l.attr("title",k.is_warned).addClass("warned");}b(".profile_more_menu").find("ul").append(l);
}b(".profile_more a").on("click",function(){b(".profile_more_menu").slideToggle("fast");});b(".profile_more_menu").on("click","li",function(){var q=b(this);
if(q.hasClass("ban")){i.close();window.ban(k.login);}else{if(q.hasClass("blacklist")){i.close();var o={idUser:k.id,action:"ban",security_ls_key:LIVESTREET_SECURITY_KEY};
var p="/blacklist/ajax/";b.ajax({url:p+"?JsHttpRequest="+(new Date()).getTime()+"-xml",type:"POST",data:o}).then(function(n){try{n=JSON.parse(n);}catch(r){msgErrorBox.alert("Внимание!","Неизвестная ошибка");
return;}if(n.js.bStateError){return msgErrorBox.alert(n.js.sMsgTitle,n.js.sMsg);}else{if(n.js.sMsg){msgNoticeBox.alert(n.js.sMsgTitle,n.js.sMsg);}}setTimeout(function(){document.location.reload();
},1000);});}}});};if(!(h in g)){JsHttpRequest.query("POST /profile/ajaxprofile/",{login:h,security_ls_key:LIVESTREET_SECURITY_KEY},function(k,l){if(!k){return;
}if(!k.bStateError){k.aProfile.friendship=parseInt(k.aProfile.friendship);g[h]=k.aProfile;j.call(i,g[h]);}},true);}else{j.call(this,g[h]);}},onClose:function(){b("#user_pm_btn").off("click");
b("#user_subscribe_btn").off("click");b("#user_friend_btn").off("click");b(".profile_more a").off("click");},onCloseComplete:function(){b(".profile_popup").remove();
}});if(typeof(MutationObserver)==="function"){var e=new MutationObserver(function(i){var h=[];b.each(i,function(k,j){if(j.type=="childList"){b.each(j.addedNodes,function(o,n){var l=b(n).find("a");
h=b.merge(h,l);});}});if(h.length){h=h.filter(function(j){if(j.hasAttribute("href")&&(!b(j).parents("#profilePopover").length)){return((j.getAttribute("href").match(f)!==null)&&(!b(j).parents(".drop-menu-main-sub").length));
}return false;});if(h.length){d.attach(h);}}});e.observe(b("body").get(0),{childList:true,subtree:true});}});})(jQuery);
(function(c){c(document).ready(function(d){d("body").on("mousewheel",function(h){var f=d(h.target);if(!(f.hasClass("pm_content")||f.parents(".pm_content").length)){return;
}var g=f.hasClass("pm_content")?f.get(0):f.parents(".pm_content").get(0);var i=h.originalEvent.deltaY||h.originalEvent.detail||h.originalEvent.wheelDelta;
if(i<0&&g.scrollTop==0){h.preventDefault();}if(i>0&&g.scrollHeight-g.clientHeight-g.scrollTop<=1){h.preventDefault();}});if(!d.browser.mobile&&!window.ie&&(typeof(localStorage)!=="undefined")&&(typeof(CURRENT_USER_ID)!=="undefined")){if(!("console" in window)){window.console={log:function(){}};
}d(window).smartMessanger({apiUrl:aRouter.talk+"messanger",checkUrl:"/talks",urlAppendParams:{security_ls_key:LIVESTREET_SECURITY_KEY,version:(typeof(SMART_MESSANGER_VERSION)!=="undefined")?SMART_MESSANGER_VERSION:"2.5"},userId:CURRENT_USER_ID,sound:(typeof(SMART_MESSANGER_SOUND)!=="undefined")?SMART_MESSANGER_SOUND:false,soundPath:"/plugins/smartusers/templates/sound/bb2"});
window.mailto_func=function(e){d(window).smartMessanger("openTalkToUser",e);};}});function a(g,f){var i=this;this.options=c.extend({handle:".pm_header",flashInterval:1000,splitNewMessages:60000,scrollTimeout:1000},g);
this.users=f.users;this.thread=f.thread;this.draft=f.draft;var h={blockScroll:false,animation:"tada",draggable:"title",closeButton:true,closeOnEsc:false,title:"Новая переписка",content:'<div class="pm_content"></div><div class="pm_footer"><textarea></textarea></div>',overlay:false,onOpen:function(){this.wrapper.addClass("pm_chat");
this.titleContainer.addClass("pm_header").removeClass("jBox-title");this.title.addClass("pm_title");this.content.addClass("pm_wrapper");}};if(!("newtalk" in g)){h.animation={open:false,close:"zoomOut"};
}var d=new jBox("Modal",h);d.open();this.node=d.wrapper.get(0);this.$node=d.wrapper;this.header=this.$node.find(this.options.handle);this.content=this.$node.find(".pm_content");
this.textbox=this.$node.find(".pm_footer > textarea");try{d.open({ignoreDelay:true});this.init();}catch(j){console.log(j);}}a.prototype={init:function(){var d=this;
this.$node.on("touchend click",".jBox-closeButton",function(f){f.preventDefault();setTimeout(function(){d.sendMessage("closeTalk",d.options.talkId,true);
},500);});this.header.on("dblclick",function(f){d.$node.toggleClass("collapsed");if(!(d.$node.hasClass("collapsed"))){d.flash(false);}d.saveWindowState();
});this.textbox.on("keydown",function(g){if(g.keyCode==13){if(g.ctrlKey){var h=this.value;if(typeof this.selectionStart=="number"&&typeof this.selectionEnd=="number"){var i=this.selectionStart;
this.value=h.slice(0,i)+"\n"+h.slice(this.selectionEnd);this.selectionStart=this.selectionEnd=i+1;}else{if(document.selection&&document.selection.createRange){this.focus();
var f=document.selection.createRange();f.text="\r\n";f.collapse(false);f.select();}}}else{if(this.value){d.sendMessage("appendDraft",{talkId:d.options.talkId,draftId:"draft_"+Math.round((Math.random()*1000000)),text:this.value},true);
d.textbox.val("");}}return false;}});this.content.on("scroll",function(h){var g=h.target.scrollTop;var f=h.target.scrollTop+h.target.clientHeight;d.maxVisibleItem=0;
c("div[msgid]",d.content).each(function(j){var k=this.getAttribute("msgid");if(/^draft_/i.test(k)){return;}var i=this.offsetTop+this.parentNode.offsetTop+this.parentNode.parentNode.offsetTop;
var e=i+this.clientHeight;if((i>=g)&&(i<f)){d.maxVisibleItem=Math.max(k,d.maxVisibleItem);}else{if((e>=g)&&(e<f)){d.maxVisibleItem=Math.max(k,d.maxVisibleItem);
}else{if((i<g)&&(e>f)){d.maxVisibleItem=Math.max(k,d.maxVisibleItem);}}}});if(d.scrollTimerId){clearTimeout(d.scrollTimerId);d.scrollTimerId=0;}d.scrollTimerId=setTimeout(function(i){d.scrollTimerId=0;
if(d.thread.lastView<d.maxVisibleItem){d.sendMessage("viewThread",{talkId:d.options.talkId,messageId:d.maxVisibleItem},true);}},d.options.scrollTimeout);
});this.$node.on("mousedown",function(f){if(!c(f.target).hasClass("jBox-draggable")){d.moveWindowToForeground();}d.saveWindowState();}).on("mouseup",function(f){d.saveWindowState();
});this.loadWindowState();this.restoreMessageState();},resetup:function(d){if(this.options.talkId!=d){try{pm=c.parseJSON(localStorage["pm.talks"]);if(this.options.talkId in pm){delete pm[this.options.talkId];
}localStorage["pm.talks"]=JSON.stringify(pm);}catch(f){}this.options.talkId=d;this.saveWindowState();}},halt:function(d){if(this.scrollTimerId){clearTimeout(this.scrollTimerId);
this.scrollTimerId=0;}this.flash(false);this.textbox.off("keydown");this.textbox.get(0).disabled=true;this.textbox.val(d);this.textbox.css("color","red");
this.content.parents("div.pm_wrapper").css("opacity",0.5);},close:function(){if(this.scrollTimerId){clearTimeout(this.scrollTimerId);this.scrollTimerId=0;
}this.flash(false);this.textbox.off("keydown");delete this.textbox;this.header.off("dblclick");delete this.header;this.$node.off("mousedown touchend click");
c.removeData(this.$node,"smartMessangerWindow");var d=this.$node.data("jBox");if(d&&d.isOpen){d.close({ignoreDelay:true});}delete this.content;delete this.$node;
delete this.node;delete this.users;delete this.thread;},flash:function(d){var e=this;if(this.flashIntervalId){clearInterval(this.flashIntervalId);this.flashIntervalId=0;
}if(d){if(this.$node.hasClass("collapsed")){this.flashIntervalId=setInterval(function(){e.$node.toggleClass("hilite");},this.options.flashInterval);}}else{this.$node.removeClass("hilite");
}},collapsed:function(d){if(d!=undefined){if(d){this.$node.addClass("collapsed");}else{this.$node.removeClass("collapsed");this.flash(false);}this.saveWindowState();
}else{return this.$node.hasClass("collapsed");}},focus:function(){this.textbox.focus();},moveWindowToForeground:function(){if(this.$node.css("zIndex")<=jBox.zIndexMax){jBox.zIndexMax+=1;
this.$node.css("zIndex",jBox.zIndexMax);}},getWindowPlace:function(f){var g=this;var h=c("html").get(0).clientWidth;var e=c("html").get(0).clientHeight-this.$node.height();
c(".pm_chat").each(function(k,m){var o=c(m);var j=parseInt(o.css("left"));if(!j){return;}if(parseInt(o.css("top"))+o.height()>e){h=Math.min(h,j);}});var d=(h-this.$node.width()-4);
if(d<0){d=0;}this.$node.css("left",d+"px");this.$node.css("top",(e-2)+"px");this.$node.css("right","auto");this.$node.css("bottom","auto");this.$node.css("z-index",jBox.zIndexMax+1);
},loadWindowState:function(){var h=false;var d={};var f={};if(!("pm.talks" in localStorage)){localStorage["pm.talks"]=JSON.stringify({});}try{f=c.parseJSON(localStorage["pm.talks"]);
if(this.options.talkId in f){d=f[this.options.talkId];if(("left" in d)&&(d.left!="auto")&&("top" in d)&&(d.top!="auto")){h=true;}}}catch(g){console.log("Invalid pm.talks JSON while loading window state.");
}this.$node.removeAttr("style");if(!h){this.getWindowPlace(f);d={collapsed:false};if(parseInt(this.$node.css("left"))<0){this.$node.css("left","0px");}d.left=this.$node.css("left");
if(parseInt(this.$node.css("top"))<0){this.$node.css("top","0px");}d.top=this.$node.css("top");d["z-index"]=this.$node.css("z-index");f[this.options.talkId]=d;
localStorage["pm.talks"]=JSON.stringify(f);}else{if("z-index" in d){this.$node.css("z-index",d["z-index"]);}if("left" in d){this.$node.css("left",d.left);
}if("top" in d){this.$node.css("top",d.top);}if(("collapsed" in d)&&(d.collapsed)){this.$node.addClass("collapsed");}else{this.$node.removeClass("collapsed");
if("width" in d){this.$node.css("width",d.width);}if("height" in d){this.$node.find(".pm_content").css("height",d.height);}}}jBox.zIndexMax=Math.max(jBox.zIndexMax,d["z-index"]);
var i=c(".pm_title",this.$node);if("header" in this.thread){i.text(this.thread.header).attr("title",this.thread.title);}else{i.text(this.thread.title).attr("title",this.thread.title);
}},saveWindowState:function(){var d={};var f={};try{f=("pm.talks" in localStorage)?c.parseJSON(localStorage["pm.talks"]):{};if(this.options.talkId in f){d=f[this.options.talkId];
}}catch(g){console.log("Invalid pm.talks JSON while saving window state.");}if(parseInt(this.$node.css("left"))<0){this.$node.css("left","0px");}d.left=this.$node.css("left");
if(parseInt(this.$node.css("top"))<0){this.$node.css("top","0px");}d.top=this.$node.css("top");d["z-index"]=this.$node.css("z-index");d.collapsed=this.$node.hasClass("collapsed");
if(d.collapsed){if("width" in d){delete d.width;}if("height" in d){delete d.height;}}else{d.width=this.$node.width()+"px";d.height=this.$node.find(".pm_content").height()+"px";
}f[this.options.talkId]=d;localStorage["pm.talks"]=JSON.stringify(f);this.sendMessage("refreshWindowState",this.options.talkId);},clearWindowState:function(){try{var d=("pm.talks" in localStorage)?c.parseJSON(localStorage["pm.talks"]):{};
if(this.options.talkId in d){delete d[this.options.talkId];localStorage["pm.talks"]=JSON.stringify(d);}}catch(f){console.log("Invalid pm.talks JSON while clearing window state.");
}},scrollToMessage:function(d){this.content.scrollTo('[msgid="'+d+'"]');},restoreMessageState:function(){var f=this;this.content.empty();var h=0;if(this.thread.lastView){for(var e=0,d=this.thread.messages.length;
e<d;e++){if(this.thread.messages[e].id==this.thread.lastView){h=e-10-1;break;}}}if(h<0){h=0;}var g=this.thread.messages.slice(h);c.each(g,function(k,j){f.pushTalkMesage(j);
});c.each(this.draft,function(l,j){var k={id:j.draftId,text:j.text,uid:f.options.userId,time:j.time};f.pushTalkMesage(k);});if(this.draft.length){this.scrollToMessage(this.draft[this.draft.length-1].draftId);
}else{this.scrollToMessage(this.thread.lastView);}},formatMessageTime:function(f){var e=new Date();var d=new Date(f);var g="";if((e.getDate()==d.getDate())&&(e.getMonth()==d.getMonth())&&(e.getFullYear()==d.getFullYear())){g+=d.getHours()<10?"0"+d.getHours():d.getHours();
g+=":";g+=d.getMinutes()<10?"0"+d.getMinutes():d.getMinutes();}else{g+=d.getDate()<10?"0"+d.getDate():d.getDate();g+=".";g+=d.getMonth()<10?"0"+d.getMonth():d.getMonth();
g+=".";g+=d.getFullYear().toString().substr(2);}return g;},pushTalkMesage:function(j){if(this.content[0].querySelector('[msgid="'+j.id+'"]')){return;}var i=false;
var f=this.content[0].lastChild;if((f!=null)&&(f.getAttribute("uid")==j.uid)){var k=f.firstChild;if(k){if(k.getAttribute("class")!="msg"){k=k.nextSibling;
}var h=k.lastChild.previousSibling;if((j.time-h.getAttribute("msgtime")<this.options.splitNewMessages)){var e=c(k.lastChild);e.before(c('<div msgid="'+j.id+'" msgtime="'+j.time+'"></div>').html(j.text));
e.text(this.formatMessageTime(j.time));i=true;}}}if(!i){var g=(j.uid!=this.options.userId);var f=c('<div class="'+(g?"in":"out")+'" uid="'+j.uid+'"></div>');
if(g){if(j.uid in this.users){var d=c('<a class="nick"></a>');d.attr("href",this.users[j.uid].url);d.attr("title",this.users[j.uid].name);d.append(c('<img src="'+this.users[j.uid].avatar+'">'));
f.append(d);d=null;}}var k=c('<div class="msg"></div>');k.append(c('<div msgid="'+j.id+'" msgtime="'+j.time+'"></div>').html(j.text));k.append(c('<div class="date"></div>').text(this.formatMessageTime(j.time)));
f.append(k);this.content.append(f);}},publicDraft:function(f,e,g){var d=c('[msgid="'+f+'"]',this.content);if(d.length){d.attr("msgid",e);d.attr("msgtime",g);
}},appendNewMessage:function(d){this.pushTalkMesage(d);this.scrollToMessage(d.id);this.content.trigger("scroll");if(this.options.userId!=d.uid){this.flash(true);
}},sendMessage:function(f,g,d){var h={event:f,data:g,time:(new Date()).getTime(),rand:Math.random()};var e=JSON.stringify(h);if(window.ie){c(window).data("smartMessangerLocalMessage",e);
}localStorage["pm.message"]=e;if(d){var f=c.Event("storage");f.key="pm.message";f.oldValue=localStorage["pm.message"];f.newValue=JSON.stringify(h);c(window).trigger(f);
}},};c.fn.smartMessangerWindow=function(f){var d=Array.prototype.slice.call(arguments,1);var e=[];this.each(function(){var i=c(this);var h=i.data("smartMessangerWindow");
if(!h){if(!("talkId" in f)){throw"talkId should be specifed.";}if(d.length<1){throw"setup data should be specifed.";}else{if(!("users" in d[0])){throw"users object should be specifed in setup data.";
}}if(!("thread" in d[0])){throw"thread object should be specifed in setup data.";}h=new a(this,f,d[0]);i.data("smartMessangerWindow",h);}if(typeof f==="string"){if(typeof h[f]!=="function"){throw"jquery.smartMessangerWindow has no '"+f+"' method";
}var g=h[f].apply(h,d);if(g!==undefined){e.push(g);}}});return e.length>0?e[0]:this;};c.smartMessangerWindow=function(e,d){var f=new a(e,d);f.$node.data("smartMessangerWindow",f);
return f.$node;};function b(e){var d=this;this.halted=false;this.options=c.extend({updateInterval:10000,lazyUpdateInterval:60000,hiddenUpdateInterval:300000,userId:0,userInStorageId:("pm.userId" in localStorage)?parseInt(localStorage["pm.userId"]):0,urlAppendParams:{},sound:false,soundPath:""},e);
this.updateTimer=0;this.talks={};this.users={};this.threads={};this.drafts={};this.init();if(this.options.userId!=0){this.feedUpdateLoop();}else{this.feedUpdate();
}}b.prototype={onLoad:function(){console.log("Loading...");this.userChanged(this.options.userId,true);try{this.users=("pm.users" in localStorage)?c.parseJSON(localStorage["pm.users"]):{};
}catch(f){console.log("Invalid pm.users JSON while loading.");}try{this.threads=("pm.threads" in localStorage)?c.parseJSON(localStorage["pm.threads"]):{};
}catch(f){console.log("Invalid pm.threads JSON while loading.");}try{this.drafts=("pm.drafts" in localStorage)?c.parseJSON(localStorage["pm.drafts"]):{};
}catch(f){console.log("Invalid pm.drafts JSON while loading.");}if("pm.talks" in localStorage){try{var d=c.parseJSON(localStorage["pm.talks"]);for(talkId in d){this.openTalk(talkId);
}}catch(f){console.log("Invalid pm.talks data while loading.");}}},onSave:function(){console.log("Saving...");},onActivityChanged:function(e){if(("pm.lastUpdate" in localStorage)&&e){var d=(new Date(localStorage["pm.lastUpdate"])).getTime();
if((new Date()).getTime()-d>this.options.updateInterval){return this.feedUpdate(true);}}this.feedUpdateLoop();},onVisibilityChanged:function(e){if(("pm.lastUpdate" in localStorage)&&!e){var d=(new Date(localStorage["pm.lastUpdate"])).getTime();
if((new Date()).getTime()-d>this.options.updateInterval){return this.feedUpdate(true);}}this.feedUpdateLoop();},halt:function(f,e){console.log("Halted by: "+e);
var g={auth:"Войдите на сайт",unknown:"Временно недоступно",refresh:"Обновите страницу"};if(this.updateTimer){clearTimeout(this.updateTimer);this.updateTimer=0;
}var d=(f in g)?g[f]:g.unknown;for(talkId in this.talks){this.talks[talkId].smartMessangerWindow("halt",d);}this.halted=true;},sound:function(){if(this.options.sound){if(c(".jBox-Modal").length){c(".jBox-Modal").data("jBox").audio({url:this.options.soundPath,volume:75});
}else{var d=new jBox("Modal");d.audio({url:this.options.soundPath,volume:75});d.destroy();}}},openTalkToUser:function(e,d){this.getUserTalkQuery(e,d);},openTalk:function(d){this.sendMessage("openTalk",d,true);
},closeTalk:function(d){this.sendMessage("closeTalk",d,true);},prepareApiUrl:function(d){if(!c.isEmptyObject(this.options.urlAppendParams)){for(var e in this.options.urlAppendParams){d+=(d.indexOf("?")==-1)?"?":"&";
d+=encodeURIComponent(e)+"="+encodeURIComponent(this.options.urlAppendParams[e]);}}d+=(d.indexOf("?")==-1)?"?":"&";d+="r="+Math.random();return d;},restarter:function(f){var e=this;
var d=false;c.ajax({url:e.prepareApiUrl(e.options.apiUrl+"/fresh"),processData:false,data:JSON.stringify({}),type:"POST",mimeType:"application/json",beforeSend:function(g){console.log("Try refresh session");
g.setRequestHeader("Content-Type","application/json");},success:function(g,i,h){if(typeof(g)=="object"){d=true;if(("security_ls_key" in g)&&("userId" in g)){e.options.urlAppendParams.security_ls_key=g.security_ls_key;
if(g.userId!=e.options.userId){e.userChanged(g.userId,true);}else{if(typeof(f)=="function"){f();}}}else{e.halt("auth","network");}}},complete:function(g,h){if(!d){e.halt("unknown","network");
}}});},executeQuery:function(d,f,h,g){var e=this;c.ajax({url:this.prepareApiUrl(d),processData:false,data:f,type:"POST",mimeType:"application/json",beforeSend:function(i){i.setRequestHeader("Content-Type","application/json");
},success:function(i,k,j){if(typeof(i)=="object"){if("userId" in i){if(i.userId!=e.options.userId){return e.userChanged(i.userId,true);}else{if(typeof(h)=="function"){return h.call(e,i);
}else{return true;}}}e.halt("unknown","network");}},complete:function(i,j){if(i.status==200){if(i.responseText=="Hacking attemp!"){e.restarter(function(){e.executeQuery(d,f,h,g);
});}else{if(typeof(g)=="function"){g.call(e);}}}else{e.halt("unknown","network");}}});},newUserTalkQuery:function(d,g,e){var f={login:d,text:g};this.executeQuery(this.options.apiUrl+"/newTalk",JSON.stringify(f),function(h){h.draftId=e;
this.sendMessage("newTalk",h,true);});},getUserTalkQuery:function(e,d){var f={login:e};this.executeQuery(this.options.apiUrl+"/getTalk",JSON.stringify(f),function(j){if("users" in j){this.sendMessage("freshUserInfo",j.users,true);
}if(("talks" in j)&&!c.isEmptyObject(j.talks)&&!d){this.sendMessage("freshTalkInfo",j.talks,true);for(g in j.talks){if(g in this.talks){if(this.talks[g].smartMessangerWindow("collapsed")){this.talks[g].smartMessangerWindow("collapsed",false);
}this.talks[g].smartMessangerWindow("focus");}break;}}else{for(var h in j.users){if(h==this.options.userId){continue;}for(g in this.talks){if(g.match(/^draft_/)&&(g in this.threads)){if(("draftLogin" in this.threads[g])&&(this.threads[g]["draftLogin"]==e)){if(this.talks[g].smartMessangerWindow("collapsed")){this.talks[g].smartMessangerWindow("collapsed",false);
}this.talks[g].smartMessangerWindow("focus");return;}}}var g="draft_"+Math.round((Math.random()*1000000));var i={};i[g]={draftLogin:this.users[h]["login"],header:this.users[h]["name"],title:"Новая переписка с пользователем "+this.users[h]["name"],url:"/talk/add/?talk_users="+this.users[h]["login"],lastView:0,messages:[]};
this.sendMessage("freshTalkInfo",i,true);break;}}});},updateQuery:function(){var g={views:{},loaded:{},messages:{}};for(var e in this.threads){if(e.toString().match(/^draft_/i)){continue;
}if(this.threads[e]!=null){g.views[e]=this.threads[e].lastView;}}for(var e in this.threads){if(e.toString().match(/^draft_/i)){continue;}if(this.threads[e]!=null){if(this.threads[e].messages.length){g.loaded[e]=this.threads[e].messages[this.threads[e].messages.length-1].id;
}}else{g.loaded[e]=null;}}var h={};for(var e in this.drafts){if(e.toString().match(/^draft_/i)){continue;}if(this.drafts[e].length){for(var f=0,d=this.drafts[e].length;
f<d;f++){if(!this.drafts[e][f]["sended"]){if(!(e in g.messages)){g.messages[e]=[];}g.messages[e].push({draftId:this.drafts[e][f].draftId,text:this.drafts[e][f].text});
this.drafts[e][f]["sended"]=true;if(!(e in h)){h[e]={};}h[e][this.drafts[e][f].draftId]=true;}}}}if(!c.isEmptyObject(h)){localStorage["pm.drafts"]=JSON.stringify(this.drafts);
this.sendMessage("sendDrafts",h);}this.executeQuery(this.options.apiUrl+"/update",JSON.stringify(g),function(i){if("appends" in i){this.sendMessage("freshDraftsInfo",i.appends,true);
}if("users" in i){this.sendMessage("freshUserInfo",i.users,true);}if("talks" in i){this.sendMessage("freshTalkInfo",i.talks,true);}if("errors" in i){this.sendMessage("freshTalkErrorInfo",i.errors,true);
}},function(){localStorage["pm.lastUpdate"]=(new Date()).toUTCString();this.sendMessage("feedUpdateReset",null,true);});},feedUpdate:function(d){if(this.halted){return;
}this.sendMessage("feedUpdateReset",null);if(d&&this.options.userId){console.log("Check before Feed update");var h=this;var f=this.options.checkUrl+"/";
var k=this.options.userId.toString();for(var g=0,e=k.length;g<e;g++){f+=k.charAt(g)+"/";}f+="notify_"+k+".txt?r="+Math.random();c.ajax({url:f,type:"GET",complete:function(i,j){if((i.readyState==4)&&(i.status==200)){if(!("pm.lastTag" in localStorage)||(i.responseText!=localStorage["pm.lastTag"])){localStorage["pm.lastTag"]=i.responseText;
h.feedUpdate();}else{h.sendMessage("feedUpdateReset",null,true);}}else{h.sendMessage("feedUpdateReset",null,true);}}});}else{console.log("Feed update loop");
this.updateQuery();}},feedUpdateLoop:function(){var d=this;var e=this.options.updateInterval;if(c.isEmptyObject(this.talks)||!document.active){e=this.options.lazyUpdateInterval;
}if(document.hidden){e=this.options.hiddenUpdateInterval;}console.log("Feed update timer set to "+e);if(this.updateTimer){clearTimeout(this.updateTimer);
}this.updateTimer=setTimeout(function(f){d.updateTimer=0;d.feedUpdate(true);},e+Math.round(Math.random()*1000));},userChanged:function(f,e){if(this.options.userInStorageId!=f){for(var d in this.talks){this.talks[talkId].smartMessangerWindow("clearWindowState");
this.talks[talkId].smartMessangerWindow("close");this.talks[talkId].remove();delete this.talks[d];}this.options.userInStorageId=f;this.options.userId=f;
this.talks={};this.threads={};this.users={};this.drafts={};if(e){delete localStorage["pm.talks"];delete localStorage["pm.threads"];delete localStorage["pm.drafts"];
delete localStorage["pm.users"];delete localStorage["pm.lastUpdate"];delete localStorage["pm.lastTag"];localStorage["pm.userId"]=f;}console.log("User changed to "+this.options.userId);
}},onMessage:function(d,l,n){switch(d){case"freshTalkInfo":var t=false;var g=[];for(var o in l){if((o in this.threads)&&(this.threads[o]!=null)){if("title" in l[o]){this.threads[o].title=l[o].title;
}if("header" in l[o]){this.threads[o].header=l[o].header;}if("url" in l[o]){this.threads[o].url=l[o].url;}if("reset" in l[o]){delete l[o].reset;delete this.threads[o].messages;
c.extend(true,this.threads[o],l[o]);if(o in this.talks){this.talks[o].smartMessangerWindow("restoreMessageState");}}else{var u=this.threads[o].messages.length?this.threads[o].messages[this.threads[o].messages.length-1]:null;
for(var m=0,k=l[o].messages.length;m<k;m++){if((u==null)||(l[o].messages[m].id>u.id)){this.threads[o].messages.push(l[o].messages[m]);if(o in this.talks){this.talks[o].smartMessangerWindow("appendNewMessage",l[o].messages[m]);
if(l[o].messages[m].uid!=this.options.userId){t=true;}}}}}}else{if("reset" in l[o]){delete l[o].reset;}this.threads[o]=l[o];t=true;}if(!(o in this.talks)){g.push(o);
}}if(n){localStorage["pm.threads"]=JSON.stringify(this.threads);for(var m=0,k=g.length;m<k;m++){this.bNewTalk=true;this.openTalk(g[m],true);}if(t){this.sound();
}}break;case"freshUserInfo":c.extend(true,this.users,l);if(n){localStorage["pm.users"]=JSON.stringify(this.users);}break;case"freshDraftsInfo":for(var o in l){if(o in this.drafts){for(var q in l[o]){for(var m=0,k=this.drafts[o].length;
m<k;m++){if(this.drafts[o][m].draftId==q){this.drafts[o].splice(m,1);if(o in this.talks){this.talks[o].smartMessangerWindow("publicDraft",q,l[o][q],(new Date()).getTime());
}if((o in this.threads)&&(this.threads[o].lastView<l[o][q])){this.threads[o].lastView=l[o][q];}break;}}}}}if(n){localStorage["pm.drafts"]=JSON.stringify(this.drafts);
}break;case"freshTalkErrorInfo":if("add" in l){for(var o in l.add){var h=l.add[o];if(o in this.talks){this.talks[o].smartMessangerWindow("halt",h);}}}break;
case"viewThread":if(l.talkId in this.threads){this.threads[l.talkId].lastView=l.messageId;if(n){localStorage["pm.threads"]=JSON.stringify(this.threads);
}}break;case"sendDrafts":for(var o in l){for(var q in l[o]){c.each(this.drafts[o],function(e,j){if(j.draftId==q){this.drafts[o][e]["sended"]=true;}});}}break;
case"appendDraft":if(l.talkId in this.threads){this.drafts[l.talkId].push({draftId:l.draftId,text:l.text,sended:false,time:(new Date()).getTime()});if(n){localStorage["pm.drafts"]=JSON.stringify(this.drafts);
}this.talks[l.talkId].smartMessangerWindow("pushTalkMesage",{id:l.draftId,uid:this.options.userId,text:l.text,time:(new Date()).getTime()});this.talks[l.talkId].smartMessangerWindow("scrollToMessage",l.draftId);
if(n){if(l.talkId.toString().match(/^draft_/i)&&(l.talkId in this.threads)){this.newUserTalkQuery(this.threads[l.talkId]["draftLogin"],l.text,l.talkId);
}else{this.feedUpdate();}}}break;case"feedUpdateReset":this.feedUpdateLoop();break;case"refreshWindowState":if(l in this.talks){this.talks[l].smartMessangerWindow("loadWindowState");
}break;case"changeWindowForeground":for(o in this.talks){this.talks[o].smartMessangerWindow("loadWindowState");}break;case"newTalk":var q=l.draftId;if("users" in l){this.sendMessage("freshUserInfo",l.users,n);
}if(("errors" in l)&&!c.isEmptyObject(l.errors)){for(var m in l.errors){var p="error_"+Math.round((Math.random()*1000000));this.talks[q].smartMessangerWindow("pushTalkMesage",{id:p,uid:0,text:l.errors[m],time:(new Date()).getTime()});
this.talks[q].smartMessangerWindow("scrollToMessage",p);}}else{if(("talks" in l)&&!c.isEmptyObject(l.talks)){for(var o in l.talks){this.talks[o]=this.talks[q];
this.talks[o].smartMessangerWindow("resetup",o);delete this.talks[q];this.drafts[o]=this.drafts[q];delete this.drafts[q];l.appends={};l.appends[o]={};l.appends[o][this.drafts[o][0].draftId]=0;
this.onMessage("freshDraftsInfo",l.appends,n);this.threads[o]=this.threads[q];delete this.threads[q];delete this.threads[o]["draftLogin"];this.onMessage("freshTalkInfo",l.talks,n);
break;}}}break;case"openTalk":var o=l;var v=false;if(!(o in this.talks)){if(!(o in this.threads)||(this.threads[o]==null)){this.threads[o]=null;if(n){v=true;
}}else{if(!(o in this.drafts)){this.drafts[o]=[];}var f={talkId:o,userId:this.options.userId};if("bNewTalk" in this){f.newtalk=true;delete this.bNewTalk;
}this.talks[o]=c.smartMessangerWindow(f,{users:this.users,thread:this.threads[o],draft:this.drafts[o]});}}if(v){try{this.feedUpdate();}catch(r){console.log(r);
}}else{this.feedUpdateLoop();}break;case"closeTalk":var o=l;if(o in this.talks){this.talks[o].smartMessangerWindow("clearWindowState");this.talks[o].smartMessangerWindow("close");
this.talks[o].remove();}if(o in this.threads){var s=0;c.each(this.threads[o].messages,function(e,j){s=Math.max(s,j.id);});this.threads[o].lastView=s;}if(n){if(o.toString().match(/^draft_/i)==null){try{this.feedUpdate();
}catch(r){console.log(r);}}else{this.feedUpdateLoop();}}delete this.talks[o];delete this.threads[o];if(!this.drafts[o].length){delete this.drafts[o];}if(n){localStorage["pm.threads"]=JSON.stringify(this.threads);
localStorage["pm.drafts"]=JSON.stringify(this.drafts);}break;case"userChanged":this.userChanged(l,n);break;case"halt":this.halt(l,"client");break;}},sendMessage:function(f,g,d){var h={event:f,data:g,time:(new Date()).getTime(),rand:Math.random()};
var e=JSON.stringify(h);if(window.ie){c(window).data("smartMessangerLocalMessage",e);}localStorage["pm.message"]=e;if(d){var f=c.Event("storage");f.key="pm.message";
f.oldValue=localStorage["pm.message"];f.newValue=e;c(window).trigger(f);}},init:function(){var f=this;var l=("pm.version" in localStorage)?localStorage["pm.version"]:"0";
var e=this.options.urlAppendParams.version;if(parseFloat(e)>parseFloat(l)){this.sendMessage("halt","refresh",false);if(parseFloat(l)<2.6){var k={"pm.userId":true,"pm.lastUpdate":true};
for(var g in localStorage){if(g.test(/^pm\./)&&(!(g in k))){delete localStorage[g];}}}localStorage["pm.version"]=e;}else{if(parseFloat(e)<parseFloat(l)){this.halt("unknown","client");
return;}}c(window).bind("beforeunload",function(i){if(f.halted){return;}c(window).unbind("beforeunload",arguments.callee);f.onSave();});c(window).bind("storage",function(n){if(f.halted){return;
}if(n.key=="pm.message"){try{var i=!("originalEvent" in n);if(!i&&window.ie&&(c(window).data("smartMessangerLocalMessage")===n.newValue)){c.removeData(c(window),"smartMessangerLocalMessage");
return;}var o=c.parseJSON(i?n.newValue:n.originalEvent.newValue);if(!("event" in o)){throw true;}try{if("data" in o){f.onMessage(o.event,o.data,i);}else{f.onMessage(o.event,null,i);
}}catch(m){console.log(m);}}catch(m){console.log("Unknown message:"+(("originalEvent" in n)?n.originalEvent.newValue:n.newValue));}}else{}});var j,d;if(typeof document.hidden!=="undefined"){j="hidden";
d="visibilitychange";}else{if(typeof document.mozHidden!=="undefined"){j="mozHidden";d="mozvisibilitychange";}else{if(typeof document.msHidden!=="undefined"){j="msHidden";
d="msvisibilitychange";}else{if(typeof document.webkitHidden!=="undefined"){j="webkitHidden";d="webkitvisibilitychange";}}}}if(j!="hidden"){document.hidden=document[j];
}document.active=!document.hidden;c(document).on(d,function(i){if(f.halted){return;}if(j!="hidden"){document.hidden=document[j];}try{f.onVisibilityChanged(document[j]);
}catch(i){console.log(i);}});var h=0;c(document).on("scroll mouseover keydown",function(i){if(f.halted){return;}if(h){clearTimeout(h);h=0;}if(!document.active){try{document.active=!document.active;
f.onActivityChanged(document.active);}catch(i){console.log(i);}}h=setTimeout(function(m){h=0;if(document.active){try{document.active=!document.active;f.onActivityChanged(document.active);
}catch(m){console.log(m);}}},20000);});c(document).trigger("scroll");this.onLoad();}};c.fn.smartMessanger=function(f){var d=Array.prototype.slice.call(arguments,1);
var e=[];this.each(function(){var i=c(this);var h=i.data("smartMessanger");if(!h){h=new b(f);i.data("smartMessanger",h);}if(typeof f==="string"){if(typeof h[f]!=="function"){throw"jquery.smartMessanger has no '"+f+"' method";
}var g=h[f].apply(h,d);if(g!==undefined){e.push(g);}}});return e.length>0?e[0]:this;};window.ie=(function(){if(window.ActiveXObject===undefined){return null;
}if(!document.querySelector){return 7;}if(!document.addEventListener){return 8;}if(!window.atob){return 9;}if(!document.__proto__){return 10;}return 11;
})();(function(d){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(d)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(d.substr(0,4));
jQuery.browser.mobile=jQuery.browser.mobile||d.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i);})(navigator.userAgent||navigator.vendor||window.opera);
})(jQuery);
(function($)
{

	function TopicDonateDialog(iTopicId)
	{
		var dialog = null;
		var options = 
		{
			id: 'topicDonateDialog',
			title: 'Поблагодарить пользователя',
			closeOnConfirm: false,
			confirmButton: 'Дать',
			cancelButton: 'Отмена',
			content: 'Вы благодарите <a id="user" target="_blank"></a> за пост <a id="topic" target="_blank"></a><br/><br/> У вас на счету: <span id="bill"></span>₽<br/><br/>Сколько даете? <input type="text" id="donate" />',

			confirm: function()
			{
				if (!parseInt(dialog.wrapper.find('#donate').val()))
				{
					return msgErrorBox.alert('Ошибка!', 'Нельзя дать 0 рублей');
				}

				if (parseInt(dialog.wrapper.find('#donate').val()) > options.iBill)
				{
					return msgErrorBox.alert('Ошибка!', 'У вас нет столько денег. Вы можете дать не более ' + options.iBill + '₽');
				}

				$.post(aRouter['money'] + 'donate_ajax?JsHttpRequest=' + (new Date()).getTime() + '-xml', {target_id: iTopicId, target_type: 'topic', amount: parseInt(dialog.wrapper.find('#donate').val()), security_ls_key: LIVESTREET_SECURITY_KEY}, function(result)
				{
					try
					{
						result = JSON.parse(result);
						result = result.js;

					} catch (e) {result = null; }

					if (!result)
					{
						return msgErrorBox.alert('Error', 'Please try again later');
					}

					if (result.bStateError)
					{
						msgErrorBox.alert(result.sMsgTitle, result.sMsg);
					} else
					{
						msgNoticeBox.alert(result.sMsgTitle, result.sMsg);
						var topic = $('.topic[tid=' + iTopicId + ']');
						if (topic.length)
						{
							var node = null;							
							var container = topic.find('.views-total, .views-total-topic');
							container.find('span').each(function(i,el)
							{
								if ($(el).text().indexOf('₽') != -1)
								{
									node = $(el);
									return false;
								}

							});

							if (node === null)
							{
								node = $('<span />');
								if (container.find('span').length) container.append(' | ');
								container.append(node);
							}

							node.attr('title', 'Топик собрал ' + result.iBill +  ' рублей').text('₽ ' + result.iBill);
						}
						dialog.close();
					}
				});
			},

			onOpen: function()
			{
				this.wrapper.find('#user').text(options.sUserTitle).attr('href', options.sUserUrl);
				this.wrapper.find('#topic').text(options.sTargetTitle).attr('href', options.sTargetUrl);
				this.wrapper.find('#bill').text(options.iBill);
				this.wrapper.find('#donate').on('keypress', function(e)
				{
					var digits = '1234567890';
					if (digits.indexOf(e.key) == -1) e.preventDefault();
				});				
			},

			onClose: function()
			{
				this.wrapper.find('#donate').off('keypress');
			},

			onCloseComplete: function()
			{
				this.destroy();
			}
		};

		$.getJSON(aRouter['money'] + 'donate_ajax', {target_id: iTopicId, target_type: 'topic', security_ls_key: LIVESTREET_SECURITY_KEY, JsHttpRequest: (new Date()).getTime() + '-xml'}, function(result)
		{
			if (result.js.bStateError)
			{
				msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
				return;
			}

			options['iBill'] = result.js.iBill;
			options['sTargetTitle'] = result.js.sTargetTitle;
			options['sTargetUrl'] = result.js.sTargetUrl;
			options['sUserTitle'] = result.js.sUserTitle;
			options['sUserUrl'] = result.js.sUserUrl;

			dialog = new jBox('Confirm', options);
			dialog.open();
		});
	}

	$(document).ready(function()
	{
		$('#content').on('click', '.topic > .voting > .donate > a', function(e)
		{
			e.preventDefault();
			var iTopicId =  $(this).parents('.topic').attr('tid');
			TopicDonateDialog(iTopicId);
		});
	});

})(jQuery);
(function($)
{
	$(document).ready(function($)
	{
		var cache = {};
		var timer = 0;
		var targetId = null;
		var targetType = null;
		var vpopup = $('<div class="WhoFavourited"></div>');
		$('body').append(vpopup);

		function vPopupFill(node, data)
		{
			vpopup.empty();
			if ($.isEmptyObject(data))
			{
				vpopup.append('Нет данных');
			} else
			{
				$.each(data, function(i, v)
				{
					vpopup.append('<div>' + v['name'] + '</div>');
				});
			}

			var off = $(node).offset();
			vpopup.css('left', off.left + $(node).outerWidth());
			vpopup.css('top', off.top + $(node).outerHeight());
			vpopup.show();
		}

		$('div.topic[tid]').on('mouseover', '.favourited_menu', function(e)
		{
			var node = e.target;
			$(node).removeAttr('title');

			timer = setTimeout(function()
			{
				timer = 0;

				var nTopic = $(node).parents('.topic[tid]');
				if (nTopic.length)
				{
					targetType = 'topic';
					targetId = nTopic.attr('tid');
				}

				if ((targetType in cache) && (targetId in cache[targetType]))
				{
					vPopupFill(node, cache[targetType][targetId]);
				} else
				{
					var off = $(node).offset();
					vpopup.empty();
					vpopup.append('<div>Загрузка...</div>');
					vpopup.css('left', off.left + $(this).outerWidth());
					vpopup.css('top', off.top + $(this).outerHeight());
					vpopup.show();

					var sLoadingTargetType = targetType;
					var iLoadingTargetId = targetId;
					JsHttpRequest.query('POST /profile/favourited/' + targetType + '/' + targetId + '/?security_ls_key=' + LIVESTREET_SECURITY_KEY, {}, function(result, errors)
					{
						if (sLoadingTargetType !== targetType) return;
						if (iLoadingTargetId !== targetId) return;

						if (result && !result.bStateError)
						{
							if (!(targetType in cache)) cache[targetType] = {};
							cache[targetType][targetId] = result.data;
							vPopupFill(node, cache[targetType][targetId]);

						} else
						{
							vpopup.find('div').text('Ошибка!');
						}
					});
				}
			}, 500);
			
		}).on('mouseout', '.favourited_menu', function(e)
		{
			targetId = null;
			targetType = null;
			if (timer)
			{
				clearTimeout(timer);
				timer = 0;
			}
			vpopup.hide();
		});
	});

})(jQuery);
jQuery(document).ready(function($)
{

	// подписка на тему
	$('.notifies_table').on('click', '.article_subscribe', function(e)
	{
		var btn = $(this);
		var sArticleId = btn.data('target-id');
		var sType = btn.data('subscribe-type');
		var bSubscribe = btn.is(':checked');

		if (sType && sArticleId)
		{
			e.preventDefault();
			$.ajax({

				url: '/finansoviy-slovar/ajaxsubscribe/' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
				type: 'POST',
				data: {id: sArticleId, type: sType, subscribe: bSubscribe ? 1 : 0, security_ls_key: LIVESTREET_SECURITY_KEY}
			}).then(function(result)
			{
				try
				{
					result = JSON.parse(result);
				} catch (e)
				{
					msgErrorBox.alert('Внимание!', 'Неизвестная ошибка');
					return;
				}

				if (result.js.bStateError)
				{
					msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
					return;
				} else
				{
					msgNoticeBox.alert(result.js.sMsgTitle, result.js.sMsg);
					btn.prop('checked', bSubscribe);
				}
			});
		}
	});

});
jQuery(document).ready(function($)
{
	// панель слева - забаненые
	var addEmployeeBtn = $('#add_company_employee').first();
	if (addEmployeeBtn.length && addEmployeeBtn.attr('company-id'))
	{
		var sWindowContent = '<div class="employeeBox">\
								<div>\
									<span>Введите имя:</span><br/>\
									<div>\
										<input type="text"/>\
									</div>\
								</div><br/>\
								<span>Список сотрудников:</span>\
								<ul>\
									<li>Загружаю...</li>\
								</ul>\
						</div>';

		var employeeDialogParam = {

			id: 'employeeDialog',
			title: 'Список сотрудников компании',
			confirmButton: 'ОК',
			cancelButton: 'Отмена',			
			content: sWindowContent,
			companyId: addEmployeeBtn.attr('company-id'),
			width: 450,

			onOpen: function()
			{
				var self = this;
				if ('confirmed' in this.options) delete this.options.confirmed;
				this.options.loadEmployeeList.call(this);
				
				var list = self.wrapper.find('ul');
				this.wrapper.on('click', '.removeFromEmployee', function()
				{
					$(this).parents('li').remove();
					if (!list.find('li').length) list.append('<li id="0">Нет сотрудников.</li>');
				});

				this.wrapper.find('input:text').autocomplete({
					serviceUrl: '/summoner/nick_autocomplete2/',
					type: 'GET',
					dataType: 'json',
					paramName: 'q',
					preventBadQueries: false,
					zIndex: 99999,
					transformResult: function(response)
					{
						return { suggestions: response.results };
					},
					onSelect: function (suggestion)
					{
						var list = self.wrapper.find('ul');
						if (!list.find('li#' + suggestion.id).length)
						{
							var a = $('<a/>').attr('href', suggestion.url).text(suggestion.value);
							var li = $('<li/>').attr('id', suggestion.id);
							li.append(a);
							li.append($('<span class="removeFromEmployee" title="Удалить из сотрудников">&ndash;</span>'));
							list.append(li);
							$(this).val('');

							if (list.find('li#0').length) list.find('li#0').remove(); // убираем "нет сотрудников"

							var iScroll = list[0].scrollHeight - list[0].clientHeight;
							list[0].scrollTop = iScroll ? iScroll : 0;
						}
					}
				});
			},

			loadEmployeeList: function()
			{
				var self = this;
				$.ajax({

					url: '/panel/ajaxemployeelist' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
					type: 'GET',
					data: {id: this.options.companyId, security_ls_key: LIVESTREET_SECURITY_KEY}

				}).then(function(result)
				{
					try
					{
						result = JSON.parse(result);
						if (result.js.bStateError)
						{
							msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
							return;
						}

					} catch (e) {}

					var list = self.wrapper.find('ul');
					list.empty();
					if (('employee' in result.js) && result.js.employee.length)
					{
						$.each(result.js.employee, function(i,v)
						{
							var li = $('<li/>');
							li.attr('id', v['id']);
							var a = $('<a/>').attr('href', v['url']).text(v['name']);
							li.append(a);

							li.append($('<span class="removeFromEmployee" title="Удалить из сотрудников">&ndash;</span>'));
							list.append(li);
						});

					} else
					{
						list.append('<li id="0">Нет сотрудников.</li>');
					}
				});
			},

			saveEmployeeList: function()
			{
				var self = this;

				var aEmployee = [];
				this.wrapper.find('ul').find('li').each(function(i, n)
				{
					aEmployee.push(this.id);
				});

				if (aEmployee.indexOf(0) !== -1) aEmployee = aEmployee.splice(aEmployee.indexOf(0), 1);

				$.ajax({

					url: '/panel/ajaxemployeelist' + '?JsHttpRequest=' + (new Date()).getTime() + '-xml',
					type: 'POST',
					data: {id: self.options.companyId, employee: aEmployee, security_ls_key: LIVESTREET_SECURITY_KEY}

				}).then(function(result)
				{
					try
					{
						result = JSON.parse(result);
					} catch (e)
					{
						msgErrorBox.alert('Внимание!', 'Неизвестная ошибка');
						return;						
					}

					if (result.js.bStateError)
					{
						msgErrorBox.alert(result.js.sMsgTitle, result.js.sMsg);
					} else
					{
						if (result.js.sMsg) msgNoticeBox.alert(result.js.sMsgTitle, result.js.sMsg);
					}
				});
			},

			confirm: function()
			{
				this['confirmed'] = true;
			},

			onClose: function()
			{
				if (('confirmed' in this.options) && (this.options.confirmed)) this.options.saveEmployeeList.call(this);
				this.wrapper.off('click');
			}
		};

		addEmployeeBtn.on('click', function()
		{
			var box = new jBox('Confirm', employeeDialogParam);
			box.open();
		});
	}

});
(function(c){var b='<div class="book_popup">	<div class="book_thumbnail">		<a href="#" title="Посмотреть страницу книги">			<img src="/plugins/books/templates/skin/default/img/nocover.png" />		</a>	</div>	<div class="book_info">		<div><a class="book_title" href="#" title="Посмотреть страницу книги">Длинное длинное название книги на несколько строк и в одну не влезает</a></div>		<div><span class="book_subtitle">Дополнительный заголовок если есть, возможно заголовок оригинальный на забугорном языке</span></div>		<div class="book_authors"><a href="#">Автор книги</a>, <a href="#">Автор книги 2</a></div>		<div class="book_rating">			<div style="width: 10%"></div>		</div>	</div>	<div class="profile_panel">		<div>			<a href="#">Купить</a>			<a href="#">Скачать</a>			<a href="#">Хочу прочитать потом</a>			<a href="#">Я ее читал</a>		</div>	</div></div>';
function a(j){var d=c(b);d.find(".book_thumbnail img").attr("src",j.thumbnail?j.thumbnail:DIR_WEB_ROOT+"/plugins/books/templates/skin/default/img/nocover.png");
d.find(".book_thumbnail a").attr("href",j.profile);d.find(".book_title").attr("href",j.profile).text(j.title);if("title_second" in j){d.find(".book_subtitle").text(j.title_second);
}else{d.find(".book_subtitle").parent("div").remove();}if("authors" in j){var i=d.find(".book_authors").empty();var h=false;for(var g in j.authors){if(h){i.append(c(document.createTextNode(", ")));
}var f=c("<a></a>").attr("href",j.authors[g]).text(g);i.append(f);h=true;}}else{d.find(".book_authors").remove();}d.find(".book_rating > div").css("width",Math.round(parseFloat(j.rating)*20)+"%");
d.find(".book_rating").attr("title","Рейтинг: "+Math.round(parseFloat(j.rating)*100)/100+", Проголосовало: "+j.votes);var e=d.find(".profile_panel > div");
e.empty();if("buy_url" in j){e.append(c('<a href="'+j.buy_url+'" target="_blank">Купить</a>'));}if("buy_in_english_url" in j){e.append(c('<a href="'+j.buy_in_english_url+'" target="_blank">Buy</a>'));
}if("download_url" in j){e.append(c('<a href="'+j.download_url+'" target="_blank">Скачать</a>'));}if(!("reviewed" in j)){if(!("wishlisted" in j)){e.append(c('<a href="'+(("guest_mode" in j)?"/login":"/books/book_add_to_wishlist/"+j.id)+'/" target="_blank">Хочу прочитать потом</a>'));
}else{e.append(c('<a href="/books/book_remove_from_wishlist/'+j.id+'/" target="_blank">Не буду читать</a>'));}e.append(c('<a href="'+(("guest_mode" in j)?"/login":"/review/add/for/"+j.id)+'/" target="_blank">Я ее читал</a>'));
}if(d.scrollHeight>0){d.css("height",(d.height()+d.scrollHeight)+"px");e.css("bottom","0");}return d;}c(document).ready(function(){var g={};var f=new RegExp("^/books/([^\\/]+)/$","i");
var e=new RegExp("^/books/book_view/(\\d+)/?$","i");var d=["book_add_to_wishlist","book_remove_from_wishlist","wishlist_of","autocomplete","book_add","book_edit","book_delete","book_view","book_list","book_search","reviewed_by","genre_add","genre_edit","genre_up","genre_down","genre_delete","genre_list","publisher_add","publisher_edit","publisher_up","publisher_down","publisher_delete","publisher_list","top","list"];
new jBox("Tooltip",{id:"bookPopover",trigger:"mouseenter",adjustDistance:{top:55,right:5,bottom:5,left:5},delayOpen:500,closeOnMouseleave:true,animation:"move",attach:c('a[href^="/books/"]').filter(function(j){if(c(this).attr("href").match(e)!==null){return true;
}var h=c(this).attr("href").match(f);if(h&&(d.indexOf(h[1])==-1)){return true;}return false;}),zIndex:8000,position:{x:"center",y:"bottom"},followMouse:true,outside:"y",onOpen:function(){var j=this;
var n=null;var k=null;if(m=c(this.target).attr("href").match(e)){n=m[1];}if(m=c(this.target).attr("href").match(f)){k=m[1];}if(c(this.target).find("img").length){this.target=c(this.target).find("img");
}var l=function(o){this.setContent(a(o));};var i=(n!=null)?"id:"+n:"u:"+k;if(!(i in g)){var h={};if("LIVESTREET_SECURITY_KEY" in window){h.security_ls_key=LIVESTREET_SECURITY_KEY;
}if(k!=null){h.url=k;}if(n!=null){h.id=n;}JsHttpRequest.query("POST /books/ajaxprofile/",h,function(o,p){if(!o){return;}if(!o.bStateError){g[i]=o.aProfile;
l.call(j,g[i]);}},true);}else{l.call(this,g[i]);}},onCloseComplete:function(){c(".book_popup").remove();}});});})(jQuery);
/**
 * Cursor Functions
 *
 * Used for setting and getting text cursor position within an input
 * and textarea field. Also used to get and set selection range.
 * 
 * @author Branden Cash
 * @email brandencash@crutzdesigns.com
 */
 
(function( $ ){
  jQuery.fn.getCursorPosition = function(){
    if(this.lengh == 0) return -1;
    return $(this).getSelectionStart();
  }
  
  jQuery.fn.setCursorPosition = function(position){
    if(this.lengh == 0) return this;
    return $(this).setSelection(position, position);
  }
  
  jQuery.fn.getSelection = function(){
    if(this.lengh == 0) return -1;
    var s = $(this).getSelectionStart();
    var e = $(this).getSelectionEnd();
    return this[0].value.substring(s,e);
  }
  
  jQuery.fn.getSelectionStart = function(){
    if(this.lengh == 0) return -1;
    input = this[0];
    
    var pos = input.value.length;
    
    if (input.createTextRange) {
      var r = document.selection.createRange().duplicate();
      r.moveEnd('character', input.value.length);
      if (r.text == '') 
        pos = input.value.length;
      pos = input.value.lastIndexOf(r.text);
    } else if(typeof(input.selectionStart)!="undefined")
      pos = input.selectionStart;
    
    return pos;
  }
  
  jQuery.fn.getSelectionEnd = function(){
    if(this.lengh == 0) return -1;
    input = this[0];
    
    var pos = input.value.length;
    
    if (input.createTextRange) {
      var r = document.selection.createRange().duplicate();
      r.moveStart('character', -input.value.length);
      if (r.text == '') 
        pos = input.value.length;
      pos = input.value.lastIndexOf(r.text);
    } else if(typeof(input.selectionEnd)!="undefined")
      pos = input.selectionEnd;
    
    return pos;
  }
  
  jQuery.fn.setSelection = function(selectionStart, selectionEnd) {
    if(this.lengh == 0) return this;
    input = this[0];
    
    if (input.createTextRange) {
      var range = input.createTextRange();
      range.collapse(true);
      range.moveEnd('character', selectionEnd);
      range.moveStart('character', selectionStart);
      range.select();
    } else if (input.setSelectionRange) {
      input.focus();
      input.setSelectionRange(selectionStart, selectionEnd);
    }
    
    return this;
  }
})( jQuery );
(function($) {

	$.fn.smart_console = function(options)
	{
		var self = this;

		var input = this.find('input');
		var help = $('<div class="help"></div>').appendTo(this);
		var combo = $('<div class="console_combo"></div>').insertAfter(this);

		options = options || {};
		var settings = {

			combo_timeout : 100,
			commands : {},
			aliases : {},
			autocomplete_url : {

				'login' : '/summoner/nick_autocomplete/$query$/',
				'company' : '/company/autocomplete/$query$/',
				'forum' : '/console/ajaxCompany/?value=$query$',
				'symbol': '/g/autocomplete/$query$/',
				'tag' : '/include/ajax/tagAutocompleterConsole.php?q=$query$',
				'wiki' : '/include/ajax/dictionaryAutocompleterConsole.php?q=$query$',
				'book' : '/books/autocomplete/$query$/'
			}
		};

		var autocomplete = {

			box: null,
			search_empty : '',
			mode : '',
			cache: {login: {}, company:{}, forum:{}, symbol:{}, tag:{}, wiki:{}, book:{}}
		};

		if (options) $.extend(settings, options);

		/* -------------------- Autocompleter begin -------------------*/

		function autocomplete_from()
		{
			var command = input.val();
			var from_spaces = 0;
			var m = command.match(/^(\s*)?(.*)/);
			if (m !== null)
			{
				command = m[2];
				from_spaces = (typeof(m[1]) == 'undefined') ? 0 : m[1].length;
			}

			var params = command.split(' ');

			// $GAZP hack
			if (command[0] == '$')
			{
				params[0] = params[0].substr(1);
				params.unshift('$');
			}


			var cmd = $.trim(params.shift().toUpperCase());
			if (cmd in settings.aliases) cmd = settings.aliases[cmd];
			if (cmd in settings.commands)
			{
				function autocomplete_try(cmd, info)
				{
					autocomplete.mode = '';
					if ('ac' in info)
					{
						var param_test = $.trim(params.join(' '));
						var param_val = info.ac.exec(param_test);

						if (param_val !== null)
						{
							if ((info.ac.toString().indexOf('@') !== -1) && (info.ac.toString().indexOf('[^@') === -1))
							{
								// login
								autocomplete.mode = 'login';
								return command.indexOf('@') + 1;

							} else if (info.act == 'forum$')
							{
								// forum
								autocomplete.mode = 'forum';
								return cmd.length; // strlen corp (without space // for $GAZP)
							
							} else if ('act' in info)
							{
								autocomplete.mode = info.act;
								return cmd.length + 1 + param_val['index'] + param_val[0].search(param_val[1]);
							}
						}
					}
					return -1;
				}

				var res = false;
				if ('variants' in settings.commands[cmd])
				{
					try
					{
						$.each(settings.commands[cmd]['variants'], function(i, v)
						{
							res = autocomplete_try(cmd, v);
							if (res !== -1)
							{
								res += from_spaces;
								//console.log(res + ' ' + autocomplete.mode);
								throw true;
							}
						});

					} catch (e) {}
				} else
				{
					res = autocomplete_try(cmd, settings.commands[cmd]);
					if (res !== -1) res += from_spaces;
				}
				return (input.getCursorPosition() >= res) ? res : -1;
			}
			return -1;
		}
						
		function autocomplete_close()
		{
			if (autocomplete.search_ajax != null)
			{
				autocomplete.search_ajax.abort();
				autocomplete.search_ajax = null;
			}

			autocomplete.box.hide();
		}

		function autocomplete_fill()
		{
			if (autocomplete.search_ajax != null)
			{
				autocomplete.search_ajax.abort();
				autocomplete.search_ajax = null;
			}

			var word = $.trim(input.val().substr(autocomplete_from()));
			if (word !== '')
			{
				function autocomplete_fill_results(data)
				{
					if (data !== null)
					{
						autocomplete.search_empty = '';
						autocomplete.cache[autocomplete.mode][word] = data;
						autocomplete.box.trigger({type:'reset', message: {items: data, mode: autocomplete.mode}});
					} else
					{
						if (!autocomplete.search_empty) autocomplete.search_empty = word;
						autocomplete_close();
					}
				}

				if (autocomplete.search_empty && (autocomplete.search_empty.length <= word.length) && (word.indexOf(autocomplete.search_empty) == 0))
				{
					autocomplete_close();
				} else
				{
					if (word in autocomplete.cache[autocomplete.mode])
					{
						autocomplete_fill_results(autocomplete.cache[autocomplete.mode][word]);
					} else
					{
						autocomplete.search_ajax = $.getJSON(settings.autocomplete_url[autocomplete.mode].replace('$query$',  encodeURIComponent(word)), function(res)
						{
							var data = ((('results' in res) && res.results.length) ? res.results : null);
							autocomplete.cache[autocomplete.mode][word] = data;
							autocomplete_fill_results(data);
						});
					}
					return true;
				}
			} else
			{
				autocomplete_close();
			}
			return false;
		}

		function autocomplete_open()
		{
			var from = autocomplete_from();
			if (from !== -1)
			{
				var word = $.trim(input.val().substr(from));
				// не искать дальше, если на предыдущий запрос ничего не нашлось. Не всегда работает с финсловарями, т.к. там поиск от 3х символов
				if (autocomplete.search_empty && (autocomplete.search_empty.length > 3) && (autocomplete.search_empty.length <= word.length) && (word.indexOf(autocomplete.search_empty) == 0)) return false;
				if (word in autocomplete.cache[autocomplete.mode])
				{
					var ct = 0;
					var founded = false;
					$.each(autocomplete.cache[autocomplete.mode][word], function(i,v)
					{
						ct++;
						if (v.l === word) founded = true;
					});

					if (founded && (ct == 1))
					{
						if (autocomplete.box.css('display') != 'none') autocomplete_close();
						return false;
					}
				}

				if (autocomplete.box.css('display') == 'none')
				{
					autocomplete.search_empty = '';
					var offset = input.offset();
					autocomplete.box.css('top', offset.top + input.outerHeight() + 'px');
					autocomplete.box.css('left', offset.left + (from * 13) + 'px');
					autocomplete.box.trigger({type:'reset', message: {items:[]}});
					autocomplete.box.show();
				}

				return autocomplete_fill();
			} else
			{
				if (autocomplete.box.css('display') != 'none') autocomplete_close();
			}

			return false;
		}

		function autocomplete_done(unique)
		{
			var from = autocomplete_from();
			if (from != -1)
			{
				var word = $.trim(input.val().substr(from));
				var res = autocomplete.cache[autocomplete.mode][word];
				try
				{
					$.each(res, function(i,v)
					{
						if (v.l == unique)
						{
							var t = input.val().substr(0, from) + unique;
							input.val(t);
							input.setCursorPosition(t.length);
							throw true;
						}
					});
	
				} catch (e){}
			}
			autocomplete_close();
		}


		/* -------------------- Autocompleter end -------------------*/


		function tooltip_help(value)
		{
			if (help.length)
			{
				help.text(value);
				if (value.length)
				{
					help.show();
				} else
				{
					help.hide();
				}
			}
		}


		function need_auth(command)
		{
			return ((!('login' in settings)) && ('auth_required' in command) && (command.auth_required === true));
		}

		function help_func(command)
		{
			if (!command.length)
			{
				var data = [];
				var needed = ['FIND ', 'FIND @', 'BLOG @', '$', 'G', 'FIND B ', 'FIND F ', 'TAG '];
				$.each(needed, function(i, command)
				{
					for (var cmd in settings.commands)
					{
						if (cmd == command)
						{
							var v = settings.commands[cmd];
							var t = ('start_title' in v) ? v['start_title'] : v['title'];
							data.push({l: cmd, t: t, s: ('syntax' in v) ? v['syntax'] : cmd, a: need_auth(settings.commands[cmd]), oc:cmd});

						} else
						{
							var variants = ('variants' in settings.commands[cmd]) ? settings.commands[cmd]['variants'] : [settings.commands[cmd]];
							$.each(variants, function(i, v)
							{
								var u = ('command' in v) ? v['command'] : (('syntax' in v) ? v['syntax'] : i);
								if (u == command)
								{
									var t = ('start_title' in v) ? v['start_title'] : v['title'];
									data.push({l: u, t: t, s: ('syntax' in v) ? v['syntax'] : cmd, a: need_auth(v), oc:cmd});
									return false;
								}
							});
						}
					}
				});
				
				combo.trigger({type:'reset', message: {items: data, mode: 'help_reverse'}});
				return true;
			}

			var params = command.replace(/^\s+/, '').split(' ');
			var cmd = params.shift().toUpperCase();
			if (cmd in settings.aliases) cmd = settings.aliases[cmd];

			if (cmd in settings.commands)
			{
				var data = [];
				var variants = ('variants' in settings.commands[cmd]) ? settings.commands[cmd]['variants'] : [settings.commands[cmd]];
				$.each(variants, function(i, v)
				{
					if (!(('hidden' in v) && v['hidden']))
					{
						var u = ('command' in v) ? v['command'] : (('syntax' in v) ? v['syntax'] : cmd);
						data.push({l: u, t: v['title'], s: ('syntax' in v) ? v['syntax'] : cmd, a: need_auth(v), oc: cmd});
						if ((u == command.toUpperCase()) && ('tooltip' in v)) tooltip_help(v['tooltip']);
					}
				});
				combo.trigger({type:'reset', message: {items: data, mode: 'help_reverse'}});
				return true;

			} else if (cmd == 'HELP')
			{
				var data = [];
				for (var i in settings.commands)
				{
					if (('hidden' in settings.commands[i]) && (settings.commands[i]['hidden'])) continue;
					var item = {l: i, t: settings.commands[i]['title'], c: 'Подробнее о команде ' + i, a: need_auth(settings.commands[i])};
					data.push(item);
				}
				data.push({l: 'HELP', t: 'Выводит это сообщение', c: 'Это вся доступная помощь \'(', a: false});
				combo.trigger({type:'reset', message: {items: data, mode: 'help'}});

				return true;

			} else if (cmd)
			{
				var data = [];
				var rx = new RegExp('^' + cmd.replace('\\', '\\\\'),'i');
				for (var i in settings.commands)
				{
					var variants = ('variants' in settings.commands[i]) ? settings.commands[i]['variants'] : [settings.commands[i]];
					$.each(variants, function(ii,v)
					{
						var u = ('command' in v) ? v['command'] : (('syntax' in v) ? v['syntax'] : i);
						if (('command' in v) && rx.test(v['command']))
						{
							data.push({l: u, t: v['title'], s: ('syntax' in v) ? v['syntax'] : i, a: need_auth(v), oc: i});

						} else if (rx.test(i) && (!('params' in v)))
						{
							data.push({l: u, t: v['title'], s: ('syntax' in v) ? v['syntax'] : i, a: need_auth(v), oc: i});

						} else if (rx.test(v['title']))
						{
							data.push({l: u, t: v['title'], s: ('syntax' in v) ? v['syntax'] : i, a: need_auth(v), oc: i});
						} else if ('keywords' in v)
						{
							var aw = v['keywords'].split(',');
							$.each(aw, function(iii,w)
							{
								if (rx.test(w))
								{
									data.push({l: u, t: v['title'], s: ('syntax' in v) ? v['syntax'] : i, a: need_auth(v), oc: i});
									return false;
								}
							});
						}
					});
				}

				if (data.length)
				{
					combo.trigger({type:'reset', message: {items: data, mode: 'help_reverse'}});
					return true;
				}

			}
			return false;
		};


		function need_help(value, prepend)
		{
			var arglen = arguments.length; 
			//value = $.trim(value);

			if ('combo_timer' in settings)
			{
				clearTimeout(settings.combo_timer);
				delete settings.combo_timer;
			}

			settings.combo_timer = setTimeout(function()
			{
				var show = help_func(value);
				if (!show)
				{
					if (combo.css('display') != 'none') combo.slideToggle('fast');
				} else
				{
					if (arglen > 1) combo.prepend(prepend);
					combo.css('max-height') < combo.height() ? combo.css('overflow-y', 'scroll') : combo.css('overflow-y', 'auto');
					if (combo.css('display') == 'none') combo.slideToggle('fast');
				}

			}, settings.combo_timeout);
		};


		function redirect(url, new_tab)
		{
			new_tab = true;
		//	if (url[0] == '/') url = 'http://smart-lab.ru' + url;

			if (new_tab)
			{
				window.open(url,'_blank');
			} else
			{
				document.location = url;
			}
		}


		function command_func(command)
		{
			var params = $.trim(command).split(' ');

			// $GAZP hack
			if (command[0] == '$')
			{
				params[0] = params[0].substr(1);
				params.unshift('$');
			}

			var cmd = params.shift().toUpperCase();
			if (cmd in settings.aliases) cmd = settings.aliases[cmd];
			if (cmd in settings.commands)
			{
				var ERR_OK = 0;
				var ERR_SYNTAX = 1;
				var ERR_UNKNOWN = 2;
				var ERR_AUTH = 3;

				var err_msg = {};
				err_msg[ERR_SYNTAX] = 'Ошибка синтаксиса.';
				err_msg[ERR_UNKNOWN] = 'Неизвестная команда.';
				err_msg[ERR_AUTH] = 'Необходима авторизация.';

				function notifyStat(sCommand)
				{
					$.get('/console/ajaxCommand', {'command': sCommand, 'line': command});
				}

				function execute(info, sCommand)
				{
					function execute_simple()
					{
						if ('redirect_url' in info)
						{
							if (need_auth(info)) return ERR_AUTH;
							redirect(info['redirect_url']);
							return ERR_OK;

						} else if ('url' in info)
						{
							if (need_auth(info)) return ERR_AUTH;

							var u = info['url'];
							if (u.indexOf('$login') !== -1) u = u.replace('$login', encodeURIComponent(settings.login));
							redirect(u);
							return ERR_OK;

						} else if ('func' in info)
						{
							if (need_auth(info)) return ERR_AUTH;
							var func = (info['func'] in window) ? window[info['func']] : info['func'];
							if (typeof(func)) func.call(window, settings.login);
							return ERR_OK;
						}
						return ERR_SYNTAX;
					}


					if (params.length == 0)
					{
						if (!('params' in info)) return execute_simple();

					} else
					{
						if ('params' in info)
						{
							var param_val = info.params.exec(params.join(' '));
							if (param_val !== null)
							{
								if ('url' in info)
								{
									if (need_auth(info)) return ERR_AUTH;

									var u = info['url'];
									for (var i = 1; i < param_val.length; i++)
									{
										u = u.replace('$'+i, encodeURIComponent(param_val[i]));
									}
									if (u.indexOf('$login') !== -1) u = u.replace('$login', encodeURIComponent(settings.login));
									redirect(u);
									return ERR_OK;

								} else if ('func' in info)
								{
									if (need_auth(info)) return ERR_AUTH;
									var func = (info['func'] in window) ? window[info['func']] : info['func'];
									if (typeof(func)) func.apply(window, param_val.slice(1));
									return ERR_OK;
								}
							}

						} else
						{
							var cmp = ('command' in info) ? info['command'] : (('syntax' in info) ? info['syntax'] : '');
							if (cmp == command.toUpperCase()) return execute_simple();
						}
					}
					return ERR_SYNTAX;
				}

				var res = ERR_UNKNOWN;
				if ('variants' in settings.commands[cmd])
				{
					try
					{
						$.each(settings.commands[cmd]['variants'], function(i, v)
						{
							res = execute(v, cmd);
							if ((res === ERR_OK) || (res === ERR_AUTH)) throw true;
						});

					} catch (e) {}
				} else
				{
					res = execute(settings.commands[cmd], cmd);
				}

				if (res !== ERR_OK)
				{
					need_help(cmd, $('<div class="console_error">' + err_msg[res] + '</div>'));
					return false;
				} else
				{
					notifyStat(cmd);
					return true;
				}

			} else if ((cmd === 'HELP') || (cmd === ''))
			{
				document.location = '/page/help/';
				return true;
			} else
			{
				// Неизвестная команда
				document.location = '/search/topics/?q=' + encodeURIComponent(command);
				return true;
			}
			return false;
		};


		input.on('keydown', function(e)
		{
			switch (e.which)
			{
				case 27:
				{
					if (autocomplete.box.css('display') != 'none')
					{
						autocomplete_close();
						e.preventDefault();

					} else if (combo.css('display') != 'none') combo.slideToggle('fast');
					break;
				}

				case 13:
				{
					if ((autocomplete.box.css('display') == 'none') && (combo.css('display') == 'none'))
					{
						e.preventDefault();

						if ('combo_timer' in settings)
						{
							clearTimeout(settings.combo_timer);
							delete settings.combo_timer;
						}

						if (command_func($(this).val().replace(/^\s+/, ''))) $(this).val('');
						break;

					} 

					// тут идет проверка на открытый попап
				}
				case 38:
				case 40:
				{
					if (autocomplete.box.css('display') != 'none')
					{
						e.preventDefault();
						autocomplete.box.trigger(jQuery.Event('keypress', {keyCode: e.which}));

					} else if (combo.css('display') != 'none')
					{
						e.preventDefault();
						combo.trigger(jQuery.Event('keypress', {keyCode: e.which}));
					}
					break;
				}

				default:
				{
					setTimeout(function(e)
					{
						if (!autocomplete_open()) need_help(input.val());

					}, 1);
					break;
				}
			}

		}).on('change', function(e)
		{
			need_help($(this).val());

		}).on('command', function(e)
		{
			if ('fromPopup' in e)
			{
				if (e.fromPopup == autocomplete.box)
				{
					if (autocomplete.box.css('display') != 'none') autocomplete_done(e.message);

				} else if (e.fromPopup == combo)
				{
					if (combo.css('display') != 'none')
					{
						var cmd = e.message; //$.trim(); - you should not do this
						var command = $(this).val().replace(/^\s+/, '');

						var command_cmd = command.split(' ').shift().toUpperCase();
						if (command_cmd[0] == '$') command_cmd = '$';

						if (command_cmd in settings.aliases)
						{
							command = settings.aliases[command_cmd] + command.substr(command_cmd.length);
							command_cmd = settings.aliases[command_cmd].toUpperCase();
						}


						if (command.substr(0, cmd.length).toUpperCase() == cmd.toUpperCase())
						{
							if (command_cmd in settings.commands)
							{
								if (command.length > cmd.length)
								{
									if (command_func($(this).val())) $(this).val('');
								} else
								{
									var variants = ('variants' in settings.commands[command_cmd]) ? settings.commands[command_cmd]['variants'] : [settings.commands[command_cmd]];
									var input = $(this);
									var bExec = false;

									$.each(variants, function(i,v)
									{
										bExec = false;
										if (!('params' in v))
										{
											if ('command' in v)
											{
												if (v['command'].toUpperCase() == command.toUpperCase()) bExec = true;

											} else if ('syntax' in v)
											{
												if (v['syntax'].toUpperCase() == command.toUpperCase()) bExec = true;

											} else if (command_cmd == cmd) bExec = true;
										}

										if (bExec)
										{
											if (command_func(input.val())) input.val('');
											return false;
										}
									});

									if (!bExec)
									{
										$(this).val(cmd);
										need_help($(this).val());
									}
								}

							} else
							{
								$(this).val(cmd);
								need_help($(this).val());
							}
						} else
						{
							$(this).val(cmd);
							need_help($(this).val());
						}
					}
				}
			}

		}).on('blur', function(e)
		{
			if (autocomplete.box.css('display') != 'none')
			{
				if (!autocomplete.box.attr('mouse_pressed')) autocomplete_close();
			}

			if (combo.css('display') != 'none')
			{
				if (!combo.attr('mouse_pressed')) combo.slideToggle('fast');
			}
			tooltip_help('');

		}).on('focus', function(e)
		{
			if (!$.trim($(this).val()))
			{
				tooltip_help('Напишите, что вы ищете или воспользуйтесь подсказками внизу');
				need_help('', '');
			} else
			{
				need_help($(this).val());
			}
		});

		combo.on('click', 'span.helplink, span.authlink', function(e)
		{
			if ($(this).hasClass('helplink'))
			{
				input.val($(this).text()).focus();
				need_help($(this).text());

			} else if ($(this).hasClass('authlink'))
			{
				if ('login_url' in settings) document.location = settings.login_url;
			}
		});

		combo.smart_console_dropdown({ parent: input, filler: function(mode, item)
		{
			switch (mode)
			{
				case 'help':
				{
					return $('<div><span class="helplink" title="' + item.c + '">' + item.l + '</span> &mdash; <span>' + item.t + '</span>' + (item.a ? ' [<span class="authlink">Необходима авторизация</span>]' : '') + '</div>');
				}

				case 'help_reverse':
				{

					var link = ('oc' in item) ? item.s.replace(item['oc'], '<span class="helplink"' + (('c' in item) ? ' title="' + item.c + '"': '') + '>' + item['oc'] + '</span>') : '<span class="helplink"' + (('c' in item) ? ' title="' + item.c + '"': '') + '>' + item.s + '</span>';
					return $('<div><span>' + item.t + '</span> ' + link + (item.a ? ' [<span class="authlink">Необходима авторизация</span>]' : '') + '</div>');
				}

				default:
				{
					return null;
				}
			}

		}});

		if (autocomplete.box === null)
		{
			autocomplete.box = $('<div class="console_acc_menu"></div>').hide();
			autocomplete.box.insertAfter(input);
			autocomplete.box.smart_console_dropdown({ parent: input, filler: function(mode, item) 
			{
				switch (mode)
				{
					case 'book':
					{
						return $('<div class="dbi"><div class="dbdd"><div>' + item.t + '</div><div>' + item.c + '</div></div></div>');
					}
					case 'wiki':
					case 'tag':
					{
						return $('<div class="dbi"><div class="dbst"><div>' + item.t + '</div></div></div>');
					}
					case 'symbol':
					{
						return $('<div class="dbi"><div class="dbsb"><div>' + item.l + '</div><div>' + item.t + '</div></div></div>');
					}
					default:
					{
						return $('<div class="dbi"><div class="dbid"><img src="' + item.i + '" /></div><div class="dbdd"><div>' + item.t + '</div><div>' + item.c + '</div></div></div>');
					}
				}

			}});
		}

		return self;
	};

})(jQuery);
;
(function($) {


	$.fn.smart_console_dropdown = function(options)
	{
		var self = this;

		options = options || {};
		var settings = {
		
			filler: null,
			parent : null
		};

		if (options) $.extend(settings, options);

		this.on('mousedown', '> div', function(e)
		{
			$('> div', self).removeClass('hilited');
			$(this).addClass('hilited');

			self.attr('mouse_pressed', true);

		}).on('mouseup', '> div', function(e)
		{
			if (self.attr('mouse_pressed'))
			{
				self.removeAttr('mouse_pressed');
				settings.parent.trigger({type: 'command', fromPopup: self, message: $(this).attr('unique')});
				settings.parent.focus();
			}

		}).on('reset', function(e)
		{
			e.preventDefault();

			var selected = $('.hilited', self).attr('unique');
			self.empty();
			self.attr('mode', e.message.mode);

			$.each(e.message.items, function(i,v)
			{
				var d = settings.filler(e.message.mode, v);
				d.attr('unique', v.l);
				self.append(d);
			});

			if (typeof(selected) != 'undefined') self.find('[unique="' + selected + '"]').first().addClass('hilited');
			if (!self.find('.hilited').length) self.find('> div').first().addClass('hilited');

		}).on('keypress', function(e)
		{
			switch (e.keyCode)
			{
				case 38: //up
				{
					var i = self.find('.hilited');
					self.find('> div').removeClass('hilited');
					((i.prev().length) ? i.prev() : self.find('> div:last')).addClass('hilited');
					break;
				}

				case 40: // down
				{
					var i = self.find('.hilited');
					self.find('> div').removeClass('hilited');
					((i.next().length) ? i.next() : self.find('> div:first')).addClass('hilited');
					break;
				}

				case 13: // enter
				{
					var selected = self.find('.hilited');
					settings.parent.trigger({type: 'command', fromPopup: self, message: selected.length ? selected.attr('unique') : null});
					settings.parent.focus();
					break;
				}
			}

			// visible item ?
			if (self.find('.hilited').length)
			{
				var i = self.find('.hilited').get(0);
				var s = self.get(0);

				var ifrom = i.offsetTop;
				var from = s.scrollTop;
				var to = s.scrollTop + s.clientHeight;

				if (from - ifrom > 0) s.scrollTop -= from - ifrom;
				if (to - (ifrom + i.clientHeight) < 0) s.scrollTop -= to - (ifrom + i.clientHeight);
			}
		});
	};
	
})(jQuery);	;
	var console_commands = {
		'FIND': {title: 'Поиск', variants:
				[
					{title: 'Поиск по финсловарю', start_title: 'По словарю', command: 'FIND F ', syntax: 'FIND F искомое', params: /^F\s(.*)$/i, ac: /^F\s([^@]+)$/i, act:'wiki', url: '/search/results/?q=$1&in=articles', tooltip: 'Введите слово'},
					{title: 'Поиск книг', start_title: 'Книгу', command: 'FIND B ', syntax: 'FIND B искомое', params: /^B\s(.*)$/i, ac: /^B\s([^@]+)$/i, act: 'book', url: '/books/book_search?q=$1', tooltip: 'Введите название книги', keywords:'искать книгу,найти книгу'},
					{title: 'Поиск людей', start_title: 'Людей', command: 'FIND @', syntax: 'FIND @login', params: /^\@([0-9a-z\_\-]+)$/i, ac: /^\@(.*)$/i, url: '/search/results/?q=$1&in=users', tooltip: 'Введите логин или имя', keywords:'искать человека,найти человека'},
					{title: 'Поиск по блогам', start_title: 'Текст в блогах', command: 'FIND ', syntax: 'FIND искомое', params: /^(.*)$/, url: '/search/results/?q=$1&in=topics', tooltip: 'Введите текст', keywords: 'искать текст,найти текст'}, // ac: /^([^@]+)$/i, act: 'tag',
					{title: 'Поиск записей трейдера в блогах', command: 'FIND ', syntax: 'FIND искомое@login', params: /^(.*)$/, ac: /(.+)\@(.*)$/i, url: '/search/results/?q=$1&in=topics'}
				]
			},
		'BLOG': {title: 'Блог', variants:
				[
					{title: 'Ваш блог', url: '/my/$login/blog/', auth_required : true, keywords: 'мой блог'},
					{title: 'Блог Романа Андреева', syntax: 'BLOG @RomanAndreev', redirect_url: '/my/RomanAndreev/blog/', keywords: 'Роман Андреев'},
					{title: 'Блог пользователя', start_title: 'Блоги людей', command: 'BLOG @', syntax: 'BLOG @login', params: /^\@([0-9a-z\_\-]+)$/i, ac: /^\@(.*)/i, url: '/my/$1/blog/', tooltip: 'Введите логин или имя'}
				]
			},
		'TAG' : {title: 'Записи по тегу', start_title: 'Теги', command: 'TAG ', syntax: 'TAG тег', params: /^(.*)$/, ac: /^(.*)/i, act: 'tag', url: '/tag/$1/', tooltip: 'Введите тег'},
		'MSG':{title: 'Личная переписка', auth_required : true, variants:
				[
					{title: 'Личное сообщение', command: 'MSG @', syntax: 'MSG @login', params: /^\@([0-9a-z\_\-]+)$/i, ac: /^\@(.*)$/i, func: 'mailto_func', auth_required : true, keywords: 'личное сообщение,написать сообщение,сообщение написать', tooltip: 'Введите имя кому'}
				]
			},

		'ALL':  {title: 'Все блоги подряд', command: 'ALL', syntax: 'ALL или BLOGS', redirect_url: '/allblog/', keywords: 'лента всех постов'},
		'ECO':  {title: 'Календарь всех событий', redirect_url: '/calendar/', keywords: 'календарь'},
		'WIKI': {title: 'Финансовый словарь', variants:
				[
					{title: 'Финансовый словарь', redirect_url: '/finansoviy-slovar/', keywords:'словарь'},
					{title: 'Написать статью в словарь', syntax: 'WIKI ADD', redirect_url: '/finansoviy-slovar/add/', auth_required : true, keywords: 'написать статью в словарь'},
					{title: 'Поиск в финсловаре', command: 'WIKI ', syntax: 'WIKI искомое', params: /^(.*)$/, ac: /^(.*)/i, act: 'wiki', url: '/finansoviy-slovar/$1'}
				]
			},
		'G':	{title: 'Графики онлайн', variants:
				[
					{title: 'Графики любых инструментов', start_title: 'График', redirect_url: '/g/', keywords: 'график'},
					{title: 'Графики онлайн', command: 'G ', syntax: 'G ticker timeframe', params: /^([0-9a-z]+)(?:\s(\d+|H|D|W|M))?$/i, ac: /^([A-Z]+)/i, act: 'symbol', url: '/g/$1/$2/', tooltip: 'Введите тикер инструмента'}
				]
			},

		'Q': {title: 'Котировки', variants:
				[
					{title: 'Котировки акций на МосБирже', redirect_url: '/q/shares/', keywords: 'акции котировки,котировки акций,курс акций'},
					{title: 'Перейти на форум акции', command: 'Q ', syntax: 'Q ticker-акции', params: /^(.*)$/, ac: /^(.*)/i, act: 'forum', url: '/forum/company_go/$1/'} // params: /^([0-9a-z]+)$/i,
				]
			},

		'OIL': {title: 'Нефть: график, запасы, новости', redirect_url: '/oil/', keywords: 'нефть'},
		'B': {title: 'Каталог книг', redirect_url: '/books/', keywords: 'книги'},
		'TOP' : {title: 'Лучше посты смартлаба', redirect_url: '/top/', keywords: 'лучшие посты,рейтинг постов'},
		'SGNL': {title: 'Лента торговых сигналов', redirect_url: '/blog/tradesignals/', keywords: 'лента сигналов,сигналы,торговые сигналы'},
		'TAGS': {title: 'Список всех тегов', redirect_url: '/tags/', keywords: 'теги все'},
		'CORP': {title:'Корпоративные блоги', variants:
				[
					{title: 'Корпоративные блоги', redirect_url: '/company/', keywords: 'брокеры блоги,корпоративные блоги'},
					{title: 'Создать корпоративный блог', syntax:'CORP ADD', redirect_url: '/company/add/', keywords: 'корпоративный блог создать,создать корп блог'},
					{title: 'Корпоративный блог компании', command: 'CORP ', syntax:'CORP название', params: /^(.*)$/, ac: /^(.*)$/i, act: 'company', url: '/company/$1/'}
				]
			},

		'$' : {title: 'Форум компании', start_title: 'Акции компаний', command: '$', syntax: '$название или тикер', params: /^(.*)$/, ac: /^(.*)/i, act: 'forum$', url: '/forum/company_go/$1/', tooltip: 'Введите название компании', keywords: 'искать компанию,найти акцию компании'}, // hardcoded
		
		'FAV' : {title:'Избранное', variants:
				[
					{title: 'Ваши избранные посты', url: '/profile/$login/favourites/', auth_required : true, keywords:'избранное мое,мое избранное'},
					{title: 'Избранное пользователя', command: 'FAV @', syntax: 'FAV @login', params: /^\@([0-9a-z\_\-]+)$/i, ac: /^\@(.*)$/i, url: '/profile/$1/favourites/', tooltip: 'введите имя чтобы посмотреть избранное', keywords:'избранное человека'}
				]
			},

		'FRND': {title:'Френдлента', variants:
				[
					{title: 'Ваша лента друзей', url: '/friends/$login/', auth_required : true, keywords: 'лента друзей,френдлента'},
					{title: 'Френдлента пользователя', command: 'FRND @', syntax: 'FRND @login', params: /^\@([0-9a-z\_\-]+)$/i, ac: /^\@(.*)$/i, url: '/friends/$1/'}
				]
			},

		'LINKS':{title:'Ссылки', variants:
				[
					{title: 'Ваши сохраненные ссылки', url: '/my/$login/tree/links/', auth_required : true, keywords: 'избранные ссылки,мои ссылки'},
					{title: 'Ссылки пользователя', command: 'LINKS @', syntax: 'LINKS @login', params: /^\@([0-9a-z\_\-]+)$/i, ac: /^\@(.*)$/i, url: '/my/$1/tree/links/'}
				]
			},

		'CMT':  {title:'Комментарии', variants:
				[
					{title: 'Ваши комментарии', url: '/my/$login/comment/', auth_required : true, keywords: 'комментарии мои,мои комментарии'},
					{title: 'Комментарии пользователя', command: 'CMT @', syntax: 'CMT @login', params: /^\@([0-9a-z\_\-]+)$/i, ac: /^\@(.*)$/i, url: '/my/$1/comment/'}
				]
			},


		'TV':  {title: 'Лента всех видео', redirect_url: '/smartlab-tv/', keywords: 'видео на смартлабе'},
		'POST':{title: 'Написать пост в свой блог', redirect_url: '/topic/add/', auth_required : true, keywords: 'написать пост,пост написать'},
		'ACC': {title: 'Статистика вашего счета', redirect_url: '/my-trading-account/', auth_required : true, keywords: 'мой счет,статистика счета'},
		'MAIL':{title: 'Личная переписка', auth_required : true, variants:
				[
					{title: 'Личная переписка', command: 'MAIL', syntax: 'MAIL или PM', redirect_url: '/talk/', auth_required : true},
					{title: 'Написать письмо', command: 'MAIL TO @', syntax: 'MAIL TO @login', params: /^TO\s\@([0-9a-z\_\-]+)$/i, ac: /^TO\s\@(.*)$/i, func: 'mailto_func', auth_required : true}
				]
			},

		'CCI':{title: 'Индексы доверия смартлаба', redirect_url: '/consumer-confidence-russia/'},
		'CHAT':{title: 'Секретный клуб', redirect_url: '/chat/', hidden : true},
		'CAT': {title: 'Каталог финансовых услуг', redirect_url: '/page/catalog/'},
		'ADV': {title: 'Размещение рекламы', redirect_url: 'https://smart-lab.ru/blog/mytrading/7053.php'},
		'MAIN':{title: 'Перекидывает на главную', redirect_url: '/'},
		'FINAM':{title: 'Сайт Финам', redirect_url: 'http://www.finam.ru/'},
		'MAP':{title: 'Тепловая карта рынка, форума и блогов', redirect_url: '/q/map/', keywords: 'акции карта рынка,карта рынка'},
		'FLOW':{title: 'Все блоги одним потоком', redirect_url: '/flow/', keywords: 'поток постов всех блогов'},
		'FXPF':{title: 'Графики-онлайн на Forexpf', redirect_url: 'http://www.forexpf.ru/chart/'},
		'NEWS':{title: 'Новости по российским акциям', variants:
			[
				{title: 'Все новости', redirect_url: '/news/', keywords: 'лента новостей,новости'},
				{title: 'Новости по Сбербанку', syntax:'NEWS $SBER', redirect_url: '/forum/news/SBER/'},
				{title: 'Новости по любой компании', syntax:'NEWS $TICKER', params: /^\$([0-9a-z\_\-]+)$/i, ac: /^\$(.*)$/i, act: 'forum', url: '/forum/$1/attached/'}
			]
		},
		'OFFTOP':{title: 'Оффтоп', variants:
			[
				{title: 'Посмотреть раздел ОФФТОП', redirect_url: '/blog/offtop/', keywords: 'оффтоп раздел'},
				{title: 'Написать пост не по теме смартлаба', syntax:'OFFTOP ADD', redirect_url: '/topic/add/?blog_id=4107', keywords:'написать в оффтоп,оффтоп написать', auth_required : true}
			]
		},
		'EVENTS':{title: 'Календарь тусовок', redirect_url: '/calendar/index/party/'},
		'SWITCH':{title: 'Переключить цветовую схему сайта', auth_required : true, variants:
				[
					{title: 'Стандартная тема', syntax: 'SWITCH BLACK', redirect_url: '/settings/theme/black', auth_required : true},
					{title: 'Белая тема', syntax: 'SWITCH WHITE', redirect_url: '/settings/theme/white', auth_required : true, keywords:'сделать смартлаб белым'},
					{title: 'Полностью черная тема', syntax: 'SWITCH FULLBLACK', redirect_url: '/settings/theme/fullblack', auth_required : true, keywords: 'сделать смартлаб полностью черным'},
					{title: 'Оригинальная тема', syntax: 'SWITCH ORIGINAL', redirect_url: '/settings/theme/original', auth_required : true, keywords: 'сделать смартлаб в старой теме'}
				]
			},
		'LINK' : {title: 'Переход по спец-ссылке', command: 'LINK ', syntax: 'LINK name', params: /^(.*)$/, url: '/console/link/$1/'},
		'EXIT':{title: 'Разлогиниться', redirect_url: '/login/exit/', auth_required : true},


		'STOCKS': {title: 'Форум по акциям', redirect_url: '/forum/', keywords: 'акции форум,форум акций'},
		'BONDS': {title: 'Форум по облигациям', redirect_url: '/bonds/', keywords: 'форум облигаций'},
		'FX': {title: 'Форум по Forex', redirect_url: '/forex/', keywords: 'форекс,форум forex'},
		'BANKS': {title: 'Форум по банкам', redirect_url: '/banki/', keywords: 'форум банков'},
		'OPT': {title: 'Форум по опционам', redirect_url: '/options/', keywords: 'опционы форум'},
		'ALGO': {title: 'Форум по торговым роботам', redirect_url: '/algotrading/', keywords: 'алготрейдинг форум,торговые роботы форум'},
		'BROK': {title: 'Рейтинг брокеров и отзывы', redirect_url: '/brokers-rating/', keywords: 'брокеры,выбрать брокера,рейтинг брокеров'},

		'ECOS': {title: 'Календарь событий по акциям', redirect_url: '/calendar/stocks/', keywords: 'акции календарь,календарь акций'},
		'FA': {title: 'Фундаментальный анализ акций', redirect_url: '/q/shares_fundamental/', keywords: 'акции фунд.анализ,мультипликаторы компаний,фундаментальный анализ акций'},
		'QBO': {title: 'Котировки облигаций', redirect_url: '/q/ofz/', keywords: 'бонды котировки,котировки ОФЗ,облигации ОФЗ,ОФЗ'},
		'BROKG': {title: 'Рейтинг глобальных брокеров', redirect_url: '/brokers-rating/global/', keywords: 'брокеры Глобальные'},
		'BROKR': {title: 'Рейтинг российских брокеров', redirect_url: '/brokers-rating/russia/', keywords: 'брокеры Россия'},
		'BROKF': {title: 'Рейтинг форекс брокеров', redirect_url: '/brokers-rating/forex/', keywords: 'брокеры Forex'},
		'ASK': {title: 'Задать вопрос на смартлабе', redirect_url: '/vopros/add/', keywords: 'вопрос задать,задать вопрос', auth_required : true},
		'ANSWER': {title: 'Лента всех вопросов', redirect_url: '/vopros/', keywords: 'вопросы лента,лента вопросов,ответы на вопросы'},
		'W': {title: 'Ваши портфели (portfolio)', auth_required : true,  variants:[
			{title: 'Ваш портфели (portfolio)', command: 'W', redirect_url: '/q/portfolio', keywords: 'портфолио,мое портфолио,портфель,списки акций мои,portfolio', auth_required : true},
			{title: 'Создать портфель', command: 'W ADD', syntax: 'W ADD', func: 'new_portfolio_func', keywords: 'создать портфель,создать портфолио', auth_required : true},
		]},
		'DIV': {title: 'Таблица дивидендов и даты отсечек', redirect_url: '/dividends/', keywords: 'дивиденды,закрытие реестров дивиденды,календарь дивидендов,реестр дивидендов'},
		'DIVR': {title: 'Информация о поступивших дивидендах', redirect_url: '/forum/Поступление%20дивидендов/', keywords: 'дивиденды поступление,поступление дивидендов'},

		'QBE': {title: 'Котировки еврооблигаций', redirect_url: '/q/eurobonds/', keywords: 'еврооблигации,котировки еврооблигаций'},
		'REG': {title: 'Календарь отсечек по акциям', redirect_url: '/calendar/index/stocks_otsechka', keywords: 'закрытие реестров календарь'},
		'PICS': {title: 'Лента всех картинок', redirect_url: '/pics/', keywords: 'картинки,лента картинок'},
		'BR': {title: 'Книжные рецензии', variants:[

			{title: 'Лента книжных рецензий', syntax: 'BR', redirect_url: '/blog/reviews/', keywords: 'книги рецензии,рецензии книг'},
			{title: 'Написать отзыв к книге', syntax: 'BR ADD', redirect_url: '/review/add/', keywords: 'написать рецензию на книгу,рецензия написать', auth_required : true}
		]},
		
		'TOPB': {title: '100 лучших книг', redirect_url: '/books/top/', keywords: 'книги топ-100,рейтинг книг'},
		'CMTS': {title: 'Лента всех комментариев', redirect_url: '/comments/', keywords: 'комментарии все,лента комментариев'},
		'CMTME': {title: 'Комментарии к вашим постам', redirect_url: '/my/$login/comment-to-me/', auth_required : true, keywords: 'комментарии к моим постам'},
		'QA': {title: 'Котировки АДР', redirect_url: '/q/adr/', keywords: 'котировки АДР'},
		'QW': {title: 'Котировки мировых индексов и Forex', redirect_url: '/q/world-quotes/', keywords: 'котировки мировые,курсы валют'},
		'QBC': {title: 'Котировки корпоративных облигаций', redirect_url: '/q/bonds/', keywords: 'котировки облигаций корп,облигации корпоративные'},
		'QBS': {title: 'Котировки облигаций субъектов РФ', redirect_url: '/q/subfed/', keywords: 'котировки облигаций субфед,облигации субъектов'},
		'QR': {title: 'Котировки валютного рынка Мосбиржи', redirect_url: '/q/currencies/', keywords: 'котировки рубля,курсы рубля'},
		'QF': {title: 'Котировки срочного рынка Мосбиржи', redirect_url: '/q/futures/', keywords: 'котировки фьючерсов'},
		'FORUMS': {title: 'Все записи форумов подряд', redirect_url: '/forums/', keywords: 'лента форумов,форумы лента'},
		'READS': {title: 'Самые полезные статьи (выбор редактора)', redirect_url: '/tradingreads/', keywords: 'лучшие статьи за все время,нетленка,трейдинг лучшие статьи'},
		'PEOPLE': {title: 'Все пользователи смартлаба', redirect_url: '/people/', keywords: 'люди,рейтинг блогеров,трейдеры все'},
		'MOB': {title: 'Переключиться на мобильную версию', redirect_url: '/mobile/', keywords: 'мобильная версия'},
		'BL': {title: 'Ваш черный список', redirect_url: '/blacklist/', keywords: 'мой черный список,черный список,чс', auth_required : true},
		'FORUMMY': {title: 'Ваши сообщения на форумах', redirect_url: '/my/$login/comment-forum/', keywords: 'мои сообщения на форуме', auth_required : true},
		'BOOKSDONE': {title: 'Книги, которые вы прочли и оценили', redirect_url: '/books/reviewed_by/$login/', keywords: 'мои прочитанные книги', auth_required : true},
		'REPORTS': {title: 'Таблица последних отчетов по МСФО', redirect_url: '/q/shares_fundamental3?&type=MSFO', keywords: 'мсфо'},
		'SETPROFILE': {title: 'Настройки вашего профиля', redirect_url: '/settings/profile/', keywords: 'настройки профиля', auth_required : true},
		'SETTINGS': {title: 'Настройки ваших уведомлений', redirect_url: '/settings/notifications/', keywords: 'настройки уведомлений', auth_required : true},
		'QBI': {title: 'Индексы российских облигаций', redirect_url: '/q/index_bonds/', keywords: 'облигации индексы'},
		'ECOB': {title: 'Календарь событий по облигациям', redirect_url: '/calendar/bonds/', keywords: 'облигации календарь'},

		'POLL': {title: 'Опросы', variants:[

			{title: 'Создайте опрос', syntax:'POLL ADD', redirect_url: '/question/add/', keywords: 'опрос создать', auth_required : true}

		]},

		'REPLY': {title: 'Ответы на мои комментарии', redirect_url: '/my/$login/reply-to-me/', keywords: 'ответы на мои комментарии', auth_required : true},
		'FREPLY': {title: 'Ответы мне на форуме', redirect_url: '/my/$login/reply-to-me-forum/', keywords: 'ответы мне на форуме', auth_required : true},
		'RULES': {title: 'Правила смартлаба', redirect_url: '/blog/mytrading/5161.php', keywords: 'правила смартлаба'},
		'FORUMERS': {title: 'Рейтинг участников форума', redirect_url: '/people/all/order_by_stocks/desc/', keywords: 'рейтинг форумчан'},
		'READERS': {title: 'Рейтинг читателей книг', redirect_url: '/people/all/order_by_books/desc/', keywords: 'рейтинг читателей'},
		'RAS': {title: 'Таблица последних отчетов по РСБУ', redirect_url: '/q/shares_fundamental3?&type=RSBU', keywords: 'рсбу'},
		'SOFT': {title: 'Форум софта для трейдинга', redirect_url: '/trading-software/', keywords: 'торговый софт'},

		

		

		

		

	};

	var console_aliases = {'1': 'POST', '2': 'BLOG', '3': 'CMT', '4' : 'LINKS', '5' : 'FAV', '6' : 'ACC', '7' : 'FRND', 'BLOGS':'ALL', 'PM' : 'MAIL', '/' : 'MAIN', 'PPL' : 'PEOPLE'};
	window['mailto_func'] = function(login)
	{
		window.open('/talk/add/?talk_users=' + encodeURIComponent(login), '_blank');
	};


	window['new_portfolio_func'] = function(login)
	{
		if (!('cachedScript' in jQuery))
		{
			jQuery.cachedScript = function( url, options )
			{
				// Allow user to set any option except for dataType, cache, and url
				options = jQuery.extend( options || {},
				{
					dataType: "script",
					cache: true,
					url: url
				});
				// Use $.ajax() since it is more flexible than $.getScript
				// Return the jqXHR object so we can chain callbacks
				return jQuery.ajax( options );
			};
		}

		jQuery.cachedScript('/plugins/trade/templates/skin/default/actions/ActionQ/js/portfolio.js').done(function( script, textStatus )
		{
			var od = $;
			$ = jQuery;
			AddPortfolioEvent('Создание нового списка', 'add_list').then(function(sMsgTitle, sMsg, iListId, sListTitle)
			{
				msgNoticeBox.alert(sMsgTitle, sMsg);
				if (typeof(CURRENT_USER_LOGIN) != 'undefined')
				{
					setTimeout(function(e)
					{
						document.location.href = '/q/portfolio/' + encodeURIComponent(CURRENT_USER_LOGIN) + '/' + iListId + '/';
					}, 1000);
				}

			}, function(sMsgTitle, sMsg)
			{
				msgErrorBox.alert(sMsgTitle, sMsg);

			}).always(function()
			{
				$ = od;
			});
		});
	};
(function ($)
	{
		$(document).ready(function()
		{
			var symbols = [];
			function success(data)
			{
				//console.log(data.short_name, data.original_name);
				var tr = $('.trade tr[tkr="' + data.original_name.replace(':', '.') + '"]');
				if (tr.length)
				{
					var chg = (Math.round(parseFloat(data.change_percent) * 10) / 10);
					var val = parseFloat(data.last_price);
					
					switch (data.original_name)
					{
						case 'CME_MINI_DL:ES1!':
						case 'BITSTAMP:BTCUSD':
						case 'FX_IDC:USDRUB':
						case 'FX_IDC:XAUUSD':
						{
							val = val.toFixed(1);
							break;
						}

						case 'FX:USDJPY':
						case 'FX_IDC:USDBRO':
						case 'FX_IDC:XAGUSD':
						{
							val = val.toFixed(2);
							break;
						}						

						case 'EUSTX50':
						case 'UK100':
						case 'OANDA:DE30EUR':
						case 'FRA40':
						case 'SHCOMP':
						case 'ESP35':
						case 'OANDA:JP225USD':
						case 'OANDA:EU50EUR':
						case 'AUS200':
						{
							val = val.toFixed(0);
							break;
						}

						case 'OANDA:CN50USD':
						{
							val = Math.round(data.last_price);
							break;
						}

						default:
						{
							val = val.toFixed(4);
							break;
						}
					}
					

					$($('td', tr)[1]).text(val.toString().replace('.', ','));
					$($('td', tr)[2]).text(((chg > 0) ? '+' : '') + chg.toString().replace('.', ',') + '%');
					if (chg < 0)
					{
						$($('td', tr)[2]).addClass('down');

					} else
					{
						$($('td', tr)[2]).removeClass('down');
					}
				}
			}

			if ($('.trades').length)
			{
				$.ajax({url: 'https://s3.tradingview.com/tv.js', dataType: 'script', cache: true}).done(function()
				{
					$('.trade tr[tkr]').each(function(i, el)
					{
						symbols.push({'symbol' : ($(el).attr('tkr')).replace('.', ':'), success: success, error : function(){}});
					});

					if (symbols.length)
					{
						new TradingView.QuotesProvider({container_id: 'hif', symbols:symbols});
					};
				});
			}
		});

	})(jQuery);
(function(b){function a(){b('<div id="abuse_dialog_tpl" style="display: none;"><div id="abuse_dialog"><fieldset class="abuse_title"><legend>Текст жалобы (до 60 символов):</legend><textarea id="abuse_text" maxlength="64"></textarea></fieldset></div></div>').appendTo(b("body"));
var c=b("#abuse_dialog");function d(g,h){var f={topic:"топик",comment:"комментарий",profile:"профиль"};var e=new jBox("Confirm",{id:"abuseDialog",title:"Пожаловаться на "+(h in f?f[h]:" жизнь"),confirmButton:"ОК",cancelButton:"Отмена",content:c,confirm:function(){var j=this;
var k={targetId:g,targetType:h,security_ls_key:LIVESTREET_SECURITY_KEY};var i=c.find("textarea#abuse_text");if(i.length){k.text=i.val();}b.post("/abuse/abuse_ajax/",k,function(l,m){if(!l){msgErrorBox.alert("Error","Please try again later");
}if(l.bStateError){msgErrorBox.alert(l.sMsgTitle,l.sMsg);}else{msgNoticeBox.alert(l.sMsgTitle,l.sMsg);}});},onOpen:function(){var i=c.find("textarea#abuse_text");
i.val("");},onCloseComplete:function(){this.destroy();}});e.open();}window.abuse=d;}b(document).ready(function(){if(typeof(CURRENT_USER_ID)!=="undefined"){a();
}});})(jQuery);
(function(a){a(document).ready(function(){window.ban=function(h){var f=a("#user_ban_dialog");var g={id:"userBanDialog",title:"Предупреждение пользователя",confirmButton:"ОК",cancelButton:"Отмена",content:f,confirm:function(){var i=this;
var m={userLogin:h,security_ls_key:LIVESTREET_SECURITY_KEY};var l=f.find('input[name="time"]');l.each(function(o,n){if(n.checked){m.time=n.value;}});var j=f.find('input[name="time_value"]');
if(j.length){m.time_value=j.val();}var k=f.find('input[name="reason"]');k.each(function(o,n){if(n.checked){m.reason=n.value;}});var j=f.find('input[name="reason_value"]');
if(j.length){m.reason_value=j.val();}a.ajax({url:"/profile/ajaxwarning/",type:"POST",data:m}).then(function(n){if(!n){msgErrorBox.alert("Error","Please try again later");
}if(n.bStateError){msgErrorBox.alert(n.sMsgTitle,n.sMsg);}else{document.location.reload();}});},onOpen:function(){var i=f.find('input[name="time"]');i.each(function(l,k){k.checked=false;
});i[0].checked=true;var j=f.find('input[name="reason"]');j.each(function(l,k){k.checked=false;});j[10].checked=true;f.on("click",function(k){f.find('input[name="time"]').each(function(m,l){if(l.checked){var n=f.find('input[name="time_value"]');
if(n.length){n[0].disabled=(l.value!="limited");}}});f.find('input[name="reason"]').each(function(m,l){if(l.checked){var n=f.find('input[name="reason_value"]');
if(n.length){n[0].disabled=(l.value!="0");}}});});},onClose:function(){f.off("click");},onCloseComplete:function(){this.destroy();}};var e=null;a.ajax({url:aRouter.profile+"ajaxwarning/",type:"GET",data:{userLogin:h,security_ls_key:LIVESTREET_SECURITY_KEY}}).then(function(i){if(!i.bStateError){if(a("#user_ban_dialog_tpl").length){a("#user_ban_dialog_tpl").remove();
}a("body").append(a(i.sHtml));f=a("#user_ban_dialog");g.content=f;e=new jBox("Confirm",g);e.open();}else{msgErrorBox.alert(i.sMsgTitle,i.sMsg);}});};window.unban=window.unwarn=function(e){var f={userLogin:e,security_ls_key:LIVESTREET_SECURITY_KEY};
a.ajax({url:"/profile/ajaxwarningclear/",type:"POST",data:f}).then(function(g){if(!g){msgErrorBox.alert("Error","Please try again later");}if(g.bStateError){msgErrorBox.alert(g.sMsgTitle,g.sMsg);
}else{if(g.sMsgTitle){msgNoticeBox.alert(g.sMsgTitle,g.sMsg);setTimeout(function(){document.location.reload();},1000);}else{document.location.reload();
}}});};var c=a("#login_pn");if(c){var d=a('<span title="IP адреса пользователя">(X)</span>').css({display:"inline-block",verticalAlign:"middle",marginLeft:"1em",cursor:"pointer",color:"#868894",fontSize:"16px",fontWeight:"normal"}).click(function(g){g.preventDefault();
var f=a("#login_ipn");if(f){f.css("display",(f.css("display")=="block")?"none":"block");}return false;}).appendTo(c);var b=a('<span title="Забанить или предупредить юзера">(Б)</span>').css({display:"inline-block",verticalAlign:"middle",marginLeft:"0.2em",cursor:"pointer",color:"#868894",fontSize:"16px",fontWeight:"normal"}).click(function(h){h.preventDefault();
var g=document.getElement('link[rel="canonical"]');if(g){var f=g.href.match(/\/profile\/([\da-z0-9\_\-]+)/i);if(f){window.ban(f[1]);}}return false;}).appendTo(c);
}});})(jQuery);
