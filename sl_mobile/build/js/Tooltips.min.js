class Tooltips{constructor(t={}){this.attach=t.attach??".smart-tooltip",this.openTrigger=t.openTrigger??"mouseenter",this.closeTrigger=t.closeTrigger??"mouseleave",this.content=t.content??"title",this.contentSource=t.contentSource??null,this.setContent=t.setContent??null,this.offset=t.offset??"",this.hasPointer=t.hasPointer??!0,this.pointerSize=t.pointerSize??"",this.maxWidth=t.maxWidth??null,this.width=t.width??null,this.posMod={},this.posMod.x=t.posMod?.x??"center",this.posMod.y=t.posMod?.y??"auto",this.hMargin=t.hMargin??10,this.textAlign=t.textAlign??"",this.theme=t.theme,this.timeout=t.timeout??500,this.classMod={},this.isOpen=!1,this.isFirstOpen=!0,this.isTouch="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,this._init()}_init(){if(this.targets=document.querySelectorAll(this.attach),!this.targets.length)throw`Не найдены ноды по селектору ${this.attach}`;if(this.el=document.createElement("div"),this.el.className="js-tooltip",this.el.innerHTML='<div class="js-tooltip__container"></div> <div class="js-tooltip__pointer js-tooltip__pointer--bottom"></div>',document.body.append(this.el),this.container=this.el.querySelector(".js-tooltip__container"),this.pointer=this.el.querySelector(".js-tooltip__pointer"),this.theme&&this.el.classList.add(`js-tooltip-${this.theme}`),this.contentSource&&"string"==typeof this.contentSource){const t=document.querySelector(this.contentSource);if(!t)throw`По селектору ${this.contentSource} не найден блок для наполнения тултипа`;this.contentSourceEl=t}if(this.isTouch&&(this.openTrigger="click"),this.targets.forEach((t=>{"title"===this.content&&(t.dataset[this.content]=t.getAttribute(this.content)??"",t.removeAttribute(this.content),this.maxWidth??=280,this.el.style.maxWidth=this.maxWidth+"px");t.addEventListener(this.openTrigger,(t=>{const e=t.target.closest(this.attach);if("mouseenter"===t.type)return e.isTooltipMouseEnter=!0,void setTimeout((()=>{e.isTooltipMouseEnter&&(console.log({closestAttach:e}),console.log(e.isTooltipMouseEnter),this.open(e))}),this.timeout);const s=this.target;this.close(),s!=e&&this.open(e)})),"click"===this.openTrigger&&(this.closeTrigger="click"),"mouseleave"===this.closeTrigger&&t.addEventListener(this.closeTrigger,(e=>{t.isTooltipMouseEnter=!1,this.close()}))})),"mouseleave"!==this.closeTrigger){const t=this.attach;document.documentElement.addEventListener("click",(e=>{e.target.closest(t)||e.target.closest(".js-tooltip")||this.close()}))}window.addEventListener("resize",(()=>{this.isOpen&&this.close()})),this._setProperty()}open(t){console.log("open"),this.target=t;let e="";if(this.setContent&&"function"==typeof this.setContent)e='\n      <div class="js-tooltip__content spinner-loader" role="status">\n        <div class="spinner-loader__ring"></div>\n        <span class="spinner-loader__label">Загружаем...</span>\n      </div>',this._setContent(t);else if(this.contentSourceEl)e=this.contentSourceEl.outerHTML;else if("title"===this.content){t.dataset[this.content]&&(e=`<div class="js-tooltip__content">${t.dataset[this.content]}</div>`)}else this.content&&(e=this.content);e&&(this.container.innerHTML=e,this._calcPos(t),this._modClasses(),this.show())}close(){console.log("close"),this.target=null,this.hide(),this._clearPos()}show(){this.el.classList.add("js-tooltip--shown"),setTimeout((()=>{this.isOpen=!0}),100)}hide(){this.el.classList.remove("js-tooltip--shown"),setTimeout((()=>{this.isOpen=!1}),100)}async _setContent(t){if(!this.setContent||"function"!=typeof this.setContent)return;const e=await this.setContent(t);e&&(this.close(),this.container.innerHTML=e,setTimeout((()=>{this._calcPos(t),this._modClasses(),this.show()}),this.timeout))}_calcPos(t){this.width&&(this.posMod.x="auto");const e=document.documentElement.clientWidth,s=t.getBoundingClientRect();this.hasPointer&&(this.pointer.style.left="");const i=window.scrollY;let o=this.el.offsetWidth,h=this.el.offsetHeight+(this.isFirstOpen?this.offset:0);this.isFirstOpen=!1;let n="auto",l="auto",r="auto",a="auto";s.top<h&&"auto"===this.posMod.y||"under"===this.posMod.y?(()=>{this.classMod.y="under",n=Math.ceil(s.bottom+i)})():(()=>{this.classMod.y="above",n=Math.ceil(s.top-h+i)})();const c=()=>Math.ceil(s.left-(o-s.width)/2),p=()=>c()+o;var d=(t="")=>{if(a="auto","auto"===t&&c()<this.hMargin)return u();p();return s.right<o-this.hMargin&&(a=this.hMargin),this.hasPointer&&o>s.width&&setTimeout((()=>{this.pointer.style.left=this.el.offsetWidth-(s.width/2+this.pointerSize)+"px"}),50),l=e-s.right},u=(t="")=>(l="auto","auto"===t&&p()>e-this.hMargin?d():(s.left+o>e-this.hMargin&&(l=this.hMargin+"px"),this.hasPointer&&o>s.width&&setTimeout((()=>{this.pointer.style.left=s.width/2-this.pointerSize+"px"}),50),a=s.left));const g=()=>{l="auto";const t=c();return p()>e-this.hMargin?d():t<this.hMargin?u():a=t};switch(this.posMod.x){case"left":u();break;case"left-auto":u("auto");break;case"right":d();break;case"right-auto":d("auto");break;default:g()}this.el.style.top="string"==typeof n?n:n+"px",this.el.style.right="string"==typeof l?l:l+"px",this.el.style.bottom=r,this.el.style.left="string"==typeof a?a:a+"px"}_clearPos(){this.el.style.top="",this.el.style.right="",this.el.style.bottom="",this.el.style.left=""}_modClasses(){switch(this.el.classList.remove("js-tooltip--top","js-tooltip--bottom"),this.pointer.classList.remove("js-tooltip__pointer--top","js-tooltip__pointer--bottom"),this.classMod.y){case"above":this.el.classList.add("js-tooltip--top"),this.pointer.classList.add("js-tooltip__pointer--bottom");break;case"under":this.el.classList.add("js-tooltip--bottom"),this.pointer.classList.add("js-tooltip__pointer--top")}}_setProperty(){this.offset?this.el.style.setProperty("--offset",this.offset):this.offset=parseFloat(window.getComputedStyle(this.el).getPropertyValue("--offset"))??12,this.hasPointer?this.pointerSize?this.el.style.setProperty("--pointer-size",this.pointerSize+"px"):this.pointerSize=parseFloat(window.getComputedStyle(this.el).getPropertyValue("--pointer-size"))??"":this.pointer.style.display="none",this.textAlign&&(this.el.style.textAlign=this.textAlign),this.maxWidth&&(this.el.style.maxWidth="string"==typeof this.maxWidth?this.maxWidth:this.maxWidth+"px"),this.width&&(this.el.style.width="string"==typeof this.width?this.width:this.width+"px")}_isMouseOverElement(t){const e=element.getBoundingClientRect();return t.clientX>=e.left&&t.clientX<=e.right&&t.clientY>=e.top&&t.clientY<=e.bottom}}